<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/src/axesim/nicback_utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/src/axesim/nicback_utils.c File Reference</h1><code>#include &lt;gsl/gsl_vector.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_multifit_nlin.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_matrix.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="aXe__grism_8h_source.html">aXe_grism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="aXe__utils_8h_source.html">aXe_utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spc__FITScards_8h_source.html">spc_FITScards.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spce__sect_8h_source.html">spce_sect.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spce__fitting_8h_source.html">spce_fitting.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spce__is__in_8h_source.html">spce_is_in.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spc__back_8h_source.html">spc_back.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spce__pathlength_8h_source.html">spce_pathlength.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="trfit__utils_8h_source.html">trfit_utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nicback__utils_8h_source.html">nicback_utils.h</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenickback__utils.html">nickback_utils</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a9342e0a07b86a22d5d66f05d0e4b8ae0">make_nicmos_back</a> (const <a class="el" href="structobservation.html">observation</a> *const obs, const char *msk_name, const char *master_bck, char bck_name[], char plist_name[], const char corr_bck[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#ab52b28abe12e4b0ac525cc5cbbddaaff">alloc_fitbck_data</a> (const int n_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#afba22b93224b6f161189d9dd72ec476a">get_skypix_frac</a> (const <a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a9918a17ac8953bd066cfebd20ad5c06e">compute_nicmos_back</a> (const gsl_matrix *mbck_img, const double factor, const double offset, const gsl_matrix *corr_img)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_vector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a759a87323afd2c28ba9796698ff4e53b">make_ksig_linfit</a> (<a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#aca6b3d4156c6ee05da065b49242e0fbb">check_fbck_data</a> (<a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_vector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a9bc21cd51c17da1e981a93f7d41873ce">get_fbck_defaults</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a601af82b7d386fc678ed78772bd72f31">clipp_fbck_data</a> (<a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data, const gsl_vector *lfit, const float kappa)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#ab2885f4df15e7ad912a28b9c84e5edca">comp_stdev_from_array</a> (const double *data, const int ndata, const double mean)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#a0c83d0f59622e62084c934e8c61d91dc">fill_fbck_data</a> (const <a class="el" href="structobservation.html">observation</a> *const obs, const gsl_matrix *msk_img, const gsl_matrix *mbck_img, <a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data, char plist_name[], const gsl_matrix *corr_img)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nicback__utils_8c.html#aea8c23d52efddd074ca3abc3f7c59c75">free_fitbck_data</a> (<a class="el" href="structfitbck__data.html">fitbck_data</a> *fbck_data)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab52b28abe12e4b0ac525cc5cbbddaaff"></a><!-- doxytag: member="nicback_utils.c::alloc_fitbck_data" ref="ab52b28abe12e4b0ac525cc5cbbddaaff" args="(const int n_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfitbck__data.html">fitbck_data</a>* alloc_fitbck_data </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>n_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: alloc_fitbck_data </p>

<p><div class="fragment"><pre class="fragment"><a name="l00146"></a>00146 {
<a name="l00147"></a>00147   <a class="code" href="structfitbck__data.html">fitbck_data</a> *fbck_data;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   fbck_data = (<a class="code" href="structfitbck__data.html">fitbck_data</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structfitbck__data.html">fitbck_data</a>));
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a> = (<span class="keywordtype">double</span> *)malloc(n_data * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00152"></a>00152   fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a> = (<span class="keywordtype">double</span> *)malloc(n_data * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00153"></a>00153   fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a> = (<span class="keywordtype">double</span> *)malloc(n_data * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00154"></a>00154   fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a> = (<span class="keywordtype">int</span> *)malloc(n_data * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00155"></a>00155   fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a> = (<span class="keywordtype">int</span> *)malloc(n_data * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a> = n_data;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   <span class="keywordflow">return</span> fbck_data;
<a name="l00160"></a>00160 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca6b3d4156c6ee05da065b49242e0fbb"></a><!-- doxytag: member="nicback_utils.c::check_fbck_data" ref="aca6b3d4156c6ee05da065b49242e0fbb" args="(fitbck_data *fbck_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_fbck_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00315"></a>00315 {
<a name="l00316"></a>00316   <span class="keywordtype">int</span> check=1;
<a name="l00317"></a>00317   <span class="keywordtype">int</span> ix_min=60000;
<a name="l00318"></a>00318   <span class="keywordtype">int</span> ix_max=0;
<a name="l00319"></a>00319   <span class="keywordtype">int</span> iy_min=60000;
<a name="l00320"></a>00320   <span class="keywordtype">int</span> iy_max=0;
<a name="l00321"></a>00321   <span class="keywordtype">int</span> index;
<a name="l00322"></a>00322   <span class="keywordtype">double</span> frac;
<a name="l00323"></a>00323   <span class="keywordtype">double</span> x_ext, y_ext;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="comment">// get the fraction of background pixel</span>
<a name="l00326"></a>00326   frac =  <a class="code" href="nicback__utils_8c.html#afba22b93224b6f161189d9dd72ec476a">get_skypix_frac</a>(fbck_data);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="keywordflow">if</span> (frac &lt; <a class="code" href="nicback__utils_8h.html#a337a6457ce9a7b8f609a3de19f1632ef">FRAC_BPIX_MIN</a>)
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330       check = 0;
<a name="l00331"></a>00331       fprintf(stdout, <span class="stringliteral">&quot;aXe_NICBACK: Not enough background pixels. Fraction: %e\n&quot;</span>, frac);
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333   <span class="keywordflow">else</span>
<a name="l00334"></a>00334     {
<a name="l00335"></a>00335       <span class="comment">// go over all data values</span>
<a name="l00336"></a>00336       <span class="keywordflow">for</span> (index=0; index &lt; fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>; index++)
<a name="l00337"></a>00337         {
<a name="l00338"></a>00338           <span class="comment">// check whether the weight is not NULL</span>
<a name="l00339"></a>00339           <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index])
<a name="l00340"></a>00340             {
<a name="l00341"></a>00341               <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>[index] &gt; ix_max)
<a name="l00342"></a>00342                 ix_max = fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>[index];
<a name="l00343"></a>00343               <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>[index] &lt; ix_min)
<a name="l00344"></a>00344                 ix_min = fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>[index];
<a name="l00345"></a>00345               <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>[index] &gt; iy_max)
<a name="l00346"></a>00346                 iy_max = fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>[index];
<a name="l00347"></a>00347               <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>[index] &lt; iy_min)
<a name="l00348"></a>00348                 iy_min = fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>[index];
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351       x_ext = (float)(ix_max-ix_min) / <a class="code" href="nicback__utils_8h.html#a6058062c12690aaa72e7570e0faba72f">NPIX_DIM1</a>;
<a name="l00352"></a>00352       y_ext = (float)(iy_max-iy_min) / <a class="code" href="nicback__utils_8h.html#a7a21219ee2a04bcf0b575e85b6484850">NPIX_DIM2</a>;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       <span class="keywordflow">if</span> (x_ext &lt; <a class="code" href="nicback__utils_8h.html#a0e656ea2d74900366a853a139715b841">AREA_EXTEND_MIN</a> || y_ext &lt; <a class="code" href="nicback__utils_8h.html#a0e656ea2d74900366a853a139715b841">AREA_EXTEND_MIN</a>)
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356           check = 0;
<a name="l00357"></a>00357           fprintf(stdout, <span class="stringliteral">&quot;aXe_NICBACK: Not enough coverage. xcover,ycover: %e,%e\n&quot;</span>, x_ext, y_ext);
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keywordflow">return</span> check;
<a name="l00362"></a>00362 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a601af82b7d386fc678ed78772bd72f31"></a><!-- doxytag: member="nicback_utils.c::clipp_fbck_data" ref="a601af82b7d386fc678ed78772bd72f31" args="(fitbck_data *fbck_data, const gsl_vector *lfit, const float kappa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int clipp_fbck_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_vector *&nbsp;</td>
          <td class="paramname"> <em>lfit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&nbsp;</td>
          <td class="paramname"> <em>kappa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: clipp_fbck_data The subroutine applies kappa-sigma clipping to a set of data points. The difference between the measured values and the expected values according to linear regression are determined. Data which is outside of the accepted interval is excluded by setting the weight to '0.0'. If at least one value was clipped, '1' is returned, otherwise '0' (if all values are within the accepted interval.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fbck_data</em>&nbsp;</td><td>- the data used for the fits </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lfit</em>&nbsp;</td><td>- the result of the fit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>kappa</em>&nbsp;</td><td>- the kappa value</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>clipped - boolean to indicate clipped values </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00412"></a>00412 {
<a name="l00413"></a>00413   <span class="keywordtype">int</span> clipped=0;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="keywordtype">int</span> ndata=0;
<a name="l00416"></a>00416   <span class="keywordtype">int</span> index;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <span class="keywordtype">double</span> dy_mean=0.0;
<a name="l00419"></a>00419   <span class="keywordtype">double</span> stdev=0.0;
<a name="l00420"></a>00420   <span class="keywordtype">double</span> absdev;
<a name="l00421"></a>00421   <span class="keywordtype">double</span> dy_act;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="keywordtype">double</span> *y_diff;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="comment">// allocate memory for the tmp-vector</span>
<a name="l00426"></a>00426   y_diff = (<span class="keywordtype">double</span> *) malloc(fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <span class="comment">// go over all data values</span>
<a name="l00429"></a>00429   <span class="keywordflow">for</span> (index=0; index &lt; fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>; index++)
<a name="l00430"></a>00430     {
<a name="l00431"></a>00431       <span class="comment">// check whether the weight is not NULL</span>
<a name="l00432"></a>00432       <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index])
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434           <span class="comment">// compute the difference from the data point</span>
<a name="l00435"></a>00435           <span class="comment">// to the prediction from the fit</span>
<a name="l00436"></a>00436           dy_act = (fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a>[index] - gsl_vector_get(lfit, 0)) * gsl_vector_get(lfit, 2)
<a name="l00437"></a>00437             + gsl_vector_get(lfit, 1)-fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a>[index];
<a name="l00438"></a>00438 
<a name="l00439"></a>00439           <span class="comment">// fill the tmp vector</span>
<a name="l00440"></a>00440           y_diff[ndata] = dy_act;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442           <span class="comment">// pre-comute the mean</span>
<a name="l00443"></a>00443           dy_mean += dy_act;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445           <span class="comment">// enhance the counter</span>
<a name="l00446"></a>00446           <span class="comment">// of non-NULL values</span>
<a name="l00447"></a>00447           ndata++;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="comment">// compute the mean offset</span>
<a name="l00452"></a>00452   dy_mean = dy_mean / (double)ndata;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="comment">// compute the standard deviation</span>
<a name="l00455"></a>00455   stdev = <a class="code" href="nicback__utils_8c.html#ab2885f4df15e7ad912a28b9c84e5edca">comp_stdev_from_array</a>(y_diff, ndata, dy_mean);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="comment">// get the maximum allowed</span>
<a name="l00458"></a>00458   <span class="comment">// deviation</span>
<a name="l00459"></a>00459   absdev = kappa*stdev;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="comment">// go over the data</span>
<a name="l00462"></a>00462   <span class="keywordflow">for</span> (index=0; index &lt; fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>; index++)
<a name="l00463"></a>00463     {
<a name="l00464"></a>00464       <span class="comment">// check whether the data has weigth</span>
<a name="l00465"></a>00465       <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index])
<a name="l00466"></a>00466         {
<a name="l00467"></a>00467           <span class="comment">// compute the absolute difference from the data point</span>
<a name="l00468"></a>00468           <span class="comment">// to the prediction from the fit</span>
<a name="l00469"></a>00469           dy_act = fabs((fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a>[index] - gsl_vector_get(lfit, 0)) * gsl_vector_get(lfit, 2)
<a name="l00470"></a>00470                         + gsl_vector_get(lfit, 1)-fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a>[index]);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472           <span class="comment">// check whether the difference</span>
<a name="l00473"></a>00473           <span class="comment">// is larger than allowed</span>
<a name="l00474"></a>00474           <span class="keywordflow">if</span> (dy_act &gt; absdev)
<a name="l00475"></a>00475             {
<a name="l00476"></a>00476               <span class="comment">// make the weight NULL</span>
<a name="l00477"></a>00477               fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index] = 0.0;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479               <span class="comment">// set the clipped flagg</span>
<a name="l00480"></a>00480               clipped=1;
<a name="l00481"></a>00481             }
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="comment">// release memory</span>
<a name="l00487"></a>00487   free(y_diff);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="comment">// return the integer</span>
<a name="l00490"></a>00490   <span class="comment">// indicating clipped values</span>
<a name="l00491"></a>00491   <span class="keywordflow">return</span> clipped;
<a name="l00492"></a>00492 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab2885f4df15e7ad912a28b9c84e5edca"></a><!-- doxytag: member="nicback_utils.c::comp_stdev_from_array" ref="ab2885f4df15e7ad912a28b9c84e5edca" args="(const double *data, const int ndata, const double mean)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double comp_stdev_from_array </td>
          <td>(</td>
          <td class="paramtype">const double *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>mean</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: comp_stdev_from_array The subroutine computes the standard deviation of a data vector, using the known mean value.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>- the data vector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ndata</em>&nbsp;</td><td>- number of data points to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mean</em>&nbsp;</td><td>- mean value of the data points</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>clipped - boolean to indicate clipped values </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00509"></a>00509 {
<a name="l00510"></a>00510   <span class="keywordtype">int</span> index=0;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512   <span class="keywordtype">double</span> stdev=0.0;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514   <span class="comment">// go over the data array</span>
<a name="l00515"></a>00515   <span class="keywordflow">for</span> (index=0; index &lt; ndata; index++)
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517       <span class="comment">// compute and add the square difference to the mean</span>
<a name="l00518"></a>00518       stdev += (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>[index] - mean) * (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>[index] - mean);
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="comment">// compute the average square difference</span>
<a name="l00522"></a>00522   <span class="keywordflow">if</span> (ndata &gt; 1)
<a name="l00523"></a>00523     stdev /= ((double)ndata-1);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   <span class="comment">// compute the final</span>
<a name="l00526"></a>00526   <span class="comment">// standard deviation</span>
<a name="l00527"></a>00527   stdev = sqrt(stdev);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529   <span class="comment">// return the stdev</span>
<a name="l00530"></a>00530   <span class="keywordflow">return</span> stdev;
<a name="l00531"></a>00531 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9918a17ac8953bd066cfebd20ad5c06e"></a><!-- doxytag: member="nicback_utils.c::compute_nicmos_back" ref="a9918a17ac8953bd066cfebd20ad5c06e" args="(const gsl_matrix *mbck_img, const double factor, const double offset, const gsl_matrix *corr_img)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* compute_nicmos_back </td>
          <td>(</td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>mbck_img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>corr_img</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: compute_nicmos_back The subroutine applies a scaling factor to a master background in order to get the background image for a specific grism image.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mbck_img</em>&nbsp;</td><td>- the master background pixel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>factor</em>&nbsp;</td><td>- the scaling factor</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>grism_bck - the background image as gsl-matrix </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00214"></a>00214 {
<a name="l00215"></a>00215   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *grism_bck;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordtype">int</span> ii, jj;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <span class="comment">// allocate the space for the background image</span>
<a name="l00220"></a>00220   grism_bck = <a class="code" href="aXe__grism_8h.html#a1214ab1bea5fd80474d7a27db0bfb429">gsl_matrix_alloc</a>(mbck_img-&gt;size1, mbck_img-&gt;size2);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <span class="comment">// go over each row</span>
<a name="l00223"></a>00223   <span class="keywordflow">for</span> (ii=0; ii &lt; mbck_img-&gt;size1; ii++)
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225       <span class="comment">// go over each column</span>
<a name="l00226"></a>00226       <span class="keywordflow">for</span> (jj=0; jj &lt; mbck_img-&gt;size2; jj++)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228           <span class="comment">// compute and set the value in the background image</span>
<a name="l00229"></a>00229           <span class="keywordflow">if</span> (corr_img != NULL)
<a name="l00230"></a>00230             <span class="comment">// using the pedestal image</span>
<a name="l00231"></a>00231             <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a>(grism_bck, ii, jj,
<a name="l00232"></a>00232                 (<a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(mbck_img, ii, jj) + <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(corr_img, ii, jj)) * factor);
<a name="l00233"></a>00233           <span class="keywordflow">else</span>
<a name="l00234"></a>00234             <span class="comment">// using the fit values only</span>
<a name="l00235"></a>00235             <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a>(grism_bck, ii, jj, <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(mbck_img, ii, jj) * factor + offset);
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="comment">// return the background image</span>
<a name="l00240"></a>00240   <span class="keywordflow">return</span> grism_bck;
<a name="l00241"></a>00241 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c83d0f59622e62084c934e8c61d91dc"></a><!-- doxytag: member="nicback_utils.c::fill_fbck_data" ref="a0c83d0f59622e62084c934e8c61d91dc" args="(const observation *const obs, const gsl_matrix *msk_img, const gsl_matrix *mbck_img, fitbck_data *fbck_data, char plist_name[], const gsl_matrix *corr_img)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_fbck_data </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>msk_img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>mbck_img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>plist_name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>corr_img</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: make_nicmos_back The subroutine creates and fills a structure with pairs of correpsonding from a grism image and a master sky background. Dq-masked pixels values and pixels which are part of an <a class="el" href="structobject.html">object</a> <a class="el" href="structbeam.html">beam</a> are used, but marked with a zero weight.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- the <a class="el" href="structobservation.html">observation</a> for the grism image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>msk_image</em>&nbsp;</td><td>- the maks image values </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mbck_img</em>&nbsp;</td><td>- the master background values </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fbck_data</em>&nbsp;</td><td>- structure with the data pairs</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00554"></a>00554 {
<a name="l00555"></a>00555   <span class="keywordtype">int</span> ix=0;
<a name="l00556"></a>00556   <span class="keywordtype">int</span> iy=0;
<a name="l00557"></a>00557   <span class="keywordtype">int</span> index=0;
<a name="l00558"></a>00558   <span class="keywordtype">char</span> Buffer[10240];
<a name="l00559"></a>00559   FILE *fout;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <span class="keywordtype">int</span> px_min=20;
<a name="l00562"></a>00562   <span class="keywordtype">int</span> px_max=180;
<a name="l00563"></a>00563   <span class="keywordtype">int</span> py_min=50;
<a name="l00564"></a>00564   <span class="keywordtype">int</span> py_max=245;
<a name="l00565"></a>00565   <span class="comment">//int px_min=0;</span>
<a name="l00566"></a>00566   <span class="comment">//int px_max=255;</span>
<a name="l00567"></a>00567   <span class="comment">//int py_min=0;</span>
<a name="l00568"></a>00568   <span class="comment">//int py_max=255;</span>
<a name="l00569"></a>00569   <span class="comment">//10:240,15:245[10:180,20:245][20:180,50:245]</span>
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   <span class="comment">// intitialize the index for</span>
<a name="l00572"></a>00572   <span class="comment">// the fit_data structure</span>
<a name="l00573"></a>00573   index = 0;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575   <span class="keywordtype">double</span> diffval;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   fout = fopen(plist_name, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="comment">// go over all pixels</span>
<a name="l00580"></a>00580   <span class="comment">// in the grism image</span>
<a name="l00581"></a>00581   <span class="keywordflow">for</span> (ix=0; ix &lt; obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size1; ix++)
<a name="l00582"></a>00582     {
<a name="l00583"></a>00583       <span class="keywordflow">for</span> (iy=0; iy &lt; obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size2; iy++)
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585           <span class="comment">// set the master background pixel as independent variable</span>
<a name="l00586"></a>00586           fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a>[index] = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(mbck_img, ix, iy);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588           <span class="keywordflow">if</span> (corr_img != NULL)
<a name="l00589"></a>00589             <span class="comment">// subtract the correction value from the background value</span>
<a name="l00590"></a>00590             diffval = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, ix, iy) - <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(corr_img, ix, iy);
<a name="l00591"></a>00591           <span class="keywordflow">else</span>
<a name="l00592"></a>00592             <span class="comment">// use the naked background value</span>
<a name="l00593"></a>00593             diffval = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, ix, iy);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595           <span class="comment">// set the grism image pixel as dependent variable</span>
<a name="l00596"></a>00596           <span class="comment">//fbck_data-&gt;y_values[index] = gsl_matrix_get(obs-&gt;grism, ix, iy);</span>
<a name="l00597"></a>00597           <span class="comment">// set the difference as dependent variable</span>
<a name="l00598"></a>00598           fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a>[index] = diffval;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600           <span class="comment">// set the x- and y-positions</span>
<a name="l00601"></a>00601           fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>[index] = ix;
<a name="l00602"></a>00602           fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>[index] = iy;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604           <span class="comment">// check whether the pixel was masked out</span>
<a name="l00605"></a>00605           <span class="comment">// or is part of an object</span>
<a name="l00606"></a>00606           <span class="keywordflow">if</span> (isnan(<a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, ix, iy))
<a name="l00607"></a>00607                     || <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(msk_img, ix, iy) &lt; -9.0e+05)
<a name="l00608"></a>00608             <span class="comment">// mask the pixel in the array</span>
<a name="l00609"></a>00609             fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index] = 0.0;
<a name="l00610"></a>00610           <span class="keywordflow">else</span>
<a name="l00611"></a>00611             {
<a name="l00612"></a>00612               <span class="comment">// give the pixel full weight</span>
<a name="l00613"></a>00613               <span class="comment">//x,y,value_back,value_grism_imag</span>
<a name="l00614"></a>00614               fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index] = 1.0;
<a name="l00615"></a>00615               sprintf (Buffer, <span class="stringliteral">&quot;%i %i %e %e\n&quot;</span>,ix, iy, <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, ix, iy), <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(mbck_img, ix, iy));
<a name="l00616"></a>00616               fputs (Buffer, fout);
<a name="l00617"></a>00617             }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619           <span class="comment">// check whether the pixel is in the</span>
<a name="l00620"></a>00620           <span class="comment">// allowed are</span>
<a name="l00621"></a>00621           <span class="keywordflow">if</span> (ix &lt; px_min || ix &gt; px_max
<a name="l00622"></a>00622               || iy &lt; py_min || iy &gt; py_max)
<a name="l00623"></a>00623             <span class="comment">// mask the pixel in the array</span>
<a name="l00624"></a>00624             fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index] = 0.0;
<a name="l00625"></a>00625           <span class="comment">// enhance the counter</span>
<a name="l00626"></a>00626           index++;
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   fclose (fout);
<a name="l00631"></a>00631 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aea8c23d52efddd074ca3abc3f7c59c75"></a><!-- doxytag: member="nicback_utils.c::free_fitbck_data" ref="aea8c23d52efddd074ca3abc3f7c59c75" args="(fitbck_data *fbck_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_fitbck_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00646"></a>00646 {
<a name="l00647"></a>00647   free(fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a>);
<a name="l00648"></a>00648   free(fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a>);
<a name="l00649"></a>00649   free(fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>);
<a name="l00650"></a>00650   free(fbck_data-&gt;<a class="code" href="structfitbck__data.html#a6a60c88543b3866c7cc21960df1b8747">x_pos</a>);
<a name="l00651"></a>00651   free(fbck_data-&gt;<a class="code" href="structfitbck__data.html#aeffa672e102b731832b1e87aa9a8b933">y_pos</a>);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   free(fbck_data);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655   fbck_data = NULL;
<a name="l00656"></a>00656 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9bc21cd51c17da1e981a93f7d41873ce"></a><!-- doxytag: member="nicback_utils.c::get_fbck_defaults" ref="a9bc21cd51c17da1e981a93f7d41873ce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_vector* get_fbck_defaults </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00366"></a>00366 {
<a name="l00367"></a>00367   gsl_vector *ret;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   ret = gsl_vector_alloc(10);
<a name="l00370"></a>00370 
<a name="l00371"></a>00371   <span class="comment">/*</span>
<a name="l00372"></a>00372 <span class="comment">  gsl_vector_set(ret, 0, xean);</span>
<a name="l00373"></a>00373 <span class="comment">  gsl_vector_set(ret, 1, c0);</span>
<a name="l00374"></a>00374 <span class="comment">  gsl_vector_set(ret, 2, c1);</span>
<a name="l00375"></a>00375 <span class="comment">  gsl_vector_set(ret, 3, cov00);</span>
<a name="l00376"></a>00376 <span class="comment">  gsl_vector_set(ret, 4, cov01);</span>
<a name="l00377"></a>00377 <span class="comment">  gsl_vector_set(ret, 5, cov11);</span>
<a name="l00378"></a>00378 <span class="comment">  gsl_vector_set(ret, 6, chisq);</span>
<a name="l00379"></a>00379 <span class="comment">  */</span>
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   gsl_vector_set(ret, 0, 0.0);
<a name="l00382"></a>00382   gsl_vector_set(ret, 1, 0.0);
<a name="l00383"></a>00383   gsl_vector_set(ret, 2, 1.0);
<a name="l00384"></a>00384   gsl_vector_set(ret, 3, 1.0);
<a name="l00385"></a>00385   gsl_vector_set(ret, 4, 0.0);
<a name="l00386"></a>00386   gsl_vector_set(ret, 5, 1.0);
<a name="l00387"></a>00387   gsl_vector_set(ret, 6, 0.0);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="keywordflow">return</span> ret;
<a name="l00390"></a>00390 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afba22b93224b6f161189d9dd72ec476a"></a><!-- doxytag: member="nicback_utils.c::get_skypix_frac" ref="afba22b93224b6f161189d9dd72ec476a" args="(const fitbck_data *fbck_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_skypix_frac </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_skypix_frac The subroutine computes the fraction of image pixels which were used for determining the scaling factor of the master background and the computation of the bacground image. Pixels not used were masked out, since they are part of an <a class="el" href="structobject.html">object</a> <a class="el" href="structbeam.html">beam</a> or rejected in the kappa-sigma clipping.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fbck_data</em>&nbsp;</td><td>- the data used for the fit</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>skypix_frac - fraction of pixels used for background determination </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178   <span class="keywordtype">int</span> index;
<a name="l00179"></a>00179   <span class="keywordtype">int</span> nvalues=0;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordtype">double</span> skypix_frac=0.0;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="comment">// go over all data values</span>
<a name="l00184"></a>00184   <span class="keywordflow">for</span> (index=0; index &lt; fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>; index++)
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186       <span class="comment">// check whether the weight is not NULL</span>
<a name="l00187"></a>00187       <span class="keywordflow">if</span> (fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>[index])
<a name="l00188"></a>00188         <span class="comment">// enhance the number of used pixels</span>
<a name="l00189"></a>00189         nvalues++;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="comment">// compute the fration of used pixels</span>
<a name="l00193"></a>00193   skypix_frac = (double)nvalues / (<span class="keywordtype">double</span>)fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">// return the fraction</span>
<a name="l00196"></a>00196   <span class="keywordflow">return</span> skypix_frac;
<a name="l00197"></a>00197 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a759a87323afd2c28ba9796698ff4e53b"></a><!-- doxytag: member="nicback_utils.c::make_ksig_linfit" ref="a759a87323afd2c28ba9796698ff4e53b" args="(fitbck_data *fbck_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_vector* make_ksig_linfit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfitbck__data.html">fitbck_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fbck_data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: compute_nicmos_back The subroutine iteratively fits a linear relation to the pairs of grism image - master background pixel values. After each fit, pairs with large deviations are determined and excluded. The result of the final fit is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fbck_data</em>&nbsp;</td><td>- the data used for the fits</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>lfit - the results of the final fit </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259   gsl_vector *lfit=NULL;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keywordtype">int</span> index=0;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="keywordtype">int</span> clipped=1;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265   <span class="comment">// check whether iterations still</span>
<a name="l00266"></a>00266   <span class="comment">// must be done and whether</span>
<a name="l00267"></a>00267   <span class="comment">// the data was changed from clipping</span>
<a name="l00268"></a>00268   <span class="keywordflow">while</span> (index &lt; <a class="code" href="nicback__utils_8h.html#ae912031e76faa714d6f8dfea1fd8dafd">N_KSIGBCK_ITER</a> &amp;&amp; clipped)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270       <span class="keywordflow">if</span> (<a class="code" href="nicback__utils_8c.html#aca6b3d4156c6ee05da065b49242e0fbb">check_fbck_data</a>(fbck_data))
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272           <span class="comment">// make a non-weighted linear fit</span>
<a name="l00273"></a>00273           lfit = <a class="code" href="spce__fitting_8c.html#a76b487ff0c90fe829ddbec4fae979fb1">det_vector_linear</a>(fbck_data-&gt;<a class="code" href="structfitbck__data.html#a52a17fe78183bb8860c15923aafd995b">x_values</a>, fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab6579e3cb28969ab1280ed85353c09dc">y_values</a>, fbck_data-&gt;<a class="code" href="structfitbck__data.html#ab949bb327e0452787c34d4bf67358b6d">e_values</a>,
<a name="l00274"></a>00274                                    fbck_data-&gt;<a class="code" href="structfitbck__data.html#aa980ba0a19fd1a9513ff5fc724d2e8b5">n_data</a>, 0);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276           <span class="comment">// make a clipping iteration</span>
<a name="l00277"></a>00277           clipped = <a class="code" href="nicback__utils_8c.html#a601af82b7d386fc678ed78772bd72f31">clipp_fbck_data</a>(fbck_data, lfit, <a class="code" href="nicback__utils_8h.html#ae160edd6112998fa5ab5f644c47e594f">N_KSIGBCK_KAPPA</a>);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279           <span class="comment">// inhance the clipping counter</span>
<a name="l00280"></a>00280           index++;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282       <span class="keywordflow">else</span>
<a name="l00283"></a>00283         {
<a name="l00284"></a>00284           <span class="comment">// release the space</span>
<a name="l00285"></a>00285           <span class="comment">// for the old vector</span>
<a name="l00286"></a>00286           <span class="keywordflow">if</span> (lfit)
<a name="l00287"></a>00287             gsl_vector_free(lfit);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289           <span class="comment">// get a new dummy vector</span>
<a name="l00290"></a>00290           lfit = <a class="code" href="nicback__utils_8c.html#a9bc21cd51c17da1e981a93f7d41873ce">get_fbck_defaults</a>();
<a name="l00291"></a>00291 
<a name="l00292"></a>00292           <span class="keywordflow">break</span>;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="comment">// check whether the scale is within the boundaries</span>
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (gsl_vector_get(lfit, 2) &lt; <a class="code" href="nicback__utils_8h.html#a4c9df06de47b01d8da6dc61e64addcf9">BCK_SCALE_MIN</a> || gsl_vector_get(lfit, 2) &gt; <a class="code" href="nicback__utils_8h.html#a0f34e4d690e58dcbc4ad8d74e28f1d99">BCK_SCALE_MAX</a>)
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299 
<a name="l00300"></a>00300       fprintf(stdout, <span class="stringliteral">&quot;aXe_NICBACK: Background scale is out of bounds. It is re-adjusted.\n&quot;</span>);
<a name="l00301"></a>00301       <span class="comment">// release the space</span>
<a name="l00302"></a>00302       <span class="comment">// for the old vector</span>
<a name="l00303"></a>00303       gsl_vector_free(lfit);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305       <span class="comment">// get a new dummy vector</span>
<a name="l00306"></a>00306       lfit = <a class="code" href="nicback__utils_8c.html#a9bc21cd51c17da1e981a93f7d41873ce">get_fbck_defaults</a>();
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="comment">// return the fit result</span>
<a name="l00310"></a>00310   <span class="keywordflow">return</span> lfit;
<a name="l00311"></a>00311 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9342e0a07b86a22d5d66f05d0e4b8ae0"></a><!-- doxytag: member="nicback_utils.c::make_nicmos_back" ref="a9342e0a07b86a22d5d66f05d0e4b8ae0" args="(const observation *const obs, const char *msk_name, const char *master_bck, char bck_name[], char plist_name[], const char corr_bck[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void make_nicmos_back </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>msk_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>master_bck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>bck_name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>plist_name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>corr_bck</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: make_nicmos_back The subroutine computes and stores the background image for a specific NICMOS grism image. The non-masked pixels in the grism image are correlated with their corresponding values in the master background image. A linear relation is fitted to the value pairs. Deviating points are excluded using kappa-sigma clipping. Using the slope of the final fit, the background image is computed and stored as a fits image.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- the <a class="el" href="structobservation.html">observation</a> for the grism image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>msk_name</em>&nbsp;</td><td>- the full name of the mask file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>master_bck</em>&nbsp;</td><td>- the full name of the master sky background </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bck_name</em>&nbsp;</td><td>- the full name of the background image</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00049"></a>00049 {
<a name="l00050"></a>00050   <a class="code" href="structpx__point.html">px_point</a> npixels;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="keywordtype">double</span> skypix_frac;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *msk_img;
<a name="l00055"></a>00055   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *mbck_img;
<a name="l00056"></a>00056   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *corr_img=NULL;
<a name="l00057"></a>00057   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *grism_bck;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   gsl_vector *lfit;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <a class="code" href="structfitbck__data.html">fitbck_data</a> *fbck_data;
<a name="l00062"></a>00062   <span class="comment">//int f_status=0;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <a class="code" href="structFITScards.html">FITScards</a> *cards;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <span class="keywordtype">char</span>  ID[<a class="code" href="aXe__grism_8h.html#ac1535592e39e7edf0cafbd5e695ea622">MAXCHAR</a>];
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="comment">// fix the extension name</span>
<a name="l00069"></a>00069   sprintf (ID, <span class="stringliteral">&quot;BCK&quot;</span>);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="comment">// load the master background image</span>
<a name="l00072"></a>00072   fprintf(stdout,<span class="stringliteral">&quot;Loading DATA from: %s...&quot;</span>, master_bck);
<a name="l00073"></a>00073   mbck_img = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(master_bck, 1, 1);
<a name="l00074"></a>00074   fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordflow">if</span> (strlen(corr_bck) &gt; 0)
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078       <span class="comment">// load the correction background image</span>
<a name="l00079"></a>00079       fprintf(stdout,<span class="stringliteral">&quot;Loading DATA from: %s...&quot;</span>, corr_bck);
<a name="l00080"></a>00080       corr_img = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(corr_bck, 1, 1);
<a name="l00081"></a>00081       fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="comment">// load the mask image</span>
<a name="l00085"></a>00085   fprintf(stdout,<span class="stringliteral">&quot;Loading DATA from: %s...&quot;</span>, msk_name);
<a name="l00086"></a>00086   msk_img = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(msk_name, 2, 1);
<a name="l00087"></a>00087   fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="comment">// get the dimension of</span>
<a name="l00090"></a>00090   <span class="comment">// the grism image</span>
<a name="l00091"></a>00091   npixels = <a class="code" href="aXe__utils_8c.html#ae7f4f277c2b5d03b7ce52b2392d176b2">get_npixel</a>(obs);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">// allocate memory for the fit data</span>
<a name="l00094"></a>00094   fbck_data = <a class="code" href="nicback__utils_8c.html#ab52b28abe12e4b0ac525cc5cbbddaaff">alloc_fitbck_data</a>(npixels.<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> * npixels.<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   <span class="comment">// fill the fit data into the structure</span>
<a name="l00097"></a>00097   <a class="code" href="nicback__utils_8c.html#a0c83d0f59622e62084c934e8c61d91dc">fill_fbck_data</a>(obs, msk_img, mbck_img, fbck_data, plist_name, corr_img);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="comment">// make the fit, including</span>
<a name="l00100"></a>00100   <span class="comment">// kappa-sigma iterations</span>
<a name="l00101"></a>00101   lfit = <a class="code" href="nicback__utils_8c.html#a759a87323afd2c28ba9796698ff4e53b">make_ksig_linfit</a>(fbck_data);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="comment">// report the result of the fit onto the screen</span>
<a name="l00104"></a>00104   fprintf(stdout, <span class="stringliteral">&quot;\nFitting result: c0 = %f +- %f , c1 = %f +- %f , chi^2 = %f\n\n&quot;</span>,
<a name="l00105"></a>00105           gsl_vector_get(lfit, 1), gsl_vector_get(lfit, 3),
<a name="l00106"></a>00106           gsl_vector_get(lfit, 2), gsl_vector_get(lfit, 4), gsl_vector_get(lfit, 6));
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <span class="comment">// compute the background for the grism frame</span>
<a name="l00109"></a>00109   grism_bck = <a class="code" href="nicback__utils_8c.html#a9918a17ac8953bd066cfebd20ad5c06e">compute_nicmos_back</a>(mbck_img, gsl_vector_get(lfit, 2),
<a name="l00110"></a>00110                                   gsl_vector_get(lfit, 1), corr_img);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   <span class="comment">// write the background image to a file</span>
<a name="l00113"></a>00113   fprintf(stdout,<span class="stringliteral">&quot;Writing data to: %s...&quot;</span>, bck_name);
<a name="l00114"></a>00114   <a class="code" href="aXe__utils_8c.html#a6a5d64fa0baa598fc20741fa603bee11">gsl_to_FITSimage</a> (grism_bck, bck_name, 1, ID);
<a name="l00115"></a>00115   fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   <span class="comment">// determine the fraction of pixels</span>
<a name="l00118"></a>00118   <span class="comment">// used in the background determination</span>
<a name="l00119"></a>00119   skypix_frac = <a class="code" href="nicback__utils_8c.html#afba22b93224b6f161189d9dd72ec476a">get_skypix_frac</a>(fbck_data);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="comment">// create the fits keywords</span>
<a name="l00122"></a>00122   cards = <a class="code" href="spc__FITScards_8c.html#af17c0df011aa3245c5aecb6bf5d0b9b1">nicbck_info_to_FITScards</a>(skypix_frac, gsl_vector_get(lfit, 2),
<a name="l00123"></a>00123                                    gsl_vector_get(lfit, 1));
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">// transfer the fits keywords</span>
<a name="l00126"></a>00126   <span class="comment">// to the background image</span>
<a name="l00127"></a>00127   <a class="code" href="aXe__utils_8c.html#a8abd9ee69f161e0ac3ee47dc722cebf0">put_FITS_cards</a> (bck_name, 2, cards);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <span class="comment">// release memory</span>
<a name="l00130"></a>00130   <a class="code" href="nicback__utils_8c.html#aea8c23d52efddd074ca3abc3f7c59c75">free_fitbck_data</a>(fbck_data);
<a name="l00131"></a>00131   <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(mbck_img);
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (corr_img != NULL)
<a name="l00133"></a>00133     <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(corr_img);
<a name="l00134"></a>00134   <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(msk_img);
<a name="l00135"></a>00135   <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(grism_bck);
<a name="l00136"></a>00136   gsl_vector_free(lfit);
<a name="l00137"></a>00137   <a class="code" href="spc__FITScards_8c.html#aaaba4aea09f708f12bf52e9446e5384b">free_FITScards</a>(cards);
<a name="l00138"></a>00138 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
