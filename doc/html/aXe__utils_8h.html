<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/aXe_utils.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/aXe_utils.h File Reference</h1><code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="aXe__grism_8h_source.html">aXe_grism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spc__FITScards_8h_source.html">spc_FITScards.h</a>&quot;</code><br/>

<p><a href="aXe__utils_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCol__Descr.html">Col_Descr</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a06be4aa9150783f3722be133a28c8ef8">MAXNCONF</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a265457e88fc46b602e539e9a7b2a6c1e">simulate_errors</a> (gsl_matrix *img, float exptime, float gain)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ad05c49b54279d1e4f6f49fe675ce254f">simulate_errors_t</a> (gsl_matrix *img, const double exptime, const double rdnoise)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a203bace423c84b28d48d305a99dfa81a">apply_DQ</a> (<a class="el" href="structobservation.html">observation</a> *obs, int dqmask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobservation.html">observation</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a661333de2efcbef321b27520d40cc9cf">load_image</a> (const char *const fname, int hdunum_data, int hdunum_err, int hdunum_dq, int dqmask, float exptime, float gain)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobservation.html">observation</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ac87755b847abbd2c375032e14bd5561c">load_image_t</a> (const char *const fname, int hdunum_data, int hdunum_err, int hdunum_dq, int dqmask, const double exptime, const double rdnoise)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobservation.html">observation</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a1aa6f31280704fd7678c78b97d0f5456">load_sci_image</a> (const char *const fname, int hdunum_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a791e8209e46381315c39a27890280053">FITSextnum</a> (const char *const fname)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a74a75b4d9d74b257e44e6ec61ca79bf5">FITSnaxes_to_gsl</a> (const char *const fname, int hdunum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a18f07b887bcf78c0c0105912818b8a2b">FITSimage_to_gslOld</a> (const char *const fname, int hdunum, int fatal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a> (const char *const fname, int hdunum, int fatal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#afdee57669eb437afcad30e96223b48a2">FITSHDU_to_gsl</a> (const char *const fname, fitsfile *fptr, int fatal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_matrix *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a616ed3bbb3c1b15f8127548fbe1d4701">storage_to_gsl</a> (long *naxes, PIXEL_T *storage)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structpx__point.html">px_point</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a7eb3cbe5ef0277544b00b2cc9c990e4c">get_npixels</a> (const char *const fname, int hdunum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a6a5d64fa0baa598fc20741fa603bee11">gsl_to_FITSimage</a> (gsl_matrix *data, char filename[], int overwrite, char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ae3c5e11b29793d5fa85913a0df2f7761">gsl_to_FITSimageHDU</a> (gsl_matrix *data, char filename[], int overwrite, char ID[], int hdu_num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a40b0ba7efd067d860b4f2a6948fea20b">quad_to_bbox</a> (const <a class="el" href="structpx__point.html">px_point</a> *const corners, <a class="el" href="structpx__point.html">px_point</a> *const ll, <a class="el" href="structpx__point.html">px_point</a> *const ur)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a57559b109efa08c59a49d92479619d0d">gsl_matrix_to_pgm</a> (const char *const fname, const gsl_matrix *const m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a6775cf9397e918007afce6147fa92ec8">build_path</a> (char envpathname[], const char file[], char *filename)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#adb066a0a2f011d58fb3a8ecfce732d9f">alloc_char_arr</a> (int nrows, int ncols)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ac8d8059b1a87e608b4570096fba84d01">free_char_arr</a> (char **char_arr, int nrows)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a1b9693d2f0e0ff78e226ede6a839881c">build_config_files</a> (char list_file[], char **list_files, int maxnrows)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a94637b37589d1f9b3c9418d620156519">replace_file_extension</a> (char infile[], char outfile[], char from_ext[], char to_ext[], int hdu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a1f63bfb071e9d0ea1f8854efdfae4692">free_oblist</a> (<a class="el" href="structobject.html">object</a> **oblist)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ab728171bc22cb503b1904ed113a8c36e">fprintf_object</a> (FILE *output, <a class="el" href="structobject.html">object</a> *o)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a831cd1049c0c8b8e918404c5035d5411">get_online_option</a> (char option_name[], int argc, char *argv[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a7c64494989064de2c0ca57df3d7f43a2">get_online_option2</a> (char option_name[], char option_value[], int argc, char *argv[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#aaf6850286e924fd44f65af2cf80894f0">free_observation</a> (<a class="el" href="structobservation.html">observation</a> *obs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ae2b196b3eec481bec79c35394e75e4fc">get_hdunum_from_hduname</a> (char filename[], char extname[], char keyword[], char keyval[], int extver)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structFITScards.html">FITScards</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#aa1a7ef7b7d19206e1df681bf2bea0d7c">get_FITS_cards</a> (char filename[], int hdu)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structFITScards.html">FITScards</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a27dd022a77729a35640126b146b35825">get_FITS_cards_opened</a> (fitsfile *input)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a8abd9ee69f161e0ac3ee47dc722cebf0">put_FITS_cards</a> (char filename[], int hdu, <a class="el" href="structFITScards.html">FITScards</a> *cards)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a6652d52eca381c6c7fbc9913f2b42a0e">put_FITS_cards_opened</a> (fitsfile *output, <a class="el" href="structFITScards.html">FITScards</a> *cards)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ad7667e161c8b5af380d7ff9f2433cd06">gsl_to_FITSimage_opened</a> (gsl_matrix *data, fitsfile *ouput, int overwrite, char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">fitsfile *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#aeed8cb8563260b750fda48d5636c92f2">create_FITSimage_opened</a> (char filename[], int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a8817e86558786acb16965f3ac1215992">get_float_from_keyword</a> (char *filename, int hdunum, char *keyword)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a19a55b09e92561a904ece2b41f6a67e2">create_FITSimage</a> (char *filename, int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#a6def7f1cbe94897d599552d9f95e1d7e">drzprep_fitstrans</a> (char filename[], int hdunum, fitsfile *PET_ptr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structpx__point.html">px_point</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="aXe__utils_8h.html#ae7f4f277c2b5d03b7ce52b2392d176b2">get_npixel</a> (const <a class="el" href="structobservation.html">observation</a> *obs)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a06be4aa9150783f3722be133a28c8ef8"></a><!-- doxytag: member="aXe_utils.h::MAXNCONF" ref="a06be4aa9150783f3722be133a28c8ef8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAXNCONF&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adb066a0a2f011d58fb3a8ecfce732d9f"></a><!-- doxytag: member="aXe_utils.h::alloc_char_arr" ref="adb066a0a2f011d58fb3a8ecfce732d9f" args="(int nrows, int ncols)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** alloc_char_arr </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nrows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ncols</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: alloc_char_arr The function allocates memory for a character array. The dimensions of the character array are specified with the number of columns per row and the number of rows in the input. The pointer to the allocated memory is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nrows</em>&nbsp;</td><td>- number of rows to allocate </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ncols</em>&nbsp;</td><td>- number of columns per row to allocate</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>char_arr - pointer to the allocated array </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01701"></a>01701 {
<a name="l01702"></a>01702   <span class="keywordtype">char</span> **char_arr;
<a name="l01703"></a>01703   <span class="keywordtype">int</span> i;
<a name="l01704"></a>01704 
<a name="l01705"></a>01705   <span class="comment">// allocate the memory for the pointers to the individual rows</span>
<a name="l01706"></a>01706   char_arr = (<span class="keywordtype">char</span> **) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*nrows);
<a name="l01707"></a>01707 
<a name="l01708"></a>01708   <span class="comment">// for each row:</span>
<a name="l01709"></a>01709   <span class="keywordflow">for</span> (i=0; i &lt; nrows; i++) 
<a name="l01710"></a>01710     <span class="comment">// allocate the columns</span>
<a name="l01711"></a>01711     char_arr[i] = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*ncols);
<a name="l01712"></a>01712 
<a name="l01713"></a>01713   <span class="comment">// return the result</span>
<a name="l01714"></a>01714   <span class="keywordflow">return</span> char_arr;
<a name="l01715"></a>01715 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a203bace423c84b28d48d305a99dfa81a"></a><!-- doxytag: member="aXe_utils.h::apply_DQ" ref="a203bace423c84b28d48d305a99dfa81a" args="(observation *obs, int dqmask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_DQ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *&nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dqmask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function uses the DQ information contained in an <a class="el" href="structobservation.html">observation</a> structure together with a bitmask (represented as an integer) to determine if a pixel is to be flagged as bad or not. Flagged pixel are replaces by GSL_NAN values.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>a pointer to an exisiting <a class="el" href="structobservation.html">observation</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dqmask</em>&nbsp;</td><td>an integer representation of a bit mask. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00073"></a>00073 {
<a name="l00074"></a>00074   <span class="keywordtype">int</span>             i, j;
<a name="l00075"></a>00075   fprintf(stdout, <span class="stringliteral">&quot;DQMASK: %4i\n&quot;</span>, dqmask);
<a name="l00076"></a>00076   
<a name="l00077"></a>00077   <span class="keywordflow">if</span> ((obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>-&gt;size1 != obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size1) || (obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>-&gt;size2 != obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size2)) {
<a name="l00078"></a>00078     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a>(<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00079"></a>00079                 <span class="stringliteral">&quot;DQ array and DATA arrays have different sizes!\n&quot;</span>);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081   <span class="keywordflow">if</span> (obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a> != NULL) {
<a name="l00082"></a>00082     <span class="keywordflow">for</span> (i = 0; i &lt; obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>-&gt;size1; i++) {
<a name="l00083"></a>00083       <span class="keywordflow">for</span> (j = 0; j &lt; obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>-&gt;size2; j++) {
<a name="l00084"></a>00084         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>, i, j) &amp; dqmask) {
<a name="l00085"></a>00085           <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, i, j, GSL_NAN);    
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087       }
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     
<a name="l00090"></a>00090   }
<a name="l00091"></a>00091 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b9693d2f0e0ff78e226ede6a839881c"></a><!-- doxytag: member="aXe_utils.h::build_config_files" ref="a1b9693d2f0e0ff78e226ede6a839881c" args="(char list_file[], char **list_files, int maxnrows)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int build_config_files </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>list_file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>list_files</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxnrows</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: build_config_files The function parses a long character string and separates individual tokens along the character ",". The tokens are stored in a character array. A check is performed such that not more tokens are copied than there exist rows in the character array.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>list_file</em>&nbsp;</td><td>- the character string to parse </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>list_files</em>&nbsp;</td><td>- the character array </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxnrows</em>&nbsp;</td><td>- the number of rows in the character array</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>nlist - the number of tokens copied </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01759"></a>01759 {
<a name="l01760"></a>01760 
<a name="l01761"></a>01761   <span class="keywordtype">int</span> nlist=0;
<a name="l01762"></a>01762   <span class="keywordtype">int</span> ii = 0;
<a name="l01763"></a>01763   <span class="keywordtype">int</span> i=0;
<a name="l01764"></a>01764   <span class="keywordtype">int</span> mod_maxrows;
<a name="l01765"></a>01765 
<a name="l01766"></a>01766   <span class="comment">// create a modified maximum number fo an easy check </span>
<a name="l01767"></a>01767   mod_maxrows = maxnrows -1;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769   <span class="comment">// go over the input string</span>
<a name="l01770"></a>01770   <span class="keywordflow">for</span> (i=0; i&lt;strlen(list_file); i++)
<a name="l01771"></a>01771     {
<a name="l01772"></a>01772 
<a name="l01773"></a>01773       <span class="comment">// check whether the actual character </span>
<a name="l01774"></a>01774       <span class="comment">// indicates the beginning of the next token</span>
<a name="l01775"></a>01775       <span class="keywordflow">if</span> (list_file[i] != <span class="charliteral">&apos;,&apos;</span> &amp;&amp; list_file[i] != <span class="charliteral">&apos;\0&apos;</span>)
<a name="l01776"></a>01776         {
<a name="l01777"></a>01777           <span class="comment">// check whether ther is space in the character array</span>
<a name="l01778"></a>01778           <span class="keywordflow">if</span> (nlist &gt; mod_maxrows)
<a name="l01779"></a>01779             <span class="comment">// give an error in case the char array is full</span>
<a name="l01780"></a>01780             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01781"></a>01781                          <span class="stringliteral">&quot;Too many configuration files! Maximum number: %i !\n&quot;</span>, maxnrows);
<a name="l01782"></a>01782           <span class="keywordflow">else</span>  
<a name="l01783"></a>01783             <span class="comment">// copy the actual character into the token</span>
<a name="l01784"></a>01784             list_files[nlist][ii++] = list_file[i];
<a name="l01785"></a>01785         }  
<a name="l01786"></a>01786     <span class="keywordflow">else</span>
<a name="l01787"></a>01787       {
<a name="l01788"></a>01788         <span class="comment">// write an end to the actual token</span>
<a name="l01789"></a>01789         list_files[nlist][ii] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01790"></a>01790 
<a name="l01791"></a>01791         <span class="comment">// enhance the token counter </span>
<a name="l01792"></a>01792         nlist++;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794         <span class="comment">// reset the position within the token</span>
<a name="l01795"></a>01795         ii = 0;
<a name="l01796"></a>01796       }
<a name="l01797"></a>01797     }
<a name="l01798"></a>01798 
<a name="l01799"></a>01799   <span class="comment">// return the number of tokens</span>
<a name="l01800"></a>01800   <span class="keywordflow">return</span> ++nlist;
<a name="l01801"></a>01801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6775cf9397e918007afce6147fa92ec8"></a><!-- doxytag: member="aXe_utils.h::build_path" ref="a6775cf9397e918007afce6147fa92ec8" args="(char envpathname[], const char file[], char *filename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void build_path </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>envpathname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>filename</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a19a55b09e92561a904ece2b41f6a67e2"></a><!-- doxytag: member="aXe_utils.h::create_FITSimage" ref="a19a55b09e92561a904ece2b41f6a67e2" args="(char *filename, int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_FITSimage </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aeed8cb8563260b750fda48d5636c92f2"></a><!-- doxytag: member="aXe_utils.h::create_FITSimage_opened" ref="aeed8cb8563260b750fda48d5636c92f2" args="(char filename[], int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fitsfile* create_FITSimage_opened </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function to create a new FITS image file with an empty first extension. If overwrite is non zero, any existing file is deleted.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to an array of character containing the filename </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>if set to 1 exisiting file is deleted first </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a fitsifle pointer to a newly created FITS file </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00803"></a>00803 {
<a name="l00804"></a>00804      fitsfile *output;
<a name="l00805"></a>00805      <span class="keywordtype">int</span> f_status = 0;
<a name="l00806"></a>00806      <span class="keywordtype">int</span> hdunum,hdutype;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808      <span class="comment">// Try to open the file</span>
<a name="l00809"></a>00809      {
<a name="l00810"></a>00810           FILE *in_file;
<a name="l00811"></a>00811           in_file = fopen (filename, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813           <span class="keywordflow">if</span> ((overwrite == 1) &amp;&amp; (in_file != NULL))
<a name="l00814"></a>00814             {
<a name="l00815"></a>00815                  <span class="comment">//aXe_message (aXe_M_WARN3, __FILE__, __LINE__,</span>
<a name="l00816"></a>00816                 <span class="comment">//            &quot;create_FITSimage_opened: File %s &quot;</span>
<a name="l00817"></a>00817                 <span class="comment">//            &quot;exits. Overwriting it.&quot;, filename);</span>
<a name="l00818"></a>00818                  fclose (in_file);
<a name="l00819"></a>00819                  unlink (filename);
<a name="l00820"></a>00820             }
<a name="l00821"></a>00821           <span class="keywordflow">if</span> ((overwrite != 1) &amp;&amp; (in_file != NULL))
<a name="l00822"></a>00822             {
<a name="l00823"></a>00823             fits_open_file (&amp;output, filename, READONLY, &amp;f_status);
<a name="l00824"></a>00824             <span class="keywordflow">if</span> (f_status)
<a name="l00825"></a>00825             {
<a name="l00826"></a>00826                 ffrprt (stderr, f_status);
<a name="l00827"></a>00827                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00828"></a>00828                     <span class="stringliteral">&quot;get_ID_index_to_MEPET:&quot;</span> <span class="stringliteral">&quot; Could not open file: %s&quot;</span>,
<a name="l00829"></a>00829                     filename);
<a name="l00830"></a>00830             }
<a name="l00831"></a>00831             fits_get_num_hdus (output, &amp;hdunum, &amp;f_status);
<a name="l00832"></a>00832             <span class="keywordflow">if</span> (f_status)
<a name="l00833"></a>00833             {
<a name="l00834"></a>00834                 ffrprt (stderr, f_status);
<a name="l00835"></a>00835                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00836"></a>00836                     <span class="stringliteral">&quot;gsl_to_FITSimage: Could not get&quot;</span>
<a name="l00837"></a>00837                     <span class="stringliteral">&quot; number of HDU from: %s&quot;</span>, filename);
<a name="l00838"></a>00838             }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840             <span class="comment">/* Move to last HDU */</span>
<a name="l00841"></a>00841             fits_movabs_hdu (output, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00842"></a>00842             <span class="keywordflow">if</span> (f_status)
<a name="l00843"></a>00843             {
<a name="l00844"></a>00844                 ffrprt (stderr, f_status);
<a name="l00845"></a>00845                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00846"></a>00846                     <span class="stringliteral">&quot;gsl_to_FITSimage: Could not mov&quot;</span>
<a name="l00847"></a>00847                     <span class="stringliteral">&quot; to HDU number %d in file: %s&quot;</span>, hdunum, filename);
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849             <span class="keywordflow">return</span> output;
<a name="l00850"></a>00850             }
<a name="l00851"></a>00851      }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853      fits_create_file (&amp;output, filename, &amp;f_status);
<a name="l00854"></a>00854      <span class="keywordflow">if</span> (f_status)
<a name="l00855"></a>00855        {
<a name="l00856"></a>00856             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00857"></a>00857                          <span class="stringliteral">&quot;create_FITSimage_opened: Could not open&quot;</span> <span class="stringliteral">&quot; file: %s&quot;</span>, filename);
<a name="l00858"></a>00858        }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860      <span class="comment">// Create empty HDU</span>
<a name="l00861"></a>00861      {
<a name="l00862"></a>00862           <span class="keywordtype">int</span> naxis = 0;
<a name="l00863"></a>00863           <span class="keywordtype">long</span> naxes[2];
<a name="l00864"></a>00864           ffiimg (output, 16, naxis, naxes, &amp;f_status);
<a name="l00865"></a>00865           <span class="keywordflow">if</span> (f_status)
<a name="l00866"></a>00866             {
<a name="l00867"></a>00867                  <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00868"></a>00868                               <span class="stringliteral">&quot;create_FITSimage_opened: Error creating &quot;</span>
<a name="l00869"></a>00869                               <span class="stringliteral">&quot; empty first HDU in: %s&quot;</span>, filename);
<a name="l00870"></a>00870             }
<a name="l00871"></a>00871      }
<a name="l00872"></a>00872     <span class="keywordflow">return</span> output;
<a name="l00873"></a>00873 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6def7f1cbe94897d599552d9f95e1d7e"></a><!-- doxytag: member="aXe_utils.h::drzprep_fitstrans" ref="a6def7f1cbe94897d599552d9f95e1d7e" args="(char filename[], int hdunum, fitsfile *PET_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int drzprep_fitstrans </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>PET_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l02130"></a>02130                                                                      {
<a name="l02131"></a>02131 
<a name="l02132"></a>02132   <span class="keywordtype">char</span> kname[FLEN_KEYWORD];
<a name="l02133"></a>02133   <span class="keywordtype">char</span> kvalue[FLEN_VALUE];
<a name="l02134"></a>02134   <span class="keywordtype">char</span> kcomment[FLEN_COMMENT];
<a name="l02135"></a>02135   fitsfile *input;
<a name="l02136"></a>02136   <span class="keywordtype">int</span>      f_status=0, hdutype=0;
<a name="l02137"></a>02137   <span class="comment">//long tmp;</span>
<a name="l02138"></a>02138 
<a name="l02139"></a>02139   fits_open_file (&amp;input, filename, READONLY, &amp;f_status);
<a name="l02140"></a>02140   <span class="keywordflow">if</span> (f_status)
<a name="l02141"></a>02141     {
<a name="l02142"></a>02142         ffrprt (stderr, f_status);
<a name="l02143"></a>02143         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02144"></a>02144             <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l02145"></a>02145             filename);
<a name="l02146"></a>02146     }
<a name="l02147"></a>02147   <span class="comment">// Move to the desired HDU</span>
<a name="l02148"></a>02148   fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l02149"></a>02149   <span class="keywordflow">if</span> (f_status)
<a name="l02150"></a>02150     {
<a name="l02151"></a>02151       ffrprt (stderr, f_status);
<a name="l02152"></a>02152       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02153"></a>02153                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not move to extension %d in file: %s&quot;</span>,
<a name="l02154"></a>02154                    hdunum,filename);
<a name="l02155"></a>02155     }
<a name="l02156"></a>02156 
<a name="l02157"></a>02157   strcpy(kname, <span class="stringliteral">&quot;OBJECTID&quot;</span>);
<a name="l02158"></a>02158   <span class="comment">//  fits_read_key_lng (input, kname, &amp;tmp, kcomment, &amp;f_status);</span>
<a name="l02159"></a>02159   fits_read_key_str(input, kname, kvalue, kcomment, &amp;f_status);
<a name="l02160"></a>02160   <span class="keywordflow">if</span> (f_status)
<a name="l02161"></a>02161     {
<a name="l02162"></a>02162       ffrprt (stderr, f_status);
<a name="l02163"></a>02163       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02164"></a>02164                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not get keyword: %s&quot;</span>,
<a name="l02165"></a>02165                    kname);
<a name="l02166"></a>02166     }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168   fits_write_key_str(PET_ptr, kname, kvalue, kcomment, &amp;f_status);
<a name="l02169"></a>02169   <span class="keywordflow">if</span> (f_status)
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171       ffrprt (stderr, f_status);
<a name="l02172"></a>02172       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02173"></a>02173                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not write keyword: %s&quot;</span>,
<a name="l02174"></a>02174                    kname);
<a name="l02175"></a>02175     }
<a name="l02176"></a>02176   strcpy(kname, <span class="stringliteral">&quot;BEAMID&quot;</span>);
<a name="l02177"></a>02177   <span class="comment">//  fits_read_key_lng (input, kname, &amp;tmp, kcomment, &amp;f_status);</span>
<a name="l02178"></a>02178   fits_read_key_str(input, kname, kvalue, kcomment, &amp;f_status);
<a name="l02179"></a>02179   <span class="keywordflow">if</span> (f_status)
<a name="l02180"></a>02180     {
<a name="l02181"></a>02181       ffrprt (stderr, f_status);
<a name="l02182"></a>02182       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02183"></a>02183                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not get keyword: %s&quot;</span>,
<a name="l02184"></a>02184                    kname);
<a name="l02185"></a>02185     }
<a name="l02186"></a>02186 
<a name="l02187"></a>02187   fits_write_key_str(PET_ptr, kname, kvalue, kcomment, &amp;f_status);
<a name="l02188"></a>02188   <span class="keywordflow">if</span> (f_status)
<a name="l02189"></a>02189     {
<a name="l02190"></a>02190       ffrprt (stderr, f_status);
<a name="l02191"></a>02191       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02192"></a>02192                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not write keyword: %s&quot;</span>,
<a name="l02193"></a>02193                    kname);
<a name="l02194"></a>02194     }
<a name="l02195"></a>02195   fits_close_file (input, &amp;f_status);
<a name="l02196"></a>02196   <span class="keywordflow">if</span> (f_status)
<a name="l02197"></a>02197     {
<a name="l02198"></a>02198       ffrprt (stderr, f_status);
<a name="l02199"></a>02199       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l02200"></a>02200                    <span class="stringliteral">&quot;drzprep_fitstrans: &quot;</span> <span class="stringliteral">&quot;Could not close fitsfile.&quot;</span>,
<a name="l02201"></a>02201                    kname);
<a name="l02202"></a>02202     }
<a name="l02203"></a>02203   <span class="keywordflow">return</span> 0;
<a name="l02204"></a>02204 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a791e8209e46381315c39a27890280053"></a><!-- doxytag: member="aXe_utils.h::FITSextnum" ref="a791e8209e46381315c39a27890280053" args="(const char *const fname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FITSextnum </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the number of extensions in a FITS image</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of extensions </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00309"></a>00309 {
<a name="l00310"></a>00310      fitsfile *input;
<a name="l00311"></a>00311      <span class="keywordtype">int</span> f_status = 0;
<a name="l00312"></a>00312      <span class="keywordtype">int</span> hdunum;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314      fits_open_file (&amp;input, fname, READONLY, &amp;f_status);
<a name="l00315"></a>00315      <span class="keywordflow">if</span> (f_status)
<a name="l00316"></a>00316        {
<a name="l00317"></a>00317             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00318"></a>00318                          <span class="stringliteral">&quot;Could not open file: %s&quot;</span>, fname);
<a name="l00319"></a>00319        }
<a name="l00320"></a>00320      fits_get_num_hdus (input, &amp;hdunum, &amp;f_status);
<a name="l00321"></a>00321      <span class="keywordflow">if</span> (f_status)
<a name="l00322"></a>00322        {
<a name="l00323"></a>00323             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00324"></a>00324                          <span class="stringliteral">&quot;Could get number of extension in file: %s&quot;</span>, fname);
<a name="l00325"></a>00325        }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327      fits_close_file (input, &amp;f_status);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329      <span class="keywordflow">return</span> hdunum;
<a name="l00330"></a>00330 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afdee57669eb437afcad30e96223b48a2"></a><!-- doxytag: member="aXe_utils.h::FITSHDU_to_gsl" ref="afdee57669eb437afcad30e96223b48a2" args="(const char *const fname, fitsfile *fptr, int fatal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* FITSHDU_to_gsl </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>fptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fatal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a FITS image from the current HDU into a gsl array</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fptr</em>&nbsp;</td><td>the number of the extension to read in (first primary = 1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fatal</em>&nbsp;</td><td>if non zero an error loading the data will trigger an exception </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a gsl_matrix containing the image data or NULL </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00641"></a>00641 {
<a name="l00642"></a>00642   <span class="keywordtype">int</span> f_status = 0;
<a name="l00643"></a>00643   <span class="keywordtype">float</span> nulval = 0;
<a name="l00644"></a>00644   <span class="keywordtype">int</span> anynul;
<a name="l00645"></a>00645   <span class="keywordtype">int</span> bitpix, naxis;
<a name="l00646"></a>00646   <span class="keywordtype">long</span> naxes[2];
<a name="l00647"></a>00647   <span class="keywordtype">long</span> zero[2] = { 1, 1 };
<a name="l00648"></a>00648   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *im;
<a name="l00649"></a>00649   <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *storage;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="comment">// determine the image information;</span>
<a name="l00652"></a>00652   <span class="comment">// complain if naxis is different from 1</span>
<a name="l00653"></a>00653   ffgipr (fptr, 2, &amp;bitpix, &amp;naxis, naxes, &amp;f_status);
<a name="l00654"></a>00654   <span class="keywordflow">if</span> (naxis != 2) {
<a name="l00655"></a>00655           <span class="keywordflow">if</span> (fatal) {
<a name="l00656"></a>00656                   fits_report_error (stderr, f_status);
<a name="l00657"></a>00657                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00658"></a>00658                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;%s is not a 2D FITS image.&quot;</span>,
<a name="l00659"></a>00659                                   fname);
<a name="l00660"></a>00660           } <span class="keywordflow">else</span> {
<a name="l00661"></a>00661                   fits_report_error (stderr, f_status);
<a name="l00662"></a>00662                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00663"></a>00663                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;%s is not a 2D FITS image.&quot;</span>,
<a name="l00664"></a>00664                                   fname);
<a name="l00665"></a>00665                   <span class="keywordflow">return</span> NULL;
<a name="l00666"></a>00666           }
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <span class="comment">// allocate memory</span>
<a name="l00670"></a>00670   <span class="keywordflow">if</span> (!(storage = malloc (naxes[0] * naxes[1] * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>))))
<a name="l00671"></a>00671       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00672"></a>00672                    <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <span class="comment">// transport the entire image data to the storage</span>
<a name="l00676"></a>00676   ffgpxv (fptr, TFLOAT, zero, naxes[0] * naxes[1], &amp;nulval, storage, &amp;anynul, &amp;f_status);
<a name="l00677"></a>00677   <span class="keywordflow">if</span> (f_status) {
<a name="l00678"></a>00678           <span class="keywordflow">if</span> (fatal) {
<a name="l00679"></a>00679                   fits_report_error (stderr, f_status);
<a name="l00680"></a>00680                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00681"></a>00681                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read data from an extention &quot;</span>
<a name="l00682"></a>00682                                   <span class="stringliteral">&quot; in file: %s&quot;</span>, fname);
<a name="l00683"></a>00683           } <span class="keywordflow">else</span> {
<a name="l00684"></a>00684                   fits_report_error (stderr, f_status);
<a name="l00685"></a>00685                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00686"></a>00686                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read data from an extention&quot;</span>
<a name="l00687"></a>00687                                   <span class="stringliteral">&quot; in file: %s&quot;</span>, fname);
<a name="l00688"></a>00688                   f_status = 0;
<a name="l00689"></a>00689                   fits_close_file (fptr, &amp;f_status);
<a name="l00690"></a>00690                   <span class="keywordflow">return</span> NULL;
<a name="l00691"></a>00691           }
<a name="l00692"></a>00692   }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">// transfer the storage to a gsl-image</span>
<a name="l00695"></a>00695   im = <a class="code" href="aXe__utils_8c.html#a616ed3bbb3c1b15f8127548fbe1d4701">storage_to_gsl</a>(naxes, storage);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="comment">// mop up and return the gsl-image</span>
<a name="l00698"></a>00698   free (storage);
<a name="l00699"></a>00699   storage = NULL;
<a name="l00700"></a>00700   <span class="keywordflow">return</span> im;
<a name="l00701"></a>00701 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae608ee7bf2717c17c842cd3dfd327884"></a><!-- doxytag: member="aXe_utils.h::FITSimage_to_gsl" ref="ae608ee7bf2717c17c842cd3dfd327884" args="(const char *const fname, int hdunum, int fatal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* FITSimage_to_gsl </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fatal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a FITS image into a gsl array</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>the number of the extension to read in (first primary = 1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fatal</em>&nbsp;</td><td>if non zero an error loading the data will trigger an exception </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a gsl_matrix (overriden in <a class="el" href="aXe__grism_8h.html">aXe_grism.h</a>) containing the image data or NULL </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00552"></a>00552 {
<a name="l00553"></a>00553   fitsfile *input;
<a name="l00554"></a>00554   <span class="keywordtype">int</span> f_status = 0;
<a name="l00555"></a>00555   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *im;
<a name="l00556"></a>00556   <span class="keywordtype">int</span> hdutype;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   <span class="comment">// open the fits file; complain if problems</span>
<a name="l00559"></a>00559   fits_open_file (&amp;input, fname, READONLY, &amp;f_status);
<a name="l00560"></a>00560   <span class="keywordflow">if</span> (f_status) {
<a name="l00561"></a>00561           <span class="keywordflow">if</span> (fatal) {
<a name="l00562"></a>00562                   fits_report_error (stderr, f_status);
<a name="l00563"></a>00563                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00564"></a>00564                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not open file %s:&quot;</span>, fname);
<a name="l00565"></a>00565           } <span class="keywordflow">else</span> {
<a name="l00566"></a>00566                   fits_report_error (stderr, f_status);
<a name="l00567"></a>00567                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00568"></a>00568                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not open file %s:&quot;</span>, fname);
<a name="l00569"></a>00569                   <span class="keywordflow">return</span> NULL;
<a name="l00570"></a>00570           }
<a name="l00571"></a>00571   }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="comment">// move to the correct HDU; complain if problems</span>
<a name="l00574"></a>00574   fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00575"></a>00575   <span class="keywordflow">if</span> (f_status) {
<a name="l00576"></a>00576           <span class="keywordflow">if</span> (fatal) {
<a name="l00577"></a>00577                   fits_report_error (stderr, f_status);
<a name="l00578"></a>00578                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00579"></a>00579                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read extention %d&quot;</span>
<a name="l00580"></a>00580                                   <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00581"></a>00581           } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582                   fits_report_error (stderr, f_status);
<a name="l00583"></a>00583                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00584"></a>00584                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read extention %d&quot;</span>
<a name="l00585"></a>00585                                   <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00586"></a>00586                   f_status = 0;
<a name="l00587"></a>00587                   fits_close_file (input, &amp;f_status);
<a name="l00588"></a>00588                   <span class="keywordflow">return</span> NULL;
<a name="l00589"></a>00589           }
<a name="l00590"></a>00590   }
<a name="l00591"></a>00591   <span class="keywordflow">if</span> (hdutype != 0) {
<a name="l00592"></a>00592           <span class="keywordflow">if</span> (fatal) {
<a name="l00593"></a>00593                   fits_report_error (stderr, f_status);
<a name="l00594"></a>00594                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00595"></a>00595                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span>
<a name="l00596"></a>00596                                   <span class="stringliteral">&quot; an image type&quot;</span>, hdunum, fname);
<a name="l00597"></a>00597           } <span class="keywordflow">else</span> {
<a name="l00598"></a>00598                   fits_report_error (stderr, f_status);
<a name="l00599"></a>00599                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00600"></a>00600                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span>
<a name="l00601"></a>00601                                   <span class="stringliteral">&quot; an image type&quot;</span>, hdunum, fname);
<a name="l00602"></a>00602                   <span class="keywordflow">return</span> NULL;
<a name="l00603"></a>00603           }
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   <span class="comment">// read the image data from the current HDU</span>
<a name="l00607"></a>00607   im = <a class="code" href="aXe__utils_8c.html#afdee57669eb437afcad30e96223b48a2">FITSHDU_to_gsl</a>(fname, input, fatal);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609   <span class="comment">// mop up</span>
<a name="l00610"></a>00610   fits_close_file (input, &amp;f_status);
<a name="l00611"></a>00611   <span class="keywordflow">if</span> (f_status) {
<a name="l00612"></a>00612           <span class="keywordflow">if</span> (fatal) {
<a name="l00613"></a>00613                   fits_report_error (stderr, f_status);
<a name="l00614"></a>00614                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00615"></a>00615                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not close file: %s&quot;</span>, fname);
<a name="l00616"></a>00616           } <span class="keywordflow">else</span> {
<a name="l00617"></a>00617                   fits_report_error (stderr, f_status);
<a name="l00618"></a>00618                   <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00619"></a>00619                                   <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not close  file: %s&quot;</span>, fname);
<a name="l00620"></a>00620                   f_status = 0;
<a name="l00621"></a>00621                   fits_close_file (input, &amp;f_status);
<a name="l00622"></a>00622                   <span class="keywordflow">return</span> NULL;
<a name="l00623"></a>00623           }
<a name="l00624"></a>00624   }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="comment">// return the gsl-image</span>
<a name="l00627"></a>00627   <span class="keywordflow">return</span> im;
<a name="l00628"></a>00628 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a18f07b887bcf78c0c0105912818b8a2b"></a><!-- doxytag: member="aXe_utils.h::FITSimage_to_gslOld" ref="a18f07b887bcf78c0c0105912818b8a2b" args="(const char *const fname, int hdunum, int fatal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* FITSimage_to_gslOld </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fatal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a FITS image into a gsl array</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>the number of the extension to read in (first primary = 1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fatal</em>&nbsp;</td><td>if non zero an error loading the data will trigger an exception </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a gsl_matrix (overriden in <a class="el" href="aXe__grism_8h.html">aXe_grism.h</a>) containing the image data or NULL </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00398"></a>00398 {
<a name="l00399"></a>00399   fitsfile *input;
<a name="l00400"></a>00400   <span class="keywordtype">int</span> f_status = 0;
<a name="l00401"></a>00401   <span class="keywordtype">float</span> nulval = 0;
<a name="l00402"></a>00402   <span class="keywordtype">int</span> anynul;
<a name="l00403"></a>00403   <span class="keywordtype">int</span> bitpix, naxis;
<a name="l00404"></a>00404   <span class="keywordtype">long</span> naxes[2];
<a name="l00405"></a>00405   <span class="keywordtype">long</span> zero[2] = { 1, 1 };
<a name="l00406"></a>00406   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *im;
<a name="l00407"></a>00407   <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *storage, *dp;
<a name="l00408"></a>00408   <span class="keywordtype">int</span> x, y;
<a name="l00409"></a>00409   <span class="keywordtype">int</span> hdutype;
<a name="l00410"></a>00410   
<a name="l00411"></a>00411   fits_open_file (&amp;input, fname, READONLY, &amp;f_status);
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (f_status)
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414       <span class="keywordflow">if</span> (fatal) 
<a name="l00415"></a>00415         {
<a name="l00416"></a>00416           fits_report_error (stderr, f_status);
<a name="l00417"></a>00417           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00418"></a>00418                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not open file %s:&quot;</span>, fname);
<a name="l00419"></a>00419         } <span class="keywordflow">else</span> {
<a name="l00420"></a>00420           fits_report_error (stderr, f_status);
<a name="l00421"></a>00421           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00422"></a>00422                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not open file %s:&quot;</span>, fname);
<a name="l00423"></a>00423           <span class="keywordflow">return</span> NULL;
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00427"></a>00427   <span class="keywordflow">if</span> (f_status)
<a name="l00428"></a>00428     {
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (fatal) 
<a name="l00430"></a>00430         {
<a name="l00431"></a>00431           fits_report_error (stderr, f_status);
<a name="l00432"></a>00432           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00433"></a>00433                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read extention %d&quot;</span>
<a name="l00434"></a>00434                        <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00435"></a>00435         } <span class="keywordflow">else</span> {
<a name="l00436"></a>00436           fits_report_error (stderr, f_status);
<a name="l00437"></a>00437           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00438"></a>00438                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read extention %d&quot;</span>
<a name="l00439"></a>00439                        <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00440"></a>00440           f_status = 0;
<a name="l00441"></a>00441           fits_close_file (input, &amp;f_status);
<a name="l00442"></a>00442           <span class="keywordflow">return</span> NULL;
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445   <span class="keywordflow">if</span> (hdutype != 0)
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447       <span class="keywordflow">if</span> (fatal) 
<a name="l00448"></a>00448         {
<a name="l00449"></a>00449           fits_report_error (stderr, f_status);
<a name="l00450"></a>00450           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00451"></a>00451                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span>
<a name="l00452"></a>00452                          <span class="stringliteral">&quot; an image type&quot;</span>, hdunum, fname);
<a name="l00453"></a>00453         } <span class="keywordflow">else</span> {
<a name="l00454"></a>00454           fits_report_error (stderr, f_status);
<a name="l00455"></a>00455           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00456"></a>00456                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span>
<a name="l00457"></a>00457                        <span class="stringliteral">&quot; an image type&quot;</span>, hdunum, fname);
<a name="l00458"></a>00458           <span class="keywordflow">return</span> NULL;
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461   ffgipr (input, 2, &amp;bitpix, &amp;naxis, naxes, &amp;f_status);
<a name="l00462"></a>00462   
<a name="l00463"></a>00463   <span class="keywordflow">if</span> (naxis != 2)
<a name="l00464"></a>00464     {
<a name="l00465"></a>00465       <span class="keywordflow">if</span> (fatal) 
<a name="l00466"></a>00466         {
<a name="l00467"></a>00467             fits_report_error (stderr, f_status);
<a name="l00468"></a>00468             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00469"></a>00469                          <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;%s is not a 2D FITS image.&quot;</span>,
<a name="l00470"></a>00470                          fname);
<a name="l00471"></a>00471         } <span class="keywordflow">else</span> {
<a name="l00472"></a>00472           fits_report_error (stderr, f_status);
<a name="l00473"></a>00473           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00474"></a>00474                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;%s is not a 2D FITS image.&quot;</span>,
<a name="l00475"></a>00475                        fname);
<a name="l00476"></a>00476           <span class="keywordflow">return</span> NULL;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479   
<a name="l00480"></a>00480   <span class="keywordflow">if</span> (!(storage = malloc (naxes[0] * naxes[1] * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>))))
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482       fits_report_error (stderr, f_status);
<a name="l00483"></a>00483       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00484"></a>00484                    <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486   
<a name="l00487"></a>00487   ffgpxv (input, TFLOAT, zero, naxes[0] * naxes[1], &amp;nulval,
<a name="l00488"></a>00488           storage, &amp;anynul, &amp;f_status);
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (f_status)
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (fatal) 
<a name="l00492"></a>00492         {
<a name="l00493"></a>00493           fits_report_error (stderr, f_status);
<a name="l00494"></a>00494           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00495"></a>00495                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read data from extention %d&quot;</span>
<a name="l00496"></a>00496                        <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00497"></a>00497         } <span class="keywordflow">else</span> {
<a name="l00498"></a>00498           fits_report_error (stderr, f_status);
<a name="l00499"></a>00499           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00500"></a>00500                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read data from extention %d&quot;</span>
<a name="l00501"></a>00501                          <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00502"></a>00502           f_status = 0;
<a name="l00503"></a>00503           fits_close_file (input, &amp;f_status);
<a name="l00504"></a>00504           <span class="keywordflow">return</span> NULL;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507   fits_close_file (input, &amp;f_status);
<a name="l00508"></a>00508   <span class="keywordflow">if</span> (f_status)
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510       <span class="keywordflow">if</span> (fatal) 
<a name="l00511"></a>00511         {
<a name="l00512"></a>00512           fits_report_error (stderr, f_status);
<a name="l00513"></a>00513           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00514"></a>00514                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not close file: %s&quot;</span>, fname);
<a name="l00515"></a>00515         } <span class="keywordflow">else</span> {
<a name="l00516"></a>00516           fits_report_error (stderr, f_status);
<a name="l00517"></a>00517           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00518"></a>00518                        <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not close  file: %s&quot;</span>, fname);
<a name="l00519"></a>00519           f_status = 0;
<a name="l00520"></a>00520           fits_close_file (input, &amp;f_status);
<a name="l00521"></a>00521           <span class="keywordflow">return</span> NULL;
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524   im = <a class="code" href="aXe__grism_8h.html#a1214ab1bea5fd80474d7a27db0bfb429">gsl_matrix_alloc</a> (naxes[0], naxes[1]);
<a name="l00525"></a>00525   dp = storage;
<a name="l00526"></a>00526   <span class="keywordflow">for</span> (y = 0; y &lt; naxes[1]; y++)
<a name="l00527"></a>00527     {
<a name="l00528"></a>00528       <span class="keywordflow">for</span> (x = 0; x &lt; naxes[0]; x++)
<a name="l00529"></a>00529         {
<a name="l00530"></a>00530           <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a> (im, x, y, *dp++);
<a name="l00531"></a>00531           
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534   
<a name="l00535"></a>00535   free (storage);
<a name="l00536"></a>00536   storage = NULL;
<a name="l00537"></a>00537   <span class="keywordflow">return</span> im;
<a name="l00538"></a>00538 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a74a75b4d9d74b257e44e6ec61ca79bf5"></a><!-- doxytag: member="aXe_utils.h::FITSnaxes_to_gsl" ref="a74a75b4d9d74b257e44e6ec61ca79bf5" args="(const char *const fname, int hdunum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* FITSnaxes_to_gsl </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a FITS image, DO not read data but return an empty gsl array This function is meant to be a faster way to get information about an <a class="el" href="structobservation.html">observation</a> rather than the actual data.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a gsl_matrix (overriden in <a class="el" href="aXe__grism_8h.html">aXe_grism.h</a>) containing the image data or NULL </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00343"></a>00343 {
<a name="l00344"></a>00344      fitsfile *input;
<a name="l00345"></a>00345      <span class="keywordtype">int</span> f_status = 0;
<a name="l00346"></a>00346      <span class="keywordtype">int</span> bitpix, naxis;
<a name="l00347"></a>00347      <span class="keywordtype">long</span> naxes[2];
<a name="l00348"></a>00348      <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *im;
<a name="l00349"></a>00349      <span class="keywordtype">int</span> hdutype;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351      fits_open_file (&amp;input, fname, READONLY, &amp;f_status);
<a name="l00352"></a>00352      <span class="keywordflow">if</span> (f_status)
<a name="l00353"></a>00353        {
<a name="l00354"></a>00354             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00355"></a>00355                          <span class="stringliteral">&quot;Could not open&quot;</span> <span class="stringliteral">&quot; file:&quot;</span>, fname);
<a name="l00356"></a>00356        }
<a name="l00357"></a>00357      fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00358"></a>00358      <span class="keywordflow">if</span> (f_status)
<a name="l00359"></a>00359        {
<a name="l00360"></a>00360             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00361"></a>00361                          <span class="stringliteral">&quot;Could not read extention %d&quot;</span> <span class="stringliteral">&quot; from file: %s&quot;</span>,
<a name="l00362"></a>00362                          hdunum, fname);
<a name="l00363"></a>00363        }
<a name="l00364"></a>00364      <span class="keywordflow">if</span> (hdutype != 0)
<a name="l00365"></a>00365        {
<a name="l00366"></a>00366             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00367"></a>00367                          <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span> <span class="stringliteral">&quot; an image type&quot;</span>,
<a name="l00368"></a>00368                          hdunum, fname);
<a name="l00369"></a>00369        }
<a name="l00370"></a>00370      ffgipr(input, 2, &amp;bitpix, &amp;naxis, naxes, &amp;f_status);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372      <span class="keywordflow">if</span> (naxis != 2)
<a name="l00373"></a>00373        {
<a name="l00374"></a>00374             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00375"></a>00375                          <span class="stringliteral">&quot;%s is not a 2D&quot;</span> <span class="stringliteral">&quot; FITS image.&quot;</span>, fname);
<a name="l00376"></a>00376        }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378      im = <a class="code" href="aXe__grism_8h.html#a1214ab1bea5fd80474d7a27db0bfb429">gsl_matrix_alloc</a> (naxes[0], naxes[1]);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380      <a class="code" href="aXe__grism_8h.html#af6161aeb008a1ffa7d888df6ccbef7cc">gsl_matrix_set_all</a> (im, 0.0);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 
<a name="l00383"></a>00383      <span class="keywordflow">return</span> im;
<a name="l00384"></a>00384 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab728171bc22cb503b1904ed113a8c36e"></a><!-- doxytag: member="aXe_utils.h::fprintf_object" ref="ab728171bc22cb503b1904ed113a8c36e" args="(FILE *output, object *o)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fprintf_object </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobject.html">object</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>output the content of an <a class="el" href="structobject.html">object</a> structure </p>

<p><div class="fragment"><pre class="fragment"><a name="l01881"></a>01881 {
<a name="l01882"></a>01882      <span class="keywordtype">int</span> i, j;
<a name="l01883"></a>01883 
<a name="l01884"></a>01884      fprintf (output, <span class="stringliteral">&quot;object ID: %d\n&quot;</span>, o-&gt;<a class="code" href="structobject.html#a8575880bdfc1c0bf44914b4efd2665bf">ID</a>);
<a name="l01885"></a>01885      fprintf (output, <span class="stringliteral">&quot;object nbeams: %d\n&quot;</span>, o-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a>);
<a name="l01886"></a>01886 
<a name="l01887"></a>01887      <span class="keywordflow">for</span> (i = 0; i &lt; o-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a>; i++)
<a name="l01888"></a>01888        {
<a name="l01889"></a>01889             fprintf (output, <span class="stringliteral">&quot;object beam ID: #%d ID\n&quot;</span>, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>);
<a name="l01890"></a>01890             fprintf (output, <span class="stringliteral">&quot;object beam #%d refpixel: %f %f\n&quot;</span>,
<a name="l01891"></a>01891                      o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>,
<a name="l01892"></a>01892                      o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>);
<a name="l01893"></a>01893 
<a name="l01894"></a>01894             <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++)
<a name="l01895"></a>01895               {
<a name="l01896"></a>01896                    fprintf (output, <span class="stringliteral">&quot;object beam #%d corner[%d]: %d %d\n&quot;</span>,
<a name="l01897"></a>01897                             o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>, j, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[j].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a>,
<a name="l01898"></a>01898                             o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[j].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>);
<a name="l01899"></a>01899               }
<a name="l01900"></a>01900 
<a name="l01901"></a>01901             <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++)
<a name="l01902"></a>01902               {
<a name="l01903"></a>01903                    fprintf (output, <span class="stringliteral">&quot;object beam #%d bbox[%d]: %d %d\n&quot;</span>,
<a name="l01904"></a>01904                             o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>, j, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[j].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a>,
<a name="l01905"></a>01905                             o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[j].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>);
<a name="l01906"></a>01906               }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908             fprintf (output, <span class="stringliteral">&quot;object beam #%d width: %f\n&quot;</span>, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>,
<a name="l01909"></a>01909                      o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a>);
<a name="l01910"></a>01910             fprintf (output, <span class="stringliteral">&quot;object beam #%d orient: %f\n&quot;</span>, o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>,
<a name="l01911"></a>01911                      o-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i].<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>);
<a name="l01912"></a>01912 
<a name="l01913"></a>01913 
<a name="l01914"></a>01914        }
<a name="l01915"></a>01915 
<a name="l01916"></a>01916 
<a name="l01917"></a>01917 
<a name="l01918"></a>01918 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac8d8059b1a87e608b4570096fba84d01"></a><!-- doxytag: member="aXe_utils.h::free_char_arr" ref="ac8d8059b1a87e608b4570096fba84d01" args="(char **char_arr, int nrows)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_char_arr </td>
          <td>(</td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>char_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nrows</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_char_arr The function releases the memory allocated in a memory array.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>char_arr</em>&nbsp;</td><td>- pointer to the character array </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nrows</em>&nbsp;</td><td>- the number of rows in the character array </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01729"></a>01729 {
<a name="l01730"></a>01730   <span class="keywordtype">int</span> i;
<a name="l01731"></a>01731 
<a name="l01732"></a>01732   <span class="comment">// for each row</span>
<a name="l01733"></a>01733   <span class="keywordflow">for</span>(i=0; i &lt; nrows; i++)
<a name="l01734"></a>01734     <span class="comment">// release the memory</span>
<a name="l01735"></a>01735     free(char_arr[i]);
<a name="l01736"></a>01736 
<a name="l01737"></a>01737   <span class="comment">// release the rest</span>
<a name="l01738"></a>01738   free(char_arr);
<a name="l01739"></a>01739 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1f63bfb071e9d0ea1f8854efdfae4692"></a><!-- doxytag: member="aXe_utils.h::free_oblist" ref="a1f63bfb071e9d0ea1f8854efdfae4692" args="(object **oblist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_oblist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structobject.html">object</a> **&nbsp;</td>
          <td class="paramname"> <em>oblist</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Free a NULL terminated array of objects</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs,a</em>&nbsp;</td><td>NULL terminated array containing pointers to objects </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01845"></a>01845 {
<a name="l01846"></a>01846   <span class="keywordtype">int</span> i, j, nobjs = 0;
<a name="l01847"></a>01847 
<a name="l01848"></a>01848   <span class="comment">/* Find the number of objects in sobjs */</span>
<a name="l01849"></a>01849   <span class="keywordflow">while</span> (oblist[nobjs])
<a name="l01850"></a>01850     nobjs++;
<a name="l01851"></a>01851   
<a name="l01852"></a>01852   <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l01853"></a>01853     {
<a name="l01854"></a>01854       <span class="keywordflow">for</span> (j=0;j &lt; oblist[i]-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a>; j++){
<a name="l01855"></a>01855         free(oblist[i]-&gt;beams[j].spec_trace-&gt;data);
<a name="l01856"></a>01856         free(oblist[i]-&gt;beams[j].spec_trace);
<a name="l01857"></a>01857 
<a name="l01858"></a>01858         <span class="keywordflow">if</span> (oblist[i]-&gt;beams[j].flux != NULL){
<a name="l01859"></a>01859           gsl_vector_free (oblist[i]-&gt;beams[j].flux);      
<a name="l01860"></a>01860           <span class="comment">//      fprintf(stderr, &quot;FLux was freed\n&quot;);</span>
<a name="l01861"></a>01861         }
<a name="l01862"></a>01862         <span class="keywordflow">else</span>{
<a name="l01863"></a>01863           <span class="comment">//      fprintf(stderr, &quot;FLux is NULL\n&quot;);</span>
<a name="l01864"></a>01864         }
<a name="l01865"></a>01865         <span class="comment">//free(oblist[i]-&gt;*beams[j]);</span>
<a name="l01866"></a>01866       }
<a name="l01867"></a>01867       free (oblist[i]);
<a name="l01868"></a>01868       oblist[i] = NULL;
<a name="l01869"></a>01869     }
<a name="l01870"></a>01870   free (oblist);
<a name="l01871"></a>01871   oblist = NULL;
<a name="l01872"></a>01872 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaf6850286e924fd44f65af2cf80894f0"></a><!-- doxytag: member="aXe_utils.h::free_observation" ref="aaf6850286e924fd44f65af2cf80894f0" args="(observation *obs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_observation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *&nbsp;</td>
          <td class="paramname"> <em>obs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function to free an <a class="el" href="structobservation.html">observation</a> struture</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>an <a class="el" href="structobservation.html">observation</a> pointer </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l02001"></a>02001 {
<a name="l02002"></a>02002   <span class="keywordflow">if</span> (obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a> != NULL)
<a name="l02003"></a>02003     <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>);
<a name="l02004"></a>02004   <span class="keywordflow">if</span> (obs-&gt;<a class="code" href="structobservation.html#a79ef486b081fa7b1973c39323f163010">pixerrs</a> != NULL)
<a name="l02005"></a>02005     <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (obs-&gt;<a class="code" href="structobservation.html#a79ef486b081fa7b1973c39323f163010">pixerrs</a>);
<a name="l02006"></a>02006   <span class="keywordflow">if</span> (obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a> != NULL)
<a name="l02007"></a>02007     <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a>);
<a name="l02008"></a>02008   free (obs);
<a name="l02009"></a>02009 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1a7ef7b7d19206e1df681bf2bea0d7c"></a><!-- doxytag: member="aXe_utils.h::get_FITS_cards" ref="aa1a7ef7b7d19206e1df681bf2bea0d7c" args="(char filename[], int hdu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structFITScards.html">FITScards</a>* get_FITS_cards </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns a NULL terminated array of *char which each contain a card from a given hdu from a given FITS file. NAXES, NAXIS, BITPIX, SIMPLE, EXTEND, ID*, DATE cards are ignored.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to a string containing the name of the FITS file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdu</em>&nbsp;</td><td>the number of the HDU in the input FITS file to access</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a NULL terminated array of char arrays </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <span class="keywordtype">int</span> f_status=0;
<a name="l01295"></a>01295     <span class="keywordtype">int</span> ninc, nexc;
<a name="l01296"></a>01296     fitsfile *input;
<a name="l01297"></a>01297     <a class="code" href="structFITScards.html">FITScards</a> *cards=NULL;
<a name="l01298"></a>01298     <span class="keywordtype">int</span> hdutype,i,n;
<a name="l01299"></a>01299     <span class="keywordtype">char</span> card[FLEN_CARD];
<a name="l01300"></a>01300     <span class="keywordtype">char</span> *inclist[1] = {
<a name="l01301"></a>01301     <span class="stringliteral">&quot;*&quot;</span>
<a name="l01302"></a>01302     };
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     <span class="keywordtype">char</span> *exclist[7] = {
<a name="l01305"></a>01305     <span class="stringliteral">&quot;NAXES&quot;</span>,
<a name="l01306"></a>01306     <span class="stringliteral">&quot;NAXIS*&quot;</span>,
<a name="l01307"></a>01307     <span class="stringliteral">&quot;BITPIX&quot;</span>,
<a name="l01308"></a>01308     <span class="stringliteral">&quot;SIMPLE&quot;</span>,
<a name="l01309"></a>01309     <span class="stringliteral">&quot;EXTEND&quot;</span>,
<a name="l01310"></a>01310     <span class="stringliteral">&quot;ID*&quot;</span>,
<a name="l01311"></a>01311     <span class="stringliteral">&quot;DATE&quot;</span>
<a name="l01312"></a>01312     };
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     ninc = 1;
<a name="l01315"></a>01315     nexc = 7;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 
<a name="l01318"></a>01318     <span class="comment">//  Open the file for creating/appending</span>
<a name="l01319"></a>01319     fits_open_file (&amp;input, filename, READONLY, &amp;f_status);
<a name="l01320"></a>01320     <span class="keywordflow">if</span> (f_status)
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322         ffrprt (stderr, f_status);
<a name="l01323"></a>01323         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01324"></a>01324             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l01325"></a>01325             filename);
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="comment">// Move to the desired HDU</span>
<a name="l01329"></a>01329     fits_movabs_hdu (input, hdu, &amp;hdutype, &amp;f_status);
<a name="l01330"></a>01330     <span class="keywordflow">if</span> (f_status)
<a name="l01331"></a>01331     {
<a name="l01332"></a>01332         ffrprt (stderr, f_status);
<a name="l01333"></a>01333         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01334"></a>01334             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not move to extension %d in file: %s&quot;</span>,
<a name="l01335"></a>01335             hdu,filename);
<a name="l01336"></a>01336     }
<a name="l01337"></a>01337 
<a name="l01338"></a>01338     <span class="comment">// Find the number of cards in this HDU</span>
<a name="l01339"></a>01339     n = 0;    
<a name="l01340"></a>01340     <span class="keywordflow">do</span> {
<a name="l01341"></a>01341         fits_find_nextkey (input, inclist, ninc, exclist,
<a name="l01342"></a>01342          nexc, card, &amp;f_status);    
<a name="l01343"></a>01343         n++;
<a name="l01344"></a>01344     }
<a name="l01345"></a>01345     <span class="keywordflow">while</span> (f_status==0);
<a name="l01346"></a>01346     <span class="keywordflow">if</span> (f_status!= KEY_NO_EXIST) {
<a name="l01347"></a>01347         ffrprt (stderr, f_status);
<a name="l01348"></a>01348         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01349"></a>01349             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Problem reading keys in extension %d of file: %s&quot;</span>,
<a name="l01350"></a>01350             hdu,filename);
<a name="l01351"></a>01351     }
<a name="l01352"></a>01352     f_status = 0;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 
<a name="l01355"></a>01355     <span class="comment">// Allocate enough room (n+1 for NULL termination) for all the cards</span>
<a name="l01356"></a>01356     <span class="comment">//cards = (char **) malloc(sizeof(char *)*(n+1));</span>
<a name="l01357"></a>01357     <span class="comment">//for(i=0;i&lt;(n+1);i++) cards[i] = malloc(sizeof(char)*FLEN_CARD);</span>
<a name="l01358"></a>01358     cards = <a class="code" href="spc__FITScards_8c.html#a2b3df1d707d609ec92e837b96e79140d">allocate_FITScards</a>(n);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     <span class="comment">// Move back tot he top of the HDU</span>
<a name="l01361"></a>01361     fits_read_record (input, 0, card, &amp;f_status);
<a name="l01362"></a>01362     <span class="keywordflow">if</span> (f_status)
<a name="l01363"></a>01363     {
<a name="l01364"></a>01364         ffrprt (stderr, f_status);
<a name="l01365"></a>01365         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01366"></a>01366             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not move to first card in extension %d in file: %s&quot;</span>,
<a name="l01367"></a>01367             hdu,filename);
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370     <span class="comment">// Read all cards </span>
<a name="l01371"></a>01371     i=0;
<a name="l01372"></a>01372     <span class="keywordflow">do</span> {
<a name="l01373"></a>01373         fits_find_nextkey (input, inclist, ninc, exclist,
<a name="l01374"></a>01374          nexc, cards-&gt;<a class="code" href="structFITScards.html#ad1be9be894e41dec8131959f119b387c">cards</a>[i], &amp;f_status);    
<a name="l01375"></a>01375         <span class="comment">//fprintf(stderr,&quot;%s\n&quot;,cards-&gt;cards[i]);</span>
<a name="l01376"></a>01376         i++;
<a name="l01377"></a>01377     }
<a name="l01378"></a>01378     <span class="keywordflow">while</span> (f_status==0);
<a name="l01379"></a>01379     <span class="keywordflow">if</span> (f_status!= KEY_NO_EXIST) {
<a name="l01380"></a>01380         ffrprt (stderr, f_status);
<a name="l01381"></a>01381         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01382"></a>01382             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Problem reading keys in extension %d of file: %s&quot;</span>,
<a name="l01383"></a>01383             hdu,filename);
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385     f_status = 0;
<a name="l01386"></a>01386     
<a name="l01387"></a>01387     <span class="comment">// NULL terminate the card array</span>
<a name="l01388"></a>01388     <span class="comment">//cards[n] = NULL;</span>
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     fits_close_file (input, &amp;f_status);
<a name="l01391"></a>01391     <span class="keywordflow">return</span> cards;
<a name="l01392"></a>01392 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a27dd022a77729a35640126b146b35825"></a><!-- doxytag: member="aXe_utils.h::get_FITS_cards_opened" ref="a27dd022a77729a35640126b146b35825" args="(fitsfile *input)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structFITScards.html">FITScards</a>* get_FITS_cards_opened </td>
          <td>(</td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>input</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01396"></a>01396 {
<a name="l01397"></a>01397     <span class="keywordtype">int</span> f_status=0;
<a name="l01398"></a>01398     <span class="keywordtype">int</span> ninc, nexc;
<a name="l01399"></a>01399     <a class="code" href="structFITScards.html">FITScards</a> *cards=NULL;
<a name="l01400"></a>01400     <span class="comment">//int hdutype;</span>
<a name="l01401"></a>01401         <span class="keywordtype">int</span> i,n;
<a name="l01402"></a>01402     <span class="keywordtype">char</span> card[FLEN_CARD];
<a name="l01403"></a>01403     <span class="keywordtype">char</span> *inclist[1] = {
<a name="l01404"></a>01404     <span class="stringliteral">&quot;*&quot;</span>
<a name="l01405"></a>01405     };
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="keywordtype">char</span> *exclist[15] = {
<a name="l01408"></a>01408     <span class="stringliteral">&quot;NAXES&quot;</span>,
<a name="l01409"></a>01409     <span class="stringliteral">&quot;NAXIS*&quot;</span>,
<a name="l01410"></a>01410     <span class="stringliteral">&quot;BITPIX&quot;</span>,
<a name="l01411"></a>01411     <span class="stringliteral">&quot;SIMPLE&quot;</span>,
<a name="l01412"></a>01412     <span class="stringliteral">&quot;EXTEND&quot;</span>,
<a name="l01413"></a>01413     <span class="stringliteral">&quot;ID*&quot;</span>,
<a name="l01414"></a>01414     <span class="stringliteral">&quot;DATE&quot;</span>,
<a name="l01415"></a>01415     <span class="stringliteral">&quot;EXTNAME&quot;</span>,
<a name="l01416"></a>01416     <span class="stringliteral">&quot;TTYPE*&quot;</span>,
<a name="l01417"></a>01417     <span class="stringliteral">&quot;TFORM*&quot;</span>,
<a name="l01418"></a>01418     <span class="stringliteral">&quot;TUNIT*&quot;</span>,
<a name="l01419"></a>01419     <span class="stringliteral">&quot;TFIELDS&quot;</span>,
<a name="l01420"></a>01420     <span class="stringliteral">&quot;XTENSION&quot;</span>,
<a name="l01421"></a>01421     <span class="stringliteral">&quot;PCOUNT&quot;</span>,
<a name="l01422"></a>01422     <span class="stringliteral">&quot;GCOUNT&quot;</span>
<a name="l01423"></a>01423     };
<a name="l01424"></a>01424 
<a name="l01425"></a>01425     ninc = 1;
<a name="l01426"></a>01426     nexc = 15;
<a name="l01427"></a>01427 
<a name="l01428"></a>01428 
<a name="l01429"></a>01429     <span class="comment">// Move back tot he top of the HDU</span>
<a name="l01430"></a>01430     fits_read_record (input, 0, card, &amp;f_status);
<a name="l01431"></a>01431     <span class="keywordflow">if</span> (f_status)
<a name="l01432"></a>01432     {
<a name="l01433"></a>01433         ffrprt (stderr, f_status);
<a name="l01434"></a>01434         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01435"></a>01435             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not move to first card in FITS extension&quot;</span>);
<a name="l01436"></a>01436     }
<a name="l01437"></a>01437     <span class="comment">// Find the number of cards in this HDU</span>
<a name="l01438"></a>01438     n = 0;    
<a name="l01439"></a>01439     <span class="keywordflow">do</span> {
<a name="l01440"></a>01440         fits_find_nextkey (input, inclist, ninc, exclist,
<a name="l01441"></a>01441          nexc, card, &amp;f_status);    
<a name="l01442"></a>01442         n++;
<a name="l01443"></a>01443     }
<a name="l01444"></a>01444     <span class="keywordflow">while</span> (f_status==0);
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (f_status!= KEY_NO_EXIST) {
<a name="l01446"></a>01446         ffrprt (stderr, f_status);
<a name="l01447"></a>01447         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01448"></a>01448             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Problem reading keys in FITS extension&quot;</span>);
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450     f_status = 0;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <span class="comment">// Allocate enough room for all the cards</span>
<a name="l01453"></a>01453     cards = <a class="code" href="spc__FITScards_8c.html#a2b3df1d707d609ec92e837b96e79140d">allocate_FITScards</a>(n);
<a name="l01454"></a>01454     <span class="comment">// Move back tot he top of the HDU</span>
<a name="l01455"></a>01455     fits_read_record (input, 0, card, &amp;f_status);
<a name="l01456"></a>01456     <span class="keywordflow">if</span> (f_status)
<a name="l01457"></a>01457     {
<a name="l01458"></a>01458         ffrprt (stderr, f_status);
<a name="l01459"></a>01459         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01460"></a>01460             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not move to first card in FITS extension&quot;</span>);
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <span class="comment">// Read all cards </span>
<a name="l01464"></a>01464     i=0;
<a name="l01465"></a>01465     <span class="keywordflow">do</span> {
<a name="l01466"></a>01466         fits_find_nextkey (input, inclist, ninc, exclist,
<a name="l01467"></a>01467          nexc, cards-&gt;<a class="code" href="structFITScards.html#ad1be9be894e41dec8131959f119b387c">cards</a>[i], &amp;f_status);    
<a name="l01468"></a>01468         i++;
<a name="l01469"></a>01469     } <span class="keywordflow">while</span> (f_status==0);
<a name="l01470"></a>01470     <span class="keywordflow">if</span> (f_status!= KEY_NO_EXIST) {
<a name="l01471"></a>01471         ffrprt (stderr, f_status);
<a name="l01472"></a>01472         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01473"></a>01473             <span class="stringliteral">&quot;get_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Problem reading keys in FITS extension&quot;</span>);
<a name="l01474"></a>01474     }
<a name="l01475"></a>01475     f_status = 0;
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="keywordflow">return</span> cards;
<a name="l01478"></a>01478 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8817e86558786acb16965f3ac1215992"></a><!-- doxytag: member="aXe_utils.h::get_float_from_keyword" ref="a8817e86558786acb16965f3ac1215992" args="(char *filename, int hdunum, char *keyword)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_float_from_keyword </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>keyword</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a FITS file header and return the value of the derired keyword. If the passed keyword string contains an actual number, then this number of converted to a float and returned. If keyword=None, then NULL is returned.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to a char array containing the name of the FITS file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>the number of the extension to access </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>keyword</em>&nbsp;</td><td>a pointer to a char array containing the name of the keyword, or a number</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the floating point value read from the FITS file or converted from the passed string </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 {
<a name="l00235"></a>00235   fitsfile *input;
<a name="l00236"></a>00236   <span class="keywordtype">int</span> f_status = 0, hdutype;
<a name="l00237"></a>00237   <span class="keywordtype">float</span> val=-1.0;
<a name="l00238"></a>00238   <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="comment">/* If keyword contains an actual number, convert it to a float and</span>
<a name="l00241"></a>00241 <span class="comment">     return the value */</span>
<a name="l00242"></a>00242   <span class="comment">//     fprintf(stdout, &quot;opening: %s\n&quot;, filename);      </span>
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a4a82c9b42093bc1e0795ef6441f89c49">isnum2</a>(keyword)) {
<a name="l00244"></a>00244     val =  atof(keyword);
<a name="l00245"></a>00245     <span class="keywordflow">return</span> val;
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247   
<a name="l00248"></a>00248   <span class="comment">/* If keyword == None return NULL */</span>
<a name="l00249"></a>00249   <span class="keywordflow">if</span> (!strcmp(keyword,<span class="stringliteral">&quot;None&quot;</span>)) <span class="keywordflow">return</span> GSL_NAN;
<a name="l00250"></a>00250   
<a name="l00251"></a>00251   <span class="comment">//  Open the file for creating/appending</span>
<a name="l00252"></a>00252   <span class="comment">//   fprintf(stdout, &quot;opening: %s\n&quot;, filename);        </span>
<a name="l00253"></a>00253   fits_open_file (&amp;input, filename, READONLY, &amp;f_status);
<a name="l00254"></a>00254   <span class="keywordflow">if</span> (f_status)
<a name="l00255"></a>00255     {
<a name="l00256"></a>00256       ffrprt (stderr, f_status);
<a name="l00257"></a>00257       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00258"></a>00258                    <span class="stringliteral">&quot;get_float_from_keyword: &quot;</span> <span class="stringliteral">&quot; Could not open file: %s&quot;</span>,
<a name="l00259"></a>00259                    filename);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261   
<a name="l00262"></a>00262   fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00263"></a>00263   <span class="keywordflow">if</span> (f_status)
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265       ffrprt (stderr, f_status);
<a name="l00266"></a>00266       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00267"></a>00267                    <span class="stringliteral">&quot;get_float_from_keyword: &quot;</span>
<a name="l00268"></a>00268                    <span class="stringliteral">&quot;Could not read extention %d from file: %s&quot;</span>, hdunum,
<a name="l00269"></a>00269                    filename);
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273   fits_read_key_flt (input, keyword, &amp;val, comment, &amp;f_status);
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (f_status)
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276       <span class="comment">//      aXe_message (aXe_M_WARN4, __FILE__, __LINE__,</span>
<a name="l00277"></a>00277       <span class="comment">//                   &quot;get_float_from_keyword: Could not read keyword %s from file: %s \n&quot;,</span>
<a name="l00278"></a>00278       <span class="comment">//                   keyword,filename);</span>
<a name="l00279"></a>00279       f_status=0;
<a name="l00280"></a>00280       fits_close_file (input, &amp;f_status);
<a name="l00281"></a>00281       <span class="keywordflow">if</span> (f_status)
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00284"></a>00284                        <span class="stringliteral">&quot;get_float_from_keyword: &quot;</span> <span class="stringliteral">&quot;Error closing file: %s &quot;</span>,
<a name="l00285"></a>00285                        filename);
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287       <span class="keywordflow">return</span> GSL_NAN;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   fits_close_file (input, &amp;f_status);
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (f_status)
<a name="l00293"></a>00293     {
<a name="l00294"></a>00294       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00295"></a>00295                    <span class="stringliteral">&quot;get_float_from_keyword: &quot;</span> <span class="stringliteral">&quot;Error closing file: %s &quot;</span>,
<a name="l00296"></a>00296                    filename);
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298   
<a name="l00299"></a>00299   <span class="keywordflow">return</span> val;
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae2b196b3eec481bec79c35394e75e4fc"></a><!-- doxytag: member="aXe_utils.h::get_hdunum_from_hduname" ref="ae2b196b3eec481bec79c35394e75e4fc" args="(char filename[], char extname[], char keyword[], char keyval[], int extver)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_hdunum_from_hduname </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>extname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>keyword</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>keyval</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>extver</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A helper function which returns the extension number in a FITS file which has a given name and also optionally containing a given keyword/key combination. The leyword/key pair is meant to diferentiate between different extensions os the same types. For example between two SCI extension containing CCDNUM=1 or CCDNUM=2 keys.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to a string containing the name of an existing FITS file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>extname</em>&nbsp;</td><td>a pointer to a string containing the name of the extension to look for </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>keyword</em>&nbsp;</td><td>a pointer to a string containing the name of an extra keyword to lolok for. Can be set to NULL </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>pointer to a string containing the value of the optional key we are looking for </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l02032"></a>02032 {
<a name="l02033"></a>02033   fitsfile *input;
<a name="l02034"></a>02034   <span class="keywordtype">int</span> f_status = 0;
<a name="l02035"></a>02035   <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l02036"></a>02036   <span class="keywordtype">char</span> sval[FLEN_VALUE];
<a name="l02037"></a>02037   <span class="keywordtype">int</span> i,hdunum,hduext;
<a name="l02038"></a>02038 
<a name="l02039"></a>02039   <span class="comment">/* If the extname is a number then we simply return that number */</span>
<a name="l02040"></a>02040   <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a4a82c9b42093bc1e0795ef6441f89c49">isnum2</a>(extname)) {
<a name="l02041"></a>02041     hdunum = (long) atoi(extname);
<a name="l02042"></a>02042     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) hdunum;
<a name="l02043"></a>02043   }
<a name="l02044"></a>02044 
<a name="l02045"></a>02045   <span class="comment">/* If it not then we first look for the names extension */</span>
<a name="l02046"></a>02046   <span class="comment">//  fprintf(stderr,&quot;Extension keyword %s %i kkkk \n&quot;,filename, f_status);</span>
<a name="l02047"></a>02047   fits_open_file (&amp;input, filename, READONLY, &amp;f_status);
<a name="l02048"></a>02048   <span class="keywordflow">if</span> (f_status)
<a name="l02049"></a>02049     {
<a name="l02050"></a>02050       ffrprt (stderr, f_status);
<a name="l02051"></a>02051       <span class="keywordflow">return</span> -1;
<a name="l02052"></a>02052     }
<a name="l02053"></a>02053   i=0;
<a name="l02054"></a>02054   <span class="keywordflow">while</span> (!f_status) {
<a name="l02055"></a>02055     <span class="comment">/* Keep looking for extensions matching the required */</span>
<a name="l02056"></a>02056     <span class="comment">/* extname */</span>
<a name="l02057"></a>02057     i++;
<a name="l02058"></a>02058     fits_movabs_hdu (input, i, NULL, &amp;f_status);
<a name="l02059"></a>02059     <span class="keywordflow">if</span> (f_status) {
<a name="l02060"></a>02060       <span class="comment">/* No more HDU found. If we are here then we failed to find */</span>
<a name="l02061"></a>02061       <span class="comment">/* a matching extension and return -1 */</span>
<a name="l02062"></a>02062       f_status = 0;
<a name="l02063"></a>02063       fits_close_file (input, &amp;f_status);
<a name="l02064"></a>02064       <span class="keywordflow">return</span> -1;
<a name="l02065"></a>02065     }
<a name="l02066"></a>02066     <span class="comment">/* Read extname and try to match it */</span>
<a name="l02067"></a>02067     fits_read_key_str (input, <span class="stringliteral">&quot;EXTNAME&quot;</span>, sval, comment, &amp;f_status);
<a name="l02068"></a>02068     <span class="keywordflow">if</span> (f_status) {
<a name="l02069"></a>02069       <span class="comment">/* Did not manage to get EXTNAME, keep looking */</span>
<a name="l02070"></a>02070       f_status = 0;
<a name="l02071"></a>02071       <span class="keywordflow">continue</span>;
<a name="l02072"></a>02072     } <span class="keywordflow">else</span> {
<a name="l02073"></a>02073       <span class="comment">/* found EXTNAME, check if it is the one we want, or continue */</span>
<a name="l02074"></a>02074       <span class="comment">//      fprintf(stdout,&quot;Extension name %s kkkk \n&quot;,sval);</span>
<a name="l02075"></a>02075       <span class="keywordflow">if</span> (strcmp(extname,sval)) {
<a name="l02076"></a>02076         f_status = 0;
<a name="l02077"></a>02077         <span class="keywordflow">continue</span>;
<a name="l02078"></a>02078       }
<a name="l02079"></a>02079     }
<a name="l02080"></a>02080     <span class="comment">/* If the passed keyword is non NULL then we attempt to match it */</span>
<a name="l02081"></a>02081     <span class="comment">/* otherwise, we are done */</span>
<a name="l02082"></a>02082     <span class="keywordflow">if</span> (!strcmp(keyword,<span class="stringliteral">&quot;None&quot;</span>)) {
<a name="l02083"></a>02083       fits_get_hdu_num(input,&amp;hdunum);
<a name="l02084"></a>02084       fits_close_file (input, &amp;f_status);
<a name="l02085"></a>02085       <span class="keywordflow">return</span> hdunum;
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087     fits_read_key_str (input, keyword, sval, comment, &amp;f_status);
<a name="l02088"></a>02088     <span class="keywordflow">if</span> (f_status) {
<a name="l02089"></a>02089 <span class="comment">/* keyword was not found, try whether the EXTVER keyword matches */</span>
<a name="l02090"></a>02090       <span class="keywordflow">if</span> (extver &gt; -1){
<a name="l02091"></a>02091         f_status = 0;
<a name="l02092"></a>02092         fits_read_key_str (input, <span class="stringliteral">&quot;EXTVER&quot;</span>, sval, comment, &amp;f_status);
<a name="l02093"></a>02093         <span class="keywordflow">if</span> (f_status) {
<a name="l02094"></a>02094           f_status = 0;
<a name="l02095"></a>02095           <span class="keywordflow">continue</span>;
<a name="l02096"></a>02096         }
<a name="l02097"></a>02097         <span class="keywordflow">else</span>{
<a name="l02098"></a>02098           hduext = atoi(sval);
<a name="l02099"></a>02099           <span class="keywordflow">if</span> (hduext == extver){
<a name="l02100"></a>02100             fits_get_hdu_num(input,&amp;hdunum);
<a name="l02101"></a>02101             fits_close_file (input, &amp;f_status);
<a name="l02102"></a>02102             <span class="keywordflow">return</span> hdunum;
<a name="l02103"></a>02103           }
<a name="l02104"></a>02104           <span class="keywordflow">else</span>{
<a name="l02105"></a>02105           f_status = 0;
<a name="l02106"></a>02106           <span class="keywordflow">continue</span>;
<a name="l02107"></a>02107           }
<a name="l02108"></a>02108         }
<a name="l02109"></a>02109       }
<a name="l02110"></a>02110       <span class="keywordflow">else</span> {
<a name="l02111"></a>02111         f_status = 0;
<a name="l02112"></a>02112         <span class="keywordflow">continue</span>;
<a name="l02113"></a>02113       }
<a name="l02114"></a>02114     } <span class="keywordflow">else</span> {
<a name="l02115"></a>02115       <span class="keywordflow">if</span> (strcmp(sval,keyval)) {
<a name="l02116"></a>02116         <span class="comment">/* keyword was found but does not match the passed value */</span>
<a name="l02117"></a>02117         <span class="comment">/* skip to next HDU */</span>
<a name="l02118"></a>02118         <span class="keywordflow">continue</span>;
<a name="l02119"></a>02119       } <span class="keywordflow">else</span> {
<a name="l02120"></a>02120         <span class="comment">/* keyword was found and the key matches, return the current */</span>
<a name="l02121"></a>02121         <span class="comment">/* HDU number */</span>
<a name="l02122"></a>02122         fits_get_hdu_num(input,&amp;hdunum);
<a name="l02123"></a>02123         fits_close_file (input, &amp;f_status);
<a name="l02124"></a>02124         <span class="keywordflow">return</span> hdunum;
<a name="l02125"></a>02125       }
<a name="l02126"></a>02126     }
<a name="l02127"></a>02127   }
<a name="l02128"></a>02128   <span class="keywordflow">return</span> -1;
<a name="l02129"></a>02129 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae7f4f277c2b5d03b7ce52b2392d176b2"></a><!-- doxytag: member="aXe_utils.h::get_npixel" ref="ae7f4f277c2b5d03b7ce52b2392d176b2" args="(const observation *obs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structpx__point.html">px_point</a> get_npixel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobservation.html">observation</a> *&nbsp;</td>
          <td class="paramname"> <em>obs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_npixel The function extracts the number of pixels in x an y or the science image associated to an 'observation'-structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- the <a class="el" href="structobservation.html">observation</a> with the science image</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>npixels - the struct to store the pixel numbers in x and y </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l02220"></a>02220 {
<a name="l02221"></a>02221 
<a name="l02222"></a>02222   <a class="code" href="structpx__point.html">px_point</a> npixels;
<a name="l02223"></a>02223 
<a name="l02224"></a>02224   npixels.<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size1;
<a name="l02225"></a>02225   npixels.<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>-&gt;size2;
<a name="l02226"></a>02226 
<a name="l02227"></a>02227   <span class="keywordflow">return</span> npixels;
<a name="l02228"></a>02228 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7eb3cbe5ef0277544b00b2cc9c990e4c"></a><!-- doxytag: member="aXe_utils.h::get_npixels" ref="a7eb3cbe5ef0277544b00b2cc9c990e4c" args="(const char *const fname, int hdunum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structpx__point.html">px_point</a> get_npixels </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine the dimension of an image</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>File name of the FITS image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>the number of the extension to read in (first primary = 1) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the dimensation of the image in the specified extension </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00738"></a>00738 {
<a name="l00739"></a>00739      fitsfile *input;
<a name="l00740"></a>00740      <span class="keywordtype">int</span> f_status = 0;
<a name="l00741"></a>00741      <span class="comment">//float nulval = 0;</span>
<a name="l00742"></a>00742      <span class="comment">//int anynul;</span>
<a name="l00743"></a>00743      <span class="keywordtype">int</span> bitpix, naxis;
<a name="l00744"></a>00744      <span class="keywordtype">long</span> naxes[2];
<a name="l00745"></a>00745      <span class="comment">//long zero[2] = { 1, 1 };</span>
<a name="l00746"></a>00746          <span class="comment">//int x, y;</span>
<a name="l00747"></a>00747      <span class="keywordtype">int</span> hdutype;
<a name="l00748"></a>00748      <a class="code" href="structpx__point.html">px_point</a> numpix;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750      fits_open_file (&amp;input, fname, READONLY, &amp;f_status);
<a name="l00751"></a>00751      <span class="keywordflow">if</span> (f_status)
<a name="l00752"></a>00752        {
<a name="l00753"></a>00753          fits_report_error (stderr, f_status);
<a name="l00754"></a>00754          <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00755"></a>00755                       <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not open file %s:&quot;</span>, fname);
<a name="l00756"></a>00756        }
<a name="l00757"></a>00757      fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00758"></a>00758      <span class="keywordflow">if</span> (f_status)
<a name="l00759"></a>00759        {
<a name="l00760"></a>00760          fits_report_error (stderr, f_status);
<a name="l00761"></a>00761          <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00762"></a>00762                       <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not read extention %d&quot;</span>
<a name="l00763"></a>00763                       <span class="stringliteral">&quot; from file: %s&quot;</span>, hdunum, fname);
<a name="l00764"></a>00764        }
<a name="l00765"></a>00765      <span class="keywordflow">if</span> (hdutype != 0)
<a name="l00766"></a>00766        {
<a name="l00767"></a>00767             fits_report_error (stderr, f_status);
<a name="l00768"></a>00768             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00769"></a>00769                          <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Extension %i of %s is not &quot;</span>
<a name="l00770"></a>00770                          <span class="stringliteral">&quot; an image type&quot;</span>, hdunum, fname);
<a name="l00771"></a>00771        }
<a name="l00772"></a>00772      ffgipr (input, 2, &amp;bitpix, &amp;naxis, naxes, &amp;f_status);
<a name="l00773"></a>00773      <span class="keywordflow">if</span> (naxis != 2)
<a name="l00774"></a>00774        {
<a name="l00775"></a>00775          fits_report_error (stderr, f_status);
<a name="l00776"></a>00776          <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00777"></a>00777                       <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;%s is not a 2D FITS image.&quot;</span>,
<a name="l00778"></a>00778                       fname);
<a name="l00779"></a>00779        }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781      numpix.<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = (int)naxes[0];
<a name="l00782"></a>00782      numpix.<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = (int)naxes[1];
<a name="l00783"></a>00783      fits_close_file (input, &amp;f_status);
<a name="l00784"></a>00784      <span class="keywordflow">if</span> (f_status)
<a name="l00785"></a>00785        {
<a name="l00786"></a>00786          fits_report_error (stderr, f_status);
<a name="l00787"></a>00787          <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00788"></a>00788                       <span class="stringliteral">&quot;FITSimage_to_gsl: &quot;</span> <span class="stringliteral">&quot;Could not close file: %s&quot;</span>, fname);
<a name="l00789"></a>00789        }
<a name="l00790"></a>00790      <span class="keywordflow">return</span> numpix;
<a name="l00791"></a>00791 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a831cd1049c0c8b8e918404c5035d5411"></a><!-- doxytag: member="aXe_utils.h::get_online_option" ref="a831cd1049c0c8b8e918404c5035d5411" args="(char option_name[], int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* get_online_option </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>option_name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function to parse the online arguments and look for an option (starting with a "-") with a certain name. If found, a pointer to a string pointing to the value of the option (following a "=") is returned. If no "=" is found, then the name of the option is returned. If the names is not found, then NULL is returned.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>option_name</em>&nbsp;</td><td>the name of the option to look for (without the "-") </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argc</em>&nbsp;</td><td>the number of online parameter </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>*argv</em>&nbsp;</td><td>a pointer to an array of strings containing all the online parameters.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to an array containing the value of the option, the name of the option if it is found but not value was found (i.e. toggle), and NULL if the option was not found at all. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01939"></a>01939 {
<a name="l01940"></a>01940      <span class="keywordtype">char</span> *parname;
<a name="l01941"></a>01941      <span class="keywordtype">char</span> *val;
<a name="l01942"></a>01942      <span class="keyword">static</span> <span class="keywordtype">char</span> wrkarg[<a class="code" href="aXe__grism_8h.html#ac1535592e39e7edf0cafbd5e695ea622">MAXCHAR</a>];
<a name="l01943"></a>01943      <span class="keywordtype">int</span> i;
<a name="l01944"></a>01944 
<a name="l01945"></a>01945      <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++)
<a name="l01946"></a>01946        {
<a name="l01947"></a>01947             <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span>)
<a name="l01948"></a>01948               {
<a name="l01949"></a>01949                    strcpy (wrkarg, argv[i] + 1);
<a name="l01950"></a>01950                    parname = strtok (wrkarg, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l01951"></a>01951                    <span class="keywordflow">if</span> (!strcmp (parname, option_name))
<a name="l01952"></a>01952                      {
<a name="l01953"></a>01953                           val = strtok (NULL, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l01954"></a>01954                           <span class="keywordflow">if</span> (val == NULL)
<a name="l01955"></a>01955                                <span class="keywordflow">return</span> parname;
<a name="l01956"></a>01956                           <span class="keywordflow">return</span> val;
<a name="l01957"></a>01957                      }
<a name="l01958"></a>01958               }
<a name="l01959"></a>01959        }
<a name="l01960"></a>01960      <span class="keywordflow">return</span> NULL;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c64494989064de2c0ca57df3d7f43a2"></a><!-- doxytag: member="aXe_utils.h::get_online_option2" ref="a7c64494989064de2c0ca57df3d7f43a2" args="(char option_name[], char option_value[], int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_online_option2 </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>option_name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>option_value</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01965"></a>01965 {
<a name="l01966"></a>01966      <span class="keywordtype">char</span> *parname;
<a name="l01967"></a>01967      <span class="keywordtype">char</span> *val;
<a name="l01968"></a>01968      <span class="keyword">static</span> <span class="keywordtype">char</span> wrkarg[<a class="code" href="aXe__grism_8h.html#ac1535592e39e7edf0cafbd5e695ea622">MAXCHAR</a>];
<a name="l01969"></a>01969      <span class="keywordtype">int</span> i;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971      <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++)
<a name="l01972"></a>01972        {
<a name="l01973"></a>01973             <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span>)
<a name="l01974"></a>01974               {
<a name="l01975"></a>01975                    strcpy (wrkarg, argv[i] + 1);
<a name="l01976"></a>01976                    parname = strtok (wrkarg, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l01977"></a>01977                    <span class="keywordflow">if</span> (!strcmp (parname, option_name))
<a name="l01978"></a>01978                      {
<a name="l01979"></a>01979                           val = strtok (NULL, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l01980"></a>01980                           <span class="keywordflow">if</span> (val == NULL)
<a name="l01981"></a>01981                             {
<a name="l01982"></a>01982                               strcpy(option_value,parname);
<a name="l01983"></a>01983                               <span class="keywordflow">return</span> 1;}
<a name="l01984"></a>01984                           
<a name="l01985"></a>01985                           strcpy(option_value,val);
<a name="l01986"></a>01986                           <span class="keywordflow">return</span> 1;
<a name="l01987"></a>01987                      }
<a name="l01988"></a>01988               }
<a name="l01989"></a>01989        }
<a name="l01990"></a>01990      <span class="keywordflow">return</span> 0;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a57559b109efa08c59a49d92479619d0d"></a><!-- doxytag: member="aXe_utils.h::gsl_matrix_to_pgm" ref="a57559b109efa08c59a49d92479619d0d" args="(const char *const fname, const gsl_matrix *const m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gsl_matrix_to_pgm </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_matrix *const &nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Saves a gsl matrix to a pgm image file, properly scaled and all.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>name of pgm file to write </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>the matrix </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 for success, -1 for failure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01252"></a>01252 {
<a name="l01253"></a>01253      FILE *f;
<a name="l01254"></a>01254      <span class="keywordtype">double</span> max = gsl_matrix_float_max (m);
<a name="l01255"></a>01255      <span class="keywordtype">double</span> min = gsl_matrix_float_min (m);
<a name="l01256"></a>01256      <span class="keywordtype">int</span> x, y;
<a name="l01257"></a>01257      <span class="keywordtype">int</span> szx = m-&gt;size1;
<a name="l01258"></a>01258      <span class="keywordtype">int</span> szy = m-&gt;size2;
<a name="l01259"></a>01259 
<a name="l01260"></a>01260      f = fopen (fname, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01261"></a>01261      <span class="keywordflow">if</span> (!f)
<a name="l01262"></a>01262        {
<a name="l01263"></a>01263             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01264"></a>01264                          <span class="stringliteral">&quot;gsl_matrix_to_pgm: Could not open file: %s&quot;</span>, fname);
<a name="l01265"></a>01265        }
<a name="l01266"></a>01266      fprintf (f, <span class="stringliteral">&quot;P5\n%d %d\n255\n&quot;</span>, szx, szy);
<a name="l01267"></a>01267      <span class="keywordflow">for</span> (y = 0; y &lt; szy; y++)
<a name="l01268"></a>01268        {
<a name="l01269"></a>01269             <span class="keywordflow">for</span> (x = 0; x &lt; szx; x++)
<a name="l01270"></a>01270               {
<a name="l01271"></a>01271                    fprintf (f, <span class="stringliteral">&quot;%c&quot;</span>,
<a name="l01272"></a>01272                             (<span class="keywordtype">int</span>)
<a name="l01273"></a>01273                             floor ((<a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a> (m, x, szy - 1 - y) /
<a name="l01274"></a>01274                                     (max - min) - min) * 255));
<a name="l01275"></a>01275               }
<a name="l01276"></a>01276        }
<a name="l01277"></a>01277      fclose (f);
<a name="l01278"></a>01278      <span class="keywordflow">return</span> 0;
<a name="l01279"></a>01279 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6a5d64fa0baa598fc20741fa603bee11"></a><!-- doxytag: member="aXe_utils.h::gsl_to_FITSimage" ref="a6a5d64fa0baa598fc20741fa603bee11" args="(gsl_matrix *data, char filename[], int overwrite, char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gsl_to_FITSimage </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Store the content of a gsl_matrix into a FITS file</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>a pointer to an existing gsl_matrix structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>a pointer to a string containing the name of the FITS file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>if set to 1 then existing file is deleted, otherwise an extension is added </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>an ID string which will be used to write an EXTNAME keyword in the extension. If NULL, no extension name is written. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfile</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfilenum</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of the HDU written to </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01018"></a>01018 {
<a name="l01019"></a>01019   fitsfile *output;
<a name="l01020"></a>01020   <span class="keywordtype">long</span> naxes[2];
<a name="l01021"></a>01021   <span class="keywordtype">int</span> f_status = 0;
<a name="l01022"></a>01022   <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *storage, *dp;
<a name="l01023"></a>01023   <span class="keywordtype">int</span> x, y;
<a name="l01024"></a>01024   <span class="keywordtype">int</span> hdunum = 1, hdutype;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026   <span class="keywordflow">if</span> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>!=NULL) {
<a name="l01027"></a>01027     naxes[0] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size1;
<a name="l01028"></a>01028     naxes[1] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size2;
<a name="l01029"></a>01029   } <span class="keywordflow">else</span> {
<a name="l01030"></a>01030     naxes[0] = 0;
<a name="l01031"></a>01031     naxes[1] = 0;
<a name="l01032"></a>01032   }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <a class="code" href="aXe__utils_8c.html#a56c8dcf357ffe98624d185a96d0922e4">create_FITSimage</a>(filename,overwrite);
<a name="l01035"></a>01035   
<a name="l01036"></a>01036   
<a name="l01037"></a>01037   <span class="comment">/* Moving pixels around into a CFITSIO friendly array */</span>
<a name="l01038"></a>01038   <span class="keywordflow">if</span> (!(storage = malloc (naxes[0] * naxes[1] * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>))))
<a name="l01039"></a>01039     {
<a name="l01040"></a>01040       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042   dp = storage;
<a name="l01043"></a>01043   <span class="keywordflow">for</span> (y = 0; y &lt; naxes[1]; y++)
<a name="l01044"></a>01044     {
<a name="l01045"></a>01045       <span class="keywordflow">for</span> (x = 0; x &lt; naxes[0]; x++)
<a name="l01046"></a>01046         {
<a name="l01047"></a>01047           *dp = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>, x, y);
<a name="l01048"></a>01048           dp++;
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052   <span class="comment">//  Open the file for creating/appending</span>
<a name="l01053"></a>01053   fits_open_file (&amp;output, filename, READWRITE, &amp;f_status);
<a name="l01054"></a>01054   <span class="keywordflow">if</span> (f_status)
<a name="l01055"></a>01055     {
<a name="l01056"></a>01056       ffrprt (stderr, f_status);
<a name="l01057"></a>01057       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01058"></a>01058                    <span class="stringliteral">&quot;gsl_to_FITSimage: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l01059"></a>01059                    filename);
<a name="l01060"></a>01060     }
<a name="l01061"></a>01061   
<a name="l01062"></a>01062 
<a name="l01063"></a>01063   fits_get_num_hdus (output, &amp;hdunum, &amp;f_status);
<a name="l01064"></a>01064   <span class="keywordflow">if</span> (f_status)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066       ffrprt (stderr, f_status);
<a name="l01067"></a>01067       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01068"></a>01068                    <span class="stringliteral">&quot;gsl_to_FITSimage: Could not get&quot;</span>
<a name="l01069"></a>01069                    <span class="stringliteral">&quot; number of HDU from: %s&quot;</span>, filename);
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072   <span class="comment">/* Move to last HDU */</span>
<a name="l01073"></a>01073   fits_movabs_hdu (output, hdunum, &amp;hdutype, &amp;f_status);
<a name="l01074"></a>01074   <span class="keywordflow">if</span> (f_status)
<a name="l01075"></a>01075     {
<a name="l01076"></a>01076       ffrprt (stderr, f_status);
<a name="l01077"></a>01077       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01078"></a>01078                    <span class="stringliteral">&quot;gsl_to_FITSimage: Could not mov&quot;</span>
<a name="l01079"></a>01079                    <span class="stringliteral">&quot; to HDU number %d in file: %s&quot;</span>, hdunum, filename);
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081   <span class="comment">/* Get current HDU number */</span>
<a name="l01082"></a>01082   fits_get_hdu_num (output, &amp;hdunum);
<a name="l01083"></a>01083   
<a name="l01084"></a>01084   fits_create_img (output, -32, 2, naxes, &amp;f_status);
<a name="l01085"></a>01085   
<a name="l01086"></a>01086   fits_write_img (output, TFLOAT, 1, naxes[0] * naxes[1], storage,
<a name="l01087"></a>01087                   &amp;f_status);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089   <span class="comment">/* Add an EXTNAME to this extension */</span>
<a name="l01090"></a>01090   <span class="keywordflow">if</span> (ID!=NULL) {
<a name="l01091"></a>01091     <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l01092"></a>01092     <span class="keywordtype">char</span> keyname[FLEN_KEYWORD];
<a name="l01093"></a>01093     <span class="comment">//fits_write_key_lng (input, ID, (long) hdunum, comment, &amp;f_status);</span>
<a name="l01094"></a>01094     sprintf(keyname,<span class="stringliteral">&quot;EXTNAME&quot;</span>);
<a name="l01095"></a>01095     sprintf(comment,<span class="stringliteral">&quot;name of this extension&quot;</span>);
<a name="l01096"></a>01096     fits_update_key (output, TSTRING, keyname, ID, comment, &amp;f_status);
<a name="l01097"></a>01097   }
<a name="l01098"></a>01098   fits_write_date (output, &amp;f_status);
<a name="l01099"></a>01099   
<a name="l01100"></a>01100   fits_get_hdu_num(output,&amp;hdunum);
<a name="l01101"></a>01101   
<a name="l01102"></a>01102   fits_close_file (output, &amp;f_status);
<a name="l01103"></a>01103   
<a name="l01104"></a>01104   free (storage);
<a name="l01105"></a>01105   storage = NULL;
<a name="l01106"></a>01106 
<a name="l01107"></a>01107   <span class="keywordflow">return</span> hdunum;
<a name="l01108"></a>01108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad7667e161c8b5af380d7ff9f2433cd06"></a><!-- doxytag: member="aXe_utils.h::gsl_to_FITSimage_opened" ref="ad7667e161c8b5af380d7ff9f2433cd06" args="(gsl_matrix *data, fitsfile *ouput, int overwrite, char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gsl_to_FITSimage_opened </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Store the content of a gsl_matrix into a FITS file</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>a pointer to an existing gsl_matrix structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>a pointer to a string containing the name of the FITS file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>if set to 1 then existing file is deleted, otherwise an extension is added </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>an ID string which will be used to write an EXTNAME keyword in the extension </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfile</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfilenum</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of the HDU written to </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00950"></a>00950 {
<a name="l00951"></a>00951      <span class="keywordtype">long</span> naxes[2];
<a name="l00952"></a>00952      <span class="keywordtype">int</span> f_status = 0;
<a name="l00953"></a>00953      <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *storage, *dp;
<a name="l00954"></a>00954      <span class="keywordtype">int</span> x, y;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956      <span class="keywordflow">if</span> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>!=NULL) {
<a name="l00957"></a>00957          naxes[0] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size1;
<a name="l00958"></a>00958          naxes[1] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size2;
<a name="l00959"></a>00959     } <span class="keywordflow">else</span> {
<a name="l00960"></a>00960         naxes[0] = 0;
<a name="l00961"></a>00961         naxes[1] = 0;
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964      <span class="comment">//create_FITSimage(filename,overwrite);</span>
<a name="l00965"></a>00965 
<a name="l00966"></a>00966 
<a name="l00967"></a>00967      <span class="comment">/* Moving pixels around into a CFITSIO friendly array */</span>
<a name="l00968"></a>00968      <span class="keywordflow">if</span> (!(storage = malloc (naxes[0] * naxes[1] * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>))))
<a name="l00969"></a>00969        {
<a name="l00970"></a>00970             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00971"></a>00971        }
<a name="l00972"></a>00972      dp = storage;
<a name="l00973"></a>00973      <span class="keywordflow">for</span> (y = 0; y &lt; naxes[1]; y++)
<a name="l00974"></a>00974        {
<a name="l00975"></a>00975             <span class="keywordflow">for</span> (x = 0; x &lt; naxes[0]; x++)
<a name="l00976"></a>00976               {
<a name="l00977"></a>00977                    *dp = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>, x, y);
<a name="l00978"></a>00978                    dp++;
<a name="l00979"></a>00979               }
<a name="l00980"></a>00980        }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982      fits_create_img (output, -32, 2, naxes, &amp;f_status);
<a name="l00983"></a>00983 
<a name="l00984"></a>00984      fits_write_img (output, TFLOAT, 1, naxes[0] * naxes[1], storage,
<a name="l00985"></a>00985                      &amp;f_status);
<a name="l00986"></a>00986 
<a name="l00987"></a>00987      <span class="comment">/* Add an EXTNAME to this extension */</span>
<a name="l00988"></a>00988      <span class="keywordflow">if</span> (ID!=NULL) {
<a name="l00989"></a>00989          <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l00990"></a>00990          <span class="keywordtype">char</span> keyname[FLEN_KEYWORD];
<a name="l00991"></a>00991         <span class="comment">//fits_write_key_lng (input, ID, (long) hdunum, comment, &amp;f_status);</span>
<a name="l00992"></a>00992         sprintf(keyname,<span class="stringliteral">&quot;EXTNAME&quot;</span>);
<a name="l00993"></a>00993         sprintf(comment,<span class="stringliteral">&quot;name of this extension&quot;</span>);
<a name="l00994"></a>00994         fits_update_key (output, TSTRING, keyname, ID, comment, &amp;f_status);
<a name="l00995"></a>00995      }
<a name="l00996"></a>00996      fits_write_date (output, &amp;f_status);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 
<a name="l00999"></a>00999      free (storage);
<a name="l01000"></a>01000      storage = NULL;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae3c5e11b29793d5fa85913a0df2f7761"></a><!-- doxytag: member="aXe_utils.h::gsl_to_FITSimageHDU" ref="ae3c5e11b29793d5fa85913a0df2f7761" args="(gsl_matrix *data, char filename[], int overwrite, char ID[], int hdu_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gsl_to_FITSimageHDU </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdu_num</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Store the content of a gsl_matrix into a FITS file</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>a pointer to an existing gsl_matrix structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>a pointer to a string containing the name of the FITS file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>if set to 1 then existing file is deleted, otherwise an extension is added </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>an ID string which will be used to write an EXTNAME keyword in the extension. If NULL, no extension name is written. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum,an</em>&nbsp;</td><td>integer pinting to the HDU the image should be written to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfile</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>HDUfilenum</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of the HDU written to </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01125"></a>01125 {
<a name="l01126"></a>01126      fitsfile *output;
<a name="l01127"></a>01127      <span class="keywordtype">long</span> naxes[2];
<a name="l01128"></a>01128      <span class="keywordtype">int</span> f_status = 0;
<a name="l01129"></a>01129      <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *storage, *dp;
<a name="l01130"></a>01130      <span class="keywordtype">int</span> x, y;
<a name="l01131"></a>01131      <span class="keywordtype">int</span> hdunum = 1, hdutype;
<a name="l01132"></a>01132 
<a name="l01133"></a>01133      <span class="keywordflow">if</span> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>!=NULL) {
<a name="l01134"></a>01134          naxes[0] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size1;
<a name="l01135"></a>01135          naxes[1] = <a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>-&gt;size2;
<a name="l01136"></a>01136     } <span class="keywordflow">else</span> {
<a name="l01137"></a>01137         naxes[0] = 0;
<a name="l01138"></a>01138         naxes[1] = 0;
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140 
<a name="l01141"></a>01141      <a class="code" href="aXe__utils_8c.html#a56c8dcf357ffe98624d185a96d0922e4">create_FITSimage</a>(filename,overwrite);
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 
<a name="l01144"></a>01144      <span class="comment">/* Moving pixels around into a CFITSIO friendly array */</span>
<a name="l01145"></a>01145      <span class="keywordflow">if</span> (!(storage = malloc (naxes[0] * naxes[1] * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>))))
<a name="l01146"></a>01146        {
<a name="l01147"></a>01147             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l01148"></a>01148        }
<a name="l01149"></a>01149      dp = storage;
<a name="l01150"></a>01150      <span class="keywordflow">for</span> (y = 0; y &lt; naxes[1]; y++)
<a name="l01151"></a>01151        {
<a name="l01152"></a>01152             <span class="keywordflow">for</span> (x = 0; x &lt; naxes[0]; x++)
<a name="l01153"></a>01153               {
<a name="l01154"></a>01154                    *dp = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a> (<a class="code" href="structCfgStrings.html#ab4ed123e084f001ff0dadb43979d8837">data</a>, x, y);
<a name="l01155"></a>01155                    dp++;
<a name="l01156"></a>01156               }
<a name="l01157"></a>01157        }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159      <span class="comment">//  Open the file for creating/appending</span>
<a name="l01160"></a>01160      fits_open_file (&amp;output, filename, READWRITE, &amp;f_status);
<a name="l01161"></a>01161      <span class="keywordflow">if</span> (f_status)
<a name="l01162"></a>01162        {
<a name="l01163"></a>01163             ffrprt (stderr, f_status);
<a name="l01164"></a>01164             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01165"></a>01165                          <span class="stringliteral">&quot;gsl_to_FITSimage: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l01166"></a>01166                          filename);
<a name="l01167"></a>01167        }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169 
<a name="l01170"></a>01170      <span class="comment">//     fits_get_num_hdus (output, &amp;hdunum, &amp;f_status);</span>
<a name="l01171"></a>01171      <span class="comment">//     if (f_status)</span>
<a name="l01172"></a>01172      <span class="comment">//       {</span>
<a name="l01173"></a>01173      <span class="comment">//     ffrprt (stderr, f_status);</span>
<a name="l01174"></a>01174      <span class="comment">//     aXe_message (aXe_M_FATAL, __FILE__, __LINE__,</span>
<a name="l01175"></a>01175      <span class="comment">//                  &quot;gsl_to_FITSimage: Could not get&quot;</span>
<a name="l01176"></a>01176      <span class="comment">//                  &quot; number of HDU from: %s&quot;, filename);</span>
<a name="l01177"></a>01177      <span class="comment">//       }</span>
<a name="l01178"></a>01178 
<a name="l01179"></a>01179      <span class="comment">/* Move to last HDU */</span>
<a name="l01180"></a>01180      fits_movabs_hdu (output, hdu_num, &amp;hdutype, &amp;f_status);
<a name="l01181"></a>01181      <span class="keywordflow">if</span> (f_status)
<a name="l01182"></a>01182        {
<a name="l01183"></a>01183             ffrprt (stderr, f_status);
<a name="l01184"></a>01184             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01185"></a>01185                          <span class="stringliteral">&quot;gsl_to_FITSimage: Could not mov&quot;</span>
<a name="l01186"></a>01186                          <span class="stringliteral">&quot; to HDU number %d in file: %s&quot;</span>, hdunum, filename);
<a name="l01187"></a>01187        }
<a name="l01188"></a>01188      <span class="comment">/* Get current HDU number */</span>
<a name="l01189"></a>01189      <span class="comment">//     fits_get_hdu_num (output, &amp;hdunum);</span>
<a name="l01190"></a>01190 
<a name="l01191"></a>01191      <span class="comment">//     fits_create_img (output, -32, 2, naxes, &amp;f_status);</span>
<a name="l01192"></a>01192 
<a name="l01193"></a>01193      fits_write_img (output, TFLOAT, 1, naxes[0] * naxes[1], storage,
<a name="l01194"></a>01194                      &amp;f_status);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196      <span class="comment">/* Add an EXTNAME to this extension */</span>
<a name="l01197"></a>01197      <span class="keywordflow">if</span> (ID!=NULL) {
<a name="l01198"></a>01198          <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l01199"></a>01199          <span class="keywordtype">char</span> keyname[FLEN_KEYWORD];
<a name="l01200"></a>01200         <span class="comment">//fits_write_key_lng (input, ID, (long) hdunum, comment, &amp;f_status);</span>
<a name="l01201"></a>01201         sprintf(keyname,<span class="stringliteral">&quot;EXTNAME&quot;</span>);
<a name="l01202"></a>01202         sprintf(comment,<span class="stringliteral">&quot;name of this extension&quot;</span>);
<a name="l01203"></a>01203         fits_update_key (output, TSTRING, keyname, ID, comment, &amp;f_status);
<a name="l01204"></a>01204      }
<a name="l01205"></a>01205      fits_write_date (output, &amp;f_status);
<a name="l01206"></a>01206 
<a name="l01207"></a>01207      fits_get_hdu_num(output,&amp;hdunum);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209      fits_close_file (output, &amp;f_status);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211      free (storage);
<a name="l01212"></a>01212      storage = NULL;
<a name="l01213"></a>01213 
<a name="l01214"></a>01214      <span class="keywordflow">return</span> hdunum;
<a name="l01215"></a>01215 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a661333de2efcbef321b27520d40cc9cf"></a><!-- doxytag: member="aXe_utils.h::load_image" ref="a661333de2efcbef321b27520d40cc9cf" args="(const char *const fname, int hdunum_data, int hdunum_err, int hdunum_dq, int dqmask, float exptime, float gain)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobservation.html">observation</a>* load_image </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_dq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dqmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>exptime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac87755b847abbd2c375032e14bd5561c"></a><!-- doxytag: member="aXe_utils.h::load_image_t" ref="ac87755b847abbd2c375032e14bd5561c" args="(const char *const fname, int hdunum_data, int hdunum_err, int hdunum_dq, int dqmask, const double exptime, const double rdnoise)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobservation.html">observation</a>* load_image_t </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_dq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dqmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>exptime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>rdnoise</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function to load a multiple extension FITS file into an <a class="el" href="structobservation.html">observation</a> structure</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>a pointer to a string containing the name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_data</em>&nbsp;</td><td>the extension number containing the data array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_err</em>&nbsp;</td><td>the extension number containing the err array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_dq</em>&nbsp;</td><td>the extension number containing the DQ array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dqmask</em>&nbsp;</td><td>the bit mask (represented as an int) to apply using the DQ info to flag a pixel as good or bad </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exptime</em>&nbsp;</td><td>exposure time (only used to determine count noise) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gain</em>&nbsp;</td><td>gain factor (only used to determine count noise) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="structobservation.html">observation</a> a pointer to a new allocated, populated, DQ masked <a class="el" href="structobservation.html">observation</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <a class="code" href="structobservation.html">observation</a>    *obs;
<a name="l00115"></a>00115   FILE           *infile;
<a name="l00116"></a>00116   
<a name="l00117"></a>00117   <span class="comment">// check whether the image file </span>
<a name="l00118"></a>00118   <span class="comment">// exists or not.</span>
<a name="l00119"></a>00119   <span class="keywordflow">if</span> (!(infile = fopen(fname, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00120"></a>00120     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a>(<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00121"></a>00121                 <span class="stringliteral">&quot;Could not find %s\n&quot;</span>, fname); 
<a name="l00122"></a>00122   <span class="keywordflow">else</span> 
<a name="l00123"></a>00123     fclose(infile);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">// allocate memory  </span>
<a name="l00126"></a>00126   obs = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structobservation.html">observation</a>));
<a name="l00127"></a>00127   
<a name="l00128"></a>00128   <span class="comment">// load the science extension</span>
<a name="l00129"></a>00129   fprintf(stdout,<span class="stringliteral">&quot;Loading DATA from: %s...&quot;</span>,fname);
<a name="l00130"></a>00130   obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a> = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(fname, hdunum_data, 1);
<a name="l00131"></a>00131   fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="comment">// check whether there</span>
<a name="l00135"></a>00135   <span class="comment">// is a dedicated error extension </span>
<a name="l00136"></a>00136   <span class="keywordflow">if</span> (hdunum_err != -1)
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138       <span class="comment">// load the error extention</span>
<a name="l00139"></a>00139       fprintf(stdout, <span class="stringliteral">&quot;Loading ERR...&quot;</span>);
<a name="l00140"></a>00140       obs-&gt;<a class="code" href="structobservation.html#a79ef486b081fa7b1973c39323f163010">pixerrs</a> = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(fname, hdunum_err, 0);
<a name="l00141"></a>00141       fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00142"></a>00142     } 
<a name="l00143"></a>00143   <span class="keywordflow">else</span>
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145       <span class="comment">// simulate the error extension </span>
<a name="l00146"></a>00146       fprintf(stdout, <span class="stringliteral">&quot;Simulating ERR with EXPTIME=%fs and RDNOISE= %fe ...&quot;</span>, exptime, rdnoise);
<a name="l00147"></a>00147       obs-&gt;<a class="code" href="structobservation.html#a79ef486b081fa7b1973c39323f163010">pixerrs</a> = <a class="code" href="aXe__utils_8c.html#ad05c49b54279d1e4f6f49fe675ce254f">simulate_errors_t</a>(obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a>, exptime, rdnoise);
<a name="l00148"></a>00148       fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment">// check whether there is a dedicated</span>
<a name="l00153"></a>00153   <span class="comment">// dq extention</span>
<a name="l00154"></a>00154   <span class="keywordflow">if</span> (hdunum_dq != -1)
<a name="l00155"></a>00155     {
<a name="l00156"></a>00156       <span class="comment">// load the dq extention</span>
<a name="l00157"></a>00157       fprintf(stdout, <span class="stringliteral">&quot;Loading DQ...&quot;</span>);
<a name="l00158"></a>00158       obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a> = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(fname, hdunum_dq, 0);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       <span class="comment">// apply the dq filter</span>
<a name="l00161"></a>00161       <span class="keywordflow">if</span> (dqmask&gt;0) 
<a name="l00162"></a>00162         {
<a name="l00163"></a>00163           fprintf(stdout,<span class="stringliteral">&quot;Applying MASK and seting DATA to NaN...&quot;</span>);
<a name="l00164"></a>00164           <a class="code" href="aXe__utils_8c.html#a203bace423c84b28d48d305a99dfa81a">apply_DQ</a>(obs, dqmask);
<a name="l00165"></a>00165           fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167     fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169   <span class="keywordflow">else</span> 
<a name="l00170"></a>00170     {
<a name="l00171"></a>00171       fprintf(stdout, <span class="stringliteral">&quot; Not using DQ. Done.\n&quot;</span>);
<a name="l00172"></a>00172       obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a> = NULL;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174   fprintf(stdout,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="comment">// return the structure created</span>
<a name="l00177"></a>00177   <span class="keywordflow">return</span> obs;
<a name="l00178"></a>00178 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1aa6f31280704fd7678c78b97d0f5456"></a><!-- doxytag: member="aXe_utils.h::load_sci_image" ref="a1aa6f31280704fd7678c78b97d0f5456" args="(const char *const fname, int hdunum_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobservation.html">observation</a>* load_sci_image </td>
          <td>(</td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function to load a multiple extension FITS file into an <a class="el" href="structobservation.html">observation</a> structure</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>a pointer to a string containing the name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_data</em>&nbsp;</td><td>the extension number containing the data array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_err</em>&nbsp;</td><td>the extension number containing the err array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum_dq</em>&nbsp;</td><td>the extension number containing the DQ array (first=1) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dqmask</em>&nbsp;</td><td>the bit mask (represented as an int) to apply using the DQ info to flag a pixel as good or bad </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exptime</em>&nbsp;</td><td>exposure time (only used to determine count noise) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gain</em>&nbsp;</td><td>gain factor (only used to determine count noise) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="structobservation.html">observation</a> a pointer to a new allocated, populated, DQ masked <a class="el" href="structobservation.html">observation</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198         <a class="code" href="structobservation.html">observation</a>    *obs;
<a name="l00199"></a>00199         FILE           *infile;
<a name="l00200"></a>00200                 
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (!(infile = fopen(fname, <span class="stringliteral">&quot;r&quot;</span>))) {
<a name="l00202"></a>00202                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a>(<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00203"></a>00203                             <span class="stringliteral">&quot;Could not find %s\n&quot;</span>, fname);
<a name="l00204"></a>00204         } <span class="keywordflow">else</span> {
<a name="l00205"></a>00205                 fclose(infile);
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207         obs = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structobservation.html">observation</a>));
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         fprintf(stdout,<span class="stringliteral">&quot;Loading DATA from: %s...&quot;</span>,fname);
<a name="l00210"></a>00210         obs-&gt;<a class="code" href="structobservation.html#a012c0ff489fbb74fc6c9abfbd7c6e320">grism</a> = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(fname, hdunum_data, 1);
<a name="l00211"></a>00211         fprintf(stdout,<span class="stringliteral">&quot;. Done.\n&quot;</span>);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         obs-&gt;<a class="code" href="structobservation.html#a79ef486b081fa7b1973c39323f163010">pixerrs</a> = NULL;
<a name="l00214"></a>00214         obs-&gt;<a class="code" href="structobservation.html#a6698fa09a4524a5928ad9f98d620ba4e">dq</a> = NULL;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         fprintf(stdout,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <span class="keywordflow">return</span> obs;
<a name="l00219"></a>00219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8abd9ee69f161e0ac3ee47dc722cebf0"></a><!-- doxytag: member="aXe_utils.h::put_FITS_cards" ref="a8abd9ee69f161e0ac3ee47dc722cebf0" args="(char filename[], int hdu, FITScards *cards)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void put_FITS_cards </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFITScards.html">FITScards</a> *&nbsp;</td>
          <td class="paramname"> <em>cards</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>routine to write a set of FITS header cards into a FITS header of a given extension. Input cards are automatically formatted propely if they are not.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to a char array containing the name fo the existing FITS file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdu</em>&nbsp;</td><td>the number of the extension to write to (-1 for last one) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cards</em>&nbsp;</td><td>a NULL terminated array of char arrays containing properly formatted cards </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01490"></a>01490 {
<a name="l01491"></a>01491     fitsfile *output;
<a name="l01492"></a>01492     <span class="keywordtype">int</span> hdutype,f_status = 0;
<a name="l01493"></a>01493     <span class="keywordtype">int</span> i, keytype;
<a name="l01494"></a>01494     <span class="keywordtype">char</span> card[FLEN_CARD];
<a name="l01495"></a>01495 
<a name="l01496"></a>01496     <span class="comment">// Do nothing if there is nothing to do</span>
<a name="l01497"></a>01497     <span class="keywordflow">if</span> (cards-&gt;<a class="code" href="structFITScards.html#ae541232523495d8487f2d47d2ad71873">n</a> == 0) <span class="keywordflow">return</span>;
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     <span class="comment">//  Open the file for creating/appending</span>
<a name="l01500"></a>01500     fits_open_file (&amp;output, filename, READWRITE, &amp;f_status);
<a name="l01501"></a>01501     <span class="keywordflow">if</span> (f_status)
<a name="l01502"></a>01502     {
<a name="l01503"></a>01503         ffrprt (stderr, f_status);
<a name="l01504"></a>01504         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01505"></a>01505             <span class="stringliteral">&quot;put_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l01506"></a>01506             filename);
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508 
<a name="l01509"></a>01509     <span class="comment">// Move to the desired HDU</span>
<a name="l01510"></a>01510     <span class="comment">// If -1 go to the last one</span>
<a name="l01511"></a>01511     <span class="keywordflow">if</span> (hdu==-1) {
<a name="l01512"></a>01512         fits_get_num_hdus (output, &amp;hdu, &amp;f_status);
<a name="l01513"></a>01513         <span class="keywordflow">if</span> (f_status)
<a name="l01514"></a>01514         {
<a name="l01515"></a>01515             ffrprt (stderr, f_status);
<a name="l01516"></a>01516             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01517"></a>01517                 <span class="stringliteral">&quot;put_FITS_cards: Could not get&quot;</span>
<a name="l01518"></a>01518                 <span class="stringliteral">&quot; number of HDU from:&quot;</span>, filename);
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520     } 
<a name="l01521"></a>01521     fits_movabs_hdu (output, hdu, &amp;hdutype, &amp;f_status);
<a name="l01522"></a>01522     <span class="keywordflow">if</span> (f_status)
<a name="l01523"></a>01523     {
<a name="l01524"></a>01524         ffrprt (stderr, f_status);
<a name="l01525"></a>01525         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01526"></a>01526             <span class="stringliteral">&quot;put_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not move to extension %d in file: %s&quot;</span>,
<a name="l01527"></a>01527             hdu,filename);
<a name="l01528"></a>01528     }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">for</span> (i=0; i&lt;cards-&gt;<a class="code" href="structFITScards.html#ae541232523495d8487f2d47d2ad71873">n</a>;i++)
<a name="l01531"></a>01531     {
<a name="l01532"></a>01532         fits_parse_template (cards-&gt;<a class="code" href="structFITScards.html#ad1be9be894e41dec8131959f119b387c">cards</a>[i], card, &amp;keytype, &amp;f_status);
<a name="l01533"></a>01533 <span class="comment">//fprintf(stderr,&quot;%s\n&quot;,cards-&gt;cards[i]);</span>
<a name="l01534"></a>01534         <span class="keywordflow">if</span> (f_status)
<a name="l01535"></a>01535         {
<a name="l01536"></a>01536             ffrprt (stderr, f_status);
<a name="l01537"></a>01537             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01538"></a>01538                 <span class="stringliteral">&quot;put_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not reformet card:\n%s&quot;</span>,cards[i]);
<a name="l01539"></a>01539         }
<a name="l01540"></a>01540         fits_write_record (output, card, &amp;f_status);
<a name="l01541"></a>01541         <span class="keywordflow">if</span> (f_status)
<a name="l01542"></a>01542         {
<a name="l01543"></a>01543             ffrprt (stderr, f_status);
<a name="l01544"></a>01544             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01545"></a>01545                 <span class="stringliteral">&quot;put_FITS_cards: &quot;</span> <span class="stringliteral">&quot;Could not write card in extension %d in file: %s&quot;</span>,
<a name="l01546"></a>01546                 hdu,filename);
<a name="l01547"></a>01547         }
<a name="l01548"></a>01548     }
<a name="l01549"></a>01549     fits_write_date (output, &amp;f_status);
<a name="l01550"></a>01550     fits_close_file (output, &amp;f_status);
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6652d52eca381c6c7fbc9913f2b42a0e"></a><!-- doxytag: member="aXe_utils.h::put_FITS_cards_opened" ref="a6652d52eca381c6c7fbc9913f2b42a0e" args="(fitsfile *output, FITScards *cards)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void put_FITS_cards_opened </td>
          <td>(</td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structFITScards.html">FITScards</a> *&nbsp;</td>
          <td class="paramname"> <em>cards</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>routine to write a set of FITS header cards into a FITS header of a given extension. Input cards are automatically formatted propely if they are not.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>input</em>&nbsp;</td><td>a fitsfile pointer pointing to the extension to write the cards to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdu</em>&nbsp;</td><td>the number of the extension to write to (-1 for last one) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cards</em>&nbsp;</td><td>a NULL terminated array of char arrays containing properly formatted cards </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01564"></a>01564 {
<a name="l01565"></a>01565     <span class="keywordtype">int</span> f_status = 0;
<a name="l01566"></a>01566     <span class="keywordtype">int</span> i, keytype;
<a name="l01567"></a>01567     <span class="keywordtype">char</span> card[FLEN_CARD];
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="comment">// Do nothing if there is nothing to do</span>
<a name="l01570"></a>01570     <span class="keywordflow">if</span> (cards-&gt;<a class="code" href="structFITScards.html#ae541232523495d8487f2d47d2ad71873">n</a> == 0) <span class="keywordflow">return</span>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572     <span class="keywordflow">for</span> (i=0; i&lt;cards-&gt;<a class="code" href="structFITScards.html#ae541232523495d8487f2d47d2ad71873">n</a>;i++)
<a name="l01573"></a>01573     {
<a name="l01574"></a>01574         fits_parse_template (cards-&gt;<a class="code" href="structFITScards.html#ad1be9be894e41dec8131959f119b387c">cards</a>[i], card, &amp;keytype, &amp;f_status);
<a name="l01575"></a>01575         <span class="keywordflow">if</span> (f_status)
<a name="l01576"></a>01576         {
<a name="l01577"></a>01577             ffrprt (stderr, f_status);
<a name="l01578"></a>01578             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01579"></a>01579                 <span class="stringliteral">&quot;put_FITS_cards_opened: &quot;</span> <span class="stringliteral">&quot;Could not reformat card:\n%s&quot;</span>,cards[i]);
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581         fits_write_record (output, card, &amp;f_status);
<a name="l01582"></a>01582         <span class="keywordflow">if</span> (f_status)
<a name="l01583"></a>01583         {
<a name="l01584"></a>01584             ffrprt (stderr, f_status);
<a name="l01585"></a>01585             fprintf(stderr, <span class="stringliteral">&quot;FITScard:   %s\n&quot;</span>, cards-&gt;<a class="code" href="structFITScards.html#ad1be9be894e41dec8131959f119b387c">cards</a>[i]);
<a name="l01586"></a>01586             fprintf(stderr, <span class="stringliteral">&quot;FITSrecord: %s\n&quot;</span>, card);
<a name="l01587"></a>01587             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01588"></a>01588                 <span class="stringliteral">&quot;put_FITS_cards_opened: %i, %s&quot;</span> <span class="stringliteral">&quot;Could not write cards.&quot;</span>, i, card);
<a name="l01589"></a>01589         }
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591     fits_write_date (output, &amp;f_status);
<a name="l01592"></a>01592 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40b0ba7efd067d860b4f2a6948fea20b"></a><!-- doxytag: member="aXe_utils.h::quad_to_bbox" ref="a40b0ba7efd067d860b4f2a6948fea20b" args="(const px_point *const corners, px_point *const ll, px_point *const ur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void quad_to_bbox </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structpx__point.html">px_point</a> *const &nbsp;</td>
          <td class="paramname"> <em>corners</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structpx__point.html">px_point</a> *const &nbsp;</td>
          <td class="paramname"> <em>ll</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structpx__point.html">px_point</a> *const &nbsp;</td>
          <td class="paramname"> <em>ur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>computes the bbox of a general <a class="el" href="structquadrangle.html">quadrangle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>corners</em>&nbsp;</td><td>the four corners of the <a class="el" href="structquadrangle.html">quadrangle</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ll</em>&nbsp;</td><td>a <a class="el" href="structpx__point.html">px_point</a> to hold the lower left corner </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ur</em>&nbsp;</td><td>a <a class="el" href="structpx__point.html">px_point</a> to hold the upper right corner </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01227"></a>01227 {
<a name="l01228"></a>01228      ll-&gt;<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> =
<a name="l01229"></a>01229           <a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (<a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (<a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (corners[0].x, corners[1].x), corners[2].x),
<a name="l01230"></a>01230                corners[3].x);
<a name="l01231"></a>01231      ll-&gt;<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> =
<a name="l01232"></a>01232           <a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (<a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (<a class="code" href="aXe__utils_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a> (corners[0].y, corners[1].y), corners[2].y),
<a name="l01233"></a>01233                corners[3].y);
<a name="l01234"></a>01234      ur-&gt;<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> =
<a name="l01235"></a>01235           <a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (<a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (<a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (corners[0].x, corners[1].x), corners[2].x),
<a name="l01236"></a>01236                corners[3].x);
<a name="l01237"></a>01237      ur-&gt;<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> =
<a name="l01238"></a>01238           <a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (<a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (<a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a> (corners[0].y, corners[1].y), corners[2].y),
<a name="l01239"></a>01239                corners[3].y);
<a name="l01240"></a>01240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94637b37589d1f9b3c9418d620156519"></a><!-- doxytag: member="aXe_utils.h::replace_file_extension" ref="a94637b37589d1f9b3c9418d620156519" args="(char infile[], char outfile[], char from_ext[], char to_ext[], int hdu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void replace_file_extension </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>infile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>outfile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>from_ext</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>to_ext</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01807"></a>01807 {
<a name="l01808"></a>01808      <span class="keywordtype">char</span> chdu[<a class="code" href="aXe__grism_8h.html#ac1535592e39e7edf0cafbd5e695ea622">MAXCHAR</a>];
<a name="l01809"></a>01809      <span class="keywordflow">if</span> (!infile)
<a name="l01810"></a>01810        {
<a name="l01811"></a>01811             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01812"></a>01812                          <span class="stringliteral">&quot;replace_file_extension: Input filename invalid&quot;</span>);
<a name="l01813"></a>01813        }
<a name="l01814"></a>01814      <span class="keywordflow">if</span> (!from_ext)
<a name="l01815"></a>01815        {
<a name="l01816"></a>01816             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01817"></a>01817                          <span class="stringliteral">&quot;replace_file_extension: Input extension invalid&quot;</span>);
<a name="l01818"></a>01818        }
<a name="l01819"></a>01819      <span class="keywordflow">if</span> (!to_ext)
<a name="l01820"></a>01820        {
<a name="l01821"></a>01821             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01822"></a>01822                          <span class="stringliteral">&quot;replace_file_extension: output extension invalid&quot;</span>);
<a name="l01823"></a>01823        }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825      strcpy (outfile, infile);
<a name="l01826"></a>01826      outfile[strlen (outfile) - strlen (from_ext)] = 0;
<a name="l01827"></a>01827      <span class="keywordflow">if</span> (hdu &gt; 0)
<a name="l01828"></a>01828        {
<a name="l01829"></a>01829             sprintf (chdu, <span class="stringliteral">&quot;_%d&quot;</span>, hdu);
<a name="l01830"></a>01830             strcat (outfile, chdu);
<a name="l01831"></a>01831        }
<a name="l01832"></a>01832      strcat (outfile, to_ext);
<a name="l01833"></a>01833 
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a265457e88fc46b602e539e9a7b2a6c1e"></a><!-- doxytag: member="aXe_utils.h::simulate_errors" ref="a265457e88fc46b602e539e9a7b2a6c1e" args="(gsl_matrix *img, float exptime, float gain)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* simulate_errors </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>exptime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad05c49b54279d1e4f6f49fe675ce254f"></a><!-- doxytag: member="aXe_utils.h::simulate_errors_t" ref="ad05c49b54279d1e4f6f49fe675ce254f" args="(gsl_matrix *img, const double exptime, const double rdnoise)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* simulate_errors_t </td>
          <td>(</td>
          <td class="paramtype">gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>exptime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>rdnoise</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A helper function which populates the error part of an <a class="el" href="structobservation.html">observation</a> structure using simple Poisson noise. Assumes data is in electrons.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>img</em>&nbsp;</td><td>a pointer to an exisiting <a class="el" href="structobservation.html">observation</a> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a GDL matrix containing the error array </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00036"></a>00036 {
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *err;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="keywordtype">double</span> nc;
<a name="l00041"></a>00041   <span class="keywordtype">double</span> sqr_rdnoise;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keywordtype">int</span> i, j;
<a name="l00044"></a>00044   
<a name="l00045"></a>00045   err = <a class="code" href="aXe__grism_8h.html#a1214ab1bea5fd80474d7a27db0bfb429">gsl_matrix_alloc</a>(img-&gt;size1, img-&gt;size2);
<a name="l00046"></a>00046   
<a name="l00047"></a>00047   sqr_rdnoise = rdnoise*rdnoise;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <span class="keywordflow">for</span> (i = 0; i &lt; img-&gt;size1; i++) {
<a name="l00050"></a>00050     <span class="keywordflow">for</span> (j = 0; j &lt; img-&gt;size2; j++) {
<a name="l00051"></a>00051 
<a name="l00052"></a>00052       nc = fabs(<a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(img, i, j));
<a name="l00053"></a>00053 
<a name="l00054"></a>00054       nc = sqrt(nc*exptime + sqr_rdnoise)/exptime;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056       <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a>(err, i, j, nc);
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058   }
<a name="l00059"></a>00059   <span class="keywordflow">return</span> err;
<a name="l00060"></a>00060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a616ed3bbb3c1b15f8127548fbe1d4701"></a><!-- doxytag: member="aXe_utils.h::storage_to_gsl" ref="a616ed3bbb3c1b15f8127548fbe1d4701" args="(long *naxes, PIXEL_T *storage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* storage_to_gsl </td>
          <td>(</td>
          <td class="paramtype">long *&nbsp;</td>
          <td class="paramname"> <em>naxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIXEL_T *&nbsp;</td>
          <td class="paramname"> <em>storage</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Transfer data from a pointer to a gsl-image</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>naxes</em>&nbsp;</td><td>axes of the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>storage</em>&nbsp;</td><td>pointer to the data </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00711"></a>00711                                              {
<a name="l00712"></a>00712         <span class="keywordtype">int</span> x, y;
<a name="l00713"></a>00713         <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *im;
<a name="l00714"></a>00714         <a class="code" href="aXe__grism_8h.html#ab4472600f4f77bd72e51d116ed5138ed">PIXEL_T</a> *dp;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="comment">// define the gsl matrix</span>
<a name="l00717"></a>00717         im = <a class="code" href="aXe__grism_8h.html#a1214ab1bea5fd80474d7a27db0bfb429">gsl_matrix_alloc</a> (naxes[0], naxes[1]);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719         <span class="comment">// initialize the pointer</span>
<a name="l00720"></a>00720         dp = storage;
<a name="l00721"></a>00721         <span class="keywordflow">for</span> (y = 0; y &lt; naxes[1]; y++)
<a name="l00722"></a>00722                 <span class="keywordflow">for</span> (x = 0; x &lt; naxes[0]; x++)
<a name="l00723"></a>00723                         <a class="code" href="aXe__grism_8h.html#a1f386ef5cd5a3b916246c2bee80f083a">gsl_matrix_set</a> (im, x, y, *dp++);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         <span class="keywordflow">return</span> im;
<a name="l00726"></a>00726 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
