<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_sex.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_sex.h File Reference</h1><code>#include &quot;<a class="el" href="spc__CD_8h_source.html">spc_CD.h</a>&quot;</code><br/>

<p><a href="spc__sex_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structellipse.html">ellipse</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSexObject.html">SexObject</a></td></tr>
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacespc__sex.html">spc_sex</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>&nbsp;&nbsp;&nbsp;10240</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(x, y)&nbsp;&nbsp;&nbsp;(((x)&gt;(y))?(x):(y))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a19321d394ebca38412cec1c3f5bbf5bf">MIN_DIFFANGLE</a>&nbsp;&nbsp;&nbsp;3.0</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a9fa77923a7b018be8b7073863b9e3c96">create_SexObject</a> (const <a class="el" href="structcolinfo.html">colinfo</a> *actinfo, char *line, const gsl_vector *waves, const gsl_vector *cnums, const <a class="el" href="structpx__point.html">px_point</a> backwin_cols, const <a class="el" href="structpx__point.html">px_point</a> modinfo_cols, const int magcol, const int fullinfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a50a3720d64c09d63859bb71314e14f8b">SexObject_fprintf</a> (FILE *output, <a class="el" href="structSexObject.html">SexObject</a> *o)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#ae9d3731ef7e209c389cde4b659e5cac8">SexMags_to_beamFlux</a> (<a class="el" href="structSexObject.html">SexObject</a> *sobj, <a class="el" href="structbeam.html">beam</a> *actbeam)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#af26ee7c0414b10010e9a3a2cdfcbcb9d">SexObject_to_slitgeom</a> (const <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, const <a class="el" href="structSexObject.html">SexObject</a> *sobj, const double trace_angle, <a class="el" href="structbeam.html">beam</a> *actbeam)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#ab677ce148520e7e408d39157562ed425">fill_corner_ignore</a> (<a class="el" href="structSexObject.html">SexObject</a> *sobj, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, int beamID, float dmag, <a class="el" href="structbeam.html">beam</a> *actbeam)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structd__point.html">d_point</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a594a5c195cf16b237615c2b8ca76ac63">check_object_size</a> (const <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, const <a class="el" href="structSexObject.html">SexObject</a> *sobj, const int beamID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#aaf18fdf0a495428d532fc2acb0cb337b">SexObject_to_beam</a> (<a class="el" href="structSexObject.html">SexObject</a> *sobj, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode, int beamID, <a class="el" href="structbeam.html">beam</a> *actbeam)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobject.html">object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#adca42a33ade468757a83d39dd9462137">SexObject_to_objectII</a> (<a class="el" href="structSexObject.html">SexObject</a> *sobj, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobject.html">object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a1cc8887bfa02d842b41141ae74750490">SexObject_to_object</a> (<a class="el" href="structSexObject.html">SexObject</a> *sobj, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobject.html">object</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a3be1c25232414791b69783398d5c0fc3">SexObjects_to_oblist</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int back_mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobject.html">object</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#aba315f6055ab2042c62d24e4a6312491">SexObjects_to_oblistII</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs, <a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a24c706cb578a86827a1d5b991c34e783">check_conf_for_slitlessgeom</a> (const <a class="el" href="structaperture__conf.html">aperture_conf</a> *conf, const int auto_reorient)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a81c5036b461b98a7c6dde47ea87c0220">fill_object_bbox</a> (<a class="el" href="structobservation.html">observation</a> *const obs, <a class="el" href="structbeam.html">beam</a> *b, const float m_width, const int dxmin, const int dxmax)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#aa358fe9be94faba9d46991eb7fa9e766">size_of_sextractor_catalog</a> (char filename[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#af8023b218b4f95008b4a8e4df19005fa">get_SexObject_from_catalog</a> (char filename[], const double lambda_mark)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a7f30208a96f597d37e88ce2ec2c7c519">ABC_image_to_el</a> (<a class="el" href="structd__point.html">d_point</a> *a, <a class="el" href="structd__point.html">d_point</a> *b, <a class="el" href="structd__point.html">d_point</a> *c, <a class="el" href="structellipse.html">ellipse</a> *el)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a3b2003d8f076d528435938f1ed8491ed">ABC_image_to_el2</a> (<a class="el" href="structd__point.html">d_point</a> *a, <a class="el" href="structd__point.html">d_point</a> *b, <a class="el" href="structd__point.html">d_point</a> *c, <a class="el" href="structellipse.html">ellipse</a> *el)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a1dfd57669396970a74aa9035c953e86d">el_to_ABC_world</a> (<a class="el" href="structellipse.html">ellipse</a> *el, <a class="el" href="structsky__coord.html">sky_coord</a> *a, <a class="el" href="structsky__coord.html">sky_coord</a> *b, <a class="el" href="structsky__coord.html">sky_coord</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a7062ae05d05dbc0071064dfe649dfb64">el_to_ABC_world2</a> (<a class="el" href="structellipse.html">ellipse</a> *el, <a class="el" href="structsky__coord.html">sky_coord</a> *a, <a class="el" href="structsky__coord.html">sky_coord</a> *b, <a class="el" href="structsky__coord.html">sky_coord</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a8dc42564a62fb75a865abd1e97f3cef5">fill_missing_image_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> *o, struct WorldCoor *from_wcs, int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a9e39e413308fb40567ce4507d4b48d78">fill_all_missing_image_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs, struct WorldCoor *from_wcs, int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a0ab3db728560b7a291df4044abbea97e">fill_missing_WCS_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> *o, struct WorldCoor *from_wcs, int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#ab49c25c830b7c93a094562fffced9597">fill_all_missing_WCS_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs, struct WorldCoor *from_wcs, int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a7f60c3c87d2ddd2c795ab0ab66effce5">compute_new_image_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> *o, struct WorldCoor *to_wcs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a0f5894072e9db45e3cee9324218a8da3">compute_new_image_sexobject</a> (<a class="el" href="structSexObject.html">SexObject</a> *o, struct WorldCoor *to_wcs, int th_sky)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#ada6d87ffba18d3cfd0d14d687aeadecd">compute_all_new_image_coordinates</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs, struct WorldCoor *to_wcs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a93f742561264057d72a0c2b74633976c">catalog_to_wcs</a> (char grismfile[], int hdunum, char infile[], char outfile[], struct WorldCoor *from_wcs, struct WorldCoor *to_wcs, int distortion, int overwrite_wcs, int overwrite_img)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a09d4b7e97c42c84bf4a3cf9ffda6c614">catalog_to_wcs_nodim</a> (char infile[], char outfile[], struct WorldCoor *to_wcs, int overwrite_wcs, int overwrite_img)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gsl_vector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a496014d96016e580b632b2b15e0b7f72">sobs_to_vout</a> (const <a class="el" href="structSexObject.html">SexObject</a> *sobs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__sex_8h.html#a1de62f331f136845a887cec91920982e">free_SexObjects</a> (<a class="el" href="structSexObject.html">SexObject</a> **sobjs)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a385dd6d87c5af9252e1c0bf82d87e969"></a><!-- doxytag: member="spc_sex.h::CATBUFFERSIZE" ref="a385dd6d87c5af9252e1c0bf82d87e969" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CATBUFFERSIZE&nbsp;&nbsp;&nbsp;10240</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aacc3ee1a7f283f8ef65cea31f4436a95"></a><!-- doxytag: member="spc_sex.h::MAX" ref="aacc3ee1a7f283f8ef65cea31f4436a95" args="(x, y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">y&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(((x)&gt;(y))?(x):(y))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a19321d394ebca38412cec1c3f5bbf5bf"></a><!-- doxytag: member="spc_sex.h::MIN_DIFFANGLE" ref="a19321d394ebca38412cec1c3f5bbf5bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_DIFFANGLE&nbsp;&nbsp;&nbsp;3.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7f30208a96f597d37e88ce2ec2c7c519"></a><!-- doxytag: member="spc_sex.h::ABC_image_to_el" ref="a7f30208a96f597d37e88ce2ec2c7c519" args="(d_point *a, d_point *b, d_point *c, ellipse *el)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ABC_image_to_el </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structellipse.html">ellipse</a> *&nbsp;</td>
          <td class="paramname"> <em>el</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: ABC_image_to_el Convert a set of three image coordinates into an elipse structure </p>

<p><div class="fragment"><pre class="fragment"><a name="l01757"></a>01757 {
<a name="l01758"></a>01758   <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> != 0.0)
<a name="l01759"></a>01759     {
<a name="l01760"></a>01760       el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = atan (b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> / b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) / M_PI * 180.0;
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762   <span class="keywordflow">else</span>
<a name="l01763"></a>01763     {
<a name="l01764"></a>01764       el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = 90.0;
<a name="l01765"></a>01765     }
<a name="l01766"></a>01766 
<a name="l01767"></a>01767   el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> = sqrt ((b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) * (b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + (b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>) * (b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01768"></a>01768   el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> = sqrt ((c-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) * (c-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + (c-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>) * (c-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01769"></a>01769 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b2003d8f076d528435938f1ed8491ed"></a><!-- doxytag: member="spc_sex.h::ABC_image_to_el2" ref="a3b2003d8f076d528435938f1ed8491ed" args="(d_point *a, d_point *b, d_point *c, ellipse *el)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ABC_image_to_el2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structd__point.html">d_point</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structellipse.html">ellipse</a> *&nbsp;</td>
          <td class="paramname"> <em>el</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: ABC_image_to_el2 Convert a set of three image coordinates into an elipse structure </p>

<p><div class="fragment"><pre class="fragment"><a name="l01778"></a>01778 {
<a name="l01779"></a>01779   el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = atan ((b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> )/ (b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>)) / M_PI * 180.0;
<a name="l01780"></a>01780 
<a name="l01781"></a>01781   el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> = sqrt ((b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) * (b-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + (b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>) * (b-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01782"></a>01782   el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> = sqrt ((c-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) * (c-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - a-&gt;<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + (c-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>) * (c-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - a-&gt;<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01783"></a>01783 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a93f742561264057d72a0c2b74633976c"></a><!-- doxytag: member="spc_sex.h::catalog_to_wcs" ref="a93f742561264057d72a0c2b74633976c" args="(char grismfile[], int hdunum, char infile[], char outfile[], struct WorldCoor *from_wcs, struct WorldCoor *to_wcs, int distortion, int overwrite_wcs, int overwrite_img)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void catalog_to_wcs </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>grismfile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>infile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>outfile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>from_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>to_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>distortion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite_img</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: catalog_to_wcs This function reads a sextractor catalog and using an input and an output CD matrix, converts the world ra and dec coordinates to the output CD matrix's image pixel coordinates. Non existing (i.e. NaN) world RA and DEC values are generated using the pixel coordinates and the input CD matrix</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>infile a pointer to a char array containing the name of the input catalog </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>outfile a pointer to a char array containing the name of the output catalog </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>from_wcs a pointer to an exisiting WoldCoor structure containing the input catalog CD matrix </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>to_wcs a pointer to an exisiting WoldCoor structure containing the output catalog CD matrix </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>overwrite_wcs if set to 1 then input wold coordinate are recomputed first using the from_wcs and the x,y image values </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-</em>&nbsp;</td><td>overwrite_img if set to 1 then the x,y coordinates of the input image are first computed using the from_wcs and the world ra and dec info </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00305"></a>00305 {
<a name="l00306"></a>00306   FILE *fin, *fout;
<a name="l00307"></a>00307   gsl_vector *v;
<a name="l00308"></a>00308   gsl_vector *v_out;
<a name="l00309"></a>00309   gsl_vector *waves;
<a name="l00310"></a>00310   gsl_vector *cnums;
<a name="l00311"></a>00311   <a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *coeffs=NULL;
<a name="l00312"></a>00312   <span class="keywordtype">char</span> Buffer[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l00313"></a>00313   <span class="keywordtype">char</span> line[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>], str[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l00314"></a>00314   <span class="keywordtype">int</span> i, hasmags=0, magcencol = 0;
<a name="l00315"></a>00315   <span class="comment">//int index;</span>
<a name="l00316"></a>00316   <a class="code" href="structSexObject.html">SexObject</a> *o;
<a name="l00317"></a>00317   <a class="code" href="structcolinfo.html">colinfo</a> * actcatinfo;
<a name="l00318"></a>00318   <a class="code" href="structpx__point.html">px_point</a>    pixmax;
<a name="l00319"></a>00319   <a class="code" href="structpx__point.html">px_point</a>    backwin_cols;
<a name="l00320"></a>00320   <a class="code" href="structpx__point.html">px_point</a>    modinfo_cols;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   actcatinfo = <a class="code" href="spc__utils_8c.html#a47a365ec494841b98f872779b80535b0">get_sex_col_descr</a> (infile);
<a name="l00324"></a>00324   hasmags = <a class="code" href="spc__utils_8c.html#a50e5a8658878acd54ee085583f3964b7">has_magnitudes</a>(actcatinfo);
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (!hasmags)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00328"></a>00328                    <span class="stringliteral">&quot;No magnitudes in file %s&quot;</span>, infile);
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330   <span class="keywordflow">else</span>{
<a name="l00331"></a>00331     waves = gsl_vector_alloc (hasmags);
<a name="l00332"></a>00332     cnums = gsl_vector_alloc (hasmags);
<a name="l00333"></a>00333     hasmags = <a class="code" href="spc__utils_8c.html#a3d16714a512547070ba425e88c4bb763">get_magcols</a>(actcatinfo, waves, cnums);
<a name="l00334"></a>00334     magcencol = <a class="code" href="spc__utils_8c.html#a9cfaa2da5415e6bde7e7cea924473b41">get_magauto_col</a>(waves, cnums, 800.0);
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   backwin_cols = <a class="code" href="spc__utils_8c.html#a57a488065fd31edc4276c24af0a2fe53">has_backwindow</a>(actcatinfo);
<a name="l00338"></a>00338   modinfo_cols = <a class="code" href="spc__utils_8c.html#a77125dc504a3f1905e2f89b0296d37cf">has_modelinfo</a>(actcatinfo);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   <span class="keywordflow">if</span> (!(fin = fopen (infile, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00344"></a>00344                    <span class="stringliteral">&quot;Cannot open catalog file %s&quot;</span>, infile);
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346   <span class="keywordflow">if</span> (!(fout = fopen (outfile, <span class="stringliteral">&quot;w&quot;</span>)))
<a name="l00347"></a>00347     {
<a name="l00348"></a>00348       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00349"></a>00349                    <span class="stringliteral">&quot;Cannot open catalog file %s&quot;</span>, outfile);
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#ab746bad662c3d633b8ea691cf6fb9bf9">check_worldcoo_input</a>(actcatinfo, 0))
<a name="l00353"></a>00353     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00354"></a>00354                  <span class="stringliteral">&quot;Catalogue %s does not have all WCO columns\n&quot;</span>, infile);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a7ff43f642c35a3c47fbef83f1000ff36">check_imagecoo_input</a>(actcatinfo))
<a name="l00357"></a>00357     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00358"></a>00358                  <span class="stringliteral">&quot;Catalogue %s does not have all image coo columns\n&quot;</span>, infile);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <a class="code" href="spc__utils_8c.html#a1300c5f47fbca9f266e3536034a859e0">make_GOL_header</a>(fout, actcatinfo, waves, cnums, backwin_cols, modinfo_cols);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <span class="keywordflow">if</span> (distortion)
<a name="l00363"></a>00363     coeffs = <a class="code" href="crossdisp__utils_8c.html#a24fed0f1bc1490134a2c5c5baaee6ad5">get_crossdisp_matrix</a>(grismfile, hdunum);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   pixmax = <a class="code" href="aXe__utils_8c.html#a7eb3cbe5ef0277544b00b2cc9c990e4c">get_npixels</a> (grismfile, hdunum);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="keywordflow">while</span> (fgets (line, <a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>, fin))
<a name="l00368"></a>00368     {
<a name="l00369"></a>00369       <span class="keywordflow">if</span> (!(<a class="code" href="spc__utils_8c.html#a045718d450da547eb37a4413e815d4d8">line_is_valid</a> (actcatinfo, line)))
<a name="l00370"></a>00370         <span class="keywordflow">continue</span>;
<a name="l00371"></a>00371        <span class="keywordflow">if</span> (line[0] == <span class="charliteral">&apos;;&apos;</span>)
<a name="l00372"></a>00372          <span class="keywordflow">continue</span>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       <span class="comment">/* Create a vector containing the information */</span>
<a name="l00375"></a>00375       <a class="code" href="spc__utils_8c.html#a5173a4942a3d83d368b97ad51aabedb6">lv1ws</a> (line);
<a name="l00376"></a>00376       v = <a class="code" href="spc__utils_8c.html#ae52364129107c1b86e38dd795086046d">string_to_gsl_array</a> (line);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378       <span class="comment">//      o = create_SexObject (sex_col_desc, line);</span>
<a name="l00379"></a>00379       o = <a class="code" href="spc__sex_8c.html#a9fa77923a7b018be8b7073863b9e3c96">create_SexObject</a> (actcatinfo, line, waves, cnums, backwin_cols, modinfo_cols, magcencol,  1);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381       <span class="keywordflow">if</span> ( (from_wcs!=NULL)&amp;&amp;(to_wcs!=NULL) )
<a name="l00382"></a>00382         {
<a name="l00383"></a>00383           <span class="comment">//      if (distortion){</span>
<a name="l00384"></a>00384           <span class="comment">//        fprintf(stdout, &quot;(%f,%f) &amp;&amp;--&gt;&amp;&amp; &quot;, o-&gt;xy_image.x, o-&gt;xy_image.y);</span>
<a name="l00385"></a>00385           <span class="comment">//        o-&gt;xy_image = undistort_point(coeffs, pixmax, o-&gt;xy_image);</span>
<a name="l00386"></a>00386           <span class="comment">//      }</span>
<a name="l00387"></a>00387           <a class="code" href="spc__sex_8c.html#a0ab3db728560b7a291df4044abbea97e">fill_missing_WCS_coordinates</a> (o, from_wcs, overwrite_wcs);
<a name="l00388"></a>00388           <a class="code" href="spc__sex_8c.html#a8dc42564a62fb75a865abd1e97f3cef5">fill_missing_image_coordinates</a> (o, from_wcs, overwrite_img);
<a name="l00389"></a>00389           <a class="code" href="spc__sex_8c.html#a7f60c3c87d2ddd2c795ab0ab66effce5">compute_new_image_coordinates</a> (o, to_wcs);
<a name="l00390"></a>00390           <span class="keywordflow">if</span> (distortion){
<a name="l00391"></a>00391             o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a> = <a class="code" href="crossdisp__utils_8c.html#a952651847d0ab23bbd827533ae3e8f78">distort_point</a>(coeffs, pixmax, o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>);
<a name="l00392"></a>00392             <span class="comment">//      fprintf(stdout, &quot;(%f,%f)\n\n&quot;, o-&gt;xy_image.x, o-&gt;xy_image.y);</span>
<a name="l00393"></a>00393           }
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396       v_out = <a class="code" href="spc__sex_8c.html#a496014d96016e580b632b2b15e0b7f72">sobs_to_vout</a>(o);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398       sprintf (Buffer, <span class="stringliteral">&quot;%8.5g &quot;</span>, gsl_vector_get (v_out, 0));
<a name="l00399"></a>00399       <span class="keywordflow">for</span> (i = 1; i &lt; v_out-&gt;size; i++)
<a name="l00400"></a>00400         {
<a name="l00401"></a>00401           sprintf (str, <span class="stringliteral">&quot; %8.5g &quot;</span>, gsl_vector_get (v_out, i));
<a name="l00402"></a>00402           strcat (Buffer, str);
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404       strcat (Buffer, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406       fputs (Buffer, fout);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408       gsl_vector_free (v_out);
<a name="l00409"></a>00409       gsl_vector_free (v);
<a name="l00410"></a>00410   }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (coeffs)
<a name="l00413"></a>00413     <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(coeffs);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   fclose (fin);
<a name="l00416"></a>00416   fclose (fout);
<a name="l00417"></a>00417 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a09d4b7e97c42c84bf4a3cf9ffda6c614"></a><!-- doxytag: member="spc_sex.h::catalog_to_wcs_nodim" ref="a09d4b7e97c42c84bf4a3cf9ffda6c614" args="(char infile[], char outfile[], struct WorldCoor *to_wcs, int overwrite_wcs, int overwrite_img)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void catalog_to_wcs_nodim </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>infile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>outfile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>grism_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite_img</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function:catalog_to_wcs_nodim This function reads a sextractor catalog and using an input and an output CD matrix, converts the world ra and dec coordinates to the output CD matrix's image pixel coordinates. Non existing (i.e. NaN) world RA and DEC values are generated using the pixel coordinates and the input CD matrix</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>infile</em>&nbsp;</td><td>- a pointer to a char array containing the name of the input catalog </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>outfile</em>&nbsp;</td><td>- a pointer to a char array containing the name of the output catalog </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from_wcs</em>&nbsp;</td><td>- a pointer to an exisiting WoldCoor structure containing the input catalog CD matrix </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>to_wcs</em>&nbsp;</td><td>- a pointer to an exisiting WoldCoor structure containing the output catalog CD matrix </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite_wcs</em>&nbsp;</td><td>- if set to 1 then input wold coordinate are recomputed first using the from_wcs and the x,y image values </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite_img</em>&nbsp;</td><td>- if set to 1 then the x,y coordinates of the input image are first computed using the from_wcs and the world ra and dec info </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00447"></a>00447 {
<a name="l00448"></a>00448   FILE *fin, *fout;
<a name="l00449"></a>00449   gsl_vector *v;
<a name="l00450"></a>00450   gsl_vector *v_out;
<a name="l00451"></a>00451   gsl_vector *waves;
<a name="l00452"></a>00452   gsl_vector *cnums;
<a name="l00453"></a>00453   <span class="keywordtype">char</span> Buffer[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l00454"></a>00454   <span class="keywordtype">char</span> line[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>], str[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l00455"></a>00455   <span class="keywordtype">int</span> i;
<a name="l00456"></a>00456   <span class="comment">//int index;</span>
<a name="l00457"></a>00457   <a class="code" href="structSexObject.html">SexObject</a> *o;
<a name="l00458"></a>00458   <span class="keywordtype">int</span> compute_imcoos=0;
<a name="l00459"></a>00459   <span class="keywordtype">int</span> th_sky=0;
<a name="l00460"></a>00460   <span class="keywordtype">int</span> checksum, hasmags=0, magcencol=0;
<a name="l00461"></a>00461   <a class="code" href="structcolinfo.html">colinfo</a> * actcatinfo;
<a name="l00462"></a>00462   <a class="code" href="structpx__point.html">px_point</a>    backwin_cols;
<a name="l00463"></a>00463   <a class="code" href="structpx__point.html">px_point</a>    modinfo_cols;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   actcatinfo = <a class="code" href="spc__utils_8c.html#a47a365ec494841b98f872779b80535b0">get_sex_col_descr</a> (infile);
<a name="l00466"></a>00466   hasmags = <a class="code" href="spc__utils_8c.html#a50e5a8658878acd54ee085583f3964b7">has_magnitudes</a>(actcatinfo);
<a name="l00467"></a>00467   <span class="keywordflow">if</span> (!hasmags)
<a name="l00468"></a>00468     {
<a name="l00469"></a>00469       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00470"></a>00470                    <span class="stringliteral">&quot;No magnitudes in file %s&quot;</span>, infile);
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472   <span class="keywordflow">else</span>{
<a name="l00473"></a>00473     waves = gsl_vector_alloc (hasmags);
<a name="l00474"></a>00474     cnums = gsl_vector_alloc (hasmags);
<a name="l00475"></a>00475     hasmags = <a class="code" href="spc__utils_8c.html#a3d16714a512547070ba425e88c4bb763">get_magcols</a>(actcatinfo, waves, cnums);
<a name="l00476"></a>00476     magcencol = <a class="code" href="spc__utils_8c.html#a9cfaa2da5415e6bde7e7cea924473b41">get_magauto_col</a>(waves, cnums, 800.0);
<a name="l00477"></a>00477   }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   backwin_cols = <a class="code" href="spc__utils_8c.html#a57a488065fd31edc4276c24af0a2fe53">has_backwindow</a>(actcatinfo);
<a name="l00480"></a>00480   modinfo_cols = <a class="code" href="spc__utils_8c.html#a77125dc504a3f1905e2f89b0296d37cf">has_modelinfo</a>(actcatinfo);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (!(fin = fopen (infile, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00485"></a>00485                    <span class="stringliteral">&quot;Cannot open catalog file %s&quot;</span>, infile);
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487   <span class="keywordflow">if</span> (!(fout = fopen (outfile, <span class="stringliteral">&quot;w&quot;</span>)))
<a name="l00488"></a>00488     {
<a name="l00489"></a>00489       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00490"></a>00490                    <span class="stringliteral">&quot;Cannot open catalog file %s&quot;</span>, outfile);
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493   <span class="comment">//  checksum = check_worldcoo_input(sex_col_desc);</span>
<a name="l00494"></a>00494   th_sky=1;
<a name="l00495"></a>00495   checksum = <a class="code" href="spc__utils_8c.html#ab746bad662c3d633b8ea691cf6fb9bf9">check_worldcoo_input</a>(actcatinfo, 1);
<a name="l00496"></a>00496   <span class="keywordflow">if</span> (checksum)
<a name="l00497"></a>00497     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00498"></a>00498                  <span class="stringliteral">&quot;Catalogue %s does not have all necessary columns\n&quot;</span>, infile);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <span class="comment">//  if (check_imagecoo_input(sex_col_desc))</span>
<a name="l00501"></a>00501   <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a7ff43f642c35a3c47fbef83f1000ff36">check_imagecoo_input</a>(actcatinfo))
<a name="l00502"></a>00502     compute_imcoos=1;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <a class="code" href="spc__utils_8c.html#a1300c5f47fbca9f266e3536034a859e0">make_GOL_header</a>(fout, actcatinfo, waves, cnums, backwin_cols, modinfo_cols);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="keywordflow">while</span> (fgets (line, <a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>, fin))
<a name="l00507"></a>00507     {
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       <span class="comment">/* If line is not a valid catalog entry, just continue */</span>
<a name="l00510"></a>00510       <span class="keywordflow">if</span> (!(<a class="code" href="spc__utils_8c.html#a045718d450da547eb37a4413e815d4d8">line_is_valid</a> (actcatinfo, line)))
<a name="l00511"></a>00511         <span class="keywordflow">continue</span>;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513       <span class="comment">/* if line starts with &quot;;&quot;, just continue */</span>
<a name="l00514"></a>00514       <span class="keywordflow">if</span> (line[0] == <span class="charliteral">&apos;;&apos;</span>)
<a name="l00515"></a>00515         <span class="keywordflow">continue</span>;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517       <span class="comment">/* Create a vector containing the information */</span>
<a name="l00518"></a>00518       <a class="code" href="spc__utils_8c.html#a5173a4942a3d83d368b97ad51aabedb6">lv1ws</a> (line);
<a name="l00519"></a>00519       v = <a class="code" href="spc__utils_8c.html#ae52364129107c1b86e38dd795086046d">string_to_gsl_array</a> (line);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521       o = <a class="code" href="spc__sex_8c.html#a9fa77923a7b018be8b7073863b9e3c96">create_SexObject</a> (actcatinfo, line, waves, cnums, backwin_cols, modinfo_cols, magcencol,  0);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524       <span class="keywordflow">if</span> (compute_imcoos)
<a name="l00525"></a>00525         <a class="code" href="spc__sex_8c.html#a0f5894072e9db45e3cee9324218a8da3">compute_new_image_sexobject</a> (o, grism_wcs, th_sky);
<a name="l00526"></a>00526       v_out = <a class="code" href="spc__sex_8c.html#a496014d96016e580b632b2b15e0b7f72">sobs_to_vout</a>(o);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529       sprintf (Buffer, <span class="stringliteral">&quot;%8.5g &quot;</span>, gsl_vector_get (v_out, 0));
<a name="l00530"></a>00530       <span class="keywordflow">for</span> (i = 1; i &lt; v_out-&gt;size; i++)
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532           sprintf (str, <span class="stringliteral">&quot; %8.5g &quot;</span>, gsl_vector_get (v_out, i));
<a name="l00533"></a>00533           strcat (Buffer, str);
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535       strcat (Buffer, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537       fputs (Buffer, fout);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539       gsl_vector_free (v_out);
<a name="l00540"></a>00540       gsl_vector_free (v);
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   fclose (fin);
<a name="l00544"></a>00544   fclose (fout);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546   free (actcatinfo);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a24c706cb578a86827a1d5b991c34e783"></a><!-- doxytag: member="spc_sex.h::check_conf_for_slitlessgeom" ref="a24c706cb578a86827a1d5b991c34e783" args="(const aperture_conf *conf, const int auto_reorient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_conf_for_slitlessgeom </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: check_conf_for_slitlessgeom The functions checks whether a smoothed flux conversion is possible or not. In case that keywords in the configuration files are missing, it is NOT possible, and 0 is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>- the configuarion file structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- integer indicating the extraction method</td></tr>
  </table>
  </dd>
</dl>
<p>Returns </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>is_possible - the paramters used in the smoothing </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01441"></a>01441   {
<a name="l01442"></a>01442     <span class="keywordtype">int</span> is_possible=1;
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="keywordflow">if</span> (auto_reorient == 1 &amp;&amp; conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a> &lt; 0.0)
<a name="l01445"></a>01445       <span class="comment">// change the switch</span>
<a name="l01446"></a>01446       is_possible = 0;
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <span class="comment">// return the pointer</span>
<a name="l01449"></a>01449     <span class="keywordflow">return</span> is_possible;
<a name="l01450"></a>01450   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a594a5c195cf16b237615c2b8ca76ac63"></a><!-- doxytag: member="spc_sex.h::check_object_size" ref="a594a5c195cf16b237615c2b8ca76ac63" args="(const aperture_conf *conf, const SexObject *sobj, const int beamID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structd__point.html">d_point</a> check_object_size </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>beamID</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00893"></a>00893   {
<a name="l00894"></a>00894     <span class="keywordtype">double</span> obj_size = 0.0;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <a class="code" href="structd__point.html">d_point</a> ret;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <span class="comment">// set the input values</span>
<a name="l00899"></a>00899     <span class="comment">// as default</span>
<a name="l00900"></a>00900     ret.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>;
<a name="l00901"></a>00901     ret.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="comment">// check whether a minimum</span>
<a name="l00904"></a>00904     <span class="comment">// size is defined</span>
<a name="l00905"></a>00905     <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a> &lt; 0.0)
<a name="l00906"></a>00906       <span class="comment">// return the value</span>
<a name="l00907"></a>00907       <span class="keywordflow">return</span> ret;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     <span class="comment">// compute the object size</span>
<a name="l00910"></a>00910     obj_size = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="comment">// check whether the object is point-like</span>
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (obj_size &lt; <a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a>))
<a name="l00914"></a>00914       {
<a name="l00915"></a>00915         <span class="comment">// transfer the point-like</span>
<a name="l00916"></a>00916         <span class="comment">// sizes to the return</span>
<a name="l00917"></a>00917         ret.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a>;
<a name="l00918"></a>00918         ret.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a>;
<a name="l00919"></a>00919         fprintf(stdout, <span class="stringliteral">&quot;Object ID %i, %c: size set to: %f\n&quot;</span>, sobj-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>, <a class="code" href="aXe__grism_8h.html#a7d90dabb6016bb0e09b6ab84087b70a7">BEAM</a>(beamID), conf-&gt;<a class="code" href="structaperture__conf.html#a981e8e9f63a913f1ac34c864ec392024">pobjsize</a>);
<a name="l00920"></a>00920       }
<a name="l00921"></a>00921 
<a name="l00922"></a>00922     <span class="comment">// return the resulting</span>
<a name="l00923"></a>00923     <span class="comment">// object size</span>
<a name="l00924"></a>00924     <span class="keywordflow">return</span> ret;
<a name="l00925"></a>00925   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ada6d87ffba18d3cfd0d14d687aeadecd"></a><!-- doxytag: member="spc_sex.h::compute_all_new_image_coordinates" ref="ada6d87ffba18d3cfd0d14d687aeadecd" args="(SexObject **sobjs, struct WorldCoor *to_wcs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compute_all_new_image_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>to_wcs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: compute_all_new_image_coordinates Replaces all SexObjects image coordinates with new ones computed using the the passed WCS.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- a NULL terminated array containing pointers to SexObjects </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>to_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l02060"></a>02060 {
<a name="l02061"></a>02061      <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063      <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l02064"></a>02064      <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l02065"></a>02065           nobjs++;
<a name="l02066"></a>02066 
<a name="l02067"></a>02067      <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l02068"></a>02068        {
<a name="l02069"></a>02069             <a class="code" href="spc__sex_8c.html#a7f60c3c87d2ddd2c795ab0ab66effce5">compute_new_image_coordinates</a> (sobjs[i], to_wcs);
<a name="l02070"></a>02070        }
<a name="l02071"></a>02071 
<a name="l02072"></a>02072 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7f60c3c87d2ddd2c795ab0ab66effce5"></a><!-- doxytag: member="spc_sex.h::compute_new_image_coordinates" ref="a7f60c3c87d2ddd2c795ab0ab66effce5" args="(SexObject *o, struct WorldCoor *to_wcs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compute_new_image_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>to_wcs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: compute_new_image_coordinates Function that uses the exisiting world coordinates of a <a class="el" href="structSexObject.html">SexObject</a> to compute new pixel coordinates using a (new) WCS.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>- a pointer to an exsting <a class="el" href="structSexObject.html">SexObject</a>. Should have been checked for validity already </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>to_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01976"></a>01976 {
<a name="l01977"></a>01977   <a class="code" href="structsky__coord.html">sky_coord</a> as, bs, cs;
<a name="l01978"></a>01978   <a class="code" href="structd__point.html">d_point</a> a, b, c;
<a name="l01979"></a>01979   <span class="keywordtype">int</span> offscl;
<a name="l01980"></a>01980 
<a name="l01981"></a>01981 
<a name="l01982"></a>01982   <span class="comment">/******************************************************************/</span>
<a name="l01983"></a>01983   <span class="comment">/* uses the existing world coordinates of a SexObject to compute  */</span>
<a name="l01984"></a>01984   <span class="comment">/* new pixel coordinates using a (new) WCS.                       */</span>
<a name="l01985"></a>01985   <span class="comment">/*******************************************************************/</span>
<a name="l01986"></a>01986 
<a name="l01987"></a>01987   <span class="comment">/* recomputes xy_image  from the world values */</span>
<a name="l01988"></a>01988   wcs2pix (to_wcs, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>),
<a name="l01989"></a>01989            &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01990"></a>01990 
<a name="l01991"></a>01991 
<a name="l01992"></a>01992   <span class="comment">/* recomputes el_image them from the world values */</span>
<a name="l01993"></a>01993   <a class="code" href="spc__sex_8c.html#a1dfd57669396970a74aa9035c953e86d">el_to_ABC_world</a> (&amp;(o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>), &amp;as, &amp;bs, &amp;cs);      <span class="comment">/* Convert ellipse into a set of 3 coordinates */</span>
<a name="l01994"></a>01994 
<a name="l01995"></a>01995   <span class="comment">/* Compute the end point of the axes in the image coord system */</span>
<a name="l01996"></a>01996   wcs2pix (to_wcs, as.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, as.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(a.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(a.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01997"></a>01997   wcs2pix (to_wcs, bs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, bs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(b.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(b.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01998"></a>01998   wcs2pix (to_wcs, cs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, cs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(c.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(c.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 
<a name="l02001"></a>02001   <span class="comment">/* DISABLED */</span>
<a name="l02002"></a>02002   <span class="comment">//     ABC_image_to_el (&amp;a, &amp;b, &amp;c, &amp;(o-&gt;el_image));  /* convert 3 coordinates into ellipse */</span>
<a name="l02003"></a>02003 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f5894072e9db45e3cee9324218a8da3"></a><!-- doxytag: member="spc_sex.h::compute_new_image_sexobject" ref="a0f5894072e9db45e3cee9324218a8da3" args="(SexObject *o, struct WorldCoor *to_wcs, int th_sky)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compute_new_image_sexobject </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>to_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>th_sky</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: compute_new_image_sexobject Function that uses the exisiting world coordinates of a <a class="el" href="structSexObject.html">SexObject</a> to compute new pixel coordinates using a (new) WCS.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>- a pointer to an exsting <a class="el" href="structSexObject.html">SexObject</a>. Should have been checked for validity already </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>to_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l02017"></a>02017 {
<a name="l02018"></a>02018   <span class="comment">//sky_coord as;</span>
<a name="l02019"></a>02019   <a class="code" href="structsky__coord.html">sky_coord</a> bs, cs;
<a name="l02020"></a>02020   <a class="code" href="structd__point.html">d_point</a> a, b, c;
<a name="l02021"></a>02021   <span class="keywordtype">int</span> offscl;
<a name="l02022"></a>02022 
<a name="l02023"></a>02023   <span class="comment">/******************************************************************/</span>
<a name="l02024"></a>02024   <span class="comment">/* uses the existing world coordinates of a SexObject to compute  */</span>
<a name="l02025"></a>02025   <span class="comment">/* new pixel coordinates using a (new) WCS.                       */</span>
<a name="l02026"></a>02026   <span class="comment">/******************************************************************/</span>
<a name="l02027"></a>02027 
<a name="l02028"></a>02028   <span class="comment">/* recomputes xy_image  from the world values */</span>
<a name="l02029"></a>02029   wcs2pix (to_wcs, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>),
<a name="l02030"></a>02030            &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l02031"></a>02031 
<a name="l02032"></a>02032   <span class="comment">/* Convert ellipse into a set of 3 coordinates */</span>
<a name="l02033"></a>02033   <a class="code" href="spc__sex_8c.html#a7062ae05d05dbc0071064dfe649dfb64">el_to_ABC_world2</a> (&amp;(o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>), &amp;(o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>), &amp;bs, &amp;cs);
<a name="l02034"></a>02034 
<a name="l02035"></a>02035   <span class="comment">/* Compute the end point of the axes in the image coord system */</span>
<a name="l02036"></a>02036 
<a name="l02037"></a>02037   wcs2pix (to_wcs, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(a.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(a.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l02038"></a>02038   wcs2pix (to_wcs, bs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, bs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(b.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(b.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l02039"></a>02039   wcs2pix (to_wcs, cs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, cs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(c.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(c.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l02040"></a>02040 
<a name="l02041"></a>02041 
<a name="l02042"></a>02042   <span class="comment">/* convert 3 coordinates into ellipse */</span>
<a name="l02043"></a>02043   <a class="code" href="spc__sex_8c.html#a3b2003d8f076d528435938f1ed8491ed">ABC_image_to_el2</a> (&amp;a, &amp;b, &amp;c, &amp;(o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>));
<a name="l02044"></a>02044   <span class="keywordflow">if</span> (th_sky)
<a name="l02045"></a>02045     o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> - 90.0;
<a name="l02046"></a>02046 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fa77923a7b018be8b7073863b9e3c96"></a><!-- doxytag: member="spc_sex.h::create_SexObject" ref="a9fa77923a7b018be8b7073863b9e3c96" args="(const colinfo *actinfo, char *line, const gsl_vector *waves, const gsl_vector *cnums, const px_point backwin_cols, const px_point modinfo_cols, const int magcol, const int fullinfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSexObject.html">SexObject</a>* create_SexObject </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structcolinfo.html">colinfo</a> *&nbsp;</td>
          <td class="paramname"> <em>actinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_vector *&nbsp;</td>
          <td class="paramname"> <em>waves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gsl_vector *&nbsp;</td>
          <td class="paramname"> <em>cnums</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structpx__point.html">px_point</a>&nbsp;</td>
          <td class="paramname"> <em>backwin_cols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structpx__point.html">px_point</a>&nbsp;</td>
          <td class="paramname"> <em>modinfo_cols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>magcol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>fullinfo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: create_SexObject Allocates and create s a SExtractor <a class="el" href="structobject.html">object</a> from a line of a SExtractor catalog.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>actinfo</em>&nbsp;</td><td>- the header structure with the column names </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>line</em>&nbsp;</td><td>- the line to be transformed into a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>waves</em>&nbsp;</td><td>- vector with the walelengths of the magnitude columns </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cnums</em>&nbsp;</td><td>- vector with the column numbers of the magnitude columns </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>magcol</em>&nbsp;</td><td>- column number of the magnitude column selected for mag_auto </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fullinfo</em>&nbsp;</td><td>- deecides whether a column is optional or not</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>o - the new created <a class="el" href="structSexObject.html">SexObject</a> </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060 {
<a name="l00061"></a>00061   gsl_vector *v;
<a name="l00062"></a>00062   gsl_vector *mags;
<a name="l00063"></a>00063   gsl_vector *wavs;
<a name="l00064"></a>00064   <a class="code" href="structSexObject.html">SexObject</a>  *o;
<a name="l00065"></a>00065   <span class="keywordtype">int</span>         i=0;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="comment">// transform the data in the line to a vector</span>
<a name="l00068"></a>00068   <a class="code" href="spc__utils_8c.html#a5173a4942a3d83d368b97ad51aabedb6">lv1ws</a> (line);
<a name="l00069"></a>00069   v = <a class="code" href="spc__utils_8c.html#ae52364129107c1b86e38dd795086046d">string_to_gsl_array</a> (line);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="comment">// allocate space for the SexObject</span>
<a name="l00072"></a>00072   o = (<a class="code" href="structSexObject.html">SexObject</a> *) malloc (<span class="keyword">sizeof</span> (<a class="code" href="structSexObject.html">SexObject</a>));
<a name="l00073"></a>00073   <span class="keywordflow">if</span> (o == NULL)
<a name="l00074"></a>00074     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00075"></a>00075                  <span class="stringliteral">&quot;create_SexObject: Could not allocate memory.&quot;</span>);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <span class="comment">// succesively fill the data into the SexObject.</span>
<a name="l00078"></a>00078   <span class="comment">// for &apos;fullinfo=1&apos; missing data results in an error.</span>
<a name="l00079"></a>00079   <span class="comment">// otherwise NaN is stored into the SexObject</span>
<a name="l00080"></a>00080   o-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a> = (int) <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;NUMBER&quot;</span>, v, 1);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;X_IMAGE&quot;</span>, v,fullinfo);
<a name="l00083"></a>00083   o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;Y_IMAGE&quot;</span>, v,fullinfo);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>    = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;X_WORLD&quot;</span>, v,1);
<a name="l00086"></a>00086   o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>   = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;Y_WORLD&quot;</span>, v,1);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;A_IMAGE&quot;</span>, v,fullinfo);
<a name="l00089"></a>00089   o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;B_IMAGE&quot;</span>, v,fullinfo);
<a name="l00090"></a>00090   o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;THETA_IMAGE&quot;</span>, v,fullinfo);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;A_WORLD&quot;</span>, v,1);
<a name="l00093"></a>00093   o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>     = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;B_WORLD&quot;</span>, v,1);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">// Some clarification is needed for the next two lines.</span>
<a name="l00096"></a>00096   <span class="comment">// to have get_col_value and get_col_value2 is not</span>
<a name="l00097"></a>00097   <span class="comment">// satisfying!! PROBLEM</span>
<a name="l00098"></a>00098   o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = <a class="code" href="spc__utils_8c.html#a1720a86f177dc973d965f0bf525ebd3a">get_col_value2</a> (actinfo, <span class="stringliteral">&quot;THETA_WORLD&quot;</span>, v,0);
<a name="l00099"></a>00099   <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> &lt;-900000){
<a name="l00100"></a>00100     <span class="comment">//  o-&gt;el_world.theta = get_col_value (actinfo, &quot;THETA_WORLD&quot;, v,0);</span>
<a name="l00101"></a>00101     <span class="comment">//  if (isnan(o-&gt;el_world.theta)){</span>
<a name="l00102"></a>00102     o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;THETA_SKY&quot;</span>, v,1);
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="keywordflow">if</span> (backwin_cols.<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> !=-1)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107       o-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>  = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;BACKWINDOW&quot;</span>, v,1);
<a name="l00108"></a>00108       o-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>  = -1;
<a name="l00109"></a>00109       <span class="comment">// old code for FORS2-MXU</span>
<a name="l00110"></a>00110       <span class="comment">// o-&gt;backwindow.y     = get_col_value (actinfo, &quot;BACKWIN_LOW&quot;, v,1);</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113   <span class="keywordflow">else</span>
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115       o-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>     = -1;
<a name="l00116"></a>00116       o-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>     = -1;
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <span class="comment">// transfer the index for the model spectrum</span>
<a name="l00120"></a>00120   <span class="keywordflow">if</span> (modinfo_cols.<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> &gt; -1)
<a name="l00121"></a>00121     o-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a> = (int)<a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a>(actinfo, <span class="stringliteral">&quot;MODSPEC&quot;</span>, v,1);
<a name="l00122"></a>00122   <span class="keywordflow">else</span>
<a name="l00123"></a>00123     o-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a> = -1;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">// transfer the index value for the object shape</span>
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (modinfo_cols.<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> &gt; -1)
<a name="l00127"></a>00127     o-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a> = (int)<a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a>(actinfo, <span class="stringliteral">&quot;MODIMAGE&quot;</span>, v,1);
<a name="l00128"></a>00128   <span class="keywordflow">else</span>
<a name="l00129"></a>00129     o-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a> = -1;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="comment">// check whether the MAG_AUTO column exists</span>
<a name="l00132"></a>00132   <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)waves-&gt;size == 1 &amp;&amp; (int)gsl_vector_get (waves, 0) == 0)
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00136"></a>00136       <span class="comment">// fill the MAG_AUTO value</span>
<a name="l00137"></a>00137       <span class="comment">// put the magnitude and wavelength vectors to NULL</span>
<a name="l00138"></a>00138       o-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a> = NULL;
<a name="l00139"></a>00139       o-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>    = NULL;
<a name="l00140"></a>00140       o-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a>   = <a class="code" href="spc__utils_8c.html#ad97d117907a3a7344fae7ecf3f5f7ec5">get_col_value</a> (actinfo, <span class="stringliteral">&quot;MAG_AUTO&quot;</span>, v, 1);
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142   <span class="keywordflow">else</span>
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144       <span class="comment">// create the vectors for the magnitude values</span>
<a name="l00145"></a>00145       mags = gsl_vector_alloc ((<span class="keywordtype">int</span>)waves-&gt;size);
<a name="l00146"></a>00146       wavs = gsl_vector_alloc ((<span class="keywordtype">int</span>)waves-&gt;size);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148       <span class="comment">// fill the magnitude values into the vectors and store them in</span>
<a name="l00149"></a>00149       <span class="comment">// the SexObject.</span>
<a name="l00150"></a>00150       <span class="keywordflow">for</span> (i=0; i &lt; (int)waves-&gt;size; i++){
<a name="l00151"></a>00151         gsl_vector_set(mags, i, gsl_vector_get (v, (<span class="keywordtype">int</span>)gsl_vector_get (cnums, i)-1));
<a name="l00152"></a>00152         gsl_vector_set(wavs, i, gsl_vector_get (waves, i));
<a name="l00153"></a>00153       }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155       <span class="comment">// fill the MAG_AUTO value</span>
<a name="l00156"></a>00156       o-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a> = mags;
<a name="l00157"></a>00157       o-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>    = wavs;
<a name="l00158"></a>00158       o-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a>   = gsl_vector_get (v, magcol-1);
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keywordflow">return</span> o;
<a name="l00162"></a>00162 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1dfd57669396970a74aa9035c953e86d"></a><!-- doxytag: member="spc_sex.h::el_to_ABC_world" ref="a1dfd57669396970a74aa9035c953e86d" args="(ellipse *el, sky_coord *a, sky_coord *b, sky_coord *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void el_to_ABC_world </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structellipse.html">ellipse</a> *&nbsp;</td>
          <td class="paramname"> <em>el</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: el_to_ABC_world Convert a wold coordinate <a class="el" href="structellipse.html">ellipse</a> into a set of 3 points on the tangent plane point a is at pos of obj, semi major-axis end is point b, semi minor axis is point c theta is measured from x-axis to semi-major axis, counter clock wise. </p>

<p><div class="fragment"><pre class="fragment"><a name="l01724"></a>01724 {
<a name="l01725"></a>01725 
<a name="l01726"></a>01726      a-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a> = 0.0;
<a name="l01727"></a>01727      a-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> = 0.0;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729      b-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a> = el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * cos (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI);
<a name="l01730"></a>01730      b-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> = el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * sin (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732      c-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a> = -1.0 * el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * sin (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI);
<a name="l01733"></a>01733      c-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> = el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * cos (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI);
<a name="l01734"></a>01734 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7062ae05d05dbc0071064dfe649dfb64"></a><!-- doxytag: member="spc_sex.h::el_to_ABC_world2" ref="a7062ae05d05dbc0071064dfe649dfb64" args="(ellipse *el, sky_coord *a, sky_coord *b, sky_coord *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void el_to_ABC_world2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structellipse.html">ellipse</a> *&nbsp;</td>
          <td class="paramname"> <em>el</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsky__coord.html">sky_coord</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l01742"></a>01742 {
<a name="l01743"></a>01743   b-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>  = a-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>  - (el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * cos (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI))/cos(a-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> / 180. * M_PI);
<a name="l01744"></a>01744   b-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> = a-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> + (el-&gt;<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * sin (el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a> / 180. * M_PI));
<a name="l01745"></a>01745 
<a name="l01746"></a>01746   c-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>  = a-&gt;<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>  - (el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * cos ((el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>-90.0)/180.*M_PI))/cos(a-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> / 180. * M_PI);
<a name="l01747"></a>01747   c-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> = a-&gt;<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a> + (el-&gt;<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * sin ((el-&gt;<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>-90.0)/180.*M_PI));
<a name="l01748"></a>01748 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9e39e413308fb40567ce4507d4b48d78"></a><!-- doxytag: member="spc_sex.h::fill_all_missing_image_coordinates" ref="a9e39e413308fb40567ce4507d4b48d78" args="(SexObject **sobjs, struct WorldCoor *from_wcs, int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_all_missing_image_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>from_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_all_missing_image_coordinates Replaces all NaN values in a set of SexObjects with ones computed from the available information and the associated WCS.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- an NULL terminated array containing pointers to SexObjects </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>- forces the re-computation of all image coordinates </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01921"></a>01921 {
<a name="l01922"></a>01922   <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l01923"></a>01923 
<a name="l01924"></a>01924   <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l01925"></a>01925   <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l01926"></a>01926     nobjs++;
<a name="l01927"></a>01927 
<a name="l01928"></a>01928   <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l01929"></a>01929     {
<a name="l01930"></a>01930       <a class="code" href="spc__sex_8c.html#a8dc42564a62fb75a865abd1e97f3cef5">fill_missing_image_coordinates</a> (sobjs[i], from_wcs, overwrite);
<a name="l01931"></a>01931     }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab49c25c830b7c93a094562fffced9597"></a><!-- doxytag: member="spc_sex.h::fill_all_missing_WCS_coordinates" ref="ab49c25c830b7c93a094562fffced9597" args="(SexObject **sobjs, struct WorldCoor *from_wcs, int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_all_missing_WCS_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>from_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_all_missing_WCS_coordinates Replaces all NaN values in a set of SexObjects with ones computed from the available information and the associated WCS.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- an NULL terminated array containing pointers to SexObjects </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>- forces the re-computation of all image coordinates </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01949"></a>01949 {
<a name="l01950"></a>01950   <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l01951"></a>01951 
<a name="l01952"></a>01952   <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l01953"></a>01953   <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l01954"></a>01954     nobjs++;
<a name="l01955"></a>01955 
<a name="l01956"></a>01956   <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l01957"></a>01957     {
<a name="l01958"></a>01958       <a class="code" href="spc__sex_8c.html#a0ab3db728560b7a291df4044abbea97e">fill_missing_WCS_coordinates</a> (sobjs[i], from_wcs, overwrite);
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab677ce148520e7e408d39157562ed425"></a><!-- doxytag: member="spc_sex.h::fill_corner_ignore" ref="ab677ce148520e7e408d39157562ed425" args="(SexObject *sobj, observation *const obs, aperture_conf *conf, int beamID, float dmag, beam *actbeam)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_corner_ignore </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>beamID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbeam.html">beam</a> *&nbsp;</td>
          <td class="paramname"> <em>actbeam</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_corner_ignore The method computes and fills the <a class="el" href="structbeam.html">beam</a> corner information and the the ignore flag into a <a class="el" href="structbeam.html">beam</a> structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>- pointer to the configuration structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>beamID</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actbeam</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> structure to be filled</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00738"></a>00738   {
<a name="l00739"></a>00739     <span class="keywordtype">double</span> mmag_extract;
<a name="l00740"></a>00740     <span class="keywordtype">double</span> mmag_mark;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <span class="comment">// get the extraction and the mark margnitudes</span>
<a name="l00743"></a>00743     mmag_extract = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#adfafb08dec01127a7c09ec3dab7729b1">mmag_extract</a> + dmag;
<a name="l00744"></a>00744     mmag_mark    = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#a2d2357691589e58e4e50eb9fe9bbf199">mmag_mark</a>    + dmag;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="comment">// make a default for the</span>
<a name="l00747"></a>00747     <span class="comment">// ignore flag</span>
<a name="l00748"></a>00748     actbeam-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 0;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="comment">/* magnitude cut */</span>
<a name="l00751"></a>00751     <span class="comment">// PROBLEM: there is a logical flaw inside</span>
<a name="l00752"></a>00752     <span class="comment">//          whhat happend when (mag &gt; mag_mark) &amp;&amp; (mag &lt;  mmag_extract) ????</span>
<a name="l00753"></a>00753     <span class="comment">//          of course this has only relevance when mag_mark &lt; mmag_extract</span>
<a name="l00754"></a>00754     <span class="comment">//      if ((sobj-&gt;mag_auto &lt;= mmag_mark)&amp;&amp;(sobj-&gt;mag_auto &lt;= mmag_extract))</span>
<a name="l00755"></a>00755     <span class="comment">// That&apos;s now an easy fix, but makes sense..</span>
<a name="l00756"></a>00756     <span class="keywordflow">if</span> (sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &lt;= mmag_extract)
<a name="l00757"></a>00757         actbeam-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 0; <span class="comment">// this object will be extracted</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">if</span> ((sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &lt;= mmag_mark)&amp;&amp;(sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_extract))
<a name="l00760"></a>00760         actbeam-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 2; <span class="comment">// this object will be not be extracted</span>
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keywordflow">if</span> ((sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_mark)&amp;&amp;(sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_extract))
<a name="l00763"></a>00763         actbeam-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 1; <span class="comment">// this object will be ignored</span>
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="comment">// fill the boundary box values;</span>
<a name="l00766"></a>00766     <span class="comment">// returns if the beams is completely out of the image</span>
<a name="l00767"></a>00767     <span class="keywordflow">if</span> (!<a class="code" href="spc__sex_8c.html#a81c5036b461b98a7c6dde47ea87c0220">fill_object_bbox</a> (obs, actbeam, 2, conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#a55f5257b40a3f5f6b43980c779734e84">offset</a>.<a class="code" href="structpx__offset.html#a5d141ef035baf4fefab88956ea1a7060">dx0</a>,
<a name="l00768"></a>00768                            conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#a55f5257b40a3f5f6b43980c779734e84">offset</a>.<a class="code" href="structpx__offset.html#a81678dca036abb27f0c829b3aabca784">dx1</a>))
<a name="l00769"></a>00769       actbeam-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 1;
<a name="l00770"></a>00770   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8dc42564a62fb75a865abd1e97f3cef5"></a><!-- doxytag: member="spc_sex.h::fill_missing_image_coordinates" ref="a8dc42564a62fb75a865abd1e97f3cef5" args="(SexObject *o, struct WorldCoor *from_wcs, int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_missing_image_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>from_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_missing_image_coordinates Update a <a class="el" href="structSexObject.html">SexObject</a> structure and replace all missing image coordinates by re-computing them using the world one and the from_wcs wcs. Re-computes: peak_image_x peak_image.y xy_image.x xy_image.y el_image.a el_image.b el_image.theta</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>- a pointer to an exsting <a class="el" href="structSexObject.html">SexObject</a>. Should have been checked for validity already </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01870"></a>01870 {
<a name="l01871"></a>01871   <a class="code" href="structsky__coord.html">sky_coord</a> as, bs, cs;
<a name="l01872"></a>01872   <a class="code" href="structd__point.html">d_point</a> a, b, c;
<a name="l01873"></a>01873   <span class="keywordtype">int</span> offscl;
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 
<a name="l01876"></a>01876   <span class="comment">/************************/</span>
<a name="l01877"></a>01877   <span class="comment">/* If the image coordinates are missing, generate them using from_wcs and sextractor world</span>
<a name="l01878"></a>01878 <span class="comment">     coordinates */</span>
<a name="l01879"></a>01879   <span class="comment">/************************/</span>
<a name="l01880"></a>01880   <span class="keywordflow">if</span> ((overwrite) || (isnan (o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>)) || (isnan (o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>)))
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882       <span class="comment">/* recomputes xy_image  from the world values */</span>
<a name="l01883"></a>01883       wcs2pix (from_wcs, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>,
<a name="l01884"></a>01884                &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01885"></a>01885 
<a name="l01886"></a>01886     }
<a name="l01887"></a>01887 
<a name="l01888"></a>01888 
<a name="l01889"></a>01889   <span class="keywordflow">if</span> ((isnan (o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>)) || (isnan (o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>))
<a name="l01890"></a>01890       || (isnan (o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>)) || (overwrite))
<a name="l01891"></a>01891     {
<a name="l01892"></a>01892 
<a name="l01893"></a>01893       <span class="comment">/* recomputes el_image them from the world values */</span>
<a name="l01894"></a>01894 
<a name="l01895"></a>01895       <a class="code" href="spc__sex_8c.html#a1dfd57669396970a74aa9035c953e86d">el_to_ABC_world</a> (&amp;(o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>), &amp;as, &amp;bs, &amp;cs);  <span class="comment">/* Convert ellipse into a set of 3 coordinates */</span>
<a name="l01896"></a>01896 
<a name="l01897"></a>01897       <span class="comment">/* Compute the end point of the axes in the image coord system */</span>
<a name="l01898"></a>01898       wcs2pix (from_wcs, as.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, as.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(a.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(a.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01899"></a>01899       wcs2pix (from_wcs, bs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, bs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(b.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(b.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01900"></a>01900       wcs2pix (from_wcs, cs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, cs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(c.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(c.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>), &amp;offscl);
<a name="l01901"></a>01901 
<a name="l01902"></a>01902       <span class="comment">/* DISABLED !!*/</span>
<a name="l01903"></a>01903       <span class="comment">//            ABC_image_to_el (&amp;a, &amp;b, &amp;c, &amp;(o-&gt;el_image));       /* convert 3 coordinates into ellipse */</span>
<a name="l01904"></a>01904     }
<a name="l01905"></a>01905 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ab3db728560b7a291df4044abbea97e"></a><!-- doxytag: member="spc_sex.h::fill_missing_WCS_coordinates" ref="a0ab3db728560b7a291df4044abbea97e" args="(SexObject *o, struct WorldCoor *from_wcs, int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_missing_WCS_coordinates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct WorldCoor *&nbsp;</td>
          <td class="paramname"> <em>from_wcs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_missing_WCS_coordinates Update a <a class="el" href="structSexObject.html">SexObject</a> structure and replace all missing WCS coordinates by re-computing them using the world one and the from_wcs wcs. Re-computes: peak_world_x peak_world.y xy_world.x xy_world.y el_world.a el_world.b el_world.theta</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>- a pointer to an exsting <a class="el" href="structSexObject.html">SexObject</a>. Should have been checked for validity already </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from_wcs</em>&nbsp;</td><td>- a pointer to an existing WoldCoord wcs structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01803"></a>01803 {
<a name="l01804"></a>01804   <a class="code" href="structsky__coord.html">sky_coord</a> as, bs, cs;
<a name="l01805"></a>01805   <a class="code" href="structd__point.html">d_point</a> a, b, c;
<a name="l01806"></a>01806   <span class="comment">//int offscl;</span>
<a name="l01807"></a>01807 
<a name="l01808"></a>01808   <span class="comment">/***************************************************************/</span>
<a name="l01809"></a>01809   <span class="comment">/* If the WCS coordinates are missing, generate them using     */</span>
<a name="l01810"></a>01810   <span class="comment">/* from_wcs and sextractor image coordinates                   */</span>
<a name="l01811"></a>01811   <span class="comment">/***************************************************************/</span>
<a name="l01812"></a>01812 
<a name="l01813"></a>01813   <span class="keywordflow">if</span> ((overwrite) || (isnan (o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>)) || (isnan (o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>)))
<a name="l01814"></a>01814     {
<a name="l01815"></a>01815       <span class="comment">/* recomputes xy_image  from the world values */</span>
<a name="l01816"></a>01816       <span class="comment">/*pix2wcs (from_wcs, o-&gt;xy_image.x, o-&gt;xy_image.y,</span>
<a name="l01817"></a>01817 <span class="comment">               &amp;(o-&gt;xy_world.ra),&amp;(o-&gt;xy_world.dec), &amp;offscl);</span>
<a name="l01818"></a>01818 <span class="comment">      */</span>
<a name="l01819"></a>01819       <span class="comment">/* recomputes xy_image  from the world values */</span>
<a name="l01820"></a>01820       <span class="comment">// new version requested since wcstools-3.6</span>
<a name="l01821"></a>01821       pix2wcs (from_wcs, o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>, o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>,
<a name="l01822"></a>01822                &amp;(o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>),&amp;(o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>));
<a name="l01823"></a>01823     }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   <span class="keywordflow">if</span> ((isnan (o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>)) || (isnan (o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>))
<a name="l01826"></a>01826       || (isnan (o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>)) || (overwrite))
<a name="l01827"></a>01827     {
<a name="l01828"></a>01828 
<a name="l01829"></a>01829       <span class="comment">/* recomputes el_image them from the world values */</span>
<a name="l01830"></a>01830 
<a name="l01831"></a>01831       <span class="comment">/* Note the following is an unconventional use of the et_to*()</span>
<a name="l01832"></a>01832 <span class="comment">         routines since we store image coords in as, bs, and cs */</span>
<a name="l01833"></a>01833       <a class="code" href="spc__sex_8c.html#a1dfd57669396970a74aa9035c953e86d">el_to_ABC_world</a> (&amp;(o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>), &amp;as, &amp;bs, &amp;cs);  <span class="comment">/* Convert ellipse into a set of 3 coordinates */</span>
<a name="l01834"></a>01834 
<a name="l01835"></a>01835       <span class="comment">/* Compute the end point of the axes in the image coord system */</span>
<a name="l01836"></a>01836       <span class="comment">/*      pix2wcs (from_wcs, as.ra, as.dec, &amp;(a.x), &amp;(a.y), &amp;offscl);</span>
<a name="l01837"></a>01837 <span class="comment">      pix2wcs (from_wcs, bs.ra, bs.dec, &amp;(b.x), &amp;(b.y), &amp;offscl);</span>
<a name="l01838"></a>01838 <span class="comment">      pix2wcs (from_wcs, cs.ra, cs.dec, &amp;(c.x), &amp;(c.y), &amp;offscl);</span>
<a name="l01839"></a>01839 <span class="comment">      */</span>
<a name="l01840"></a>01840       <span class="comment">/* Compute the end point of the axes in the image coord system */</span>
<a name="l01841"></a>01841       <span class="comment">// new version requested since wcstools-3.6</span>
<a name="l01842"></a>01842       pix2wcs (from_wcs, as.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, as.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(a.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(a.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01843"></a>01843       pix2wcs (from_wcs, bs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, bs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(b.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(b.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01844"></a>01844       pix2wcs (from_wcs, cs.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>, cs.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>, &amp;(c.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>), &amp;(c.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l01845"></a>01845 
<a name="l01846"></a>01846       <a class="code" href="spc__sex_8c.html#a7f30208a96f597d37e88ce2ec2c7c519">ABC_image_to_el</a> (&amp;a, &amp;b, &amp;c, &amp;(o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>));     <span class="comment">/* convert 3 coordinates into ellipse */</span>
<a name="l01847"></a>01847     }
<a name="l01848"></a>01848 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81c5036b461b98a7c6dde47ea87c0220"></a><!-- doxytag: member="spc_sex.h::fill_object_bbox" ref="a81c5036b461b98a7c6dde47ea87c0220" args="(observation *const obs, beam *b, const float m_width, const int dxmin, const int dxmax)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fill_object_bbox </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbeam.html">beam</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&nbsp;</td>
          <td class="paramname"> <em>m_width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>dxmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>dxmax</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fill_object_bbox Fill up the aperture part of the <a class="el" href="structbeam.html">beam</a> of an <a class="el" href="structobject.html">object</a> structure by looking at the trace polynomial description associated with this <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image (used for bound checking) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>- A pointer to a <a class="el" href="structbeam.html">beam</a> whose aperture must be filled. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m_width</em>&nbsp;</td><td>- The width in pixel of the extraction box </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dxmin</em>&nbsp;</td><td>- How far (in pixel) to follow the trace on the left side of the <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dxmax</em>&nbsp;</td><td>- How far (in pixel) to follow the trace on the right hand side of the <a class="el" href="structspectrum.html">spectrum</a></td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if bounding box appears to be valied (i.e. non-empty) </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01471"></a>01471 {
<a name="l01472"></a>01472      <a class="code" href="structd__point.html">d_point</a> pmin, pmax;
<a name="l01473"></a>01473      <a class="code" href="structd__point.html">d_point</a> pminl, pminh, pmaxl, pmaxh;
<a name="l01474"></a>01474      <span class="keywordtype">float</span> w = b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a>/2. * m_width + 2.0;
<a name="l01475"></a>01475      <span class="keywordtype">float</span> wcos, wsin;
<a name="l01476"></a>01476      <span class="keywordtype">float</span> area;
<a name="l01477"></a>01477 
<a name="l01478"></a>01478          <span class="keywordtype">int</span> xmin, xmax, xact;
<a name="l01479"></a>01479          <span class="comment">//int i;</span>
<a name="l01480"></a>01480      <span class="keywordtype">double</span> yact;
<a name="l01481"></a>01481 
<a name="l01482"></a>01482      pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + dxmin;
<a name="l01483"></a>01483      pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> =
<a name="l01484"></a>01484           b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#a7c1a538b7ae1293d6e0fc1bdd4c2739c">func</a> (dxmin, b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>);
<a name="l01485"></a>01485 
<a name="l01486"></a>01486      pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + dxmax;
<a name="l01487"></a>01487      pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> =
<a name="l01488"></a>01488           b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#a7c1a538b7ae1293d6e0fc1bdd4c2739c">func</a> (dxmax, b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>);
<a name="l01489"></a>01489 
<a name="l01490"></a>01490 
<a name="l01491"></a>01491      <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aedeeb1989f1f33f55e7c641f9510864e">type</a> &gt; 1)
<a name="l01492"></a>01492        {
<a name="l01493"></a>01493          <span class="keywordflow">if</span> (dxmin &lt; dxmax)
<a name="l01494"></a>01494            {
<a name="l01495"></a>01495              xmin = dxmin;
<a name="l01496"></a>01496              xmax = dxmax;
<a name="l01497"></a>01497            }
<a name="l01498"></a>01498          <span class="keywordflow">else</span>
<a name="l01499"></a>01499            {
<a name="l01500"></a>01500              xmin = dxmax;
<a name="l01501"></a>01501              xmax = dxmin;
<a name="l01502"></a>01502            }
<a name="l01503"></a>01503 
<a name="l01504"></a>01504          <span class="keywordflow">for</span> (xact = xmin; xact &lt; xmax; xact++)
<a name="l01505"></a>01505            {
<a name="l01506"></a>01506              yact = b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#a7c1a538b7ae1293d6e0fc1bdd4c2739c">func</a> (xact, b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>);
<a name="l01507"></a>01507 
<a name="l01508"></a>01508              <span class="keywordflow">if</span> (yact &lt; pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>)
<a name="l01509"></a>01509                pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = yact;
<a name="l01510"></a>01510              <span class="keywordflow">if</span> (yact &gt; pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>)
<a name="l01511"></a>01511                pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = yact;
<a name="l01512"></a>01512            }
<a name="l01513"></a>01513          wcos = w * cos (b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>);
<a name="l01514"></a>01514          wsin = w * sin (b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>);
<a name="l01515"></a>01515 
<a name="l01516"></a>01516          <span class="keywordflow">if</span> (wcos &gt; 0)
<a name="l01517"></a>01517            {
<a name="l01518"></a>01518              pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - wcos;
<a name="l01519"></a>01519              pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + wcos;
<a name="l01520"></a>01520            }
<a name="l01521"></a>01521          <span class="keywordflow">else</span>
<a name="l01522"></a>01522            {
<a name="l01523"></a>01523              pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + wcos;
<a name="l01524"></a>01524              pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - wcos;
<a name="l01525"></a>01525            }
<a name="l01526"></a>01526          <span class="keywordflow">if</span> (wsin &gt; 0)
<a name="l01527"></a>01527            {
<a name="l01528"></a>01528              pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - wsin;
<a name="l01529"></a>01529              pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + wsin;
<a name="l01530"></a>01530            }
<a name="l01531"></a>01531          <span class="keywordflow">else</span>
<a name="l01532"></a>01532            {
<a name="l01533"></a>01533              pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + wsin;
<a name="l01534"></a>01534              pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - wsin;
<a name="l01535"></a>01535            }
<a name="l01536"></a>01536          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01537"></a>01537          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01540"></a>01540          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01543"></a>01543          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01544"></a>01544 
<a name="l01545"></a>01545          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[3].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01546"></a>01546          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[3].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01547"></a>01547        }
<a name="l01548"></a>01548      <span class="keywordflow">else</span>
<a name="l01549"></a>01549        {
<a name="l01550"></a>01550 
<a name="l01551"></a>01551          wcos = w * cos (b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>);
<a name="l01552"></a>01552          wsin = w * sin (b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>);
<a name="l01553"></a>01553 
<a name="l01554"></a>01554          pminl.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - wcos;
<a name="l01555"></a>01555          pminl.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - wsin;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557          pminh.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmin.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + wcos;
<a name="l01558"></a>01558          pminh.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmin.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + wsin;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560          pmaxl.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - wcos;
<a name="l01561"></a>01561          pmaxl.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - wsin;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563          pmaxh.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = pmax.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> + wcos;
<a name="l01564"></a>01564          pmaxh.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = pmax.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> + wsin;
<a name="l01565"></a>01565 
<a name="l01566"></a>01566          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pminl.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01567"></a>01567          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pminl.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmaxl.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01570"></a>01570          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmaxl.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pmaxh.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01573"></a>01573          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pmaxh.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01574"></a>01574 
<a name="l01575"></a>01575          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[3].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> = pminh.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01576"></a>01576          b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[3].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> = pminh.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01577"></a>01577        }
<a name="l01578"></a>01578 
<a name="l01579"></a>01579      <span class="comment">/* Compute the area of this aperture */</span>
<a name="l01580"></a>01580      area =
<a name="l01581"></a>01581           0.5 * (fabs (b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> - b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[4].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>) *
<a name="l01582"></a>01582                  fabs (b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[0].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> - b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a>) +
<a name="l01583"></a>01583                  fabs (b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> -
<a name="l01584"></a>01584                        b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[1].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>) * fabs (b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[3].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> -
<a name="l01585"></a>01585                                                 b-&gt;<a class="code" href="structbeam.html#a785bab6bf808db6a8841654312d20899">corners</a>[2].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a>));
<a name="l01586"></a>01586      <span class="keywordflow">if</span> (area == 0)
<a name="l01587"></a>01587        {
<a name="l01588"></a>01588             fprintf (stderr, <span class="stringliteral">&quot;aper debug: area is zero!\n&quot;</span>);
<a name="l01589"></a>01589             <span class="keywordflow">return</span> 0;
<a name="l01590"></a>01590        }
<a name="l01591"></a>01591      <span class="keywordflow">return</span> 1;
<a name="l01592"></a>01592 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1de62f331f136845a887cec91920982e"></a><!-- doxytag: member="spc_sex.h::free_SexObjects" ref="a1de62f331f136845a887cec91920982e" args="(SexObject **sobjs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_SexObjects </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_SexObjects Free a NULL terminated array of <a class="el" href="structSexObject.html">SexObject</a></p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- a NULL terminated array containing pointers to SexObjects </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l02085"></a>02085 {
<a name="l02086"></a>02086   <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l02087"></a>02087 
<a name="l02088"></a>02088   <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l02089"></a>02089   <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l02090"></a>02090     nobjs++;
<a name="l02091"></a>02091 
<a name="l02092"></a>02092   <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l02093"></a>02093     {
<a name="l02094"></a>02094       <span class="keywordflow">if</span> (sobjs[i]-&gt;magnitudes){
<a name="l02095"></a>02095         gsl_vector_free (sobjs[i]-&gt;lambdas);
<a name="l02096"></a>02096         gsl_vector_free (sobjs[i]-&gt;magnitudes);
<a name="l02097"></a>02097       }
<a name="l02098"></a>02098       free (sobjs[i]);
<a name="l02099"></a>02099       sobjs[i] = NULL;
<a name="l02100"></a>02100     }
<a name="l02101"></a>02101   free (sobjs);
<a name="l02102"></a>02102   sobjs = NULL;
<a name="l02103"></a>02103 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8023b218b4f95008b4a8e4df19005fa"></a><!-- doxytag: member="spc_sex.h::get_SexObject_from_catalog" ref="af8023b218b4f95008b4a8e4df19005fa" args="(char filename[], const double lambda_mark)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSexObject.html">SexObject</a>** get_SexObject_from_catalog </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>lambda_mark</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_SexObject_from_catalog Parses a Sextractor 2.0 catalog file, and outputs a NULL terminated array of SexObjects pointers. Ignores rows starting with a ;</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer pointing to a char array containing the list of a sextractor <a class="el" href="structobject.html">object</a> output catalog</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to an array of SeXObject pointer. NULL terminated </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01653"></a>01653 {
<a name="l01654"></a>01654   FILE *input;
<a name="l01655"></a>01655   <span class="keywordtype">char</span> Buffer[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l01656"></a>01656   gsl_vector *v;
<a name="l01657"></a>01657   gsl_vector *waves;
<a name="l01658"></a>01658   gsl_vector *cnums;
<a name="l01659"></a>01659   <span class="keywordtype">int</span> catsize, nobjs, i, hasmags=0, magcencol=0;
<a name="l01660"></a>01660   <a class="code" href="structSexObject.html">SexObject</a> **sobjs, *sobj;
<a name="l01661"></a>01661   <a class="code" href="structcolinfo.html">colinfo</a> * actcatinfo;
<a name="l01662"></a>01662   <a class="code" href="structpx__point.html">px_point</a>  backwin_cols;
<a name="l01663"></a>01663   <a class="code" href="structpx__point.html">px_point</a>  modinfo_cols;
<a name="l01664"></a>01664 
<a name="l01665"></a>01665 
<a name="l01666"></a>01666   actcatinfo = <a class="code" href="spc__utils_8c.html#a47a365ec494841b98f872779b80535b0">get_sex_col_descr</a> (filename);
<a name="l01667"></a>01667   hasmags = <a class="code" href="spc__utils_8c.html#a50e5a8658878acd54ee085583f3964b7">has_magnitudes</a>(actcatinfo);
<a name="l01668"></a>01668   waves = gsl_vector_alloc (hasmags);
<a name="l01669"></a>01669   cnums = gsl_vector_alloc (hasmags);
<a name="l01670"></a>01670   hasmags = <a class="code" href="spc__utils_8c.html#a3d16714a512547070ba425e88c4bb763">get_magcols</a>(actcatinfo, waves, cnums);
<a name="l01671"></a>01671   magcencol = <a class="code" href="spc__utils_8c.html#a9cfaa2da5415e6bde7e7cea924473b41">get_magauto_col</a>(waves, cnums, lambda_mark);
<a name="l01672"></a>01672 
<a name="l01673"></a>01673   backwin_cols = <a class="code" href="spc__utils_8c.html#a57a488065fd31edc4276c24af0a2fe53">has_backwindow</a>(actcatinfo);
<a name="l01674"></a>01674   modinfo_cols = <a class="code" href="spc__utils_8c.html#a77125dc504a3f1905e2f89b0296d37cf">has_modelinfo</a>(actcatinfo);
<a name="l01675"></a>01675 
<a name="l01676"></a>01676 
<a name="l01677"></a>01677   <span class="comment">//  catsize = count_keys (catalog_header);</span>
<a name="l01678"></a>01678   catsize = actcatinfo-&gt;<a class="code" href="structcolinfo.html#aeac67ce88746e560df5b1f503d26a670">numcols</a>;
<a name="l01679"></a>01679   nobjs = <a class="code" href="spc__sex_8c.html#aa358fe9be94faba9d46991eb7fa9e766">size_of_sextractor_catalog</a> (filename);
<a name="l01680"></a>01680 
<a name="l01681"></a>01681   <span class="keywordflow">if</span> (!(input = fopen (filename, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l01682"></a>01682        {
<a name="l01683"></a>01683          <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01684"></a>01684                       <span class="stringliteral">&quot;Could not open Sextractor catalog&quot;</span> <span class="stringliteral">&quot;file %s,\n&quot;</span>,
<a name="l01685"></a>01685                       filename);
<a name="l01686"></a>01686        }
<a name="l01687"></a>01687 
<a name="l01688"></a>01688   <span class="comment">/* Allocate enough room for nobjs+1 SexObject  pointers */</span>
<a name="l01689"></a>01689   sobjs = (<a class="code" href="structSexObject.html">SexObject</a> **) malloc ((nobjs + 1) * <span class="keyword">sizeof</span> (<a class="code" href="structSexObject.html">SexObject</a> *));
<a name="l01690"></a>01690   <span class="keywordflow">if</span> (!sobjs)
<a name="l01691"></a>01691     {
<a name="l01692"></a>01692       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory.&quot;</span>);
<a name="l01693"></a>01693     }
<a name="l01694"></a>01694 
<a name="l01695"></a>01695   i = 0;
<a name="l01696"></a>01696   <span class="keywordflow">while</span> (fgets (Buffer, <a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>, input))
<a name="l01697"></a>01697     {
<a name="l01698"></a>01698       <span class="keywordflow">if</span> (Buffer[0] == <span class="charliteral">&apos;;&apos;</span>)
<a name="l01699"></a>01699         <span class="keywordflow">continue</span>;
<a name="l01700"></a>01700       v = <a class="code" href="spc__utils_8c.html#ae52364129107c1b86e38dd795086046d">string_to_gsl_array</a> (Buffer);
<a name="l01701"></a>01701       <span class="keywordflow">if</span> (v==NULL) <span class="keywordflow">continue</span>;
<a name="l01702"></a>01702       <span class="keywordflow">if</span> (v-&gt;size == catsize)
<a name="l01703"></a>01703         {
<a name="l01704"></a>01704           <span class="comment">// BIG BUG!!!</span>
<a name="l01705"></a>01705           <span class="comment">//               sobj = create_SexObject (catalog_header, Buffer);</span>
<a name="l01706"></a>01706           sobj = <a class="code" href="spc__sex_8c.html#a9fa77923a7b018be8b7073863b9e3c96">create_SexObject</a> (actcatinfo, Buffer, waves, cnums, backwin_cols, modinfo_cols, magcencol, 0);
<a name="l01707"></a>01707           sobjs[i++] = sobj;
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710   sobjs[i] = NULL;
<a name="l01711"></a>01711 
<a name="l01712"></a>01712   <span class="keywordflow">return</span> sobjs;
<a name="l01713"></a>01713 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9d3731ef7e209c389cde4b659e5cac8"></a><!-- doxytag: member="spc_sex.h::SexMags_to_beamFlux" ref="ae9d3731ef7e209c389cde4b659e5cac8" args="(SexObject *sobj, beam *actbeam)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SexMags_to_beamFlux </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbeam.html">beam</a> *&nbsp;</td>
          <td class="paramname"> <em>actbeam</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexMags_to_beamFlux Fill an <a class="el" href="structbeam.html">beam</a> structure with the flux and shape information information contained in a <a class="el" href="structSexObject.html">SexObject</a> structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actbeam</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> structure to be filled</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00564"></a>00564   {
<a name="l00565"></a>00565     <span class="keywordtype">int</span> nvalid=0;
<a name="l00566"></a>00566     <span class="keywordtype">int</span> jj=0;
<a name="l00567"></a>00567     <span class="keywordtype">int</span> j=0;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="keywordtype">double</span> fval=0.0;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     gsl_vector *flux;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     <span class="comment">// set &apos;default&apos; shapes</span>
<a name="l00574"></a>00574     actbeam-&gt;<a class="code" href="structbeam.html#a9a40c792769161a2526fb415c6dadad0">awidth</a>  = -1.0;
<a name="l00575"></a>00575     actbeam-&gt;<a class="code" href="structbeam.html#acc52e3393f91f5f11a65d1a6806b681f">bwidth</a>  = -1.0;
<a name="l00576"></a>00576     actbeam-&gt;<a class="code" href="structbeam.html#a5cbf4e447f3c6272f31215965e4d574c">aorient</a> = -1.0;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="comment">// set a &apos;default&apos; flux</span>
<a name="l00579"></a>00579     actbeam-&gt;<a class="code" href="structbeam.html#a199b010e935235ef70f482416d113458">flux</a> = NULL;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">/* if flux/wavelength information exists */</span>
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>)
<a name="l00583"></a>00583       {
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <span class="comment">// get the number of valid entries in &apos;sobj-&gt;magnitudes&apos;</span>
<a name="l00586"></a>00586         nvalid = <a class="code" href="spc__utils_8c.html#a975f8bbace187edba3fbb05b9d099046">get_valid_entries</a>(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>);
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (!nvalid)
<a name="l00588"></a>00588           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00589"></a>00589                        <span class="stringliteral">&quot;No valid magnitude for object %i !\n&quot;</span>, sobj-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <span class="comment">// allocate the flux vector</span>
<a name="l00593"></a>00593         flux = gsl_vector_alloc (2*(nvalid));
<a name="l00594"></a>00594 
<a name="l00595"></a>00595         <span class="comment">// initialize a counter</span>
<a name="l00596"></a>00596         jj=0;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         <span class="comment">//  go over all magnidute values</span>
<a name="l00599"></a>00599         <span class="keywordflow">for</span> (j=0; j &lt; sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>-&gt;size; j++)
<a name="l00600"></a>00600           {
<a name="l00601"></a>00601             <span class="comment">// check whether the current entry is valuied</span>
<a name="l00602"></a>00602             <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a8e9536e04ecffec6365a655c18070867">is_valid_entry</a>(gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>, j)))
<a name="l00603"></a>00603               {
<a name="l00604"></a>00604                 <span class="comment">// get the current entry, already converted to flux</span>
<a name="l00605"></a>00605                 fval = <a class="code" href="model__utils_8c.html#a8d6681aef9c109bc5c407c286c85d67c">get_flambda_from_magab</a>(gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>, j), gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>, j));
<a name="l00606"></a>00606 
<a name="l00607"></a>00607                 <span class="comment">// set the wavelength value and the flux value</span>
<a name="l00608"></a>00608                 gsl_vector_set(flux, 2*jj, gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>, j));
<a name="l00609"></a>00609                 gsl_vector_set(flux, 2*jj+1, fval);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                 <span class="comment">// enhance the counter</span>
<a name="l00612"></a>00612                 jj++;
<a name="l00613"></a>00613               }
<a name="l00614"></a>00614           }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <span class="comment">// transfer the flux values</span>
<a name="l00617"></a>00617         <span class="comment">// to the beam</span>
<a name="l00618"></a>00618         actbeam-&gt;<a class="code" href="structbeam.html#a199b010e935235ef70f482416d113458">flux</a> = flux;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620         <span class="comment">// transfer the shape values</span>
<a name="l00621"></a>00621         <span class="comment">// to the beam</span>
<a name="l00622"></a>00622         actbeam-&gt;<a class="code" href="structbeam.html#a9a40c792769161a2526fb415c6dadad0">awidth</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>;
<a name="l00623"></a>00623         actbeam-&gt;<a class="code" href="structbeam.html#acc52e3393f91f5f11a65d1a6806b681f">bwidth</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>;
<a name="l00624"></a>00624         actbeam-&gt;<a class="code" href="structbeam.html#a5cbf4e447f3c6272f31215965e4d574c">aorient</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>;
<a name="l00625"></a>00625       }
<a name="l00626"></a>00626   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a50a3720d64c09d63859bb71314e14f8b"></a><!-- doxytag: member="spc_sex.h::SexObject_fprintf" ref="a50a3720d64c09d63859bb71314e14f8b" args="(FILE *output, SexObject *o)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SexObject_fprintf </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObject_fprintf Function to print the attributes of a SexObbject to an output stream.</p>
<p>Paramters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>output</em>&nbsp;</td><td>- an ouput file or stream </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>o</em>&nbsp;</td><td>- a pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00176"></a>00176 {
<a name="l00177"></a>00177      fprintf (output, <span class="stringliteral">&quot;NUMBER: %d\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179      fprintf (output, <span class="stringliteral">&quot;X_IMAGE: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>);
<a name="l00180"></a>00180      fprintf (output, <span class="stringliteral">&quot;Y_IMAGE: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182      fprintf (output, <span class="stringliteral">&quot;X_WORLD: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>);
<a name="l00183"></a>00183      fprintf (output, <span class="stringliteral">&quot;Y_WORLD: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185      fprintf (output, <span class="stringliteral">&quot;A_IMAGE: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>);
<a name="l00186"></a>00186      fprintf (output, <span class="stringliteral">&quot;B_IMAGE: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>);
<a name="l00187"></a>00187      fprintf (output, <span class="stringliteral">&quot;THETA_IMAGE: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189      fprintf (output, <span class="stringliteral">&quot;A_WORLD: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>);
<a name="l00190"></a>00190      fprintf (output, <span class="stringliteral">&quot;B_WORLD: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>);
<a name="l00191"></a>00191      fprintf (output, <span class="stringliteral">&quot;THETA_WORLD: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193      fprintf (output, <span class="stringliteral">&quot;MAG_AUTO: %e\n&quot;</span>, o-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaf18fdf0a495428d532fc2acb0cb337b"></a><!-- doxytag: member="spc_sex.h::SexObject_to_beam" ref="aaf18fdf0a495428d532fc2acb0cb337b" args="(SexObject *sobj, observation *const obs, aperture_conf *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode, int beamID, beam *actbeam)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SexObject_to_beam </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>conffile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>mfwhm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bck_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>beamID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbeam.html">beam</a> *&nbsp;</td>
          <td class="paramname"> <em>actbeam</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObject_to_beam Fill an <a class="el" href="structbeam.html">beam</a> structure with the information contained in a <a class="el" href="structSexObject.html">SexObject</a> structure plus further information derived via the confiugration file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>- pointer to the configuration structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conffile</em>&nbsp;</td><td>- the name of the aperture configuration file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mfwhm</em>&nbsp;</td><td>- the fwhm multiplicator constant to apply to determine the width of the aperture box for the <a class="el" href="structobject.html">object</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- if set then this task tries to optimize the orientation of the extraction slit - Should in general be left at 1 so that strange geomety is avoided. If set to 2 the extraction is forced to be vertical (90 deg.) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bck_mode</em>&nbsp;</td><td>- pointer for background mode </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>beamID</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actbeam</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> structure to be filled</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00957"></a>00957   {
<a name="l00958"></a>00958     <span class="keywordtype">double</span> trace_angle;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <a class="code" href="structd__point.html">d_point</a> pixel;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     <a class="code" href="structtracestruct.html">tracestruct</a> *trace;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <span class="comment">// set the beam ID</span>
<a name="l00965"></a>00965     actbeam-&gt;<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a> = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#a240d13d3f0a07ee411bce6c41b590b5b">ID</a>;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="comment">// set the model template ID&apos;s</span>
<a name="l00968"></a>00968     actbeam-&gt;<a class="code" href="structbeam.html#a60879dd4cb05dff92646b26f0b1ca8d8">modspec</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a>;
<a name="l00969"></a>00969     actbeam-&gt;<a class="code" href="structbeam.html#a343c47194d158bcc217a46923038e1a3">modimage</a> = sobj-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a>;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">// Adjust for posibly non (0,0) ref point of the 2D field dependence</span>
<a name="l00972"></a>00972     <span class="comment">// get the geometrical description of the trace at position &quot;pixel&quot;</span>
<a name="l00973"></a>00973     pixel.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - 1.0 - conf-&gt;<a class="code" href="structaperture__conf.html#a5cdddf8dafb95b7a77458fbdbf74e5b9">refx</a>;
<a name="l00974"></a>00974     pixel.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - 1.0 - conf-&gt;<a class="code" href="structaperture__conf.html#ae48467c471e66355a90db41d8ce77bc6">refy</a>;
<a name="l00975"></a>00975     trace = <a class="code" href="trace__conf_8c.html#af23d39f0c71ce368e456ce5bbdd45a74">get_tracestruct_at_pos</a> (conffile, conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[beamID].<a class="code" href="structbeam__conf.html#a240d13d3f0a07ee411bce6c41b590b5b">ID</a>, pixel);
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="comment">// transfer trace information to the beam</span>
<a name="l00978"></a>00978     actbeam-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a> = <a class="code" href="spc__trace__functions_8c.html#a63f2dd8f35451e510ac0347532bd4b91">vector_to_trace_polyN</a>(trace-&gt;<a class="code" href="structtracestruct.html#a42797f7a46efa0ea3e5ec4c7512906e1">pol</a>);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="comment">// compute the local trace angle</span>
<a name="l00981"></a>00981     trace_angle = atan2(actbeam-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0, actbeam-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="comment">// set the reference point</span>
<a name="l00984"></a>00984     actbeam-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> - 1.0 + trace-&gt;<a class="code" href="structtracestruct.html#a036bfe31dd2376d708c7ee84adfcb035">offset</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l00985"></a>00985     actbeam-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> - 1.0 + trace-&gt;<a class="code" href="structtracestruct.html#a036bfe31dd2376d708c7ee84adfcb035">offset</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     <span class="comment">// fill the flux and shape information</span>
<a name="l00988"></a>00988     <a class="code" href="spc__sex_8c.html#ae9d3731ef7e209c389cde4b659e5cac8">SexMags_to_beamFlux</a>(sobj, actbeam);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="comment">// fill in the slit geometry</span>
<a name="l00991"></a>00991     <a class="code" href="spc__sex_8c.html#af26ee7c0414b10010e9a3a2cdfcbcb9d">SexObject_to_slitgeom</a>(conf, sobj, trace_angle, actbeam);
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="comment">// actually set the extraction parameters</span>
<a name="l00994"></a>00994     <a class="code" href="spc__sex_8c.html#a97763327c0d5be165c3b8bc123825aad">set_extraction_parameters</a>(sobj,bck_mode,mfwhm, auto_reorient, trace_angle, actbeam);
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="comment">// set the beam corners and the ignore flag</span>
<a name="l00997"></a>00997     <a class="code" href="spc__sex_8c.html#ab677ce148520e7e408d39157562ed425">fill_corner_ignore</a>(sobj, obs, conf, beamID, dmag, actbeam);
<a name="l00998"></a>00998   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1cc8887bfa02d842b41141ae74750490"></a><!-- doxytag: member="spc_sex.h::SexObject_to_object" ref="a1cc8887bfa02d842b41141ae74750490" args="(SexObject *sobj, observation *const obs, aperture_conf *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobject.html">object</a>* SexObject_to_object </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>conffile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>mfwhm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bck_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObject_to_object Fill an <a class="el" href="structobject.html">object</a> structure with the information contained in a <a class="el" href="structSexObject.html">SexObject</a> structure This function uses a configuration file to compute the full list of beams for each <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conffile</em>&nbsp;</td><td>- the name of the aperture configuration file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxmag</em>&nbsp;</td><td>- upper magniture bound. If <a class="el" href="structobject.html">object</a> has a magnitude greater than this has its ignore flag set to 1, zero otherwise. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mfwhm</em>&nbsp;</td><td>- the fwhm multiplicator constant to apply to determine the width of the aperture box for the <a class="el" href="structobject.html">object</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- if set then this task tries to optimize the orientation of the extraction slit - Should in general be left at 1 so that strange geomety is avoided. If set to 2 the extraction is forced to be vertical (90 deg.)</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a newly allocated <a class="el" href="structobject.html">object</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01083"></a>01083 {
<a name="l01084"></a>01084   <span class="keywordtype">int</span> i, dx0, dx1;
<a name="l01085"></a>01085   <a class="code" href="structbeam.html">beam</a> *b;
<a name="l01086"></a>01086   <span class="keywordtype">object</span> *ob = malloc (<span class="keyword">sizeof</span> (<span class="keywordtype">object</span>));
<a name="l01087"></a>01087   <a class="code" href="structd__point.html">d_point</a> pixel;
<a name="l01088"></a>01088   <a class="code" href="structtracestruct.html">tracestruct</a> *trace;
<a name="l01089"></a>01089   <span class="comment">//  aperture_conf *conf;</span>
<a name="l01090"></a>01090   <span class="keywordtype">float</span> mmag_extract, mmag_mark;
<a name="l01091"></a>01091   <span class="comment">//  conf = get_aperture_descriptor (conffile);</span>
<a name="l01092"></a>01092   <span class="keywordtype">int</span> j = 0, jj=0, nvalid=0;
<a name="l01093"></a>01093   <span class="keywordtype">double</span> fval=0.0;
<a name="l01094"></a>01094   gsl_vector *flux;
<a name="l01095"></a>01095   <span class="keywordtype">float</span> aposang, paposang;
<a name="l01096"></a>01096   <span class="keywordtype">float</span> dya, dyb;
<a name="l01097"></a>01097   <span class="keywordtype">int</span> iturn;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099   ob-&gt;<a class="code" href="structobject.html#a8575880bdfc1c0bf44914b4efd2665bf">ID</a> = sobj-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;<a class="code" href="structaperture__conf.html#af53b09fa4f86ff116c002640c3e817d9">nbeams</a>; i++)
<a name="l01103"></a>01103     {
<a name="l01104"></a>01104       dx0 = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#a55f5257b40a3f5f6b43980c779734e84">offset</a>.<a class="code" href="structpx__offset.html#a5d141ef035baf4fefab88956ea1a7060">dx0</a>;
<a name="l01105"></a>01105       dx1 = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#a55f5257b40a3f5f6b43980c779734e84">offset</a>.<a class="code" href="structpx__offset.html#a81678dca036abb27f0c829b3aabca784">dx1</a>;
<a name="l01106"></a>01106       mmag_extract = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#adfafb08dec01127a7c09ec3dab7729b1">mmag_extract</a>+dmag;
<a name="l01107"></a>01107       mmag_mark = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#a2d2357691589e58e4e50eb9fe9bbf199">mmag_mark</a>+dmag;
<a name="l01108"></a>01108       b = &amp;(ob-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i]);
<a name="l01109"></a>01109       b-&gt;<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a> = conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#a240d13d3f0a07ee411bce6c41b590b5b">ID</a>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111       <span class="comment">//---------------------------------------</span>
<a name="l01112"></a>01112       <span class="comment">// some code for FORS2 MXU</span>
<a name="l01113"></a>01113       <span class="comment">// b-&gt;backwindow.x = sobj-&gt;backwindow.x;</span>
<a name="l01114"></a>01114       <span class="comment">// b-&gt;backwindow.y = sobj-&gt;backwindow.y;</span>
<a name="l01115"></a>01115 
<a name="l01116"></a>01116       b-&gt;<a class="code" href="structbeam.html#a60879dd4cb05dff92646b26f0b1ca8d8">modspec</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a>;
<a name="l01117"></a>01117       b-&gt;<a class="code" href="structbeam.html#a343c47194d158bcc217a46923038e1a3">modimage</a> = sobj-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a>;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119       <span class="comment">/* Adjust for posibly non (0,0) ref point of the 2D field dependence */</span>
<a name="l01120"></a>01120       pixel.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>-1 - conf-&gt;<a class="code" href="structaperture__conf.html#a5cdddf8dafb95b7a77458fbdbf74e5b9">refx</a>;
<a name="l01121"></a>01121       pixel.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>-1 - conf-&gt;<a class="code" href="structaperture__conf.html#ae48467c471e66355a90db41d8ce77bc6">refy</a>;
<a name="l01122"></a>01122       <span class="comment">/* get the geometrical description of the trace at position &quot;pixel&quot; */</span>
<a name="l01123"></a>01123       trace =
<a name="l01124"></a>01124         <a class="code" href="trace__conf_8c.html#af23d39f0c71ce368e456ce5bbdd45a74">get_tracestruct_at_pos</a> (conffile, conf-&gt;<a class="code" href="structaperture__conf.html#aa1f52d8496707cab4631dc2369d3dec2">beam</a>[i].<a class="code" href="structbeam__conf.html#a240d13d3f0a07ee411bce6c41b590b5b">ID</a>, pixel);
<a name="l01125"></a>01125 
<a name="l01126"></a>01126       b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a> = <a class="code" href="spc__trace__functions_8c.html#a63f2dd8f35451e510ac0347532bd4b91">vector_to_trace_polyN</a> ( trace-&gt;<a class="code" href="structtracestruct.html#a42797f7a46efa0ea3e5ec4c7512906e1">pol</a> );
<a name="l01127"></a>01127 
<a name="l01128"></a>01128       b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a>   = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * mfwhm;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130 
<a name="l01131"></a>01131       <span class="comment">/* if flux/wavelength information exists */</span>
<a name="l01132"></a>01132       <span class="keywordflow">if</span> (sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>)
<a name="l01133"></a>01133         {
<a name="l01134"></a>01134 
<a name="l01135"></a>01135           <span class="comment">// get the number of valid entries in &apos;sobj-&gt;magnitudes&apos;</span>
<a name="l01136"></a>01136           nvalid = <a class="code" href="spc__utils_8c.html#a975f8bbace187edba3fbb05b9d099046">get_valid_entries</a>(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>);
<a name="l01137"></a>01137           <span class="keywordflow">if</span> (!nvalid)
<a name="l01138"></a>01138             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01139"></a>01139                          <span class="stringliteral">&quot;No valid magnitude for object %i !\n&quot;</span>, sobj-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>);
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142           <span class="comment">// allocate the vector for the flux</span>
<a name="l01143"></a>01143           flux = gsl_vector_alloc (2*(nvalid));
<a name="l01144"></a>01144 
<a name="l01145"></a>01145           <span class="comment">// fill the flux vector with values</span>
<a name="l01146"></a>01146           jj=0;
<a name="l01147"></a>01147           <span class="keywordflow">for</span> (j=0; j &lt; sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>-&gt;size; j++)
<a name="l01148"></a>01148             {
<a name="l01149"></a>01149               <span class="keywordflow">if</span> (<a class="code" href="spc__utils_8c.html#a8e9536e04ecffec6365a655c18070867">is_valid_entry</a>(gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>, j)))
<a name="l01150"></a>01150                 {
<a name="l01151"></a>01151 
<a name="l01152"></a>01152                   fval = <a class="code" href="model__utils_8c.html#a8d6681aef9c109bc5c407c286c85d67c">get_flambda_from_magab</a>(gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>, j), gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>, j));
<a name="l01153"></a>01153 
<a name="l01154"></a>01154                   gsl_vector_set(flux, 2*jj, gsl_vector_get(sobj-&gt;<a class="code" href="structSexObject.html#a600679e00f71f8e9828818316229da5c">lambdas</a>, j));
<a name="l01155"></a>01155                   <span class="comment">//              gsl_vector_set(flux, 2*jj+1, gsl_vector_get(sobj-&gt;magnitudes, j));</span>
<a name="l01156"></a>01156                   gsl_vector_set(flux, 2*jj+1, fval);
<a name="l01157"></a>01157                   jj++;
<a name="l01158"></a>01158                 }
<a name="l01159"></a>01159             }
<a name="l01160"></a>01160           b-&gt;<a class="code" href="structbeam.html#a199b010e935235ef70f482416d113458">flux</a> = flux;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162           <span class="comment">/* fill the structual parameters of the object */</span>
<a name="l01163"></a>01163           b-&gt;<a class="code" href="structbeam.html#a9a40c792769161a2526fb415c6dadad0">awidth</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>;
<a name="l01164"></a>01164           b-&gt;<a class="code" href="structbeam.html#acc52e3393f91f5f11a65d1a6806b681f">bwidth</a>  = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>;
<a name="l01165"></a>01165           b-&gt;<a class="code" href="structbeam.html#a5cbf4e447f3c6272f31215965e4d574c">aorient</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>;
<a name="l01166"></a>01166         }
<a name="l01167"></a>01167       <span class="comment">// if flux/wavelength information does not exists</span>
<a name="l01168"></a>01168       <span class="keywordflow">else</span>
<a name="l01169"></a>01169         {
<a name="l01170"></a>01170           <span class="comment">// set everything to dummy values</span>
<a name="l01171"></a>01171           b-&gt;<a class="code" href="structbeam.html#a199b010e935235ef70f482416d113458">flux</a> = NULL;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173           b-&gt;<a class="code" href="structbeam.html#a9a40c792769161a2526fb415c6dadad0">awidth</a>  = -1.0;
<a name="l01174"></a>01174           b-&gt;<a class="code" href="structbeam.html#acc52e3393f91f5f11a65d1a6806b681f">bwidth</a>  = -1.0;
<a name="l01175"></a>01175           b-&gt;<a class="code" href="structbeam.html#a5cbf4e447f3c6272f31215965e4d574c">aorient</a> = -1.0;
<a name="l01176"></a>01176         }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178       <span class="comment">/* Convert from SeXtractor angle reference point to aXe&apos;s */</span>
<a name="l01179"></a>01179       b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> = (180 + sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>) / 180. * M_PI;
<a name="l01180"></a>01180       <span class="keywordflow">while</span> (b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> &gt; M_PI)
<a name="l01181"></a>01181         b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> = b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> - M_PI;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183       <span class="comment">// calculate the angle between</span>
<a name="l01184"></a>01184       <span class="comment">// the extraction direction and the trace</span>
<a name="l01185"></a>01185       aposang =
<a name="l01186"></a>01186         b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> - atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0, b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188       <span class="comment">// transform the angle to degrees</span>
<a name="l01189"></a>01189       paposang = aposang / M_PI * 180.;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191       <span class="comment">// give a warning for small angles</span>
<a name="l01192"></a>01192       <span class="comment">// between the orientation direction and</span>
<a name="l01193"></a>01193       <span class="comment">// the trace angle.</span>
<a name="l01194"></a>01194       <span class="keywordflow">if</span> ((fabs(paposang &lt; <a class="code" href="spc__sex_8h.html#a19321d394ebca38412cec1c3f5bbf5bf">MIN_DIFFANGLE</a>) || fabs(paposang-180.0) &lt; <a class="code" href="spc__sex_8h.html#a19321d394ebca38412cec1c3f5bbf5bf">MIN_DIFFANGLE</a>) &amp;&amp; auto_reorient == 0)
<a name="l01195"></a>01195         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l01196"></a>01196                      <span class="stringliteral">&quot;aXe_GOL2AF: Object ID: %i: The angle between the extraction orientation and &quot;</span>
<a name="l01197"></a>01197                      <span class="stringliteral">&quot;the trace is less than %5.2f degrees. You may get severe problems&quot;</span>
<a name="l01198"></a>01198                      <span class="stringliteral">&quot; down to core dumps in the 1D extraction later on!\n&quot;</span>, ob-&gt;<a class="code" href="structobject.html#a8575880bdfc1c0bf44914b4efd2665bf">ID</a>, <a class="code" href="spc__sex_8h.html#a19321d394ebca38412cec1c3f5bbf5bf">MIN_DIFFANGLE</a>);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200 
<a name="l01201"></a>01201       <span class="comment">/* Case when the extraction angle is modified to that the extraction */</span>
<a name="l01202"></a>01202       <span class="comment">/* proceeds along the semi-axis which projects farther away from the</span>
<a name="l01203"></a>01203 <span class="comment">       * trace i.e. we avoid trying to extract spectra in a direction nearly</span>
<a name="l01204"></a>01204 <span class="comment">       * parallel the trace */</span>
<a name="l01205"></a>01205       <span class="keywordflow">if</span> (auto_reorient==1)
<a name="l01206"></a>01206         {
<a name="l01207"></a>01207 
<a name="l01208"></a>01208           aposang =
<a name="l01209"></a>01209             b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> - atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0,
<a name="l01210"></a>01210                                                     b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212           <span class="comment">/* February 2004 introduced to make a hardstop in the range for</span>
<a name="l01213"></a>01213 <span class="comment">             allowed angles. */</span>
<a name="l01214"></a>01214           <span class="keywordflow">if</span> (aposang &gt; 0.0){
<a name="l01215"></a>01215             paposang = aposang / M_PI * 180.;
<a name="l01216"></a>01216           }
<a name="l01217"></a>01217           <span class="keywordflow">else</span>{
<a name="l01218"></a>01218             paposang = aposang / M_PI * 180. + 360.0;
<a name="l01219"></a>01219           }
<a name="l01220"></a>01220           <span class="keywordflow">if</span> (paposang &gt; 180.0)
<a name="l01221"></a>01221             paposang = paposang-180.0;
<a name="l01222"></a>01222           <span class="comment">/* the hard stop is here */</span>
<a name="l01223"></a>01223           <span class="keywordflow">if</span> (paposang &gt; 30.0 &amp;&amp; paposang &lt; 150.0){
<a name="l01224"></a>01224             iturn = 0;}
<a name="l01225"></a>01225           <span class="keywordflow">else</span>{
<a name="l01226"></a>01226             iturn = 1;}
<a name="l01227"></a>01227           <span class="comment">/*end introduction */</span>
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 
<a name="l01230"></a>01230           <span class="comment">/* Compute how far each axes extends away from the trace */</span>
<a name="l01231"></a>01231           dya = fabs (sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * sin (aposang));
<a name="l01232"></a>01232           dyb = fabs (sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * sin (M_PI / 2. - aposang));
<a name="l01233"></a>01233 
<a name="l01234"></a>01234           <span class="comment">/* Select the broader of the two axes */</span>
<a name="l01235"></a>01235           <span class="keywordflow">if</span> (dya &gt; dyb &amp;&amp; iturn == 0)
<a name="l01236"></a>01236             {
<a name="l01237"></a>01237               b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * mfwhm;
<a name="l01238"></a>01238             }
<a name="l01239"></a>01239           <span class="keywordflow">else</span>
<a name="l01240"></a>01240             {
<a name="l01241"></a>01241               b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a> = sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * mfwhm;
<a name="l01242"></a>01242               b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> = b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> + M_PI / 2.;
<a name="l01243"></a>01243             }
<a name="l01244"></a>01244         }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246         <span class="comment">/* Case when we force the extraction to be vertical,</span>
<a name="l01247"></a>01247 <span class="comment">           the extraction width is recomputed */</span>
<a name="l01248"></a>01248       <span class="keywordflow">if</span> (auto_reorient==2) {
<a name="l01249"></a>01249         <span class="comment">// new system for fixed extraction:</span>
<a name="l01250"></a>01250         <span class="comment">//    - extraction direction perpendicular</span>
<a name="l01251"></a>01251         <span class="comment">//      to the trace</span>
<a name="l01252"></a>01252         <span class="comment">//    - the mfwhm is used as a fixed extraction widt in pixels</span>
<a name="l01253"></a>01253         b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> =
<a name="l01254"></a>01254           atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0,b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0)+ M_PI / 2.0;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256         <span class="keywordflow">if</span> (mfwhm &lt; 0.0)
<a name="l01257"></a>01257           {
<a name="l01258"></a>01258             b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> =
<a name="l01259"></a>01259               atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0.0,b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0)+ M_PI / 2.0;
<a name="l01260"></a>01260             b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a>  = -mfwhm;
<a name="l01261"></a>01261 
<a name="l01262"></a>01262           }
<a name="l01263"></a>01263         <span class="keywordflow">else</span>
<a name="l01264"></a>01264           {
<a name="l01265"></a>01265             aposang = b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a>
<a name="l01266"></a>01266               - atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0,b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0);
<a name="l01267"></a>01267 
<a name="l01268"></a>01268             <span class="comment">/* Compute how far each axes extends away from the trace */</span>
<a name="l01269"></a>01269             dya = fabs (sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a> * sin (aposang));
<a name="l01270"></a>01270             dyb = fabs (sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a> * sin (M_PI / 2. - aposang));
<a name="l01271"></a>01271             b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a> = mfwhm*<a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(dya,dyb);
<a name="l01272"></a>01272             b-&gt;<a class="code" href="structbeam.html#a362f20c7f29a9d08731a03939103c8c1">orient</a> =
<a name="l01273"></a>01273               atan2(b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#acdda34da0c92344832184081c6f41718">deriv</a> (0,b-&gt;<a class="code" href="structbeam.html#a918b8655ff4142f173ca73226ce27922">spec_trace</a>-&gt;<a class="code" href="structtrace__func.html#aa610d641940ef4a567aef884dd0b32da">data</a>),1.0)+ M_PI / 2.0;
<a name="l01274"></a>01274           }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276       }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278       <span class="keywordflow">if</span> (sobj-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> != -1 &amp;&amp; bck_mode)
<a name="l01279"></a>01279         b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a> = <a class="code" href="aper__conf_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(b-&gt;<a class="code" href="structbeam.html#ae99ff960c070381b6e76af5a58cb9c45">width</a>, sobj-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>);
<a name="l01280"></a>01280 
<a name="l01281"></a>01281       <span class="comment">/* On coordinate systems:</span>
<a name="l01282"></a>01282 <span class="comment">         the sexrtractor image positions are given in the iraf system,</span>
<a name="l01283"></a>01283 <span class="comment">         which means the value of the lower left pixel is associated</span>
<a name="l01284"></a>01284 <span class="comment">         with the coordinate (1.0,1.0).</span>
<a name="l01285"></a>01285 <span class="comment">         aXe works in a kind of &apos;matrix system&apos;, where the value of</span>
<a name="l01286"></a>01286 <span class="comment">         the lower left pixel is stored in the matrix indices (0,0)</span>
<a name="l01287"></a>01287 <span class="comment">         or (0.0,0.0) seen as a coordinate system.</span>
<a name="l01288"></a>01288 <span class="comment">         To transform into this system 1.0 is subracted from</span>
<a name="l01289"></a>01289 <span class="comment">         both sextractor coordinates.</span>
<a name="l01290"></a>01290 <span class="comment">       */</span>
<a name="l01291"></a>01291       b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>-1.0 + trace-&gt;<a class="code" href="structtracestruct.html#a036bfe31dd2376d708c7ee84adfcb035">offset</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>;
<a name="l01292"></a>01292       b-&gt;<a class="code" href="structbeam.html#a54c64670a8b3e8732c1468d156ddb0ca">refpoint</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> = sobj-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>-1.0 + trace-&gt;<a class="code" href="structtracestruct.html#a036bfe31dd2376d708c7ee84adfcb035">offset</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294       <span class="comment">/* magnitude cut */</span>
<a name="l01295"></a>01295       <span class="comment">// PROBLEM: there is a logical flaw inside</span>
<a name="l01296"></a>01296       <span class="comment">//          whhat happend when (mag &gt; mag_mark) &amp;&amp; (mag &lt;  mmag_extract) ????</span>
<a name="l01297"></a>01297       <span class="comment">//          of course this has only relevance when mag_mark &lt; mmag_extract</span>
<a name="l01298"></a>01298       <span class="comment">//      if ((sobj-&gt;mag_auto &lt;= mmag_mark)&amp;&amp;(sobj-&gt;mag_auto &lt;= mmag_extract))</span>
<a name="l01299"></a>01299       <span class="comment">// That&apos;s now an easy fix, but makes sense..</span>
<a name="l01300"></a>01300       <span class="keywordflow">if</span> (sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &lt;= mmag_extract)
<a name="l01301"></a>01301         {
<a name="l01302"></a>01302           b-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 0; <span class="comment">/* This object will be extracted */</span>
<a name="l01303"></a>01303         }
<a name="l01304"></a>01304       <span class="keywordflow">if</span> ((sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &lt;= mmag_mark)&amp;&amp;(sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_extract))
<a name="l01305"></a>01305         {
<a name="l01306"></a>01306           b-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 2; <span class="comment">/* This object will be not be extracted */</span>
<a name="l01307"></a>01307         }
<a name="l01308"></a>01308       <span class="keywordflow">if</span> ((sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_mark)&amp;&amp;(sobj-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a> &gt; mmag_extract))
<a name="l01309"></a>01309         {
<a name="l01310"></a>01310           b-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 1; <span class="comment">/* This object will be ignored */</span>
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312 
<a name="l01313"></a>01313       <span class="keywordflow">if</span> (!<a class="code" href="spc__sex_8c.html#a81c5036b461b98a7c6dde47ea87c0220">fill_object_bbox</a> (obs, b, 2, dx0, dx1))
<a name="l01314"></a>01314         b-&gt;<a class="code" href="structbeam.html#a8c7dc459dedfd957741d35c59440972f">ignore</a> = 1;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     b-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[0] = -1.0;
<a name="l01317"></a>01317     b-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[1] = -1.0;
<a name="l01318"></a>01318     b-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[2] = -1.0;
<a name="l01319"></a>01319     b-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[3] = -1.0;
<a name="l01320"></a>01320     }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322   ob-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a> = conf-&gt;<a class="code" href="structaperture__conf.html#af53b09fa4f86ff116c002640c3e817d9">nbeams</a>;
<a name="l01323"></a>01323   ob-&gt;<a class="code" href="structobject.html#a90d2a68e430a65d8b022b7abd9491e3e">grism_obs</a> = obs;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   <span class="keywordflow">return</span> ob;
<a name="l01326"></a>01326 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adca42a33ade468757a83d39dd9462137"></a><!-- doxytag: member="spc_sex.h::SexObject_to_objectII" ref="adca42a33ade468757a83d39dd9462137" args="(SexObject *sobj, observation *const obs, aperture_conf *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobject.html">object</a>* SexObject_to_objectII </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>conffile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>mfwhm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bck_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObject_to_objectII Fill an <a class="el" href="structobject.html">object</a> structure with the information contained in a <a class="el" href="structSexObject.html">SexObject</a> structure This function uses a configuration file to compute the full list of beams for each <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>- pointer to the configuration structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conffile</em>&nbsp;</td><td>- the name of the aperture configuration file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mfwhm</em>&nbsp;</td><td>- the fwhm multiplicator constant to apply to determine the width of the aperture box for the <a class="el" href="structobject.html">object</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- if set then this task tries to optimize the orientation of the extraction slit - Should in general be left at 1 so that strange geomety is avoided. If set to 2 the extraction is forced to be vertical (90 deg.) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bck_mode</em>&nbsp;</td><td>- pointer for background mode</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a newly allocated <a class="el" href="structobject.html">object</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01027"></a>01027   {
<a name="l01028"></a>01028     <span class="keywordtype">int</span> i=0;
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     <span class="keywordtype">object</span> *ob;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="comment">// allocate an object</span>
<a name="l01033"></a>01033     ob = (<span class="keywordtype">object</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">object</span>));
<a name="l01034"></a>01034 
<a name="l01035"></a>01035     <span class="comment">// store the object specific</span>
<a name="l01036"></a>01036     <span class="comment">// information</span>
<a name="l01037"></a>01037     ob-&gt;<a class="code" href="structobject.html#a8575880bdfc1c0bf44914b4efd2665bf">ID</a> = sobj-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>;
<a name="l01038"></a>01038     ob-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a> = conf-&gt;<a class="code" href="structaperture__conf.html#af53b09fa4f86ff116c002640c3e817d9">nbeams</a>;
<a name="l01039"></a>01039     ob-&gt;<a class="code" href="structobject.html#a90d2a68e430a65d8b022b7abd9491e3e">grism_obs</a> = obs;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <span class="comment">// go over all beams</span>
<a name="l01042"></a>01042     <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;<a class="code" href="structaperture__conf.html#af53b09fa4f86ff116c002640c3e817d9">nbeams</a>; i++)
<a name="l01043"></a>01043         <span class="comment">// fill the current beam</span>
<a name="l01044"></a>01044         <a class="code" href="spc__sex_8c.html#aaf18fdf0a495428d532fc2acb0cb337b">SexObject_to_beam</a>(sobj, obs, conf, conffile, mfwhm, dmag, auto_reorient,
<a name="l01045"></a>01045                           bck_mode, i, &amp;(ob-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[i]));
<a name="l01046"></a>01046 
<a name="l01047"></a>01047     <span class="comment">// return the object</span>
<a name="l01048"></a>01048     <span class="keywordflow">return</span> ob;
<a name="l01049"></a>01049   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af26ee7c0414b10010e9a3a2cdfcbcb9d"></a><!-- doxytag: member="spc_sex.h::SexObject_to_slitgeom" ref="af26ee7c0414b10010e9a3a2cdfcbcb9d" args="(const aperture_conf *conf, const SexObject *sobj, const double trace_angle, beam *actbeam)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SexObject_to_slitgeom </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>trace_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbeam.html">beam</a> *&nbsp;</td>
          <td class="paramname"> <em>actbeam</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObject_to_slitgeom Fill a <a class="el" href="structbeam.html">beam</a> structure with the optimized geometry information. The quantities are computed from the <a class="el" href="structobject.html">object</a> shape and the trace angle.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobj</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trace_angle</em>&nbsp;</td><td>- pointer to a <a class="el" href="structSexObject.html">SexObject</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actbeam</em>&nbsp;</td><td>- the <a class="el" href="structbeam.html">beam</a> structure to be filled</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00645"></a>00645   {
<a name="l00646"></a>00646     <span class="keywordtype">double</span> theta=0.0;
<a name="l00647"></a>00647     <span class="keywordtype">double</span> orient=0.0;
<a name="l00648"></a>00648     <span class="keywordtype">double</span> tmp_angle, cos_tmp_angle;
<a name="l00649"></a>00649     <span class="keywordtype">double</span> A11, A12, A22;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <a class="code" href="structd__point.html">d_point</a> obj_size;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <span class="comment">// convert the SExtractor angle to rad in the right quadrant</span>
<a name="l00654"></a>00654     orient = (180.0 + sobj-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>) / 180.0 * M_PI;
<a name="l00655"></a>00655     <span class="keywordflow">while</span> (orient &gt; M_PI)
<a name="l00656"></a>00656       orient = orient - M_PI;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="comment">// compute angle between object</span>
<a name="l00659"></a>00659     <span class="comment">// orientation and trace</span>
<a name="l00660"></a>00660     theta = orient - trace_angle;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="comment">// check the object size, possibly setting</span>
<a name="l00663"></a>00663     <span class="comment">// it to the size of point-like object</span>
<a name="l00664"></a>00664     obj_size = <a class="code" href="spc__sex_8c.html#a594a5c195cf16b237615c2b8ca76ac63">check_object_size</a>(conf, sobj, actbeam-&gt;<a class="code" href="structbeam.html#a5c3f06b67e4cc3c79be539d1b515f3c6">ID</a>);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="comment">/*</span>
<a name="l00667"></a>00667 <span class="comment">    // determine the three matrix elements</span>
<a name="l00668"></a>00668 <span class="comment">    A11 = SQR(cos(theta) / sobj-&gt;el_image.a) + SQR(sin(theta) / sobj-&gt;el_image.b);</span>
<a name="l00669"></a>00669 <span class="comment">    A12 = cos(theta) * sin(theta) * (1.0/(SQR(sobj-&gt;el_image.a)) - 1.0/SQR(sobj-&gt;el_image.b));</span>
<a name="l00670"></a>00670 <span class="comment">    A22 = SQR(sin(theta) / sobj-&gt;el_image.a) + SQR(cos(theta) / sobj-&gt;el_image.b);</span>
<a name="l00671"></a>00671 <span class="comment"></span>
<a name="l00672"></a>00672 <span class="comment">    // compute a temporary angle</span>
<a name="l00673"></a>00673 <span class="comment">    // and its cosine</span>
<a name="l00674"></a>00674 <span class="comment">    tmp_angle     = atan(A12 / A11);</span>
<a name="l00675"></a>00675 <span class="comment">    cos_tmp_angle = cos(tmp_angle);</span>
<a name="l00676"></a>00676 <span class="comment"></span>
<a name="l00677"></a>00677 <span class="comment">    // compute the slit length</span>
<a name="l00678"></a>00678 <span class="comment">    if (cos_tmp_angle &gt; 0.01)</span>
<a name="l00679"></a>00679 <span class="comment">      actbeam-&gt;slitgeom[0] = sqrt(A11)*sobj-&gt;el_image.a*sobj-&gt;el_image.b / cos_tmp_angle;</span>
<a name="l00680"></a>00680 <span class="comment">    else</span>
<a name="l00681"></a>00681 <span class="comment">      actbeam-&gt;slitgeom[0] = sqrt(A11)*sobj-&gt;el_image.a*sobj-&gt;el_image.b / 0.01;</span>
<a name="l00682"></a>00682 <span class="comment"></span>
<a name="l00683"></a>00683 <span class="comment">    // compute the slit orientation</span>
<a name="l00684"></a>00684 <span class="comment">    actbeam-&gt;slitgeom[1] = tmp_angle + trace_angle + M_PI_2;</span>
<a name="l00685"></a>00685 <span class="comment"></span>
<a name="l00686"></a>00686 <span class="comment">    // compute the slit length</span>
<a name="l00687"></a>00687 <span class="comment">    actbeam-&gt;slitgeom[2] = 1.0 / sqrt(A11);</span>
<a name="l00688"></a>00688 <span class="comment"></span>
<a name="l00689"></a>00689 <span class="comment">    // compute a modified B_IMAGE value, defined to keep the object area constant</span>
<a name="l00690"></a>00690 <span class="comment">    actbeam-&gt;slitgeom[3] = sobj-&gt;el_image.a*sobj-&gt;el_image.b / actbeam-&gt;slitgeom[0];</span>
<a name="l00691"></a>00691 <span class="comment">    */</span>
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="comment">// determine the three matrix elements</span>
<a name="l00694"></a>00694     A11 = <a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(cos(theta) / obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + <a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(sin(theta) / obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>);
<a name="l00695"></a>00695     A12 = cos(theta) * sin(theta) * (1.0/(<a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>)) - 1.0/<a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>));
<a name="l00696"></a>00696     A22 = <a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(sin(theta) / obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>) + <a class="code" href="dirimage__model_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(cos(theta) / obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="comment">// compute a temporary angle</span>
<a name="l00699"></a>00699     <span class="comment">// and its cosine</span>
<a name="l00700"></a>00700     tmp_angle     = atan(A12 / A11);
<a name="l00701"></a>00701     cos_tmp_angle = cos(tmp_angle);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="comment">// compute the slit length</span>
<a name="l00704"></a>00704     <span class="keywordflow">if</span> (cos_tmp_angle &gt; 0.01)
<a name="l00705"></a>00705       actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[0] = sqrt(A11)*obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>*obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> / cos_tmp_angle;
<a name="l00706"></a>00706     <span class="keywordflow">else</span>
<a name="l00707"></a>00707       actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[0] = sqrt(A11)*obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>*obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> / 0.01;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     <span class="comment">// compute the slit orientation</span>
<a name="l00710"></a>00710     actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[1] = tmp_angle + trace_angle + M_PI_2;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="comment">// compute the slit width</span>
<a name="l00713"></a>00713     actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[2] = 1.0 / sqrt(A11);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <span class="comment">// compute a modified B_IMAGE value, defined to keep the object area constant</span>
<a name="l00716"></a>00716     actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[3] = obj_size.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>*obj_size.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a> / actbeam-&gt;<a class="code" href="structbeam.html#acc5dfdc4ba4457869ecb2a9395d1273e">slitgeom</a>[0];
<a name="l00717"></a>00717   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3be1c25232414791b69783398d5c0fc3"></a><!-- doxytag: member="spc_sex.h::SexObjects_to_oblist" ref="a3be1c25232414791b69783398d5c0fc3" args="(SexObject **sobjs, observation *const obs, aperture_conf *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int back_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobject.html">object</a>** SexObjects_to_oblist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>conffile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>mfwhm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bck_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObjects_to_oblist Produces an <a class="el" href="structobject.html">object</a> list from the data contained in an array of SexObjects</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- an NULL terminated array containing pointers to SexObjects </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conffile</em>&nbsp;</td><td>- the name of the aperture configuration file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mmag_extract</em>&nbsp;</td><td>- upper magniture bound. Any <a class="el" href="structobject.html">object</a> with a magnitude greater than this has its ignore flag set to 1. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mmag_mark</em>&nbsp;</td><td>- upper magniture bound. Any <a class="el" href="structobject.html">object</a> with a magnitude greater than this has its ignore flag set to 2. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mfwhm</em>&nbsp;</td><td>- the fwhm multiplicator constant to apply to determine the width of the aperture box for the <a class="el" href="structobject.html">object</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- if set to 1 then this task tries to optimize the orientation of the extraction slit. Should in general be left at 1 so that strange geomety is avoided. If set to 2 the extraction is forced to be vertical (90 deg.)</td></tr>
  </table>
  </dd>
</dl>
<p>Return: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a NULL terminated <a class="el" href="structobject.html">object</a> array. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01356"></a>01356 {
<a name="l01357"></a>01357      <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l01358"></a>01358      <span class="keywordtype">object</span> **oblist;
<a name="l01359"></a>01359 
<a name="l01360"></a>01360      <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l01361"></a>01361      <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l01362"></a>01362           nobjs++;
<a name="l01363"></a>01363      <span class="comment">/* Allocate enough room for a new object list */</span>
<a name="l01364"></a>01364      oblist = (<span class="keywordtype">object</span> **) malloc ((nobjs + 1) * <span class="keyword">sizeof</span> (<span class="keywordtype">object</span> *));
<a name="l01365"></a>01365 
<a name="l01366"></a>01366      <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l01367"></a>01367        {
<a name="l01368"></a>01368          <span class="comment">//fprintf(stdout, &quot;Using the old routine...\n&quot;);</span>
<a name="l01369"></a>01369          oblist[i] =
<a name="l01370"></a>01370          <a class="code" href="spc__sex_8c.html#a1cc8887bfa02d842b41141ae74750490">SexObject_to_object</a>(sobjs[i], obs, conf, conffile, mfwhm, dmag, auto_reorient, bck_mode);
<a name="l01371"></a>01371         }
<a name="l01372"></a>01372      oblist[nobjs] = NULL;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374      <span class="keywordflow">return</span> oblist;
<a name="l01375"></a>01375 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aba315f6055ab2042c62d24e4a6312491"></a><!-- doxytag: member="spc_sex.h::SexObjects_to_oblistII" ref="aba315f6055ab2042c62d24e4a6312491" args="(SexObject **sobjs, observation *const obs, aperture_conf *conf, char conffile[], float mfwhm, float dmag, int auto_reorient, int bck_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobject.html">object</a>** SexObjects_to_oblistII </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSexObject.html">SexObject</a> **&nbsp;</td>
          <td class="paramname"> <em>sobjs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structobservation.html">observation</a> *const &nbsp;</td>
          <td class="paramname"> <em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structaperture__conf.html">aperture_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>conffile</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>mfwhm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>dmag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>auto_reorient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bck_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: SexObjects_to_oblistII Produces an <a class="el" href="structobject.html">object</a> list from the data contained in an array of SexObjects</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobjs</em>&nbsp;</td><td>- an NULL terminated array containing pointers to SexObjects </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obs</em>&nbsp;</td><td>- a pointer to the data array containing the image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conffile</em>&nbsp;</td><td>- the name of the aperture configuration file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mmag_extract</em>&nbsp;</td><td>- upper magniture bound. Any <a class="el" href="structobject.html">object</a> with a magnitude greater than this has its ignore flag set to 1. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mmag_mark</em>&nbsp;</td><td>- upper magniture bound. Any <a class="el" href="structobject.html">object</a> with a magnitude greater than this has its ignore flag set to 2. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mfwhm</em>&nbsp;</td><td>- the fwhm multiplicator constant to apply to determine the width of the aperture box for the <a class="el" href="structobject.html">object</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dmag</em>&nbsp;</td><td>- number of magnitudes to add to the magnitudes cutoffs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auto_reorient</em>&nbsp;</td><td>- if set to 1 then this task tries to optimize the orientation of the extraction slit. Should in general be left at 1 so that strange geomety is avoided. If set to 2 the extraction is forced to be vertical (90 deg.)</td></tr>
  </table>
  </dd>
</dl>
<p>Return: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a NULL terminated <a class="el" href="structobject.html">object</a> array. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l01404"></a>01404 {
<a name="l01405"></a>01405      <span class="keywordtype">int</span> i, nobjs = 0;
<a name="l01406"></a>01406      <span class="keywordtype">object</span> **oblist;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408      <span class="comment">/* Find the number of SexObjects in sobjs */</span>
<a name="l01409"></a>01409      <span class="keywordflow">while</span> (sobjs[nobjs])
<a name="l01410"></a>01410           nobjs++;
<a name="l01411"></a>01411      <span class="comment">/* Allocate enough room for a new object list */</span>
<a name="l01412"></a>01412      oblist = (<span class="keywordtype">object</span> **) malloc ((nobjs + 1) * <span class="keyword">sizeof</span> (<span class="keywordtype">object</span> *));
<a name="l01413"></a>01413 
<a name="l01414"></a>01414      <span class="keywordflow">for</span> (i = 0; i &lt; nobjs; i++)
<a name="l01415"></a>01415        {
<a name="l01416"></a>01416          <span class="comment">//fprintf(stdout, &quot;Using the new routine...\n&quot;);</span>
<a name="l01417"></a>01417          oblist[i] =
<a name="l01418"></a>01418          <a class="code" href="spc__sex_8c.html#adca42a33ade468757a83d39dd9462137">SexObject_to_objectII</a>(sobjs[i], obs, conf, conffile, mfwhm, dmag, auto_reorient, bck_mode);
<a name="l01419"></a>01419         }
<a name="l01420"></a>01420      oblist[nobjs] = NULL;
<a name="l01421"></a>01421 
<a name="l01422"></a>01422      <span class="keywordflow">return</span> oblist;
<a name="l01423"></a>01423 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa358fe9be94faba9d46991eb7fa9e766"></a><!-- doxytag: member="spc_sex.h::size_of_sextractor_catalog" ref="aa358fe9be94faba9d46991eb7fa9e766" args="(char filename[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int size_of_sextractor_catalog </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: size_of_sextractor_catalog A utility function which parses a Sextractor catalog file, and returns the number of valid catalog entries found in the file</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- a pointer pointing to a char array containing the list of a sextractor <a class="el" href="structobject.html">object</a> output catalog. Ignores rows starting with a ";" </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01606"></a>01606 {
<a name="l01607"></a>01607   FILE *input;
<a name="l01608"></a>01608   <span class="keywordtype">char</span> Buffer[<a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>];
<a name="l01609"></a>01609   gsl_vector *v;
<a name="l01610"></a>01610   <span class="keywordtype">int</span> catsize;
<a name="l01611"></a>01611   <span class="keywordtype">int</span> num = 0;
<a name="l01612"></a>01612   <a class="code" href="structcolinfo.html">colinfo</a> * actcatinfo;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614   actcatinfo = <a class="code" href="spc__utils_8c.html#a47a365ec494841b98f872779b80535b0">get_sex_col_descr</a> (filename);
<a name="l01615"></a>01615   <span class="comment">//  catalog_header = get_sex_col_descr (filename);</span>
<a name="l01616"></a>01616   catsize = actcatinfo-&gt;<a class="code" href="structcolinfo.html#aeac67ce88746e560df5b1f503d26a670">numcols</a>;
<a name="l01617"></a>01617   <span class="keywordflow">if</span> (!(input = fopen (filename, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l01618"></a>01618     {
<a name="l01619"></a>01619       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01620"></a>01620                    <span class="stringliteral">&quot;Could not open Sextractor catalog&quot;</span> <span class="stringliteral">&quot;file %s,\n&quot;</span>,
<a name="l01621"></a>01621                    filename);
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624 
<a name="l01625"></a>01625   <span class="keywordflow">while</span> (fgets (Buffer, <a class="code" href="spc__sex_8h.html#a385dd6d87c5af9252e1c0bf82d87e969">CATBUFFERSIZE</a>, input))
<a name="l01626"></a>01626     {
<a name="l01627"></a>01627       <span class="keywordflow">if</span> (Buffer[0] == <span class="charliteral">&apos;;&apos;</span>)
<a name="l01628"></a>01628         <span class="keywordflow">continue</span>;
<a name="l01629"></a>01629       <a class="code" href="spc__utils_8c.html#a5173a4942a3d83d368b97ad51aabedb6">lv1ws</a> (Buffer);
<a name="l01630"></a>01630       v = <a class="code" href="spc__utils_8c.html#ae52364129107c1b86e38dd795086046d">string_to_gsl_array</a> (Buffer);
<a name="l01631"></a>01631       <span class="keywordflow">if</span> (v==NULL) <span class="keywordflow">continue</span>;
<a name="l01632"></a>01632       <span class="keywordflow">if</span> (v-&gt;size == catsize)
<a name="l01633"></a>01633         num++;
<a name="l01634"></a>01634     }
<a name="l01635"></a>01635   <span class="keywordflow">return</span> num;
<a name="l01636"></a>01636 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a496014d96016e580b632b2b15e0b7f72"></a><!-- doxytag: member="spc_sex.h::sobs_to_vout" ref="a496014d96016e580b632b2b15e0b7f72" args="(const SexObject *sobs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_vector* sobs_to_vout </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structSexObject.html">SexObject</a> *&nbsp;</td>
          <td class="paramname"> <em>sobs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: sobs_to_vout The function transforms a <a class="el" href="structSexObject.html">SexObject</a> into a vector.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sobs</em>&nbsp;</td><td>- the <a class="el" href="structSexObject.html">SexObject</a> to be transformed</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>vout - the vector with the Seobject data </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00211"></a>00211 {
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="keywordtype">int</span> nentries, i;
<a name="l00214"></a>00214   <span class="keywordtype">int</span> count=0;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="comment">// determine the size of the vector</span>
<a name="l00217"></a>00217   <span class="keywordflow">if</span> (sobs-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>){
<a name="l00218"></a>00218     nentries = 11+sobs-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>-&gt;size;
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220   <span class="keywordflow">else</span>{
<a name="l00221"></a>00221     nentries = 12;
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> != -1)
<a name="l00225"></a>00225     nentries = nentries+1;
<a name="l00226"></a>00226     <span class="comment">// old FORS2-MXU code:</span>
<a name="l00227"></a>00227     <span class="comment">//nentries = nentries+2;</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a> != -1)
<a name="l00230"></a>00230     nentries++;
<a name="l00231"></a>00231   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a> != -1)
<a name="l00232"></a>00232     nentries++;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="comment">// allocate space for the vector</span>
<a name="l00235"></a>00235   gsl_vector *vout = gsl_vector_alloc (nentries);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">// fill the vector</span>
<a name="l00238"></a>00238   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#ad41b1dda3b8dba7dd6e53098efaafd23">number</a>);
<a name="l00239"></a>00239   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#aec601540bafa93c27df796833cef0a4a">ra</a>);
<a name="l00240"></a>00240   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#af314bec47ffaac3fe444f43a5f942d0d">xy_world</a>.<a class="code" href="structsky__coord.html#adf4362b3c3798af082500ff300f57d89">dec</a>);
<a name="l00241"></a>00241   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>);
<a name="l00242"></a>00242   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>);
<a name="l00243"></a>00243   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a0f2ad0a554a84e0a03f572a7d2889c79">el_world</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>);
<a name="l00244"></a>00244   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>);
<a name="l00245"></a>00245   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#aeb623e63f7277a5f81f85f0d213c6bbd">xy_image</a>.<a class="code" href="structd__point.html#ad9846a025508bf8873a501ca5fcefbf4">y</a>);
<a name="l00246"></a>00246   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#a2fac14d548cade31112387455a842a69">a</a>);
<a name="l00247"></a>00247   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#af6973a98639e96a46f99252a477a25fd">b</a>);
<a name="l00248"></a>00248   gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a87b0ff7f5399d04b16efe748d16fb7fc">el_image</a>.<a class="code" href="structellipse.html#ab6b6b276e1a61dd9fe682a57086e1ca6">theta</a>);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a> != -1)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#aabcfc9c81bd2103d1497ccce3955b45e">backwindow</a>.<a class="code" href="structd__point.html#a922a3b5d82a119168ba85e5f939d02c3">x</a>);
<a name="l00253"></a>00253       <span class="comment">// old code for FORS2-MXU</span>
<a name="l00254"></a>00254       <span class="comment">//gsl_vector_set (vout, count++, sobs-&gt;backwindow.y);</span>
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a> != -1)
<a name="l00258"></a>00258       gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#a0f462eb5c84b02f2bbdeb4d02dd76f5b">modspec</a>);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="keywordflow">if</span>(sobs-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a> != -1)
<a name="l00261"></a>00261       gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#acfe99bcffce1874072c406bf4517cd07">modimage</a>);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="comment">// see whether there is MAG_AUTO</span>
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (sobs-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>){
<a name="l00265"></a>00265     <span class="comment">// fill in the magnitude values</span>
<a name="l00266"></a>00266     <span class="keywordflow">for</span> (i=0; i &lt; sobs-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>-&gt;size; i++)
<a name="l00267"></a>00267       gsl_vector_set (vout, count++, gsl_vector_get(sobs-&gt;<a class="code" href="structSexObject.html#afcb11ccfb82237107b71410de52d9b79">magnitudes</a>, i));
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269   <span class="keywordflow">else</span>{
<a name="l00270"></a>00270     <span class="comment">// fill in the MAG_AUTO value</span>
<a name="l00271"></a>00271     gsl_vector_set (vout, count++, sobs-&gt;<a class="code" href="structSexObject.html#afbbb8f8bd937e942e0f9aa9560097b13">mag_auto</a>);
<a name="l00272"></a>00272   }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <span class="comment">// return the vector</span>
<a name="l00275"></a>00275   <span class="keywordflow">return</span> vout;
<a name="l00276"></a>00276 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
