<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_flatfield.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_flatfield.h File Reference</h1><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_spline.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_rng.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_randist.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="aXe__grism_8h_source.html">aXe_grism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="aXe__utils_8h_source.html">aXe_utils.h</a>&quot;</code><br/>

<p><a href="spc__flatfield_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpolynom__flatfield.html">polynom_flatfield</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmulti__flatfield.html">multi_flatfield</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structs__flatfield.html">s_flatfield</a></td></tr>
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacespc__flatfield.html">spc_flatfield</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a28c43bd3fb84d6eb9a3199021e3aebcd">_SPC_FLATFIELD_H</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structs__flatfield.html">s_flatfield</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a2697a446d526e1695a9c8f5fde07166c">flatfield_d</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a83750e7a1e9eaf61ee280a730786f115">load_flat_poly_cube</a> (char *fname)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#ace74cc16d90b32b8af96da0408dc3c73">free_flat_poly_cube</a> (<a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *poly_cube)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structs__flatfield.html">flatfield_d</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a7bbb89f8979ec898f238c71670ea9a97">make_poly_flatfield</a> (const <a class="el" href="structbeam.html">beam</a> *const curbeam, const char *const flat_name, const int order, const double *const coeffs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#ac58feb28bf1828414955e0010edbde09">free_poly_flatfield</a> (<a class="el" href="structs__flatfield.html">flatfield_d</a> *const flat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structs__flatfield.html">flatfield_d</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a51dc63c9e14b10df5c589cbf97eedd20">make_multi_flatfield</a> (const <a class="el" href="structbeam.html">beam</a> *const curbeam, const int num_flats, const double lambda, const char *const flat_name,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a5a296123b4a5ee3eacc23dc08b2e253b">free_multi_flatfield</a> (<a class="el" href="structs__flatfield.html">flatfield_d</a> *const flat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#ab42beec46d951d535ed65eeb14a0c50a">apply_flatfield</a> (<a class="el" href="structap__pixel.html">ap_pixel</a> *const ap_p, const <a class="el" href="structs__flatfield.html">flatfield_d</a> *const flat)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__flatfield_8h.html#a453e895ac1865f71f8b5126a0bcfb519">poly_cube_flatfield_lambda</a> (const double lambda, const int x, const int y, <a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *poly_cube)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a28c43bd3fb84d6eb9a3199021e3aebcd"></a><!-- doxytag: member="spc_flatfield.h::_SPC_FLATFIELD_H" ref="a28c43bd3fb84d6eb9a3199021e3aebcd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _SPC_FLATFIELD_H&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a2697a446d526e1695a9c8f5fde07166c"></a><!-- doxytag: member="spc_flatfield.h::flatfield_d" ref="a2697a446d526e1695a9c8f5fde07166c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structs__flatfield.html">s_flatfield</a>
 <a class="el" href="structs__flatfield.html">flatfield_d</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Descriptor of a flatfielding function, including the function to compute the flat field value of a given pixel, the bounding box we handle, and auxillary data (usually a flatfield image) </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab42beec46d951d535ed65eeb14a0c50a"></a><!-- doxytag: member="spc_flatfield.h::apply_flatfield" ref="ab42beec46d951d535ed65eeb14a0c50a" args="(ap_pixel *const ap_p, const flatfield_d *const flat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_flatfield </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structap__pixel.html">ap_pixel</a> *const &nbsp;</td>
          <td class="paramname"> <em>ap_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structs__flatfield.html">flatfield_d</a> *const &nbsp;</td>
          <td class="paramname"> <em>flat</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ace74cc16d90b32b8af96da0408dc3c73"></a><!-- doxytag: member="spc_flatfield.h::free_flat_poly_cube" ref="ace74cc16d90b32b8af96da0408dc3c73" args="(poly_cube_flatfield *poly_cube)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_flat_poly_cube </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *&nbsp;</td>
          <td class="paramname"> <em>poly_cube</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Completely frees up the space allocated to a gsl_matrix </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>poly_cube</em>&nbsp;</td><td>a pointer to a <a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> structure </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00134"></a>00134 {
<a name="l00135"></a>00135   <span class="keywordtype">int</span> i=0;
<a name="l00136"></a>00136   
<a name="l00137"></a>00137   <span class="keywordflow">if</span> (poly_cube!=NULL) {
<a name="l00138"></a>00138     <span class="keywordflow">for</span> (i=0;i&lt;poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a43ded1d19ab5c7a6d34ffc75788e6fdf">poly_order</a>;i++)
<a name="l00139"></a>00139       <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a5e941be5d850641c8f11e35e48d9266e">coeffs</a>[i]);
<a name="l00140"></a>00140     free(poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a5e941be5d850641c8f11e35e48d9266e">coeffs</a>);
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (poly_cube) free(poly_cube);
<a name="l00142"></a>00142     poly_cube=NULL;
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5a296123b4a5ee3eacc23dc08b2e253b"></a><!-- doxytag: member="spc_flatfield.h::free_multi_flatfield" ref="a5a296123b4a5ee3eacc23dc08b2e253b" args="(flatfield_d *const flat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_multi_flatfield </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__flatfield.html">flatfield_d</a> *&nbsp;</td>
          <td class="paramname"> <em>flat</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>frees a flatfield consisting of multiple images and its assoicated data structures</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>flat</em>&nbsp;</td><td>the flatfield to free </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00472"></a>00472 {
<a name="l00473"></a>00473   <span class="keywordtype">int</span> i;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="keywordflow">for</span> (i = 0; i &lt; flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a1445b447b76505577b98dead719a86b7">num_flats</a>; i++)
<a name="l00476"></a>00476     {
<a name="l00477"></a>00477       <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a>[i]);
<a name="l00478"></a>00478       <span class="keywordflow">if</span> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>[i])
<a name="l00479"></a>00479         {
<a name="l00480"></a>00480           <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>[i]);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a>);
<a name="l00484"></a>00484   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a> = NULL;
<a name="l00485"></a>00485   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>);
<a name="l00486"></a>00486   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a> = NULL;
<a name="l00487"></a>00487   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a>);
<a name="l00488"></a>00488   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a> = NULL;
<a name="l00489"></a>00489   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>);
<a name="l00490"></a>00490   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a> = NULL;
<a name="l00491"></a>00491   free (flat);
<a name="l00492"></a>00492   flat = NULL;
<a name="l00493"></a>00493 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac58feb28bf1828414955e0010edbde09"></a><!-- doxytag: member="spc_flatfield.h::free_poly_flatfield" ref="ac58feb28bf1828414955e0010edbde09" args="(flatfield_d *const flat)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_poly_flatfield </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs__flatfield.html">flatfield_d</a> *&nbsp;</td>
          <td class="paramname"> <em>flat</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>frees a polynom flatfield and its assoicated data structures</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>flat</em>&nbsp;</td><td>the flatfield to free </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00324"></a>00324 {
<a name="l00325"></a>00325   <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>-&gt;<a class="code" href="structpolynom__flatfield.html#a489ee68b385052b07372fa0ae768106c">flatfield</a>);
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>-&gt;<a class="code" href="structpolynom__flatfield.html#a7cb096f2701bd64b8f57d27aef51e8ce">errors</a>)
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a> (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>-&gt;<a class="code" href="structpolynom__flatfield.html#a7cb096f2701bd64b8f57d27aef51e8ce">errors</a>);
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>-&gt;<a class="code" href="structpolynom__flatfield.html#a1c036a8e0217763384459507643a5f80">poly_coeffs</a>);
<a name="l00331"></a>00331   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>-&gt;<a class="code" href="structpolynom__flatfield.html#a1c036a8e0217763384459507643a5f80">poly_coeffs</a> = NULL;
<a name="l00332"></a>00332   free (flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a>);
<a name="l00333"></a>00333   flat-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a15327899ebefeb485896f96b795d846e">poly</a> = NULL;
<a name="l00334"></a>00334   free (flat);
<a name="l00335"></a>00335   flat = NULL;
<a name="l00336"></a>00336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83750e7a1e9eaf61ee280a730786f115"></a><!-- doxytag: member="spc_flatfield.h::load_flat_poly_cube" ref="a83750e7a1e9eaf61ee280a730786f115" args="(char *fname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a>* load_flat_poly_cube </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Load and return a gsl cube whose planes (z-direction) contain the coefficients of a polynomial of the form ff(i,j,lambda) = a0+a1*lambda+...</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>the name of a flat cube to read and load</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a NULL terminated array of gsl_matrix </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00051"></a>00051 {
<a name="l00052"></a>00052   <span class="keywordtype">int</span> i;
<a name="l00053"></a>00053   <span class="keywordtype">int</span> order = 0;
<a name="l00054"></a>00054   <a class="code" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *poly_cube;
<a name="l00055"></a>00055     
<a name="l00056"></a>00056   <span class="comment">/* Getting the number of extension sin the file */</span>
<a name="l00057"></a>00057   order = <a class="code" href="aXe__utils_8c.html#a791e8209e46381315c39a27890280053">FITSextnum</a>(fname);
<a name="l00058"></a>00058     
<a name="l00059"></a>00059   <span class="comment">/* Allocating the memory */</span>
<a name="l00060"></a>00060   poly_cube = (<a class="code" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a>));
<a name="l00061"></a>00061   poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a43ded1d19ab5c7a6d34ffc75788e6fdf">poly_order</a> = order;
<a name="l00062"></a>00062   poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a5e941be5d850641c8f11e35e48d9266e">coeffs</a> = (<a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> **) malloc(poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a43ded1d19ab5c7a6d34ffc75788e6fdf">poly_order</a> * <span class="keyword">sizeof</span>(<a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *));
<a name="l00063"></a>00063   
<a name="l00064"></a>00064   <span class="comment">/* Load the FF coefficients, on eplane at a time */</span>
<a name="l00065"></a>00065   <span class="keywordflow">for</span> (i=0;i&lt;poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a43ded1d19ab5c7a6d34ffc75788e6fdf">poly_order</a>;i++)  
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067       poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a5e941be5d850641c8f11e35e48d9266e">coeffs</a>[i] = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a> (fname, i+1, 1);
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069   <span class="comment">/* Load the minimum and maximum wavelengths this cube applies to */</span>
<a name="l00070"></a>00070   poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a1ffb6722301a4c505bf12fa1b465ba40">wmin</a> = <a class="code" href="aXe__utils_8c.html#a8817e86558786acb16965f3ac1215992">get_float_from_keyword</a>(fname, 1, <span class="stringliteral">&quot;WMIN&quot;</span>);
<a name="l00071"></a>00071   poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a84506df8267a17616949e9f34424dd62">wmax</a> = <a class="code" href="aXe__utils_8c.html#a8817e86558786acb16965f3ac1215992">get_float_from_keyword</a>(fname, 1, <span class="stringliteral">&quot;WMAX&quot;</span>);
<a name="l00072"></a>00072   
<a name="l00073"></a>00073   <span class="keywordflow">return</span> poly_cube;
<a name="l00074"></a>00074 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a51dc63c9e14b10df5c589cbf97eedd20"></a><!-- doxytag: member="spc_flatfield.h::make_multi_flatfield" ref="a51dc63c9e14b10df5c589cbf97eedd20" args="(const beam *const curbeam, const int num_flats, const double lambda, const char *const flat_name,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__flatfield.html">flatfield_d</a>* make_multi_flatfield </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structbeam.html">beam</a> *const &nbsp;</td>
          <td class="paramname"> <em>curbeam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>num_flats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>flat_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>creates a descriptor for a flatfield with multiple flatfields at various wavelengths</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>curbeam</em>&nbsp;</td><td>the <a class="el" href="structbeam.html">beam</a> to create the flatfield for, with the bbox filled out (e.g., after <a class="el" href="namespacespc__extract.html">spc_extract</a> has run) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>num_flats</em>&nbsp;</td><td>the number of (lambda,flatfield) pairs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lambda</em>&nbsp;</td><td>(and the next num_flats odd parameters) the wave length of the following flat field </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flat_name</em>&nbsp;</td><td>(and the next num_flats even parameters) name of the flat field </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>an allocated flatfield descriptor </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00405"></a>00405 {
<a name="l00406"></a>00406   <a class="code" href="structs__flatfield.html">flatfield_d</a> *ff = malloc (<span class="keyword">sizeof</span> (<a class="code" href="structs__flatfield.html">flatfield_d</a>));
<a name="l00407"></a>00407   va_list args;
<a name="l00408"></a>00408   <span class="keywordtype">int</span> i;
<a name="l00409"></a>00409   
<a name="l00410"></a>00410   <span class="keywordflow">if</span> (num_flats &lt; 3)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00413"></a>00413                    <span class="stringliteral">&quot;Number of flats must be&quot;</span> <span class="stringliteral">&quot; larger than 3.&quot;</span>);
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415   <span class="keywordflow">if</span> (num_flats &gt; <a class="code" href="spc__flatfield_8c.html#ab649f643965f102de18156563d7e4485">MAX_FLATS</a>)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00418"></a>00418                    <span class="stringliteral">&quot;Too many flatfields.&quot;</span> <span class="stringliteral">&quot; Increase MAX_FLATS in &quot;</span>
<a name="l00419"></a>00419                    __FILE__ <span class="stringliteral">&quot; and recompile me.&quot;</span>);
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421   
<a name="l00422"></a>00422   <span class="keywordflow">if</span> (!ff)
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   ff-&gt;<a class="code" href="structs__flatfield.html#a1d7f7b9c4eff24588fe25d35f2a0e3ea">ll_x</a> = curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[0].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a>;
<a name="l00427"></a>00427   ff-&gt;<a class="code" href="structs__flatfield.html#affab7067e6e424adb423dc8de163bd5e">ll_y</a> = curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[0].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a>;
<a name="l00428"></a>00428   ff-&gt;<a class="code" href="structs__flatfield.html#a06769e5af56e9be88885af9cd2e25dd9">w</a> = curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[1].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> - curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[0].<a class="code" href="structpx__point.html#ab715a558731a820a25b50bd7797dd004">x</a> + 1;
<a name="l00429"></a>00429   ff-&gt;<a class="code" href="structs__flatfield.html#a8d217598ba3babf676e72e2d8e1d5068">h</a> = curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[1].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> - curbeam-&gt;<a class="code" href="structbeam.html#aa703d04290c347c35197ff52993b98f3">bbox</a>[0].<a class="code" href="structpx__point.html#a2d02b900722a71f22a8d5100822bda61">y</a> + 1;
<a name="l00430"></a>00430   ff-&gt;<a class="code" href="structs__flatfield.html#a27ed375a08ad88a9a25ab15f1186daba">func</a> = <a class="code" href="spc__flatfield_8c.html#ad05bdab9660f9325c11b117b254d42e1">flat_multi_func</a>;
<a name="l00431"></a>00431   
<a name="l00432"></a>00432   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a> = malloc (<span class="keyword">sizeof</span> (<a class="code" href="structmulti__flatfield.html">multi_flatfield</a>));
<a name="l00433"></a>00433   <span class="keywordflow">if</span> (!ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>)
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a1445b447b76505577b98dead719a86b7">num_flats</a> = num_flats;
<a name="l00438"></a>00438   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a> = malloc (<span class="keyword">sizeof</span> (<a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *) * num_flats);
<a name="l00439"></a>00439   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a> = malloc (<span class="keyword">sizeof</span> (<a class="code" href="aXe__grism_8h.html#a6117e17bb3108107676f4486e62d40e5">gsl_matrix</a> *) * num_flats);
<a name="l00440"></a>00440   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a> = malloc (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>) * num_flats);
<a name="l00441"></a>00441   <span class="keywordflow">if</span> ((!ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>) || (!ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a>)
<a name="l00442"></a>00442       || (!ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a>))
<a name="l00443"></a>00443     {
<a name="l00444"></a>00444       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446   
<a name="l00447"></a>00447   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a>[0] = lambda;
<a name="l00448"></a>00448   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a>[0] = <a class="code" href="spc__flatfield_8c.html#a1a2a238a4168103d4c9db69848e6fdd7">load_flatfield</a> (ff, flat_name);
<a name="l00449"></a>00449   ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>[0] = NULL;
<a name="l00450"></a>00450   va_start (args, flat_name);
<a name="l00451"></a>00451   <span class="keywordflow">for</span> (i = 1; i &lt; num_flats; i++)
<a name="l00452"></a>00452     {
<a name="l00453"></a>00453       ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a174bf56a945c6149cb95ba3bcc2fcea7">lambdas</a>[i] = va_arg (args, <span class="keywordtype">double</span>);
<a name="l00454"></a>00454       ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#ac18df4cfe74dac5ef4ae036ffc24bddd">flatfields</a>[i] =
<a name="l00455"></a>00455         <a class="code" href="spc__flatfield_8c.html#a1a2a238a4168103d4c9db69848e6fdd7">load_flatfield</a> (ff, va_arg (args, <span class="keywordtype">char</span> *));
<a name="l00456"></a>00456       ff-&gt;<a class="code" href="structs__flatfield.html#a8f036c9091ac39aa9d42968bb770af09">data</a>.<a class="code" href="structs__flatfield.html#a34eb871ec49e718e1e1b87d5f219c18d">multi</a>-&gt;<a class="code" href="structmulti__flatfield.html#a524bb3759060a0ac556ab8d6b1e0f146">errors</a>[i] = NULL;
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458   va_end (args);
<a name="l00459"></a>00459   
<a name="l00460"></a>00460   <span class="keywordflow">return</span> ff;
<a name="l00461"></a>00461 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7bbb89f8979ec898f238c71670ea9a97"></a><!-- doxytag: member="spc_flatfield.h::make_poly_flatfield" ref="a7bbb89f8979ec898f238c71670ea9a97" args="(const beam *const curbeam, const char *const flat_name, const int order, const double *const coeffs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structs__flatfield.html">flatfield_d</a>* make_poly_flatfield </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structbeam.html">beam</a> *const &nbsp;</td>
          <td class="paramname"> <em>curbeam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>flat_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *const &nbsp;</td>
          <td class="paramname"> <em>coeffs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a453e895ac1865f71f8b5126a0bcfb519"></a><!-- doxytag: member="spc_flatfield.h::poly_cube_flatfield_lambda" ref="a453e895ac1865f71f8b5126a0bcfb519" args="(const double lambda, const int x, const int y, poly_cube_flatfield *poly_cube)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double poly_cube_flatfield_lambda </td>
          <td>(</td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> *&nbsp;</td>
          <td class="paramname"> <em>poly_cube</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Evaluates and return the flatfielding value of pixel coordinates x,y and at wavelength lambda, using the field dependent polynomial description contained in a <a class="el" href="structpoly__cube__flatfield.html">poly_cube_flatfield</a> structure. Uses abs(lambda) for cosmetic reasons. If the sampled wavelength falls outside of the wmin&lt;w&lt;wmax range, then a warning is issued and no flat-field coefficient is computed, and 1.0 is returned [new version now returns the FF value at the closest known wavelength] </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lambda</em>&nbsp;</td><td>the wavelength </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <span class="keywordtype">int</span> i;
<a name="l00094"></a>00094   <span class="keywordtype">double</span> ff=0.0;
<a name="l00095"></a>00095   <span class="keywordtype">double</span> w; <span class="comment">/* nomalized wavelength */</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     
<a name="l00098"></a>00098   <span class="comment">/* if ( (lambda&gt;poly_cube-&gt;wmax) || (lambda&lt;poly_cube-&gt;wmin) )</span>
<a name="l00099"></a>00099 <span class="comment">     {</span>
<a name="l00100"></a>00100 <span class="comment">     aXe_message (aXe_M_WARN4, __FILE__, __LINE__, &quot;Sampled wavelengh (%f)&quot;</span>
<a name="l00101"></a>00101 <span class="comment">     &quot; is outside of FF cube (%f &lt; ww &lt; %f). Returning 1.0\n&quot;,lambda,poly_cube-&gt;wmin,poly_cube-&gt;wmax);</span>
<a name="l00102"></a>00102 <span class="comment">     w = 1.0;</span>
<a name="l00103"></a>00103 <span class="comment">     for (i=0;i&lt;poly_cube-&gt;poly_order;i++) </span>
<a name="l00104"></a>00104 <span class="comment">     {</span>
<a name="l00105"></a>00105 <span class="comment">     ff = ff + gsl_matrix_get(poly_cube-&gt;coeffs[i],x,y)*pow(w,i);</span>
<a name="l00106"></a>00106 <span class="comment">     }</span>
<a name="l00107"></a>00107 <span class="comment">     return ff;</span>
<a name="l00108"></a>00108 <span class="comment">     }*/</span>
<a name="l00109"></a>00109     
<a name="l00110"></a>00110   w = (fabs(lambda) - poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a1ffb6722301a4c505bf12fa1b465ba40">wmin</a>)/(poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a84506df8267a17616949e9f34424dd62">wmax</a>-poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a1ffb6722301a4c505bf12fa1b465ba40">wmin</a>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   <span class="keywordflow">if</span> (lambda&lt;poly_cube-&gt;wmin)
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       w = .0;
<a name="l00115"></a>00115     }        
<a name="l00116"></a>00116   <span class="keywordflow">if</span> (lambda&gt;poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a84506df8267a17616949e9f34424dd62">wmax</a>)
<a name="l00117"></a>00117     {
<a name="l00118"></a>00118       w = 1.0;
<a name="l00119"></a>00119     }    
<a name="l00120"></a>00120   
<a name="l00121"></a>00121   <span class="keywordflow">for</span> (i=0;i&lt;poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a43ded1d19ab5c7a6d34ffc75788e6fdf">poly_order</a>;i++) 
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123       ff = ff + <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(poly_cube-&gt;<a class="code" href="structpoly__cube__flatfield.html#a5e941be5d850641c8f11e35e48d9266e">coeffs</a>[i],x,y)*pow(w,i);
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125   <span class="keywordflow">return</span> ff;
<a name="l00126"></a>00126 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
