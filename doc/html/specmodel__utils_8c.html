<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/src/axesim/specmodel_utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/src/axesim/specmodel_utils.c File Reference</h1><code>#include &lt;fitsio.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_matrix.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_vector.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_interp.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="aXe__grism_8h_source.html">aXe_grism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="aXe__utils_8h_source.html">aXe_utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="spc__wl__calib_8h_source.html">spc_wl_calib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="aXe__errors_8h_source.html">aXe_errors.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="specmodel__utils_8h_source.html">specmodel_utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="model__utils_8h_source.html">model_utils.h</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacespecmodel__utils.html">specmodel_utils</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobject__models.html">object_models</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a2683e0be35d7cfb48bb1950f84989643">load_object_models</a> (const char object_models_file[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdirim__emission.html">dirim_emission</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#af1be6583f4bbd24bf2c1b5af04645115">load_diremission_list</a> (const char object_models_file[], const int n_models)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdirim__emission.html">dirim_emission</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#acab1018d02eee26f8cade96c2f8afebb">load_diremission</a> (const char object_models_file[], const int ext_num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#ae180cf6fd252d1eae9ddd146f288f9b5">free_object_models</a> (<a class="el" href="structobject__models.html">object_models</a> *objmodels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a78ace28fa324d880ddc10324be32d053">free_dirim_emission</a> (<a class="el" href="structdirim__emission.html">dirim_emission</a> *diremission)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a226591d5386a294bc4444add1a349bb3">print_object_models</a> (const <a class="el" href="structobject__models.html">object_models</a> *objmodels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a950dcbfa64fcf4397250929956649318">print_dirim_emission</a> (const <a class="el" href="structdirim__emission.html">dirim_emission</a> *diremission)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdirim__emission.html">dirim_emission</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a152c924fc73a4302519e7407c958ef2e">get_dirim_emission</a> (const <a class="el" href="structobject__models.html">object_models</a> *objmodels, const int objspec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a2257600178b2705e1c92f6e45bf249a8">has_aperture_dirim</a> (const <a class="el" href="structobject__models.html">object_models</a> *objmodels, const <a class="el" href="structobject.html">object</a> *actobject)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a24e2a40a5d4d62193ae91e05f9c395ae">has_aper_dirim</a> (const <a class="el" href="structfits__access.html">fits_access</a> *m_access, const <a class="el" href="structobject.html">object</a> *actobject)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a90e8278f78014bbbaa595341f92cedb5">get_diremission_value</a> (const <a class="el" href="structdirim__emission.html">dirim_emission</a> *diremission, const double xpos, const double ypos)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#ae8cf51d73f2a4500a1ab657ac2563245">bilin_interp_matrix</a> (const gsl_matrix *modimage, const double x, const double y)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspectral__models.html">spectral_models</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a815d1f785501fd2a9cc3f33a6a95c34d">load_spectral_models</a> (const char spectral_models_file[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfits__access.html">fits_access</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a5fd3ec3fb04fbdc2e1ce7ed627dbfc48">access_fits_models</a> (const char fits_models_file[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a72d7c5f0cb45632c1f130a2a60c196e0">print_spectral_models</a> (const <a class="el" href="structspectral__models.html">spectral_models</a> *smodels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structenergy__distrib.html">energy_distrib</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#af32683a60bb4033ebb23eff38ca207fb">load_SED_list</a> (const char spectral_models_file[], const int n_models)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structenergy__distrib.html">energy_distrib</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a5abd5876b6dbdab673e829168c3767fd">load_SED_from_fitsext</a> (const char spectral_models_file[], fitsfile *s_models)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a9d5d7796fd3bc959d9ae8e6fda0939c8">get_num_extensions</a> (const char spectral_models_file[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#aacf21452ac18d26013430240df196892">free_spectral_models</a> (<a class="el" href="structspectral__models.html">spectral_models</a> *smodels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a05bec4559d0ac39512725211cee1d2ff">free_fits_access</a> (<a class="el" href="structfits__access.html">fits_access</a> *m_access)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structenergy__distrib.html">energy_distrib</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a234518e70caa6622e95b73820fd03aa6">get_model_sed</a> (const <a class="el" href="structspectral__models.html">spectral_models</a> *spec_mod, const int modspec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structenergy__distrib.html">energy_distrib</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#ab0006ea759b7141dcec257eba61910e2">load_model_sed</a> (<a class="el" href="structfits__access.html">fits_access</a> *m_access, const int modspec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="specmodel__utils_8c.html#a90fff582cc9236b1457b8c9b757420a3">move_in_fits</a> (<a class="el" href="structfits__access.html">fits_access</a> *m_access, const int targetHDU)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5fd3ec3fb04fbdc2e1ce7ed627dbfc48"></a><!-- doxytag: member="specmodel_utils.c::access_fits_models" ref="a5fd3ec3fb04fbdc2e1ce7ed627dbfc48" args="(const char fits_models_file[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfits__access.html">fits_access</a>* access_fits_models </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>fits_models_file</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: access_fits_models</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spectral_models_file</em>&nbsp;</td><td>- pathname to the spectral models file</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>model_map - the map of the models </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00480"></a>00480 {
<a name="l00481"></a>00481   <span class="keywordtype">int</span> f_status=0;
<a name="l00482"></a>00482   <span class="comment">//int n_models=0;</span>
<a name="l00483"></a>00483   <a class="code" href="structfits__access.html">fits_access</a> * m_access;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   <span class="comment">// allocate space for the spectral models structure</span>
<a name="l00486"></a>00486   m_access = (<a class="code" href="structfits__access.html">fits_access</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structfits__access.html">fits_access</a>));
<a name="l00487"></a>00487 
<a name="l00488"></a>00488   <span class="comment">// copy the file name to the struct</span>
<a name="l00489"></a>00489   strcpy(m_access-&gt;<a class="code" href="structfits__access.html#af606a81f066e75230aa061386ddede21">fits_file</a>, fits_models_file);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   <span class="comment">// open the fits file</span>
<a name="l00492"></a>00492   <span class="comment">// report any error</span>
<a name="l00493"></a>00493   fits_open_file (&amp;m_access-&gt;<a class="code" href="structfits__access.html#afdf355de50df0d99e3186ad2fddcd2b6">fits_ptr</a>, fits_models_file, READONLY, &amp;f_status);
<a name="l00494"></a>00494   <span class="keywordflow">if</span> (f_status)
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496       ffrprt (stderr, f_status);
<a name="l00497"></a>00497       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00498"></a>00498                    <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l00499"></a>00499                    fits_models_file);
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="comment">// get the number of models</span>
<a name="l00503"></a>00503   m_access-&gt;<a class="code" href="structfits__access.html#a241260b89300c1d0fa1356f279c1319c">n_modelHDU</a> =  <a class="code" href="specmodel__utils_8c.html#a9d5d7796fd3bc959d9ae8e6fda0939c8">get_num_extensions</a>(fits_models_file);
<a name="l00504"></a>00504   m_access-&gt;<a class="code" href="structfits__access.html#a210b0f35b33c7e271b3d288d05782dbf">act_hdu</a> =  -1;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="comment">// return the structure</span>
<a name="l00507"></a>00507   <span class="keywordflow">return</span> m_access;
<a name="l00508"></a>00508 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae8cf51d73f2a4500a1ab657ac2563245"></a><!-- doxytag: member="specmodel_utils.c::bilin_interp_matrix" ref="ae8cf51d73f2a4500a1ab657ac2563245" args="(const gsl_matrix *modimage, const double x, const double y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double bilin_interp_matrix </td>
          <td>(</td>
          <td class="paramtype">const gsl_matrix *&nbsp;</td>
          <td class="paramname"> <em>modimage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: bilin_interp_matrix The function computes and returns the bilinear interpolated value of a given matrix at a given coordinate position. The algorithm was taken from the numerical recipes.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>modimage</em>&nbsp;</td><td>- the direct emission model </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>- the x-position </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>y</em>&nbsp;</td><td>- the y-position</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>value - the interpolated value </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <span class="keywordtype">int</span> x_lower;
<a name="l00395"></a>00395   <span class="keywordtype">int</span> y_lower;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="keywordtype">double</span> v1, v2, v3, v4;
<a name="l00398"></a>00398   <span class="keywordtype">double</span> t, u;
<a name="l00399"></a>00399   
<a name="l00400"></a>00400   <span class="keywordtype">double</span> value;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   <span class="comment">// get the indices of the &apos;lower&apos;</span>
<a name="l00403"></a>00403   <span class="comment">// pixel corner </span>
<a name="l00404"></a>00404   x_lower = (int) x;
<a name="l00405"></a>00405   y_lower = (int) y;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   <span class="comment">// check whether a pixel center is directly hit</span>
<a name="l00408"></a>00408   <span class="keywordflow">if</span> (fabs((<span class="keywordtype">float</span>)x_lower-x) &lt; 1.0e-06 &amp;&amp; fabs((<span class="keywordtype">float</span>)y_lower-y) &lt; 1.0e-06)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410       <span class="comment">// give the full pixel value</span>
<a name="l00411"></a>00411       value =  <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(modimage, x_lower  , y_lower  );
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413   <span class="keywordflow">else</span>
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415       <span class="comment">// extract the matrix values at the corners surrounding</span>
<a name="l00416"></a>00416       <span class="comment">// the requested interpolation position</span>
<a name="l00417"></a>00417       v1 = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(modimage, x_lower  , y_lower  );
<a name="l00418"></a>00418       v2 = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(modimage, x_lower+1, y_lower  );
<a name="l00419"></a>00419       v3 = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(modimage, x_lower+1, y_lower+1);
<a name="l00420"></a>00420       v4 = <a class="code" href="aXe__grism_8h.html#acf709ee71c580f1cd65d726ed03200ea">gsl_matrix_get</a>(modimage, x_lower  , y_lower+1);
<a name="l00421"></a>00421       
<a name="l00422"></a>00422       <span class="comment">// compute the pixel offset</span>
<a name="l00423"></a>00423       <span class="comment">// from the lower corner</span>
<a name="l00424"></a>00424       t = x - (float)x_lower;
<a name="l00425"></a>00425       u = y - (float)y_lower;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427       <span class="comment">// compute the bi-linear interpolated value</span>
<a name="l00428"></a>00428       <span class="comment">// (algorithm taken from &apos;Numerical Recipes&apos;</span>
<a name="l00429"></a>00429       value = (1-t)*(1-u)*v1 + t*(1-u)*v2 + t*u*v3 + (1-t)*u*v4;
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="comment">// return the interpolated value</span>
<a name="l00433"></a>00433   <span class="keywordflow">return</span> value;
<a name="l00434"></a>00434 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a78ace28fa324d880ddc10324be32d053"></a><!-- doxytag: member="specmodel_utils.c::free_dirim_emission" ref="a78ace28fa324d880ddc10324be32d053" args="(dirim_emission *diremission)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_dirim_emission </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdirim__emission.html">dirim_emission</a> *&nbsp;</td>
          <td class="paramname"> <em>diremission</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_dirim_emission The function frees all memory allocated in a direct emission <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>diremission</em>&nbsp;</td><td>- the direct emission model to free</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00180"></a>00180 {
<a name="l00181"></a>00181   <span class="comment">// free the matrix with the direct emission</span>
<a name="l00182"></a>00182   <a class="code" href="aXe__grism_8h.html#a61aa1d37853a90711852146f18d0b85f">gsl_matrix_free</a>(diremission-&gt;<a class="code" href="structdirim__emission.html#a8ae8f988a0ad5d4dd23c294c59e81e0e">modimage</a>);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">// free the whole structure</span>
<a name="l00185"></a>00185   free(diremission);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   <span class="comment">// set the struct to NULL</span>
<a name="l00188"></a>00188   diremission = NULL;
<a name="l00189"></a>00189 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a05bec4559d0ac39512725211cee1d2ff"></a><!-- doxytag: member="specmodel_utils.c::free_fits_access" ref="a05bec4559d0ac39512725211cee1d2ff" args="(fits_access *m_access)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_fits_access </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfits__access.html">fits_access</a> *&nbsp;</td>
          <td class="paramname"> <em>m_access</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_model_access Releases the memory allocated in a model access structure</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>m_access</em>&nbsp;</td><td>- the model access structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00805"></a>00805 {
<a name="l00806"></a>00806         <span class="keywordtype">int</span> f_status=0;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808         <span class="comment">// close the fits file</span>
<a name="l00809"></a>00809         fits_close_file (m_access-&gt;<a class="code" href="structfits__access.html#afdf355de50df0d99e3186ad2fddcd2b6">fits_ptr</a>, &amp;f_status);
<a name="l00810"></a>00810         <span class="keywordflow">if</span> (f_status)
<a name="l00811"></a>00811         {
<a name="l00812"></a>00812                 ffrprt (stderr, f_status);
<a name="l00813"></a>00813                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00814"></a>00814                                 <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Could not close file: %s&quot;</span>,
<a name="l00815"></a>00815                                 m_access-&gt;<a class="code" href="structfits__access.html#af606a81f066e75230aa061386ddede21">fits_file</a>);
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818         <span class="comment">// free the structure</span>
<a name="l00819"></a>00819         free(m_access);
<a name="l00820"></a>00820         m_access = NULL;
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae180cf6fd252d1eae9ddd146f288f9b5"></a><!-- doxytag: member="specmodel_utils.c::free_object_models" ref="ae180cf6fd252d1eae9ddd146f288f9b5" args="(object_models *objmodels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_object_models </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structobject__models.html">object_models</a> *&nbsp;</td>
          <td class="paramname"> <em>objmodels</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_object_models The function frees all memory allocated in a <a class="el" href="structobject.html">object</a> model structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>objmodels</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> model structure to free</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00149"></a>00149 {
<a name="l00150"></a>00150   <span class="keywordtype">int</span> iii;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment">// go over each model</span>
<a name="l00153"></a>00153   <span class="keywordflow">for</span> (iii=0; iii &lt; objmodels-&gt;<a class="code" href="structobject__models.html#a5810731176663b015f18d20d29b194ee">n_models</a>; iii++)
<a name="l00154"></a>00154     {
<a name="l00155"></a>00155       <span class="comment">// free every model separately</span>
<a name="l00156"></a>00156       <a class="code" href="specmodel__utils_8c.html#a78ace28fa324d880ddc10324be32d053">free_dirim_emission</a>(objmodels-&gt;<a class="code" href="structobject__models.html#afdd965836e9c88e46e75d644a2f31af0">obj_list</a>[iii]);
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   <span class="comment">// free the rest</span>
<a name="l00160"></a>00160   free(objmodels-&gt;<a class="code" href="structobject__models.html#afdd965836e9c88e46e75d644a2f31af0">obj_list</a>);
<a name="l00161"></a>00161   free(objmodels);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="comment">// set the structure to null</span>
<a name="l00164"></a>00164   objmodels = NULL;
<a name="l00165"></a>00165 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aacf21452ac18d26013430240df196892"></a><!-- doxytag: member="specmodel_utils.c::free_spectral_models" ref="aacf21452ac18d26013430240df196892" args="(spectral_models *smodels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_spectral_models </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectral__models.html">spectral_models</a> *&nbsp;</td>
          <td class="paramname"> <em>smodels</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_spectral_models Releases the memory allocated in a spectral models structure</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smodels</em>&nbsp;</td><td>- the spectral models structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00772"></a>00772 {
<a name="l00773"></a>00773   <span class="keywordtype">int</span> i=0;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="comment">// go over all energy distributions</span>
<a name="l00776"></a>00776   <span class="keywordflow">for</span> (i=0; i &lt; smodels-&gt;<a class="code" href="structspectral__models.html#a1e0a38224697819c156efc42a4988faa">n_models</a>; i++)
<a name="l00777"></a>00777     {
<a name="l00778"></a>00778       <span class="comment">// free the energy distribution</span>
<a name="l00779"></a>00779       <a class="code" href="model__utils_8c.html#af4aeb43aa090824fe3dcad3049d38a62">free_enerdist</a>(smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[i]);
<a name="l00780"></a>00780       smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[i] = NULL;
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782   
<a name="l00783"></a>00783   <span class="comment">// free the SED list</span>
<a name="l00784"></a>00784   free(smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>);
<a name="l00785"></a>00785   smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a> = NULL;
<a name="l00786"></a>00786   
<a name="l00787"></a>00787   <span class="comment">// free the structure</span>
<a name="l00788"></a>00788   free(smodels);
<a name="l00789"></a>00789   smodels = NULL;
<a name="l00790"></a>00790 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90e8278f78014bbbaa595341f92cedb5"></a><!-- doxytag: member="specmodel_utils.c::get_diremission_value" ref="a90e8278f78014bbbaa595341f92cedb5" args="(const dirim_emission *diremission, const double xpos, const double ypos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_diremission_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdirim__emission.html">dirim_emission</a> *&nbsp;</td>
          <td class="paramname"> <em>diremission</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>xpos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&nbsp;</td>
          <td class="paramname"> <em>ypos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_diremission_value The function computes the direct emission value for a given direct emission <a class="el" href="structobject.html">object</a> and coordinates. The coordinates are given in x- and y-position with respect to the mean position of the direct emission <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>diremission</em>&nbsp;</td><td>- the direct emission model </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>xpos</em>&nbsp;</td><td>- the relative x-position </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ypos</em>&nbsp;</td><td>- the relative y-position</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>value - the emission value </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00343"></a>00343 {
<a name="l00344"></a>00344   <span class="keywordtype">double</span> x_abs;
<a name="l00345"></a>00345   <span class="keywordtype">double</span> y_abs;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="keywordtype">double</span> value=0.0;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <span class="comment">// compute the absolute positions</span>
<a name="l00350"></a>00350   <span class="comment">// in the coordinate system</span>
<a name="l00351"></a>00351   <span class="comment">// of the matrix</span>
<a name="l00352"></a>00352   x_abs = xpos + diremission-&gt;<a class="code" href="structdirim__emission.html#a57c2f8cf6dfc3ede582b40f8a63e3eec">xmean</a>;
<a name="l00353"></a>00353   y_abs = ypos + diremission-&gt;<a class="code" href="structdirim__emission.html#a95dcd0f591805409a5667874e771597e">ymean</a>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="comment">//fprintf(stderr, &quot; from x,y= % e,% e &quot;,  x_abs, y_abs);</span>
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   <span class="comment">// check whether the position</span>
<a name="l00358"></a>00358   <span class="comment">// is outside the matrix</span>
<a name="l00359"></a>00359   <span class="keywordflow">if</span> (x_abs &lt; 0.0 || y_abs &lt; 0.0
<a name="l00360"></a>00360       || x_abs &gt;= (<span class="keywordtype">float</span>)(diremission-&gt;<a class="code" href="structdirim__emission.html#a4184a616a68e4d92efee811168b9ab7e">dim_x</a>-1) || y_abs &gt;= (<span class="keywordtype">float</span>)(diremission-&gt;<a class="code" href="structdirim__emission.html#a9b3ba1b1264aaae084c69f290f6343e3">dim_y</a>-1))
<a name="l00361"></a>00361     <span class="comment">// assign 0.0</span>
<a name="l00362"></a>00362     {  
<a name="l00363"></a>00363       <span class="comment">//fprintf(stderr, &quot;FIX %i,%i  % e,% e &quot;, (int)x_abs, (int)y_abs, x_abs, y_abs);</span>
<a name="l00364"></a>00364       value = 0.0;
<a name="l00365"></a>00365       <span class="comment">//fprintf(stdout, &quot;NI \n&quot;,  x_abs, y_abs);</span>
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367   <span class="keywordflow">else</span>
<a name="l00368"></a>00368     {  <span class="comment">//  fprintf(stdout, &quot;from x,y= %e,%e&quot;,  x_abs, y_abs);</span>
<a name="l00369"></a>00369     <span class="comment">// assign the bilinear interpolated value</span>
<a name="l00370"></a>00370       value = <a class="code" href="specmodel__utils_8c.html#ae8cf51d73f2a4500a1ab657ac2563245">bilin_interp_matrix</a>(diremission-&gt;<a class="code" href="structdirim__emission.html#a8ae8f988a0ad5d4dd23c294c59e81e0e">modimage</a>, x_abs, y_abs);
<a name="l00371"></a>00371       <span class="comment">//fprintf(stdout, &quot;IN \n&quot;,  x_abs, y_abs);</span>
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373   <span class="comment">// return the value</span>
<a name="l00374"></a>00374   <span class="keywordflow">return</span> value;
<a name="l00375"></a>00375 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a152c924fc73a4302519e7407c958ef2e"></a><!-- doxytag: member="specmodel_utils.c::get_dirim_emission" ref="a152c924fc73a4302519e7407c958ef2e" args="(const object_models *objmodels, const int objspec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdirim__emission.html">dirim_emission</a>* get_dirim_emission </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobject__models.html">object_models</a> *&nbsp;</td>
          <td class="paramname"> <em>objmodels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>objspec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_dirim_emission The function returns from a direct <a class="el" href="structobject.html">object</a> model the direct emission <a class="el" href="structobject.html">object</a> addressed by the index. The function translates from the <a class="el" href="structobject.html">object</a> index, which is in [1, n_model] to the structure index in [0, n_model-1]</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>objmodels</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> model structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objspec</em>&nbsp;</td><td>- the 'index' of the desired direct emission model</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>dirim - the desired direct emission model </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00248"></a>00248 {
<a name="l00249"></a>00249   <a class="code" href="structdirim__emission.html">dirim_emission</a> *dirim;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (objspec &gt;  objmodels-&gt;<a class="code" href="structobject__models.html#a5810731176663b015f18d20d29b194ee">n_models</a> || objspec &lt; 1)
<a name="l00252"></a>00252     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00253"></a>00253                  <span class="stringliteral">&quot;aXe_PETCONT: &quot;</span> <span class="stringliteral">&quot;Direct emission model number %i does NOT exist!&quot;</span>,
<a name="l00254"></a>00254                  objspec);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="comment">// extract the desired SED</span>
<a name="l00257"></a>00257   dirim = objmodels-&gt;<a class="code" href="structobject__models.html#afdd965836e9c88e46e75d644a2f31af0">obj_list</a>[objspec-1];
<a name="l00258"></a>00258 
<a name="l00259"></a>00259   <span class="comment">// return the SED</span>
<a name="l00260"></a>00260   <span class="keywordflow">return</span> dirim;
<a name="l00261"></a>00261 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a234518e70caa6622e95b73820fd03aa6"></a><!-- doxytag: member="specmodel_utils.c::get_model_sed" ref="a234518e70caa6622e95b73820fd03aa6" args="(const spectral_models *spec_mod, const int modspec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structenergy__distrib.html">energy_distrib</a>* get_model_sed </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structspectral__models.html">spectral_models</a> *&nbsp;</td>
          <td class="paramname"> <em>spec_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>modspec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_model_sed Extracts and returns the desired model <a class="el" href="structspectrum.html">spectrum</a> from th model structure. Translates from the <a class="el" href="structobject.html">object</a> index [1, n_models] to the spectral model structure index [0, n_model-1].</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structspectral__models.html">spectral_models</a></em>&nbsp;</td><td>- the spectral models structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>modspec</em>&nbsp;</td><td>- the index of the desired SED</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00839"></a>00839 {
<a name="l00840"></a>00840   <a class="code" href="structenergy__distrib.html">energy_distrib</a> *sed;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842   <span class="keywordflow">if</span> (modspec &gt;  spec_mod-&gt;<a class="code" href="structspectral__models.html#a1e0a38224697819c156efc42a4988faa">n_models</a>)
<a name="l00843"></a>00843     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00844"></a>00844                  <span class="stringliteral">&quot;aXe_PETCONT: &quot;</span> <span class="stringliteral">&quot;Model number %i does NOT exist!&quot;</span>,
<a name="l00845"></a>00845                  modspec);
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   <span class="comment">// extract the desired SED</span>
<a name="l00848"></a>00848   sed = spec_mod-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[modspec-1];
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   <span class="comment">// return the SED</span>
<a name="l00851"></a>00851   <span class="keywordflow">return</span> sed;
<a name="l00852"></a>00852 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9d5d7796fd3bc959d9ae8e6fda0939c8"></a><!-- doxytag: member="specmodel_utils.c::get_num_extensions" ref="a9d5d7796fd3bc959d9ae8e6fda0939c8" args="(const char spectral_models_file[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_num_extensions </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>spectral_models_file</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_num_extensions The function determines the number of extensions in the fits file. Here the primary extension does not count.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spectral_models_file</em>&nbsp;</td><td>- pathname to the spectral models file</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>n_models - the number of spectral models </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00717"></a>00717 {
<a name="l00718"></a>00718   <span class="keywordtype">int</span> n_ext=0;
<a name="l00719"></a>00719   <span class="keywordtype">int</span> n_models=0;
<a name="l00720"></a>00720   <span class="comment">//int i;</span>
<a name="l00721"></a>00721   <span class="keywordtype">int</span> f_status=0;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   fitsfile *s_models;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="comment">// open the fits file</span>
<a name="l00727"></a>00727   <span class="comment">// report any error</span>
<a name="l00728"></a>00728   fits_open_file (&amp;s_models, spectral_models_file, READONLY, &amp;f_status);
<a name="l00729"></a>00729   <span class="keywordflow">if</span> (f_status)
<a name="l00730"></a>00730     {
<a name="l00731"></a>00731       ffrprt (stderr, f_status);
<a name="l00732"></a>00732       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00733"></a>00733                    <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l00734"></a>00734                    spectral_models_file);
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   <span class="comment">// do until a fits error occurs</span>
<a name="l00738"></a>00738   <span class="keywordflow">while</span> (!f_status)
<a name="l00739"></a>00739     {
<a name="l00740"></a>00740       <span class="comment">// move one extension forward</span>
<a name="l00741"></a>00741       fits_movrel_hdu (s_models, 1, NULL, &amp;f_status);
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       <span class="comment">// count up</span>
<a name="l00744"></a>00744       n_ext++;
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746   
<a name="l00747"></a>00747   <span class="comment">// close the fits file</span>
<a name="l00748"></a>00748   fits_close_file (s_models, &amp;f_status);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750   <span class="comment">// the zeroth extension</span>
<a name="l00751"></a>00751   <span class="comment">// does nnot count!!</span>
<a name="l00752"></a>00752   n_models = n_ext - 1;
<a name="l00753"></a>00753   
<a name="l00754"></a>00754   <span class="comment">// return the </span>
<a name="l00755"></a>00755   <span class="keywordflow">return</span> n_models;
<a name="l00756"></a>00756 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a24e2a40a5d4d62193ae91e05f9c395ae"></a><!-- doxytag: member="specmodel_utils.c::has_aper_dirim" ref="a24e2a40a5d4d62193ae91e05f9c395ae" args="(const fits_access *m_access, const object *actobject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int has_aper_dirim </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfits__access.html">fits_access</a> *&nbsp;</td>
          <td class="paramname"> <em>m_access</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structobject.html">object</a> *&nbsp;</td>
          <td class="paramname"> <em>actobject</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: has_aper_dirim The function checks whether an <a class="el" href="structobject.html">object</a> has an associated direct emission structure or not. The corresponding boolean integer value is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>m_access</em>&nbsp;</td><td>- the fits access structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actobject</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>has_dirim - boolean whether direct emission exists (=1) or not (=0) </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00308"></a>00308 {
<a name="l00309"></a>00309   <span class="keywordtype">int</span> has_dirim=0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <span class="comment">// check whether the direct emission model</span>
<a name="l00312"></a>00312   <span class="comment">// structure is defined</span>
<a name="l00313"></a>00313   <span class="keywordflow">if</span> (m_access)
<a name="l00314"></a>00314     <span class="comment">// check whether the object has beams</span>
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (actobject-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a> &gt; 0)
<a name="l00316"></a>00316       <span class="comment">// check whether the direct emission number makes sense</span>
<a name="l00317"></a>00317       <span class="keywordflow">if</span> (actobject-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[0].<a class="code" href="structbeam.html#a343c47194d158bcc217a46923038e1a3">modimage</a> &gt; 0) <span class="comment">//&amp;&amp; actobject-&gt;beams[0].modimage &lt;= objmodels-&gt;n_models)</span>
<a name="l00318"></a>00318         <span class="comment">// report an existing direct emission</span>
<a name="l00319"></a>00319         has_dirim = 1;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="comment">// return the result</span>
<a name="l00322"></a>00322   <span class="keywordflow">return</span> has_dirim;
<a name="l00323"></a>00323 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2257600178b2705e1c92f6e45bf249a8"></a><!-- doxytag: member="specmodel_utils.c::has_aperture_dirim" ref="a2257600178b2705e1c92f6e45bf249a8" args="(const object_models *objmodels, const object *actobject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int has_aperture_dirim </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobject__models.html">object_models</a> *&nbsp;</td>
          <td class="paramname"> <em>objmodels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structobject.html">object</a> *&nbsp;</td>
          <td class="paramname"> <em>actobject</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: has_aperture_dirim The function checks whether an <a class="el" href="structobject.html">object</a> has an associated direct emission structure or not. The corresponding boolean integer value is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>objmodels</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> models structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>actobject</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>has_dirim - boolean whether direct emission exists (=1) or not (=0) </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00277"></a>00277 {
<a name="l00278"></a>00278   <span class="keywordtype">int</span> has_dirim=0;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <span class="comment">// check whether the direct emission model</span>
<a name="l00281"></a>00281   <span class="comment">// structure is defined</span>
<a name="l00282"></a>00282   <span class="keywordflow">if</span> (objmodels)
<a name="l00283"></a>00283     <span class="comment">// check whether the object has beams</span>
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (actobject-&gt;<a class="code" href="structobject.html#a14120e3b048a2118f7acd75ea1571c60">nbeams</a> &gt; 0)
<a name="l00285"></a>00285       <span class="comment">// check whether the direct emission number makes sense</span>
<a name="l00286"></a>00286       <span class="keywordflow">if</span> (actobject-&gt;<a class="code" href="structobject.html#ad643757142781f8265b430e19700cfe5">beams</a>[0].<a class="code" href="structbeam.html#a343c47194d158bcc217a46923038e1a3">modimage</a> &gt; 0) <span class="comment">//&amp;&amp; actobject-&gt;beams[0].modimage &lt;= objmodels-&gt;n_models)</span>
<a name="l00287"></a>00287         <span class="comment">// report an existing direct emission</span>
<a name="l00288"></a>00288         has_dirim = 1;
<a name="l00289"></a>00289   
<a name="l00290"></a>00290   <span class="comment">// return the result</span>
<a name="l00291"></a>00291   <span class="keywordflow">return</span> has_dirim;
<a name="l00292"></a>00292 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acab1018d02eee26f8cade96c2f8afebb"></a><!-- doxytag: member="specmodel_utils.c::load_diremission" ref="acab1018d02eee26f8cade96c2f8afebb" args="(const char object_models_file[], const int ext_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdirim__emission.html">dirim_emission</a>* load_diremission </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>object_models_file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>ext_num</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_diremission The function loads one extension of a multi-extension fits file with emission model and creates a single direct emission <a class="el" href="structobject.html">object</a>. This <a class="el" href="structobject.html">object</a> is eventually returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>object_models_file</em>&nbsp;</td><td>- the file with the <a class="el" href="structobject.html">object</a> model data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ext_num</em>&nbsp;</td><td>- the extension number to load</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>diremission - a direct emission model </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116   <a class="code" href="structdirim__emission.html">dirim_emission</a> *diremission;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="comment">// allocate memory for the structure</span>
<a name="l00119"></a>00119   diremission = (<a class="code" href="structdirim__emission.html">dirim_emission</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structdirim__emission.html">dirim_emission</a>));
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   <span class="comment">// load the image in the gsl</span>
<a name="l00122"></a>00122   diremission-&gt;<a class="code" href="structdirim__emission.html#a8ae8f988a0ad5d4dd23c294c59e81e0e">modimage</a> = <a class="code" href="aXe__utils_8c.html#ae608ee7bf2717c17c842cd3dfd327884">FITSimage_to_gsl</a>(object_models_file, ext_num, 1);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="comment">// transfer the image dimension</span>
<a name="l00125"></a>00125   diremission-&gt;<a class="code" href="structdirim__emission.html#a4184a616a68e4d92efee811168b9ab7e">dim_x</a> = (int)diremission-&gt;<a class="code" href="structdirim__emission.html#a8ae8f988a0ad5d4dd23c294c59e81e0e">modimage</a>-&gt;size1;
<a name="l00126"></a>00126   diremission-&gt;<a class="code" href="structdirim__emission.html#a9b3ba1b1264aaae084c69f290f6343e3">dim_y</a> = (<span class="keywordtype">int</span>)diremission-&gt;<a class="code" href="structdirim__emission.html#a8ae8f988a0ad5d4dd23c294c59e81e0e">modimage</a>-&gt;size2;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">// compute and store the mean image coordinates</span>
<a name="l00129"></a>00129   diremission-&gt;<a class="code" href="structdirim__emission.html#a57c2f8cf6dfc3ede582b40f8a63e3eec">xmean</a> = (float)(diremission-&gt;<a class="code" href="structdirim__emission.html#a4184a616a68e4d92efee811168b9ab7e">dim_x</a>-1) / 2.0;
<a name="l00130"></a>00130   diremission-&gt;<a class="code" href="structdirim__emission.html#a95dcd0f591805409a5667874e771597e">ymean</a> = (float)(diremission-&gt;<a class="code" href="structdirim__emission.html#a9b3ba1b1264aaae084c69f290f6343e3">dim_y</a>-1) / 2.0;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="comment">// return the structure</span>
<a name="l00133"></a>00133   <span class="keywordflow">return</span> diremission;
<a name="l00134"></a>00134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af1be6583f4bbd24bf2c1b5af04645115"></a><!-- doxytag: member="specmodel_utils.c::load_diremission_list" ref="af1be6583f4bbd24bf2c1b5af04645115" args="(const char object_models_file[], const int n_models)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdirim__emission.html">dirim_emission</a>** load_diremission_list </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>object_models_file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>n_models</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_diremission_list The function loads all the direct emission models given in a multi-extension fits file and creates a list of direct emission models. This list is returned.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>object_models_file</em>&nbsp;</td><td>- the file with the <a class="el" href="structobject.html">object</a> model data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>n_models</em>&nbsp;</td><td>- the number of <a class="el" href="structobject.html">object</a> models in the file</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>obj_list - the list of direct emission models </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00078"></a>00078 {
<a name="l00079"></a>00079   <span class="keywordtype">int</span> i=0;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <a class="code" href="structdirim__emission.html">dirim_emission</a> **obj_list;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083   <span class="comment">// allocate space for the SED list</span>
<a name="l00084"></a>00084   obj_list = (<a class="code" href="structdirim__emission.html">dirim_emission</a> **)malloc(n_models * <span class="keyword">sizeof</span>(<a class="code" href="structdirim__emission.html">dirim_emission</a> *));
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   <span class="comment">// go over the nuymber of models</span>
<a name="l00087"></a>00087   <span class="keywordflow">for</span> (i=0; i &lt; n_models; i++)
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089       <span class="comment">// load one model</span>
<a name="l00090"></a>00090       <span class="comment">// the &apos;i + 2&apos; is necessary due to the</span>
<a name="l00091"></a>00091       <span class="comment">// different counting in cfitsio </span>
<a name="l00092"></a>00092       obj_list[i] =  <a class="code" href="specmodel__utils_8c.html#acab1018d02eee26f8cade96c2f8afebb">load_diremission</a>(object_models_file, i+2);
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">// return the loaded structure</span>
<a name="l00096"></a>00096   <span class="keywordflow">return</span> obj_list;
<a name="l00097"></a>00097 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab0006ea759b7141dcec257eba61910e2"></a><!-- doxytag: member="specmodel_utils.c::load_model_sed" ref="ab0006ea759b7141dcec257eba61910e2" args="(fits_access *m_access, const int modspec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structenergy__distrib.html">energy_distrib</a>* load_model_sed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfits__access.html">fits_access</a> *&nbsp;</td>
          <td class="paramname"> <em>m_access</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>modspec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_model_sed Loads and returns the desired model <a class="el" href="structspectrum.html">spectrum</a> from the spectral model table. Translates from the <a class="el" href="structobject.html">object</a> index [1, n_models] to the fits table index [2, n_model+1] (taking into account the primary extension)</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>m_access</em>&nbsp;</td><td>- the model access structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>modspec</em>&nbsp;</td><td>- the index of the desired SED</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00869"></a>00869 {
<a name="l00870"></a>00870         <span class="keywordtype">int</span> nrel;
<a name="l00871"></a>00871         <span class="keywordtype">int</span> hdutype;
<a name="l00872"></a>00872         <span class="keywordtype">int</span> f_status=0;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874         <a class="code" href="structenergy__distrib.html">energy_distrib</a> *sed;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         <a class="code" href="specmodel__utils_8c.html#a90fff582cc9236b1457b8c9b757420a3">move_in_fits</a>(m_access, modspec);
<a name="l00877"></a>00877         <span class="comment">/*</span>
<a name="l00878"></a>00878 <span class="comment">        // make sure the SED does exist</span>
<a name="l00879"></a>00879 <span class="comment">        if (modspec &lt; 0 || modspec &gt;  m_access-&gt;n_modelHDU)</span>
<a name="l00880"></a>00880 <span class="comment">                aXe_message (aXe_M_FATAL, __FILE__, __LINE__,</span>
<a name="l00881"></a>00881 <span class="comment">                                &quot;aXe_DISPIMAGE: &quot; &quot;Model number %i does NOT exist!&quot;,</span>
<a name="l00882"></a>00882 <span class="comment">                                modspec);</span>
<a name="l00883"></a>00883 <span class="comment"></span>
<a name="l00884"></a>00884 <span class="comment">        // if accessing the first time</span>
<a name="l00885"></a>00885 <span class="comment">        // we go to an absolute position</span>
<a name="l00886"></a>00886 <span class="comment">        if (m_access-&gt;act_hdu &lt;0){</span>
<a name="l00887"></a>00887 <span class="comment">                // move to the absolute HDU positions</span>
<a name="l00888"></a>00888 <span class="comment">                fits_movabs_hdu(m_access-&gt;fits_ptr, modspec+1, &amp;hdutype, &amp;f_status);</span>
<a name="l00889"></a>00889 <span class="comment">                if (f_status) {</span>
<a name="l00890"></a>00890 <span class="comment">                        ffrprt (stderr, f_status);</span>
<a name="l00891"></a>00891 <span class="comment">                        aXe_message (aXe_M_FATAL, __FILE__, __LINE__,</span>
<a name="l00892"></a>00892 <span class="comment">                                        &quot;aXe_DISPIMAGE: &quot; &quot;Could not move to HDU %d in file: %s!&quot;,modspec+1, m_access-&gt;fits_file);</span>
<a name="l00893"></a>00893 <span class="comment">                    }</span>
<a name="l00894"></a>00894 <span class="comment">                //fprintf (stdout,&quot;In file: %s moving to HDU: %d.\n&quot;, m_access-&gt;fits_file, m_access-&gt;act_hdu);</span>
<a name="l00895"></a>00895 <span class="comment">        }</span>
<a name="l00896"></a>00896 <span class="comment">        // move relative to the current position</span>
<a name="l00897"></a>00897 <span class="comment">        else{</span>
<a name="l00898"></a>00898 <span class="comment">                // compute the relative move and jump there</span>
<a name="l00899"></a>00899 <span class="comment">                nrel=modspec+1-m_access-&gt;act_hdu;</span>
<a name="l00900"></a>00900 <span class="comment">                fits_movrel_hdu(m_access-&gt;fits_ptr, nrel,  &amp;hdutype, &amp;f_status);</span>
<a name="l00901"></a>00901 <span class="comment">                if (f_status) {</span>
<a name="l00902"></a>00902 <span class="comment">                        ffrprt (stderr, f_status);</span>
<a name="l00903"></a>00903 <span class="comment">                        aXe_message (aXe_M_FATAL, __FILE__, __LINE__,</span>
<a name="l00904"></a>00904 <span class="comment">                                        &quot;aXe_DISPIMAGE: &quot; &quot;Could not move %d HDU&apos;s in file: %s!&quot;, nrel, m_access-&gt;fits_file);</span>
<a name="l00905"></a>00905 <span class="comment">                    }</span>
<a name="l00906"></a>00906 <span class="comment">                //fprintf (stdout,&quot;In file: %s moved relative: %d.\n&quot;,m_access-&gt;fits_file, nrel);</span>
<a name="l00907"></a>00907 <span class="comment">        }</span>
<a name="l00908"></a>00908 <span class="comment">        // update the current HDU number</span>
<a name="l00909"></a>00909 <span class="comment">        m_access-&gt;act_hdu=modspec+1;</span>
<a name="l00910"></a>00910 <span class="comment">        */</span>
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="comment">// load the energy distribution</span>
<a name="l00913"></a>00913         sed = <a class="code" href="specmodel__utils_8c.html#a5abd5876b6dbdab673e829168c3767fd">load_SED_from_fitsext</a>(m_access-&gt;<a class="code" href="structfits__access.html#af606a81f066e75230aa061386ddede21">fits_file</a>, m_access-&gt;<a class="code" href="structfits__access.html#afdf355de50df0d99e3186ad2fddcd2b6">fits_ptr</a>);
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         <span class="comment">// return the SED</span>
<a name="l00916"></a>00916         <span class="keywordflow">return</span> sed;
<a name="l00917"></a>00917 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2683e0be35d7cfb48bb1950f84989643"></a><!-- doxytag: member="specmodel_utils.c::load_object_models" ref="a2683e0be35d7cfb48bb1950f84989643" args="(const char object_models_file[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobject__models.html">object_models</a>* load_object_models </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>object_models_file</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_object_models The function loads all direct emission models stored in a mulit-extension fits image into a corresponding <a class="el" href="structobject.html">object</a> model structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>object_models_file</em>&nbsp;</td><td>- the file with the <a class="el" href="structobject.html">object</a> model data</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>objmodels - the <a class="el" href="structobject.html">object</a> model structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00035"></a>00035  {
<a name="l00036"></a>00036   <a class="code" href="structobject__models.html">object_models</a> *objmodels;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="keywordtype">int</span> n_extent=0;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="comment">// give feedback to the user</span>
<a name="l00041"></a>00041   fprintf (stdout, <span class="stringliteral">&quot;aXe_PETCONT: Loading object models...&quot;</span>, object_models_file);
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="comment">// allocate space for the direct emission structure</span>
<a name="l00044"></a>00044   objmodels = (<a class="code" href="structobject__models.html">object_models</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structobject__models.html">object_models</a>));
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment">// get the number of models</span>
<a name="l00047"></a>00047   n_extent = <a class="code" href="specmodel__utils_8c.html#a9d5d7796fd3bc959d9ae8e6fda0939c8">get_num_extensions</a>(object_models_file);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <span class="comment">// load the list with the individual direct emission</span>
<a name="l00050"></a>00050   objmodels-&gt;<a class="code" href="structobject__models.html#afdd965836e9c88e46e75d644a2f31af0">obj_list</a> = <a class="code" href="specmodel__utils_8c.html#af1be6583f4bbd24bf2c1b5af04645115">load_diremission_list</a>(object_models_file, n_extent);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">// store the number of direct emission images</span>
<a name="l00053"></a>00053   objmodels-&gt;<a class="code" href="structobject__models.html#a5810731176663b015f18d20d29b194ee">n_models</a> =  n_extent;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="comment">// report the number of models loaded</span>
<a name="l00056"></a>00056   fprintf (stdout,<span class="stringliteral">&quot;%d models loaded.\n&quot;</span>, objmodels-&gt;<a class="code" href="structobject__models.html#a5810731176663b015f18d20d29b194ee">n_models</a>);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">// return the list structure</span>
<a name="l00059"></a>00059   <span class="keywordflow">return</span> objmodels;
<a name="l00060"></a>00060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5abd5876b6dbdab673e829168c3767fd"></a><!-- doxytag: member="specmodel_utils.c::load_SED_from_fitsext" ref="a5abd5876b6dbdab673e829168c3767fd" args="(const char spectral_models_file[], fitsfile *s_models)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structenergy__distrib.html">energy_distrib</a>* load_SED_from_fitsext </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>spectral_models_file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>s_models</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_SED_from_fitsext The function creates a energy distribution from the data stored in a fits file extension. The data must be stored in the columns "wavelength" and "flux".</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spectral_models_file</em>&nbsp;</td><td>- pathname to the spectral models file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s_models</em>&nbsp;</td><td>- pointer to the fits file extension</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>sed - the energy distribution created </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00606"></a>00606 {
<a name="l00607"></a>00607   <span class="keywordtype">int</span> f_status=0;
<a name="l00608"></a>00608   <span class="keywordtype">int</span> anynul;
<a name="l00609"></a>00609   <span class="keywordtype">long</span> nrows=0;
<a name="l00610"></a>00610   <span class="keywordtype">int</span> colnum1;
<a name="l00611"></a>00611   <span class="keywordtype">int</span> colnum2;
<a name="l00612"></a>00612   
<a name="l00613"></a>00613   <a class="code" href="structenergy__distrib.html">energy_distrib</a> *sed=NULL;
<a name="l00614"></a>00614   <span class="keywordtype">double</span> *sed_wavs;
<a name="l00615"></a>00615   <span class="keywordtype">double</span> *sed_flux;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617   <span class="comment">// allocate memory for the energy distribution</span>
<a name="l00618"></a>00618   sed = (<a class="code" href="structenergy__distrib.html">energy_distrib</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structenergy__distrib.html">energy_distrib</a>));
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="comment">// get number of rows</span>
<a name="l00621"></a>00621   fits_get_num_rows (s_models, &amp;nrows, &amp;f_status);
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (f_status) {
<a name="l00623"></a>00623     ffrprt (stderr, f_status);
<a name="l00624"></a>00624     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00625"></a>00625                  <span class="stringliteral">&quot;load_SED_from_fitsext: &quot;</span>
<a name="l00626"></a>00626                  <span class="stringliteral">&quot;Could not determine the number of rows in&quot;</span>
<a name="l00627"></a>00627                  <span class="stringliteral">&quot; table %s&quot;</span>,spectral_models_file);
<a name="l00628"></a>00628   }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <span class="comment">// allocate memory for the data</span>
<a name="l00631"></a>00631   sed_wavs = (<span class="keywordtype">double</span> *) malloc(nrows*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00632"></a>00632   <span class="keywordflow">if</span> (!sed_wavs) { 
<a name="l00633"></a>00633     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#ad247dca204a2964327532d0359b59ad8">aXe_M_ERROR</a>, __FILE__, __LINE__,
<a name="l00634"></a>00634                  <span class="stringliteral">&quot;Memory allocation failed&quot;</span>);
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636   sed_flux = (<span class="keywordtype">double</span> *) malloc(nrows*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00637"></a>00637   <span class="keywordflow">if</span> (!sed_flux) {
<a name="l00638"></a>00638     <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#ad247dca204a2964327532d0359b59ad8">aXe_M_ERROR</a>, __FILE__, __LINE__,
<a name="l00639"></a>00639                  <span class="stringliteral">&quot;Memory allocation failed&quot;</span>);
<a name="l00640"></a>00640   }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642   <span class="comment">// get the column number for the wavelength</span>
<a name="l00643"></a>00643   fits_get_colnum (s_models, CASEINSEN, <span class="stringliteral">&quot;WAV_NM&quot;</span>, &amp;colnum1, &amp;f_status);
<a name="l00644"></a>00644   <span class="keywordflow">if</span> (f_status)
<a name="l00645"></a>00645     {
<a name="l00646"></a>00646       ffrprt (stderr, f_status);
<a name="l00647"></a>00647       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00648"></a>00648                    <span class="stringliteral">&quot;create_interp_ftable: &quot;</span>
<a name="l00649"></a>00649                    <span class="stringliteral">&quot;Could not determine column %s in &quot;</span>
<a name="l00650"></a>00650                    <span class="stringliteral">&quot; table %s&quot;</span>, <span class="stringliteral">&quot;WAV_NM&quot;</span>, spectral_models_file);
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652   <span class="comment">// read the wavelength</span>
<a name="l00653"></a>00653   fits_read_col (s_models, TDOUBLE, colnum1, 1, 1, nrows, NULL, sed_wavs,
<a name="l00654"></a>00654                     &amp;anynul, &amp;f_status);
<a name="l00655"></a>00655   <span class="keywordflow">if</span> (f_status)
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657       ffrprt (stderr, f_status);
<a name="l00658"></a>00658       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00659"></a>00659                    <span class="stringliteral">&quot;load_SED_from_fitsext: &quot;</span>
<a name="l00660"></a>00660                    <span class="stringliteral">&quot;Could not read content of WAVELENGTH column &quot;</span>
<a name="l00661"></a>00661                    <span class="stringliteral">&quot; from BINARY table %s&quot;</span>, spectral_models_file);
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664   <span class="comment">// get the column number for the flux</span>
<a name="l00665"></a>00665   fits_get_colnum (s_models, CASEINSEN, <span class="stringliteral">&quot;FLUX&quot;</span>, &amp;colnum2, &amp;f_status);
<a name="l00666"></a>00666   <span class="keywordflow">if</span> (f_status)
<a name="l00667"></a>00667     {
<a name="l00668"></a>00668       ffrprt (stderr, f_status);
<a name="l00669"></a>00669       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00670"></a>00670                    <span class="stringliteral">&quot;create_interp_ftable: &quot;</span>
<a name="l00671"></a>00671                    <span class="stringliteral">&quot;Could not determine column %s in &quot;</span>
<a name="l00672"></a>00672                    <span class="stringliteral">&quot; table %s&quot;</span>, <span class="stringliteral">&quot;FLUX&quot;</span>, spectral_models_file);
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674   <span class="comment">// read the flux column </span>
<a name="l00675"></a>00675   fits_read_col (s_models, TDOUBLE, colnum2, 1, 1, nrows, NULL, sed_flux,
<a name="l00676"></a>00676                     &amp;anynul, &amp;f_status);
<a name="l00677"></a>00677   <span class="keywordflow">if</span> (f_status)
<a name="l00678"></a>00678     {
<a name="l00679"></a>00679       ffrprt (stderr, f_status);
<a name="l00680"></a>00680       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00681"></a>00681                    <span class="stringliteral">&quot;load_SED_from_fitsext: &quot;</span>
<a name="l00682"></a>00682                    <span class="stringliteral">&quot;Could not read content of FLUX column &quot;</span>
<a name="l00683"></a>00683                    <span class="stringliteral">&quot; from BINARY table %s&quot;</span>, spectral_models_file);
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">// transfer the vector and length information</span>
<a name="l00687"></a>00687   <span class="comment">// to the SED object</span>
<a name="l00688"></a>00688   sed-&gt;<a class="code" href="structenergy__distrib.html#ae5e24fde4a41b46a8b8510118f646e67">npoints</a>    = nrows;
<a name="l00689"></a>00689   sed-&gt;<a class="code" href="structenergy__distrib.html#ac32d12647e9ef7f158b0d4532c09a568">wavelength</a> = sed_wavs ;
<a name="l00690"></a>00690   sed-&gt;<a class="code" href="structenergy__distrib.html#a7da8059a7bb2f8af463b6ee1dd1e6554">flux</a>       = sed_flux;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <span class="comment">// allocate some structures for the interpolator</span>
<a name="l00693"></a>00693   sed-&gt;<a class="code" href="structenergy__distrib.html#a3d90efb6bd5ace3c19884613063644af">interp</a>     = gsl_interp_alloc (<a class="code" href="specmodel__utils_8h.html#a00b4bcd06b2bd05ba6cfe10a4824fdd8">SMODEL_INTERP_TYPE</a>, (<span class="keywordtype">size_t</span>)sed-&gt;<a class="code" href="structenergy__distrib.html#ae5e24fde4a41b46a8b8510118f646e67">npoints</a> );
<a name="l00694"></a>00694   sed-&gt;<a class="code" href="structenergy__distrib.html#a7d0d556a145bd34158514bdbab57b0ee">accel</a>      = gsl_interp_accel_alloc ();
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <span class="comment">// initialize the iterpolator</span>
<a name="l00697"></a>00697   gsl_interp_init (sed-&gt;<a class="code" href="structenergy__distrib.html#a3d90efb6bd5ace3c19884613063644af">interp</a>, sed-&gt;<a class="code" href="structenergy__distrib.html#ac32d12647e9ef7f158b0d4532c09a568">wavelength</a>, sed-&gt;<a class="code" href="structenergy__distrib.html#a7da8059a7bb2f8af463b6ee1dd1e6554">flux</a>, (<span class="keywordtype">size_t</span>)sed-&gt;<a class="code" href="structenergy__distrib.html#ae5e24fde4a41b46a8b8510118f646e67">npoints</a>);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="comment">// return the energy distribution</span>
<a name="l00700"></a>00700   <span class="keywordflow">return</span> sed;
<a name="l00701"></a>00701 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af32683a60bb4033ebb23eff38ca207fb"></a><!-- doxytag: member="specmodel_utils.c::load_SED_list" ref="af32683a60bb4033ebb23eff38ca207fb" args="(const char spectral_models_file[], const int n_models)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structenergy__distrib.html">energy_distrib</a>** load_SED_list </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>spectral_models_file</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>n_models</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_SED_list The function creates a list of energy distributions from data stored in several extensions of a fits file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spectral_models_file</em>&nbsp;</td><td>- pathname to the spectral models file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>n_models</em>&nbsp;</td><td>- the number of spectral models in the file</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>SEDlist - the list of energy distributions </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00552"></a>00552 {
<a name="l00553"></a>00553   <span class="keywordtype">int</span> i;
<a name="l00554"></a>00554   <span class="keywordtype">int</span> f_status=0;
<a name="l00555"></a>00555   <span class="keywordtype">int</span> hdutype;
<a name="l00556"></a>00556   <a class="code" href="structenergy__distrib.html">energy_distrib</a> **SEDlist;
<a name="l00557"></a>00557   fitsfile *s_models;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <span class="comment">// allocate space for the SED list</span>
<a name="l00560"></a>00560   SEDlist = (<a class="code" href="structenergy__distrib.html">energy_distrib</a> **)malloc(n_models * <span class="keyword">sizeof</span>(<a class="code" href="structenergy__distrib.html">energy_distrib</a> *));
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="comment">// open the fits file</span>
<a name="l00563"></a>00563   <span class="comment">// report any error</span>
<a name="l00564"></a>00564   fits_open_file (&amp;s_models, spectral_models_file, READONLY, &amp;f_status);
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (f_status)
<a name="l00566"></a>00566     {
<a name="l00567"></a>00567       ffrprt (stderr, f_status);
<a name="l00568"></a>00568       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00569"></a>00569                    <span class="stringliteral">&quot;aXe_PETCONT: &quot;</span> <span class="stringliteral">&quot;Could not open file: %s&quot;</span>,
<a name="l00570"></a>00570                    spectral_models_file);
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572   
<a name="l00573"></a>00573   <span class="comment">// go over all extensions</span>
<a name="l00574"></a>00574   <span class="keywordflow">for</span> (i=0; i &lt; n_models; i++)
<a name="l00575"></a>00575     {
<a name="l00576"></a>00576       <span class="comment">// move to the right extension</span>
<a name="l00577"></a>00577       fits_movabs_hdu (s_models, i+2, &amp;hdutype, &amp;f_status);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579       <span class="comment">// load the energy distribution</span>
<a name="l00580"></a>00580       SEDlist[i] = <a class="code" href="specmodel__utils_8c.html#a5abd5876b6dbdab673e829168c3767fd">load_SED_from_fitsext</a>(spectral_models_file, s_models);
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="comment">// close the fits file</span>
<a name="l00584"></a>00584   fits_close_file (s_models, &amp;f_status);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="comment">// return the SED list</span>
<a name="l00587"></a>00587   <span class="keywordflow">return</span> SEDlist;
<a name="l00588"></a>00588 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a815d1f785501fd2a9cc3f33a6a95c34d"></a><!-- doxytag: member="specmodel_utils.c::load_spectral_models" ref="a815d1f785501fd2a9cc3f33a6a95c34d" args="(const char spectral_models_file[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspectral__models.html">spectral_models</a>* load_spectral_models </td>
          <td>(</td>
          <td class="paramtype">const char&nbsp;</td>
          <td class="paramname"> <em>spectral_models_file</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: load_spectral_models The function file a spectral models structure with models extracted from a fits file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spectral_models_file</em>&nbsp;</td><td>- pathname to the spectral models file</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>smodels - the <a class="el" href="structtracedata.html">tracedata</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00450"></a>00450 {
<a name="l00451"></a>00451   <span class="keywordtype">int</span> n_models=0;
<a name="l00452"></a>00452   <a class="code" href="structspectral__models.html">spectral_models</a> *smodels;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="comment">// allocate space for the spectral models structure</span>
<a name="l00455"></a>00455   smodels = (<a class="code" href="structspectral__models.html">spectral_models</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structspectral__models.html">spectral_models</a>));
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="comment">// get the number of models</span>
<a name="l00458"></a>00458   n_models = <a class="code" href="specmodel__utils_8c.html#a9d5d7796fd3bc959d9ae8e6fda0939c8">get_num_extensions</a>(spectral_models_file);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="comment">// allocate space for the models</span>
<a name="l00461"></a>00461   <span class="comment">//smodels-&gt;SEDlist = (energy_distrib **)malloc(n_models * sizeof(energy_distrib *));</span>
<a name="l00462"></a>00462   smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a> = <a class="code" href="specmodel__utils_8c.html#af32683a60bb4033ebb23eff38ca207fb">load_SED_list</a>(spectral_models_file, n_models);
<a name="l00463"></a>00463   smodels-&gt;<a class="code" href="structspectral__models.html#a1e0a38224697819c156efc42a4988faa">n_models</a> =  n_models;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   <span class="comment">// return the structure</span>
<a name="l00466"></a>00466   <span class="keywordflow">return</span> smodels;
<a name="l00467"></a>00467 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90fff582cc9236b1457b8c9b757420a3"></a><!-- doxytag: member="specmodel_utils.c::move_in_fits" ref="a90fff582cc9236b1457b8c9b757420a3" args="(fits_access *m_access, const int targetHDU)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void move_in_fits </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfits__access.html">fits_access</a> *&nbsp;</td>
          <td class="paramname"> <em>m_access</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetHDU</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: move_in_fits Loads and returns the desired model <a class="el" href="structspectrum.html">spectrum</a> from the spectral model table. Translates from the <a class="el" href="structobject.html">object</a> index [1, n_models] to the fits table index [2, n_model+1] (taking into account the primary extension)</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>m_access</em>&nbsp;</td><td>- the model access structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>targetHDU</em>&nbsp;</td><td>- index of the target HDU</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00934"></a>00934 {
<a name="l00935"></a>00935         <span class="keywordtype">int</span> nrel;
<a name="l00936"></a>00936         <span class="keywordtype">int</span> hdutype;
<a name="l00937"></a>00937         <span class="keywordtype">int</span> f_status=0;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939         <span class="comment">// make sure the SED does exist</span>
<a name="l00940"></a>00940         <span class="keywordflow">if</span> (targetHDU &lt; 0 || targetHDU &gt;  m_access-&gt;<a class="code" href="structfits__access.html#a241260b89300c1d0fa1356f279c1319c">n_modelHDU</a>)
<a name="l00941"></a>00941                 <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00942"></a>00942                                 <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Can not move to HDU %i!&quot;</span>,
<a name="l00943"></a>00943                                 targetHDU);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945         <span class="comment">// if accessing the first time</span>
<a name="l00946"></a>00946         <span class="comment">// we go to an absolute position</span>
<a name="l00947"></a>00947         <span class="keywordflow">if</span> (m_access-&gt;<a class="code" href="structfits__access.html#a210b0f35b33c7e271b3d288d05782dbf">act_hdu</a> &lt;0){
<a name="l00948"></a>00948                 <span class="comment">// move to the absolute HDU positions</span>
<a name="l00949"></a>00949                 fits_movabs_hdu(m_access-&gt;<a class="code" href="structfits__access.html#afdf355de50df0d99e3186ad2fddcd2b6">fits_ptr</a>, targetHDU+1, &amp;hdutype, &amp;f_status);
<a name="l00950"></a>00950                 <span class="keywordflow">if</span> (f_status) {
<a name="l00951"></a>00951                         ffrprt (stderr, f_status);
<a name="l00952"></a>00952                         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00953"></a>00953                                         <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Could not move to HDU %d in file: %s!&quot;</span>,targetHDU+1, m_access-&gt;<a class="code" href="structfits__access.html#af606a81f066e75230aa061386ddede21">fits_file</a>);
<a name="l00954"></a>00954                     }
<a name="l00955"></a>00955                 <span class="comment">//fprintf (stdout,&quot;In file: %s moving to HDU: %d.\n&quot;, m_access-&gt;fits_file, m_access-&gt;act_hdu);</span>
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957         <span class="comment">// move relative to the current position</span>
<a name="l00958"></a>00958         <span class="keywordflow">else</span>{
<a name="l00959"></a>00959                 <span class="comment">// compute the relative move and jump there</span>
<a name="l00960"></a>00960                 nrel=targetHDU+1-m_access-&gt;<a class="code" href="structfits__access.html#a210b0f35b33c7e271b3d288d05782dbf">act_hdu</a>;
<a name="l00961"></a>00961                 fits_movrel_hdu(m_access-&gt;<a class="code" href="structfits__access.html#afdf355de50df0d99e3186ad2fddcd2b6">fits_ptr</a>, nrel,  &amp;hdutype, &amp;f_status);
<a name="l00962"></a>00962                 <span class="keywordflow">if</span> (f_status) {
<a name="l00963"></a>00963                         ffrprt (stderr, f_status);
<a name="l00964"></a>00964                         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00965"></a>00965                                         <span class="stringliteral">&quot;aXe_DISPIMAGE: &quot;</span> <span class="stringliteral">&quot;Could not move %d HDU&apos;s in file: %s!&quot;</span>, nrel, m_access-&gt;<a class="code" href="structfits__access.html#af606a81f066e75230aa061386ddede21">fits_file</a>);
<a name="l00966"></a>00966                     }
<a name="l00967"></a>00967                 <span class="comment">//fprintf (stdout,&quot;In file: %s moved relative: %d.\n&quot;,m_access-&gt;fits_file, nrel);</span>
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969         <span class="comment">// update the current HDU number</span>
<a name="l00970"></a>00970         m_access-&gt;<a class="code" href="structfits__access.html#a210b0f35b33c7e271b3d288d05782dbf">act_hdu</a>=targetHDU+1;
<a name="l00971"></a>00971 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a950dcbfa64fcf4397250929956649318"></a><!-- doxytag: member="specmodel_utils.c::print_dirim_emission" ref="a950dcbfa64fcf4397250929956649318" args="(const dirim_emission *diremission)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_dirim_emission </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdirim__emission.html">dirim_emission</a> *&nbsp;</td>
          <td class="paramname"> <em>diremission</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: print_dirim_emission The function prints a direct emission <a class="el" href="structobject.html">object</a>.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>diremission</em>&nbsp;</td><td>- the direct emission model to print</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00227"></a>00227 {
<a name="l00228"></a>00228   fprintf(stdout, <span class="stringliteral">&quot;dim_x: %i, dim_y: %i\n&quot;</span>, diremission-&gt;<a class="code" href="structdirim__emission.html#a4184a616a68e4d92efee811168b9ab7e">dim_x</a>, diremission-&gt;<a class="code" href="structdirim__emission.html#a9b3ba1b1264aaae084c69f290f6343e3">dim_y</a>);
<a name="l00229"></a>00229   fprintf(stdout, <span class="stringliteral">&quot;xmean: %f, ymean: %f\n&quot;</span>, diremission-&gt;<a class="code" href="structdirim__emission.html#a57c2f8cf6dfc3ede582b40f8a63e3eec">xmean</a>, diremission-&gt;<a class="code" href="structdirim__emission.html#a95dcd0f591805409a5667874e771597e">ymean</a>);
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a226591d5386a294bc4444add1a349bb3"></a><!-- doxytag: member="specmodel_utils.c::print_object_models" ref="a226591d5386a294bc4444add1a349bb3" args="(const object_models *objmodels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_object_models </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structobject__models.html">object_models</a> *&nbsp;</td>
          <td class="paramname"> <em>objmodels</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: print_object_models The function prints a direct <a class="el" href="structobject.html">object</a> model structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>objmodels</em>&nbsp;</td><td>- the <a class="el" href="structobject.html">object</a> model structure to 'print'</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00203"></a>00203 {
<a name="l00204"></a>00204   <span class="keywordtype">int</span> i;
<a name="l00205"></a>00205   
<a name="l00206"></a>00206   <span class="comment">// go over each model</span>
<a name="l00207"></a>00207   <span class="keywordflow">for</span> (i=0; i &lt; objmodels-&gt;<a class="code" href="structobject__models.html#a5810731176663b015f18d20d29b194ee">n_models</a>; i++)
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209       <span class="comment">// print each model</span>
<a name="l00210"></a>00210       fprintf(stdout, <span class="stringliteral">&quot;Model No.: %i\n&quot;</span>, i);
<a name="l00211"></a>00211       <a class="code" href="specmodel__utils_8c.html#a950dcbfa64fcf4397250929956649318">print_dirim_emission</a>(objmodels-&gt;<a class="code" href="structobject__models.html#afdd965836e9c88e46e75d644a2f31af0">obj_list</a>[i]);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a72d7c5f0cb45632c1f130a2a60c196e0"></a><!-- doxytag: member="specmodel_utils.c::print_spectral_models" ref="a72d7c5f0cb45632c1f130a2a60c196e0" args="(const spectral_models *smodels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_spectral_models </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structspectral__models.html">spectral_models</a> *&nbsp;</td>
          <td class="paramname"> <em>smodels</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: print_spectral_models The function prints the content of a spectral models structure onto the screen</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smodels</em>&nbsp;</td><td>- the spectral models structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00523"></a>00523 {
<a name="l00524"></a>00524   <span class="keywordtype">int</span> i=0;
<a name="l00525"></a>00525   <span class="keywordtype">int</span> n=0;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <span class="keywordflow">for</span> (i=0; i &lt; smodels-&gt;<a class="code" href="structspectral__models.html#a1e0a38224697819c156efc42a4988faa">n_models</a>; i++)
<a name="l00528"></a>00528     {
<a name="l00529"></a>00529       <span class="comment">// print the model number</span>
<a name="l00530"></a>00530       fprintf(stdout,<span class="stringliteral">&quot;Model number: %i\n&quot;</span>, i);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       <span class="comment">// print the model data</span>
<a name="l00533"></a>00533       <span class="keywordflow">for</span> (n=0; n &lt; smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[i]-&gt;<a class="code" href="structenergy__distrib.html#ae5e24fde4a41b46a8b8510118f646e67">npoints</a>; n++)
<a name="l00534"></a>00534         fprintf(stdout,<span class="stringliteral">&quot;%i Wavelength: %e, Flux: %e\n&quot;</span>, n, smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[i]-&gt;<a class="code" href="structenergy__distrib.html#ac32d12647e9ef7f158b0d4532c09a568">wavelength</a>[n], smodels-&gt;<a class="code" href="structspectral__models.html#a72c9e572d91921b9deb60470a0b31161">SEDlist</a>[i]-&gt;<a class="code" href="structenergy__distrib.html#a7da8059a7bb2f8af463b6ee1dd1e6554">flux</a>[n]);
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
