<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TIPS: /renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_spc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/renoir/fourmano/Desktop/OUSIM/TIPS/branches/tips_build/include/axesim/spc_spc.h File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="aXe__grism_8h_source.html">aXe_grism.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="aXe__utils_8h_source.html">aXe_utils.h</a>&quot;</code><br/>
<code>#include &lt;fitsio.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_nan.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_sys.h&gt;</code><br/>

<p><a href="spc__spc_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacespc__spc.html">spc_spc</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#af61a1a0b448a3583ed18f5a34076b974">SPCTOL</a>&nbsp;&nbsp;&nbsp;1.0e-5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a7501ed6347cdbad890d6a0f2fc9a92ea">RESP_FUNC_INTERP_TYPE</a>&nbsp;&nbsp;&nbsp;gsl_interp_linear</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a2b7693a22a9e1b6d287465b8bff189de">allocate_spectrum</a> (const int numbin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a5be6cea9695b1d36f979acac98009ff3">free_spectrum</a> (<a class="el" href="structspectrum.html">spectrum</a> *const spec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#acae5c3e717ae1e9e19c97e6a688efae5">fprintf_spectrum</a> (FILE *output, const <a class="el" href="structspectrum.html">spectrum</a> *const sp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a9792a9c98d3cfae195b45055127a7af7">subtract_spectra</a> (<a class="el" href="structspectrum.html">spectrum</a> *a, <a class="el" href="structspectrum.html">spectrum</a> *b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#abb978bc00496ea18cc7590c587133887">get_ID_index_to_SPC</a> (char filename[], char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#ab5f7914ef2b01f1f93a2f8ac400eeb7a">add_ID_index_to_SPC</a> (char filename[], char ID[], int hdunum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#ad938fc5086cc4fa9525e78360ad965af">add_ID_to_SPC</a> (char filename[], int N, char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#aa9de3dbaee823cf4223edf572b5d95ae">find_ID_in_SPC</a> (char filename[], char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a04113a68250979dcf9b17544cf8edb33">create_SPC</a> (char filename[], int overwrite)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (fitsfile *input, char colname[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#afa47cc3a687d35d546ceec87d0f14f06">add_spectra_to_SPC</a> (char filename[], <a class="el" href="structspectrum.html">spectrum</a> *obj_spec, <a class="el" href="structspectrum.html">spectrum</a> *bck_spec, <a class="el" href="structspectrum.html">spectrum</a> *sobj_spec, int aperID, int beamID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#af79a706e87b64ac8e177b70798e3b57e">add_data_to_SPC</a> (<a class="el" href="structspectrum.html">spectrum</a> *spec, char countcolname[], char errorcolname[], char weightcolname[], char ID[], char filename[], int hdunum, long N)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a3b09e9e958c00c75f26933bac7d0ffe8">trim_spectrum</a> (<a class="el" href="structspectrum.html">spectrum</a> *spc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#ad92b28f006b157c32fd16f9cdb7b2c82">empty_counts_spectrum_copy</a> (<a class="el" href="structspectrum.html">spectrum</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a5985d31d3be091b7b8e151f940914392">add_ID_to_SPC_opened</a> (fitsfile *output, int N, char ID[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#ad5f7a3bb4b3128c780fbf22b97dfda64">add_spectra_to_SPC_opened</a> (fitsfile *input, <a class="el" href="structspectrum.html">spectrum</a> *obj_spec, <a class="el" href="structspectrum.html">spectrum</a> *bck_spec, <a class="el" href="structspectrum.html">spectrum</a> *sobj_spec, int aperID, int beamID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a0d937250aad5dea3bcebe04d66bbfa90">add_data_to_SPC_opened</a> (<a class="el" href="structspectrum.html">spectrum</a> *spec, char countcolname[], char errorcolname[], char weightcolname[], char ID[], fitsfile *input, long N)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">fitsfile *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spc__spc_8h.html#a2d1c885838e3b2bd9f1fdb2f62cbceae">create_SPC_opened</a> (char filename[], int overwrite)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a7501ed6347cdbad890d6a0f2fc9a92ea"></a><!-- doxytag: member="spc_spc.h::RESP_FUNC_INTERP_TYPE" ref="a7501ed6347cdbad890d6a0f2fc9a92ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESP_FUNC_INTERP_TYPE&nbsp;&nbsp;&nbsp;gsl_interp_linear</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af61a1a0b448a3583ed18f5a34076b974"></a><!-- doxytag: member="spc_spc.h::SPCTOL" ref="af61a1a0b448a3583ed18f5a34076b974" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPCTOL&nbsp;&nbsp;&nbsp;1.0e-5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af79a706e87b64ac8e177b70798e3b57e"></a><!-- doxytag: member="spc_spc.h::add_data_to_SPC" ref="af79a706e87b64ac8e177b70798e3b57e" args="(spectrum *spec, char countcolname[], char errorcolname[], char weightcolname[], char ID[], char filename[], int hdunum, long N)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_data_to_SPC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>countcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>errorcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>weightcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>N</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_data_to_SPC Function to add a specific <a class="el" href="structspectrum.html">spectrum</a> structure into specifically named columns of an existing SPC FITS file. If a column name is set to NULL then that particular data column is not written to the file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spec</em>&nbsp;</td><td>- a pointer to an existing <a class="el" href="structspectrum.html">spectrum</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>coutncolname</em>&nbsp;</td><td>- the name of the column to write spec.counts into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>errorcolname</em>&nbsp;</td><td>- the name of the column to write spec.errors into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>weightcolname</em>&nbsp;</td><td>- the name of the column to write spec.weights into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>- the aperture/beam ID of this <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- the name of an existing SPC FITS table </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>- the number of the extension in the SPC FITS file to write the data to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>N</em>&nbsp;</td><td>- the number of elements of the <a class="el" href="structspectrum.html">spectrum</a> to write to the table </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00948"></a>00948 {
<a name="l00949"></a>00949   fitsfile *input;
<a name="l00950"></a>00950   <span class="keywordtype">int</span> f_status = 0, hdutype;
<a name="l00951"></a>00951   <span class="keywordtype">int</span> colnum;
<a name="l00952"></a>00952   <span class="keywordtype">char</span> colname[FLEN_KEYWORD];
<a name="l00953"></a>00953   <span class="keywordtype">int</span> index = -1;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   <span class="comment">//#define DEBUGSPC</span>
<a name="l00956"></a>00956   <span class="comment">//  Open the file for creating/appending</span>
<a name="l00957"></a>00957   fits_open_file (&amp;input, filename, READWRITE, &amp;f_status);
<a name="l00958"></a>00958   <span class="keywordflow">if</span> (f_status)
<a name="l00959"></a>00959     {
<a name="l00960"></a>00960       ffrprt (stderr, f_status);
<a name="l00961"></a>00961       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00962"></a>00962                    <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span> <span class="stringliteral">&quot;Could not open file:&quot;</span>,
<a name="l00963"></a>00963                    filename);
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965   fits_movabs_hdu (input, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00966"></a>00966   <span class="keywordflow">if</span> (f_status)
<a name="l00967"></a>00967     {
<a name="l00968"></a>00968       ffrprt (stderr, f_status);
<a name="l00969"></a>00969       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00970"></a>00970                    <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l00971"></a>00971                    <span class="stringliteral">&quot;Could not read extention %d from file: %s&quot;</span>, hdunum,
<a name="l00972"></a>00972                    filename);
<a name="l00973"></a>00973     }
<a name="l00974"></a>00974   <span class="keywordflow">if</span> (hdutype != 2)
<a name="l00975"></a>00975     {
<a name="l00976"></a>00976       ffrprt (stderr, f_status);
<a name="l00977"></a>00977       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00978"></a>00978                    <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l00979"></a>00979                    <span class="stringliteral">&quot;Extension %i of %s is not a BINARY table&quot;</span>, hdunum,
<a name="l00980"></a>00980                    filename);
<a name="l00981"></a>00981     }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="comment">/* Row number containing the desired ID */</span>
<a name="l00984"></a>00984   index = 1;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="comment">/* If there are no elements in the table to write then exit now */</span>
<a name="l00987"></a>00987   <span class="keywordflow">if</span> (N==0) {
<a name="l00988"></a>00988     fits_close_file (input, &amp;f_status);
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (f_status)
<a name="l00990"></a>00990       {
<a name="l00991"></a>00991         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00992"></a>00992                      <span class="stringliteral">&quot;Error closing file: %s &quot;</span>, filename);
<a name="l00993"></a>00993       }
<a name="l00994"></a>00994     <span class="keywordflow">return</span>;      
<a name="l00995"></a>00995   }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997   <span class="comment">/* Writing count, error, weight, lambda, contam, dq */</span>
<a name="l00998"></a>00998   {
<a name="l00999"></a>00999     <span class="keywordtype">double</span> *array_error, *array_count, *array_weight, *array_lambda;
<a name="l01000"></a>01000     <span class="keywordtype">double</span> *array_flux, *array_ferror, *array_contam;
<a name="l01001"></a>01001     <span class="keywordtype">int</span> *array_dq;
<a name="l01002"></a>01002     <span class="keywordtype">int</span> i;
<a name="l01003"></a>01003     <a class="code" href="structspc__entry.html">spc_entry</a> *pt = NULL;
<a name="l01004"></a>01004     
<a name="l01005"></a>01005     array_error = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01006"></a>01006     <span class="keywordflow">if</span> (array_error == NULL)
<a name="l01007"></a>01007       {
<a name="l01008"></a>01008         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01009"></a>01009                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011     array_count = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01012"></a>01012     <span class="keywordflow">if</span> (array_count == NULL)
<a name="l01013"></a>01013       {
<a name="l01014"></a>01014         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01015"></a>01015                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01016"></a>01016       }
<a name="l01017"></a>01017     array_weight = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01018"></a>01018     <span class="keywordflow">if</span> (array_weight == NULL)
<a name="l01019"></a>01019       {
<a name="l01020"></a>01020         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01021"></a>01021                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01022"></a>01022       }
<a name="l01023"></a>01023     array_lambda = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01024"></a>01024     <span class="keywordflow">if</span> (array_lambda == NULL)
<a name="l01025"></a>01025       {
<a name="l01026"></a>01026         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01027"></a>01027                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01028"></a>01028       }
<a name="l01029"></a>01029     array_flux = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01030"></a>01030     <span class="keywordflow">if</span> (array_flux == NULL)
<a name="l01031"></a>01031       {
<a name="l01032"></a>01032         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01033"></a>01033                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01034"></a>01034       }
<a name="l01035"></a>01035     array_ferror = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (array_ferror == NULL)
<a name="l01037"></a>01037       {
<a name="l01038"></a>01038         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01039"></a>01039                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01040"></a>01040       }
<a name="l01041"></a>01041     array_contam = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (array_contam == NULL)
<a name="l01043"></a>01043       {
<a name="l01044"></a>01044         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01045"></a>01045                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01046"></a>01046       }
<a name="l01047"></a>01047     array_dq = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>));
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (array_dq == NULL)
<a name="l01049"></a>01049       {
<a name="l01050"></a>01050         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01051"></a>01051                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01052"></a>01052       }
<a name="l01053"></a>01053     <span class="keywordflow">if</span> (spec != NULL)
<a name="l01054"></a>01054       pt = spec-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>;
<a name="l01055"></a>01055     <span class="keywordflow">for</span> (i = 0; i &lt; N; i++)
<a name="l01056"></a>01056       {
<a name="l01057"></a>01057         <span class="keywordflow">if</span> (spec != NULL)
<a name="l01058"></a>01058           {
<a name="l01059"></a>01059             array_lambda[i] = pt-&gt;<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l01060"></a>01060             array_count[i] = pt-&gt;<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>;
<a name="l01061"></a>01061             array_error[i] = pt-&gt;<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>;
<a name="l01062"></a>01062             array_weight[i] = pt-&gt;<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>;
<a name="l01063"></a>01063             array_flux[i] = pt-&gt;<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a>;
<a name="l01064"></a>01064             array_ferror[i] = pt-&gt;<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a>;
<a name="l01065"></a>01065             array_contam[i] = pt-&gt;<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a>;
<a name="l01066"></a>01066             array_dq[i] = pt-&gt;<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a>;
<a name="l01067"></a>01067           }
<a name="l01068"></a>01068         <span class="keywordflow">else</span>
<a name="l01069"></a>01069           {
<a name="l01070"></a>01070             array_lambda[i] = GSL_NAN;
<a name="l01071"></a>01071             array_count[i] = GSL_NAN;
<a name="l01072"></a>01072             array_error[i] = GSL_NAN;
<a name="l01073"></a>01073             array_weight[i] = GSL_NAN;
<a name="l01074"></a>01074             array_flux[i] = GSL_NAN;
<a name="l01075"></a>01075             array_ferror[i] = GSL_NAN;
<a name="l01076"></a>01076             array_contam[i] = -1.0;
<a name="l01077"></a>01077             array_dq[i] = 0;
<a name="l01078"></a>01078           }
<a name="l01079"></a>01079         pt++;
<a name="l01080"></a>01080       }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;LAMBDA&quot;</span>);
<a name="l01083"></a>01083     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_lambda,
<a name="l01084"></a>01084                     &amp;f_status);
<a name="l01085"></a>01085     <span class="keywordflow">if</span> (f_status)
<a name="l01086"></a>01086       {
<a name="l01087"></a>01087         ffrprt (stderr, f_status);
<a name="l01088"></a>01088         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01089"></a>01089                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01090"></a>01090                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file %s &quot;</span>,
<a name="l01091"></a>01091                      index, <span class="stringliteral">&quot;LAMBDA&quot;</span>, colnum, filename);
<a name="l01092"></a>01092       }
<a name="l01093"></a>01093     
<a name="l01094"></a>01094     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;FLUX&quot;</span>);
<a name="l01095"></a>01095     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_flux,
<a name="l01096"></a>01096                     &amp;f_status);
<a name="l01097"></a>01097     <span class="keywordflow">if</span> (f_status)
<a name="l01098"></a>01098       {
<a name="l01099"></a>01099         ffrprt (stderr, f_status);
<a name="l01100"></a>01100         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01101"></a>01101                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01102"></a>01102                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file %s &quot;</span>,
<a name="l01103"></a>01103                      index, <span class="stringliteral">&quot;FLUX&quot;</span>, colnum, filename);
<a name="l01104"></a>01104       }
<a name="l01105"></a>01105     
<a name="l01106"></a>01106     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;FERROR&quot;</span>);
<a name="l01107"></a>01107     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_ferror,
<a name="l01108"></a>01108                     &amp;f_status);
<a name="l01109"></a>01109     <span class="keywordflow">if</span> (f_status)
<a name="l01110"></a>01110       {
<a name="l01111"></a>01111         ffrprt (stderr, f_status);
<a name="l01112"></a>01112         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01113"></a>01113                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01114"></a>01114                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file %s &quot;</span>,
<a name="l01115"></a>01115                      index, <span class="stringliteral">&quot;FERROR&quot;</span>, colnum, filename);
<a name="l01116"></a>01116       }
<a name="l01117"></a>01117     
<a name="l01118"></a>01118     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;CONTAM&quot;</span>);
<a name="l01119"></a>01119     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_contam,
<a name="l01120"></a>01120                     &amp;f_status);
<a name="l01121"></a>01121     <span class="keywordflow">if</span> (f_status)
<a name="l01122"></a>01122       {
<a name="l01123"></a>01123         ffrprt (stderr, f_status);
<a name="l01124"></a>01124         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01125"></a>01125                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01126"></a>01126                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file %s &quot;</span>,
<a name="l01127"></a>01127                      index, <span class="stringliteral">&quot;CONTAM&quot;</span>, colnum, filename);
<a name="l01128"></a>01128       }
<a name="l01129"></a>01129     
<a name="l01130"></a>01130     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;DQ&quot;</span>);
<a name="l01131"></a>01131     fits_write_col (input, TINT, colnum, index, 1, N, array_dq,
<a name="l01132"></a>01132                     &amp;f_status);
<a name="l01133"></a>01133     <span class="keywordflow">if</span> (f_status)
<a name="l01134"></a>01134       {
<a name="l01135"></a>01135         ffrprt (stderr, f_status);
<a name="l01136"></a>01136         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01137"></a>01137                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01138"></a>01138                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file %s &quot;</span>,
<a name="l01139"></a>01139                      index, <span class="stringliteral">&quot;DQ&quot;</span>, colnum, filename);
<a name="l01140"></a>01140       }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="comment">/* Write the spec.counts data if the name of the column is defined */</span>
<a name="l01143"></a>01143     <span class="keywordflow">if</span> (countcolname != NULL)
<a name="l01144"></a>01144       {
<a name="l01145"></a>01145         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, countcolname);
<a name="l01146"></a>01146         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01147"></a>01147                         array_count, &amp;f_status);
<a name="l01148"></a>01148         <span class="keywordflow">if</span> (f_status)
<a name="l01149"></a>01149           {
<a name="l01150"></a>01150             ffrprt (stderr, f_status);
<a name="l01151"></a>01151             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01152"></a>01152                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01153"></a>01153                          <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in file&quot;</span>
<a name="l01154"></a>01154                          <span class="stringliteral">&quot; %s &quot;</span>, index, countcolname, colnum,
<a name="l01155"></a>01155                          filename);
<a name="l01156"></a>01156           }
<a name="l01157"></a>01157       }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="comment">/* Write the spec.errors data if the name of the column is defined */</span>
<a name="l01160"></a>01160     <span class="keywordflow">if</span> (errorcolname != NULL)
<a name="l01161"></a>01161       {
<a name="l01162"></a>01162         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, errorcolname);
<a name="l01163"></a>01163         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01164"></a>01164                         array_error, &amp;f_status);
<a name="l01165"></a>01165         <span class="keywordflow">if</span> (f_status)
<a name="l01166"></a>01166           {
<a name="l01167"></a>01167             ffrprt (stderr, f_status);
<a name="l01168"></a>01168             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01169"></a>01169                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01170"></a>01170                          <span class="stringliteral">&quot;Could not write %s to row %d, collumn %s (%d) in file&quot;</span>
<a name="l01171"></a>01171                          <span class="stringliteral">&quot; %s &quot;</span>, errorcolname, index, colname,
<a name="l01172"></a>01172                          colnum, filename);
<a name="l01173"></a>01173           }
<a name="l01174"></a>01174       }
<a name="l01175"></a>01175     
<a name="l01176"></a>01176     <span class="comment">/* Write the spec.weights data if the name of the column is defined */</span>
<a name="l01177"></a>01177     <span class="keywordflow">if</span> (weightcolname != NULL)
<a name="l01178"></a>01178       {
<a name="l01179"></a>01179         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, weightcolname);
<a name="l01180"></a>01180         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01181"></a>01181                         array_weight, &amp;f_status);
<a name="l01182"></a>01182         <span class="keywordflow">if</span> (f_status)
<a name="l01183"></a>01183           {
<a name="l01184"></a>01184             ffrprt (stderr, f_status);
<a name="l01185"></a>01185             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01186"></a>01186                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01187"></a>01187                          <span class="stringliteral">&quot;Could not write %s to row %d, collumn %s (%d) in file&quot;</span>
<a name="l01188"></a>01188                          <span class="stringliteral">&quot; %s &quot;</span>, weightcolname, index, colname,
<a name="l01189"></a>01189                          colnum, filename);
<a name="l01190"></a>01190           }
<a name="l01191"></a>01191       }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     free (array_count);
<a name="l01195"></a>01195     array_count = NULL;
<a name="l01196"></a>01196     free (array_error);
<a name="l01197"></a>01197     array_error = NULL;
<a name="l01198"></a>01198     free (array_weight);
<a name="l01199"></a>01199     array_weight = NULL;
<a name="l01200"></a>01200     free (array_lambda);
<a name="l01201"></a>01201     array_lambda = NULL;
<a name="l01202"></a>01202     free (array_flux);
<a name="l01203"></a>01203     array_flux = NULL;
<a name="l01204"></a>01204     free (array_ferror);
<a name="l01205"></a>01205     array_ferror = NULL;
<a name="l01206"></a>01206     free (array_contam);
<a name="l01207"></a>01207     array_contam = NULL;
<a name="l01208"></a>01208     free (array_dq);
<a name="l01209"></a>01209     array_dq = NULL;
<a name="l01210"></a>01210      }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   fits_close_file (input, &amp;f_status);
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (f_status)
<a name="l01214"></a>01214     {
<a name="l01215"></a>01215       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01216"></a>01216                    <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span> <span class="stringliteral">&quot;Error closing file: %s &quot;</span>,
<a name="l01217"></a>01217                    filename);
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d937250aad5dea3bcebe04d66bbfa90"></a><!-- doxytag: member="spc_spc.h::add_data_to_SPC_opened" ref="a0d937250aad5dea3bcebe04d66bbfa90" args="(spectrum *spec, char countcolname[], char errorcolname[], char weightcolname[], char ID[], fitsfile *input, long N)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_data_to_SPC_opened </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>countcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>errorcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>weightcolname</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>N</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_data_to_SPC_opened Function to add a specific <a class="el" href="structspectrum.html">spectrum</a> structure into specifically named columns of an existing opened SPC FITS file. If a column name is set to NULL then that particular data column is not written to the file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spec</em>&nbsp;</td><td>- a pointer to an existing <a class="el" href="structspectrum.html">spectrum</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>coutncolname</em>&nbsp;</td><td>- the name of the column to write spec.counts into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>errorcolname</em>&nbsp;</td><td>- the name of the column to write spec.errors into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>weightcolname</em>&nbsp;</td><td>- the name of the column to write spec.weights into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>- the aperture/beam ID of this <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>input</em>&nbsp;</td><td>- a pointer to an opened FITS file and HDU </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>N</em>&nbsp;</td><td>- the number of elements of the <a class="el" href="structspectrum.html">spectrum</a> to write to the table </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l01310"></a>01310 {
<a name="l01311"></a>01311   <span class="keywordtype">int</span> f_status = 0;
<a name="l01312"></a>01312   <span class="keywordtype">int</span> colnum;
<a name="l01313"></a>01313   <span class="keywordtype">char</span> colname[FLEN_KEYWORD];
<a name="l01314"></a>01314   <span class="keywordtype">int</span> index = -1;
<a name="l01315"></a>01315   
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="comment">/* Row number containing the desired ID */</span>
<a name="l01318"></a>01318   index = 1;
<a name="l01319"></a>01319   
<a name="l01320"></a>01320   <span class="comment">/* If there are no elements in the table to write then exit now */</span>
<a name="l01321"></a>01321   <span class="keywordflow">if</span> (N==0)  <span class="keywordflow">return</span>;     
<a name="l01322"></a>01322   
<a name="l01323"></a>01323   <span class="comment">/* Writing count, error, weight, lambda */</span>
<a name="l01324"></a>01324   {
<a name="l01325"></a>01325     <span class="keywordtype">double</span> *array_error, *array_count, *array_weight, *array_lambda;
<a name="l01326"></a>01326     <span class="keywordtype">double</span> *array_flux, *array_ferror, *array_contam, *array_dlambda;
<a name="l01327"></a>01327     <span class="keywordtype">int</span> *array_dq;
<a name="l01328"></a>01328     <span class="keywordtype">int</span> i;
<a name="l01329"></a>01329     <a class="code" href="structspc__entry.html">spc_entry</a> *pt = NULL;
<a name="l01330"></a>01330     
<a name="l01331"></a>01331     array_error = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01332"></a>01332     <span class="keywordflow">if</span> (array_error == NULL)
<a name="l01333"></a>01333       {
<a name="l01334"></a>01334         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01335"></a>01335                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01336"></a>01336       }
<a name="l01337"></a>01337     array_count = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01338"></a>01338     <span class="keywordflow">if</span> (array_count == NULL)
<a name="l01339"></a>01339       {
<a name="l01340"></a>01340         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01341"></a>01341                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01342"></a>01342       }
<a name="l01343"></a>01343     array_weight = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01344"></a>01344     <span class="keywordflow">if</span> (array_weight == NULL)
<a name="l01345"></a>01345       {
<a name="l01346"></a>01346         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01347"></a>01347                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01348"></a>01348       }
<a name="l01349"></a>01349     array_lambda = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01350"></a>01350     <span class="keywordflow">if</span> (array_lambda == NULL)
<a name="l01351"></a>01351       {
<a name="l01352"></a>01352         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01353"></a>01353                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01354"></a>01354       }
<a name="l01355"></a>01355     array_flux = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01356"></a>01356     <span class="keywordflow">if</span> (array_flux == NULL)
<a name="l01357"></a>01357       {
<a name="l01358"></a>01358         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01359"></a>01359                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01360"></a>01360       }
<a name="l01361"></a>01361     array_ferror = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01362"></a>01362     <span class="keywordflow">if</span> (array_ferror == NULL)
<a name="l01363"></a>01363       {
<a name="l01364"></a>01364         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01365"></a>01365                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01366"></a>01366       }
<a name="l01367"></a>01367     array_contam = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01368"></a>01368     <span class="keywordflow">if</span> (array_contam == NULL)
<a name="l01369"></a>01369       {
<a name="l01370"></a>01370         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01371"></a>01371                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01372"></a>01372       }
<a name="l01373"></a>01373     array_dlambda = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">double</span>));
<a name="l01374"></a>01374     <span class="keywordflow">if</span> (array_dlambda == NULL)
<a name="l01375"></a>01375       {
<a name="l01376"></a>01376         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01377"></a>01377                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01378"></a>01378       }
<a name="l01379"></a>01379     array_dq = malloc (N * <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>));
<a name="l01380"></a>01380     <span class="keywordflow">if</span> (array_dq == NULL)
<a name="l01381"></a>01381       {
<a name="l01382"></a>01382         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01383"></a>01383                      <span class="stringliteral">&quot;add_data_to_SPC: Out of memory&quot;</span>);
<a name="l01384"></a>01384       }
<a name="l01385"></a>01385     
<a name="l01386"></a>01386     <span class="keywordflow">if</span> (spec != NULL)
<a name="l01387"></a>01387       pt = spec-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>;
<a name="l01388"></a>01388     <span class="keywordflow">for</span> (i = 0; i &lt; N; i++)
<a name="l01389"></a>01389       {
<a name="l01390"></a>01390         <span class="keywordflow">if</span> (spec != NULL)
<a name="l01391"></a>01391           {
<a name="l01392"></a>01392             array_lambda[i] = pt-&gt;<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l01393"></a>01393             array_count[i] = pt-&gt;<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>;
<a name="l01394"></a>01394             array_error[i] = pt-&gt;<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>;
<a name="l01395"></a>01395             array_weight[i] = pt-&gt;<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>;
<a name="l01396"></a>01396             array_flux[i] = pt-&gt;<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a>;
<a name="l01397"></a>01397             array_ferror[i] = pt-&gt;<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a>;
<a name="l01398"></a>01398             array_contam[i] = pt-&gt;<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a>;
<a name="l01399"></a>01399             array_dlambda[i] = pt-&gt;<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a>;
<a name="l01400"></a>01400             array_dq[i] = (int) pt-&gt;<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a>;
<a name="l01401"></a>01401           }
<a name="l01402"></a>01402         <span class="keywordflow">else</span>
<a name="l01403"></a>01403           {
<a name="l01404"></a>01404             array_lambda[i] = GSL_NAN;
<a name="l01405"></a>01405             array_count[i] = GSL_NAN;
<a name="l01406"></a>01406             array_error[i] = GSL_NAN;
<a name="l01407"></a>01407             array_weight[i] = GSL_NAN;
<a name="l01408"></a>01408             array_flux[i] = GSL_NAN;
<a name="l01409"></a>01409             array_ferror[i] = GSL_NAN;
<a name="l01410"></a>01410             array_contam[i] = -1.0;
<a name="l01411"></a>01411             array_dlambda[i] = GSL_NAN;
<a name="l01412"></a>01412             array_dq[i] = (int) 0;
<a name="l01413"></a>01413           }
<a name="l01414"></a>01414         
<a name="l01415"></a>01415         pt++;
<a name="l01416"></a>01416       }
<a name="l01417"></a>01417     
<a name="l01418"></a>01418     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;LAMBDA&quot;</span>);
<a name="l01419"></a>01419     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_lambda,
<a name="l01420"></a>01420                     &amp;f_status);
<a name="l01421"></a>01421     <span class="keywordflow">if</span> (f_status)
<a name="l01422"></a>01422       {
<a name="l01423"></a>01423         ffrprt (stderr, f_status);
<a name="l01424"></a>01424         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01425"></a>01425                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01426"></a>01426                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01427"></a>01427                      index, <span class="stringliteral">&quot;LAMBDA&quot;</span>, colnum);
<a name="l01428"></a>01428       }
<a name="l01429"></a>01429        
<a name="l01430"></a>01430     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;FLUX&quot;</span>);
<a name="l01431"></a>01431     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_flux,
<a name="l01432"></a>01432                     &amp;f_status);
<a name="l01433"></a>01433     <span class="keywordflow">if</span> (f_status)
<a name="l01434"></a>01434       {
<a name="l01435"></a>01435         ffrprt (stderr, f_status);
<a name="l01436"></a>01436         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01437"></a>01437                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01438"></a>01438                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01439"></a>01439                      index, <span class="stringliteral">&quot;FLUX&quot;</span>, colnum);
<a name="l01440"></a>01440       }
<a name="l01441"></a>01441        
<a name="l01442"></a>01442     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;FERROR&quot;</span>);
<a name="l01443"></a>01443     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_ferror,
<a name="l01444"></a>01444                     &amp;f_status);
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (f_status)
<a name="l01446"></a>01446       {
<a name="l01447"></a>01447         ffrprt (stderr, f_status);
<a name="l01448"></a>01448         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01449"></a>01449                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01450"></a>01450                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01451"></a>01451                      index, <span class="stringliteral">&quot;FERROR&quot;</span>, colnum);
<a name="l01452"></a>01452       }
<a name="l01453"></a>01453     
<a name="l01454"></a>01454     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;CONTAM&quot;</span>);
<a name="l01455"></a>01455     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_contam,
<a name="l01456"></a>01456                     &amp;f_status);
<a name="l01457"></a>01457     <span class="keywordflow">if</span> (f_status)
<a name="l01458"></a>01458       {
<a name="l01459"></a>01459         ffrprt (stderr, f_status);
<a name="l01460"></a>01460         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01461"></a>01461                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01462"></a>01462                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01463"></a>01463                      index, <span class="stringliteral">&quot;CONTAM&quot;</span>, colnum);
<a name="l01464"></a>01464       }
<a name="l01465"></a>01465        
<a name="l01466"></a>01466 
<a name="l01467"></a>01467     <span class="comment">// NEW for dlambda column </span>
<a name="l01468"></a>01468     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;DLAMBDA&quot;</span>);
<a name="l01469"></a>01469     fits_write_col (input, TDOUBLE, colnum, index, 1, N, array_dlambda,
<a name="l01470"></a>01470                     &amp;f_status);
<a name="l01471"></a>01471     <span class="keywordflow">if</span> (f_status)
<a name="l01472"></a>01472       {
<a name="l01473"></a>01473         ffrprt (stderr, f_status);
<a name="l01474"></a>01474         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01475"></a>01475                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01476"></a>01476                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01477"></a>01477                      index, <span class="stringliteral">&quot;DLAMBDA&quot;</span>, colnum);
<a name="l01478"></a>01478       }
<a name="l01479"></a>01479        
<a name="l01480"></a>01480     colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, <span class="stringliteral">&quot;DQ&quot;</span>);
<a name="l01481"></a>01481     fits_write_col (input, TINT, colnum, index, 1, N, array_dq,
<a name="l01482"></a>01482                     &amp;f_status);
<a name="l01483"></a>01483     <span class="keywordflow">if</span> (f_status)
<a name="l01484"></a>01484       {
<a name="l01485"></a>01485         ffrprt (stderr, f_status);
<a name="l01486"></a>01486         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01487"></a>01487                      <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01488"></a>01488                      <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file &quot;</span>,
<a name="l01489"></a>01489                      index, <span class="stringliteral">&quot;DQ&quot;</span>, colnum);
<a name="l01490"></a>01490       }
<a name="l01491"></a>01491        
<a name="l01492"></a>01492     <span class="comment">/* Write the spec.counts data if the name of the column is defined */</span>
<a name="l01493"></a>01493     <span class="keywordflow">if</span> (countcolname != NULL)
<a name="l01494"></a>01494       {
<a name="l01495"></a>01495         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, countcolname);
<a name="l01496"></a>01496         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01497"></a>01497                         array_count, &amp;f_status);
<a name="l01498"></a>01498         <span class="keywordflow">if</span> (f_status)
<a name="l01499"></a>01499           {
<a name="l01500"></a>01500             ffrprt (stderr, f_status);
<a name="l01501"></a>01501             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01502"></a>01502                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01503"></a>01503                          <span class="stringliteral">&quot;Could not write to row %d, collumn %s (%d) in SPC file&quot;</span>
<a name="l01504"></a>01504                          <span class="stringliteral">&quot; %s &quot;</span>, index, countcolname, colnum);                               
<a name="l01505"></a>01505           }
<a name="l01506"></a>01506       }
<a name="l01507"></a>01507     
<a name="l01508"></a>01508     <span class="comment">/* Write the spec.errors data if the name of the column is defined */</span>
<a name="l01509"></a>01509     <span class="keywordflow">if</span> (errorcolname != NULL)
<a name="l01510"></a>01510       {
<a name="l01511"></a>01511         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, errorcolname);
<a name="l01512"></a>01512         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01513"></a>01513                         array_error, &amp;f_status);
<a name="l01514"></a>01514         <span class="keywordflow">if</span> (f_status)
<a name="l01515"></a>01515           {
<a name="l01516"></a>01516             ffrprt (stderr, f_status);
<a name="l01517"></a>01517             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01518"></a>01518                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01519"></a>01519                          <span class="stringliteral">&quot;Could not write %s to row %d, collumn %s (%d) in  SPC file&quot;</span>
<a name="l01520"></a>01520                          , errorcolname, index, colname,
<a name="l01521"></a>01521                          colnum);
<a name="l01522"></a>01522           }
<a name="l01523"></a>01523       }
<a name="l01524"></a>01524        
<a name="l01525"></a>01525     <span class="comment">/* Write the spec.weights data if the name of the column is defined */</span>
<a name="l01526"></a>01526     <span class="keywordflow">if</span> (weightcolname != NULL)
<a name="l01527"></a>01527       {
<a name="l01528"></a>01528         colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (input, weightcolname);
<a name="l01529"></a>01529         fits_write_col (input, TDOUBLE, colnum, index, 1, N,
<a name="l01530"></a>01530                         array_weight, &amp;f_status);
<a name="l01531"></a>01531         <span class="keywordflow">if</span> (f_status)
<a name="l01532"></a>01532           {
<a name="l01533"></a>01533             ffrprt (stderr, f_status);
<a name="l01534"></a>01534             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01535"></a>01535                          <span class="stringliteral">&quot;add_data_to_SPC: &quot;</span>
<a name="l01536"></a>01536                          <span class="stringliteral">&quot;Could not write %s to row %d, collumn %s (%d) in SPC file&quot;</span>
<a name="l01537"></a>01537                          , weightcolname, index, colname,
<a name="l01538"></a>01538                          colnum);
<a name="l01539"></a>01539           }
<a name="l01540"></a>01540       }
<a name="l01541"></a>01541 
<a name="l01542"></a>01542 
<a name="l01543"></a>01543     free (array_count);
<a name="l01544"></a>01544     array_count = NULL;
<a name="l01545"></a>01545     free (array_error);
<a name="l01546"></a>01546     array_error = NULL;
<a name="l01547"></a>01547     free (array_weight);
<a name="l01548"></a>01548     array_weight = NULL;
<a name="l01549"></a>01549     free (array_lambda);
<a name="l01550"></a>01550     array_lambda = NULL;
<a name="l01551"></a>01551     free (array_flux);
<a name="l01552"></a>01552     array_flux = NULL;
<a name="l01553"></a>01553     free (array_ferror);
<a name="l01554"></a>01554     array_ferror = NULL;
<a name="l01555"></a>01555     free (array_contam);
<a name="l01556"></a>01556     array_contam = NULL;
<a name="l01557"></a>01557     free (array_dlambda);
<a name="l01558"></a>01558     array_dlambda = NULL;    
<a name="l01559"></a>01559     free (array_dq);
<a name="l01560"></a>01560     array_dq = NULL;
<a name="l01561"></a>01561   }
<a name="l01562"></a>01562 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab5f7914ef2b01f1f93a2f8ac400eeb7a"></a><!-- doxytag: member="spc_spc.h::add_ID_index_to_SPC" ref="ab5f7914ef2b01f1f93a2f8ac400eeb7a" args="(char filename[], char ID[], int hdunum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_ID_index_to_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hdunum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_ID_index_to_SPC Add an HDU index keyword for <a class="el" href="structbeam.html">beam</a> IDdc into the first HDU of the FITS file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- a pointer to an array containing the name of an existing FITS file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>- a pointer to a char array containing the <a class="el" href="structbeam.html">beam</a> ID in the form "ID%d%c". </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdunum</em>&nbsp;</td><td>- the index of the HDU containing this <a class="el" href="structbeam.html">beam</a>. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00681"></a>00681 {
<a name="l00682"></a>00682   fitsfile *input;
<a name="l00683"></a>00683   <span class="keywordtype">int</span> f_status = 0, hdutype;
<a name="l00684"></a>00684   <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">//  Open the file for creating/appending</span>
<a name="l00687"></a>00687   fits_open_file (&amp;input, filename, READWRITE, &amp;f_status);
<a name="l00688"></a>00688   <span class="keywordflow">if</span> (f_status)
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690       ffrprt (stderr, f_status);
<a name="l00691"></a>00691       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00692"></a>00692                    <span class="stringliteral">&quot;add_ID_index_to_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file:&quot;</span>,
<a name="l00693"></a>00693                    filename);
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695   <span class="comment">/* Move to first hdu */</span>
<a name="l00696"></a>00696   fits_movabs_hdu (input, 1, &amp;hdutype, &amp;f_status);
<a name="l00697"></a>00697   <span class="keywordflow">if</span> (f_status)
<a name="l00698"></a>00698     {
<a name="l00699"></a>00699       ffrprt (stderr, f_status);
<a name="l00700"></a>00700       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00701"></a>00701                    <span class="stringliteral">&quot;add_ID_index_to_SPC: &quot;</span>
<a name="l00702"></a>00702                    <span class="stringliteral">&quot;Could not read extention %d from file: %s&quot;</span>, hdunum,
<a name="l00703"></a>00703                    filename);
<a name="l00704"></a>00704     }
<a name="l00705"></a>00705   sprintf (comment, <span class="stringliteral">&quot;HDU number for beam&quot;</span>);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   fits_write_key_lng (input, ID, (<span class="keywordtype">long</span>) hdunum, comment, &amp;f_status);
<a name="l00708"></a>00708   <span class="keywordflow">if</span> (f_status)
<a name="l00709"></a>00709     {
<a name="l00710"></a>00710       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00711"></a>00711                    <span class="stringliteral">&quot;add_ID_index_to_SPC: Error adding index keyword %s &quot;</span>,
<a name="l00712"></a>00712                    ID);
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   fits_close_file (input, &amp;f_status);
<a name="l00716"></a>00716   <span class="keywordflow">if</span> (f_status)
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00719"></a>00719                    <span class="stringliteral">&quot;add_ID_index_to_SPC: Error closing file: %s &quot;</span>,
<a name="l00720"></a>00720                    filename);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad938fc5086cc4fa9525e78360ad965af"></a><!-- doxytag: member="spc_spc.h::add_ID_to_SPC" ref="ad938fc5086cc4fa9525e78360ad965af" args="(char filename[], int N, char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int add_ID_to_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_ID_to_SPC A function that add a binary table extension to an existing SPC FITS file. The table is appended to the FITS file. No check is performed to ensure that the named extension does not exist already. This function is meant to initialize a FITS binary table which will be used to store the content of an <a class="el" href="structspectrum.html">spectrum</a> structure.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- The name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>N</em>&nbsp;</td><td>- The size of the vectors in this table (i.e. number of pixels in the <a class="el" href="structap__pixel.html">ap_pixel</a> structure). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>extname</em>&nbsp;</td><td>- The name to give to this extension</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>hdunum - the number of the HDU that was just created </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00614"></a>00614 {
<a name="l00615"></a>00615  
<a name="l00616"></a>00616   fitsfile *output;
<a name="l00617"></a>00617   <span class="keywordtype">int</span> f_status = 0;
<a name="l00618"></a>00618   <span class="keywordtype">int</span> hdunum = 0, hdutype;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="comment">//  Open the file for creating/appending</span>
<a name="l00621"></a>00621   fits_open_file (&amp;output, filename, READWRITE, &amp;f_status);
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (f_status)
<a name="l00623"></a>00623     {
<a name="l00624"></a>00624       ffrprt (stderr, f_status);
<a name="l00625"></a>00625       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00626"></a>00626                    <span class="stringliteral">&quot;add_new_to_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file: %s&quot;</span>,
<a name="l00627"></a>00627                    filename);
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629   fits_get_num_hdus (output, &amp;hdunum, &amp;f_status);
<a name="l00630"></a>00630   <span class="keywordflow">if</span> (f_status)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632       ffrprt (stderr, f_status);
<a name="l00633"></a>00633       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00634"></a>00634                    <span class="stringliteral">&quot;add_new_to_SPC: Could not get&quot;</span>
<a name="l00635"></a>00635                    <span class="stringliteral">&quot; number of HDU from:&quot;</span>, filename);
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637   <span class="comment">/* Move to last HDU */</span>
<a name="l00638"></a>00638   fits_movabs_hdu (output, hdunum, &amp;hdutype, &amp;f_status);
<a name="l00639"></a>00639   <span class="keywordflow">if</span> (f_status)
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       ffrprt (stderr, f_status);
<a name="l00642"></a>00642       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00643"></a>00643                    <span class="stringliteral">&quot;add_new_to_SPC: Could not mov&quot;</span>
<a name="l00644"></a>00644                    <span class="stringliteral">&quot; to HDU number %d in file: %s&quot;</span>, hdunum, filename);
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646   <span class="comment">/* Get current HDU number */</span>
<a name="l00647"></a>00647   fits_get_hdu_num (output, &amp;hdunum);
<a name="l00648"></a>00648   <span class="keywordflow">if</span> (f_status)
<a name="l00649"></a>00649     {
<a name="l00650"></a>00650       ffrprt (stderr, f_status);
<a name="l00651"></a>00651       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00652"></a>00652                    <span class="stringliteral">&quot;add_new_to_SPC: Could not get&quot;</span>
<a name="l00653"></a>00653                    <span class="stringliteral">&quot; current HDU number from file: %s&quot;</span>, filename);
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655   
<a name="l00656"></a>00656   <a class="code" href="spc__spc_8c.html#a5985d31d3be091b7b8e151f940914392">add_ID_to_SPC_opened</a> (output, N, ID);
<a name="l00657"></a>00657   
<a name="l00658"></a>00658   
<a name="l00659"></a>00659   fits_close_file (output, &amp;f_status);
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (f_status)
<a name="l00661"></a>00661     {
<a name="l00662"></a>00662       ffrprt (stderr, f_status);
<a name="l00663"></a>00663       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00664"></a>00664                    <span class="stringliteral">&quot;add_new_to_SPC: Could not&quot;</span> <span class="stringliteral">&quot; close file: %s&quot;</span>,
<a name="l00665"></a>00665                    filename);
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667   <span class="keywordflow">return</span> hdunum;
<a name="l00668"></a>00668 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5985d31d3be091b7b8e151f940914392"></a><!-- doxytag: member="spc_spc.h::add_ID_to_SPC_opened" ref="a5985d31d3be091b7b8e151f940914392" args="(fitsfile *output, int N, char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_ID_to_SPC_opened </td>
          <td>(</td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00454"></a>00454 {
<a name="l00455"></a>00455   <span class="comment">/*   struct Col_Descr SPCData[SPCCOL] = {</span>
<a name="l00456"></a>00456 <span class="comment">       {&quot;ID&quot;, &quot;60A&quot;, NULL},</span>
<a name="l00457"></a>00457 <span class="comment">       {&quot;N&quot;, &quot;I1&quot;, NULL},</span>
<a name="l00458"></a>00458 <span class="comment">       {&quot;LAMBDA&quot;, &quot;XXXE1&quot;, &quot;ANGSTROM&quot;},</span>
<a name="l00459"></a>00459 <span class="comment">       {&quot;TCOUNT&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00460"></a>00460 <span class="comment">       {&quot;BCOUNT&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00461"></a>00461 <span class="comment">       {&quot;COUNT&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00462"></a>00462 <span class="comment">       {&quot;TERROR&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00463"></a>00463 <span class="comment">       {&quot;BERROR&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00464"></a>00464 <span class="comment">       {&quot;ERROR&quot;, &quot;XXXE1&quot;, &quot;COUNT&quot;},</span>
<a name="l00465"></a>00465 <span class="comment">       {&quot;FLUX&quot;, &quot;XXXE1&quot;, &quot;PHYSICAL UNITS&quot;},</span>
<a name="l00466"></a>00466 <span class="comment">       {&quot;FERROR&quot;, &quot;XXXE1&quot;, &quot;PHYSICAL UNITS&quot;},</span>
<a name="l00467"></a>00467 <span class="comment">       {&quot;WEIGHT&quot;, &quot;XXXE1&quot;, &quot;PIXEL&quot;},</span>
<a name="l00468"></a>00468 <span class="comment">       {&quot;CONTAM&quot;, &quot;XXXI1&quot;, &quot;FLAG&quot;}</span>
<a name="l00469"></a>00469 <span class="comment">       };</span>
<a name="l00470"></a>00470 <span class="comment">*/</span>
<a name="l00471"></a>00471   <span class="keyword">struct </span><a class="code" href="structCol__Descr.html">Col_Descr</a> SPCData[<a class="code" href="spc__spc_8c.html#a615e6fe30c4c4a677e79cdedcfea73cc">SPCCOL</a>] = {
<a name="l00472"></a>00472     {<span class="stringliteral">&quot;ID&quot;</span>, <span class="stringliteral">&quot;60A&quot;</span>, NULL},
<a name="l00473"></a>00473     {<span class="stringliteral">&quot;N&quot;</span>, <span class="stringliteral">&quot;I1&quot;</span>, NULL},
<a name="l00474"></a>00474     {<span class="stringliteral">&quot;LAMBDA&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;ANGSTROM&quot;</span>},
<a name="l00475"></a>00475     {<span class="stringliteral">&quot;TCOUNT&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00476"></a>00476     {<span class="stringliteral">&quot;BCOUNT&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00477"></a>00477     {<span class="stringliteral">&quot;COUNT&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00478"></a>00478     {<span class="stringliteral">&quot;TERROR&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00479"></a>00479     {<span class="stringliteral">&quot;BERROR&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00480"></a>00480     {<span class="stringliteral">&quot;ERROR&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;COUNT&quot;</span>},
<a name="l00481"></a>00481     {<span class="stringliteral">&quot;FLUX&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;PHYSICAL UNITS&quot;</span>},
<a name="l00482"></a>00482     {<span class="stringliteral">&quot;FERROR&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;PHYSICAL UNITS&quot;</span>},
<a name="l00483"></a>00483     {<span class="stringliteral">&quot;WEIGHT&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;PIXEL&quot;</span>},
<a name="l00484"></a>00484     {<span class="stringliteral">&quot;CONTAM&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;FLAG&quot;</span>},
<a name="l00485"></a>00485     <span class="comment">// new for dlambda column</span>
<a name="l00486"></a>00486     {<span class="stringliteral">&quot;DLAMBDA&quot;</span>, <span class="stringliteral">&quot;E1&quot;</span>, <span class="stringliteral">&quot;ANGSTROM&quot;</span>},
<a name="l00487"></a>00487     {<span class="stringliteral">&quot;DQ&quot;</span>,<span class="stringliteral">&quot;I1&quot;</span>,<span class="stringliteral">&quot;DQ&quot;</span>}};
<a name="l00488"></a>00488   
<a name="l00489"></a>00489      
<a name="l00490"></a>00490   <span class="keywordtype">int</span> f_status = 0;
<a name="l00491"></a>00491   {
<a name="l00492"></a>00492     <span class="keywordtype">char</span> *<a class="code" href="structCol__Descr.html#af5ee028efb2b6e22ccb8e7a54604ab02">ttype</a>[<a class="code" href="spc__spc_8c.html#a615e6fe30c4c4a677e79cdedcfea73cc">SPCCOL</a>], *<a class="code" href="structCol__Descr.html#a5ad3c37d211910766ed08e553b86d17a">tform</a>[<a class="code" href="spc__spc_8c.html#a615e6fe30c4c4a677e79cdedcfea73cc">SPCCOL</a>], *<a class="code" href="structCol__Descr.html#ac5a0fbd1953a39e0b3b5904c8c3de3a3">tunit</a>[<a class="code" href="spc__spc_8c.html#a615e6fe30c4c4a677e79cdedcfea73cc">SPCCOL</a>];
<a name="l00493"></a>00493     
<a name="l00494"></a>00494     <span class="keywordtype">int</span> i;
<a name="l00495"></a>00495     
<a name="l00496"></a>00496     <span class="comment">/* Prepare column description */</span>
<a name="l00497"></a>00497     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="spc__spc_8c.html#a615e6fe30c4c4a677e79cdedcfea73cc">SPCCOL</a>; i++)
<a name="l00498"></a>00498       {
<a name="l00499"></a>00499         ttype[i] = (<span class="keywordtype">char</span> *) malloc (FLEN_KEYWORD * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));
<a name="l00500"></a>00500         <span class="keywordflow">if</span> (ttype[i] == NULL)
<a name="l00501"></a>00501           {
<a name="l00502"></a>00502             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00503"></a>00503                          <span class="stringliteral">&quot;intadd_ID_to_SPC_opened: &quot;</span>
<a name="l00504"></a>00504                          <span class="stringliteral">&quot;Memory allocation failed,&quot;</span>);
<a name="l00505"></a>00505           }
<a name="l00506"></a>00506         tform[i] = (<span class="keywordtype">char</span> *) malloc (FLEN_KEYWORD * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (tform[i] == NULL)
<a name="l00508"></a>00508           {
<a name="l00509"></a>00509             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00510"></a>00510                          <span class="stringliteral">&quot;intadd_ID_to_SPC_opened: &quot;</span>
<a name="l00511"></a>00511                          <span class="stringliteral">&quot;Memory allocation failed,&quot;</span>);
<a name="l00512"></a>00512           }
<a name="l00513"></a>00513         tunit[i] = (<span class="keywordtype">char</span> *) malloc (FLEN_KEYWORD * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));
<a name="l00514"></a>00514         <span class="keywordflow">if</span> (tunit[i] == NULL)
<a name="l00515"></a>00515           {
<a name="l00516"></a>00516             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00517"></a>00517                          <span class="stringliteral">&quot;intadd_ID_to_SPC_opened: &quot;</span>
<a name="l00518"></a>00518                          <span class="stringliteral">&quot;Memory allocation failed,&quot;</span>);
<a name="l00519"></a>00519           }
<a name="l00520"></a>00520         <span class="keywordflow">if</span> (SPCData[i].ttype != NULL)
<a name="l00521"></a>00521           sprintf (ttype[i], <span class="stringliteral">&quot;%s&quot;</span>, SPCData[i].ttype);
<a name="l00522"></a>00522         <span class="keywordflow">if</span> (SPCData[i].tform != NULL)
<a name="l00523"></a>00523           {
<a name="l00524"></a>00524             <span class="keywordflow">if</span> (!strncmp (<span class="stringliteral">&quot;XXX&quot;</span>, SPCData[i].tform, 3))
<a name="l00525"></a>00525               {
<a name="l00526"></a>00526                 sprintf (tform[i], <span class="stringliteral">&quot;%d%s&quot;</span>, N,
<a name="l00527"></a>00527                          SPCData[i].tform + 3);
<a name="l00528"></a>00528               }
<a name="l00529"></a>00529             <span class="keywordflow">else</span>
<a name="l00530"></a>00530               {
<a name="l00531"></a>00531                 sprintf (tform[i], <span class="stringliteral">&quot;%s&quot;</span>, SPCData[i].tform);
<a name="l00532"></a>00532               }
<a name="l00533"></a>00533           }
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (SPCData[i].tunit != NULL)
<a name="l00535"></a>00535           sprintf (tunit[i], <span class="stringliteral">&quot;%s&quot;</span>, SPCData[i].tunit);
<a name="l00536"></a>00536         <span class="keywordflow">else</span>
<a name="l00537"></a>00537           sprintf (tunit[i], <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);
<a name="l00538"></a>00538       }
<a name="l00539"></a>00539     
<a name="l00540"></a>00540     fits_create_tbl (output, BINARY_TBL, 0, SPCCOL, ttype, tform, tunit,
<a name="l00541"></a>00541                      ID, &amp;f_status);
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (f_status)
<a name="l00543"></a>00543       {
<a name="l00544"></a>00544         ffrprt (stderr, f_status);
<a name="l00545"></a>00545         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00546"></a>00546                      <span class="stringliteral">&quot;intadd_ID_to_SPC_opened: Could not create&quot;</span>
<a name="l00547"></a>00547                      <span class="stringliteral">&quot; new binary table HDU in SPC file&quot;</span>);
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549     
<a name="l00550"></a>00550     <span class="comment">/* Clean up */</span>
<a name="l00551"></a>00551     <span class="keywordflow">for</span> (i = 0; i &lt; SPCCOL; i++)
<a name="l00552"></a>00552       {
<a name="l00553"></a>00553         free (tunit[i]);
<a name="l00554"></a>00554         tunit[i] = NULL;
<a name="l00555"></a>00555         free (ttype[i]);
<a name="l00556"></a>00556         ttype[i] = NULL;
<a name="l00557"></a>00557         free (tform[i]);
<a name="l00558"></a>00558         tform[i] = NULL;
<a name="l00559"></a>00559       }
<a name="l00560"></a>00560     
<a name="l00561"></a>00561     {
<a name="l00562"></a>00562       <span class="keywordtype">char</span> **array;
<a name="l00563"></a>00563       <span class="keywordtype">int</span> colnum;
<a name="l00564"></a>00564       array = malloc (<span class="keyword">sizeof</span> (<span class="keywordtype">char</span> *));
<a name="l00565"></a>00565       <span class="keywordflow">if</span> (array == NULL)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00568"></a>00568                        <span class="stringliteral">&quot;add_new_to_SPC: Out of memory&quot;</span>);
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570       array[0] = malloc (60 * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));
<a name="l00571"></a>00571       <span class="keywordflow">if</span> (array[0] == NULL)
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00574"></a>00574                        <span class="stringliteral">&quot;add_net_to_SPC: Out of memory&quot;</span>);
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576       sprintf (array[0], <span class="stringliteral">&quot;%s&quot;</span>, ID);
<a name="l00577"></a>00577       colnum = <a class="code" href="spc__spc_8c.html#a4a3cfebfb9e8d0b9e17e8f87ab3a59e2">get_SPC_colnum</a> (output, <span class="stringliteral">&quot;ID&quot;</span>);
<a name="l00578"></a>00578       fits_write_col (output, TSTRING, colnum, 1, 1, 1, array,
<a name="l00579"></a>00579                       &amp;f_status);
<a name="l00580"></a>00580       free (array[0]);
<a name="l00581"></a>00581       array[0] = NULL;
<a name="l00582"></a>00582       free (array);
<a name="l00583"></a>00583       array = NULL;
<a name="l00584"></a>00584       
<a name="l00585"></a>00585       <span class="keywordflow">if</span> (f_status)
<a name="l00586"></a>00586         {
<a name="l00587"></a>00587           ffrprt (stderr, f_status);
<a name="l00588"></a>00588           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00589"></a>00589                        <span class="stringliteral">&quot;add_new_to_SPC: &quot;</span>
<a name="l00590"></a>00590                        <span class="stringliteral">&quot;Could not write ID to row %d ,collumn %s (%d) in &quot;</span>
<a name="l00591"></a>00591                        <span class="stringliteral">&quot;SPC file &quot;</span>, 1, <span class="stringliteral">&quot;ID&quot;</span>, colnum);
<a name="l00592"></a>00592         } 
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594   } 
<a name="l00595"></a>00595 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afa47cc3a687d35d546ceec87d0f14f06"></a><!-- doxytag: member="spc_spc.h::add_spectra_to_SPC" ref="afa47cc3a687d35d546ceec87d0f14f06" args="(char filename[], spectrum *obj_spec, spectrum *bck_spec, spectrum *sobj_spec, int aperID, int beamID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_spectra_to_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>obj_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>bck_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aperID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>beamID</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_spectra_to_SPC Function to add a new entry into a SPC file. This function takes three spectra, one containing the <a class="el" href="structobject.html">object</a>, one containing the background, and the last one containing the <a class="el" href="structobject.html">object</a> subtracted background and add the information to the appropriate (i.e. create a new one or update an existing one) extension binary table.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- a pointer to a string containing the name of the PET file to write to/ </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obj_spec</em>&nbsp;</td><td>- a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the object+background 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bck_spec</em>&nbsp;</td><td>- a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the background 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sobj_spec</em>&nbsp;</td><td>- a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the <a class="el" href="structobject.html">object</a> 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>aperID</em>&nbsp;</td><td>- the numeric aperture ID of this table. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>beamID</em>&nbsp;</td><td>- the numeric <a class="el" href="structbeam.html">beam</a> ID of this table. </td></tr>
  </table>
  </dd>
</dl>

<p><p>NEED TO LOOK IN HDU 1 FOR KEY IDDD</p>
<p>IF FAIL THEN DO FOLLOWING LINE</p>
<p>NEED TO ADD KEYWORK IDDD IN HDU 0 WITH HDUNUM AS VALUE </p>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00844"></a>00844 {
<a name="l00845"></a>00845      <span class="keywordtype">int</span> hdunum;
<a name="l00846"></a>00846      <span class="keywordtype">char</span> ID[60], IDindex[60];
<a name="l00847"></a>00847      <span class="keywordtype">int</span> spec_len;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849      <a class="code" href="spc__spc_8c.html#a04113a68250979dcf9b17544cf8edb33">create_SPC</a> (filename, 0);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851      sprintf (ID, <span class="stringliteral">&quot;BEAM_%d%c&quot;</span>, aperID, <a class="code" href="aXe__grism_8h.html#a7d90dabb6016bb0e09b6ab84087b70a7">BEAM</a> (beamID));
<a name="l00852"></a>00852      sprintf (IDindex, <span class="stringliteral">&quot;%s&quot;</span>, ID);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854      <span class="keywordflow">if</span> (bck_spec != NULL)
<a name="l00855"></a>00855        {
<a name="l00856"></a>00856             <span class="comment">/* Check that it has the proper length */</span>
<a name="l00857"></a>00857             <span class="keywordflow">if</span> (obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> != bck_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>)
<a name="l00858"></a>00858               {
<a name="l00859"></a>00859                    <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00860"></a>00860                                 <span class="stringliteral">&quot;add_spectra_to_SPC: Total and Background spectra&quot;</span>
<a name="l00861"></a>00861                                 <span class="stringliteral">&quot; do not have the same lengths!: %d vs. %d\n&quot;</span>,
<a name="l00862"></a>00862                                 obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>, bck_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l00863"></a>00863               }
<a name="l00864"></a>00864        }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866      <span class="keywordflow">if</span> (sobj_spec != NULL)
<a name="l00867"></a>00867        {
<a name="l00868"></a>00868             <span class="comment">/* Check that it has the proper length */</span>
<a name="l00869"></a>00869             <span class="keywordflow">if</span> (obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> != sobj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>)
<a name="l00870"></a>00870               {
<a name="l00871"></a>00871                    <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00872"></a>00872                                 <span class="stringliteral">&quot;add_spectra_to_SPC: Total and Object spectra&quot;</span>
<a name="l00873"></a>00873                                 <span class="stringliteral">&quot; do not have the same lengths!: %d vs. %d\n&quot;</span>,
<a name="l00874"></a>00874                                 obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>, sobj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l00875"></a>00875               }
<a name="l00876"></a>00876        }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keywordflow">if</span> (obj_spec!=NULL) {
<a name="l00879"></a>00879         spec_len = obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>;
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="keywordflow">else</span> {
<a name="l00882"></a>00882         spec_len = 0;
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884     
<a name="l00885"></a>00885 <span class="preprocessor">#ifdef DEBUGSPC</span>
<a name="l00886"></a>00886 <span class="preprocessor"></span>     fprintf (stderr, <span class="stringliteral">&quot;Looking for ID:%s in SPC...&quot;</span>, ID);
<a name="l00887"></a>00887 <span class="preprocessor">#endif</span>
<a name="l00888"></a>00888 <span class="preprocessor"></span>
<a name="l00889"></a>00889 
<a name="l00891"></a>00891      hdunum = <a class="code" href="spc__spc_8c.html#abb978bc00496ea18cc7590c587133887">get_ID_index_to_SPC</a> (filename, IDindex);
<a name="l00893"></a>00893      <span class="keywordflow">if</span> (hdunum == -1)
<a name="l00894"></a>00894        {
<a name="l00895"></a>00895             hdunum = <a class="code" href="spc__spc_8c.html#aa9de3dbaee823cf4223edf572b5d95ae">find_ID_in_SPC</a> (filename, ID);
<a name="l00896"></a>00896        }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 <span class="preprocessor">#ifdef DEBUGSPC</span>
<a name="l00899"></a>00899 <span class="preprocessor"></span>     fprintf (stderr, <span class="stringliteral">&quot;Found at HDU: %d. &quot;</span>, hdunum);
<a name="l00900"></a>00900 <span class="preprocessor">#endif</span>
<a name="l00901"></a>00901 <span class="preprocessor"></span>
<a name="l00902"></a>00902 
<a name="l00903"></a>00903      <span class="keywordflow">if</span> (hdunum == -1)
<a name="l00904"></a>00904        {
<a name="l00905"></a>00905             hdunum = <a class="code" href="spc__spc_8c.html#ad938fc5086cc4fa9525e78360ad965af">add_ID_to_SPC</a> (filename, spec_len, ID);
<a name="l00907"></a>00907             <a class="code" href="spc__spc_8c.html#ab5f7914ef2b01f1f93a2f8ac400eeb7a">add_ID_index_to_SPC</a> (filename, IDindex, hdunum);
<a name="l00908"></a>00908        }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="preprocessor">#ifdef DEBUGSPC</span>
<a name="l00912"></a>00912 <span class="preprocessor"></span>     fprintf (stderr, <span class="stringliteral">&quot;Done.\n&quot;</span>);
<a name="l00913"></a>00913 <span class="preprocessor">#endif</span>
<a name="l00914"></a>00914 <span class="preprocessor"></span>     <span class="comment">// Write data into HDU HERE!</span>
<a name="l00915"></a>00915      <a class="code" href="spc__spc_8c.html#af79a706e87b64ac8e177b70798e3b57e">add_data_to_SPC</a> (bck_spec, <span class="stringliteral">&quot;BCOUNT&quot;</span>, <span class="stringliteral">&quot;BERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, filename,
<a name="l00916"></a>00916                       hdunum, spec_len);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918      <a class="code" href="spc__spc_8c.html#af79a706e87b64ac8e177b70798e3b57e">add_data_to_SPC</a> (obj_spec, <span class="stringliteral">&quot;TCOUNT&quot;</span>, <span class="stringliteral">&quot;TERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, filename,
<a name="l00919"></a>00919                       hdunum, spec_len);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921      <span class="comment">/* warning, if sobj_spec does not contain a valiv lambda and</span>
<a name="l00922"></a>00922 <span class="comment">        weight values, then these still get written... */</span>
<a name="l00923"></a>00923      <a class="code" href="spc__spc_8c.html#af79a706e87b64ac8e177b70798e3b57e">add_data_to_SPC</a> (sobj_spec, <span class="stringliteral">&quot;COUNT&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, filename,
<a name="l00924"></a>00924                       hdunum, spec_len);
<a name="l00925"></a>00925 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad5f7a3bb4b3128c780fbf22b97dfda64"></a><!-- doxytag: member="spc_spc.h::add_spectra_to_SPC_opened" ref="ad5f7a3bb4b3128c780fbf22b97dfda64" args="(fitsfile *input, spectrum *obj_spec, spectrum *bck_spec, spectrum *sobj_spec, int aperID, int beamID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_spectra_to_SPC_opened </td>
          <td>(</td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>obj_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>bck_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>sobj_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>aperID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>beamID</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: add_spectra_to_SPC_opened Function to add a new entry into a SPC file. This function takes three spectra, one containing the <a class="el" href="structobject.html">object</a>, one containing the background, and the last one containing the <a class="el" href="structobject.html">object</a> subtracted background and add the information to the appropriate (i.e. create a new one or update an existing one) extension binary table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>a pointer to a string containing the name of the PET file to write to/ </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obj_spec</em>&nbsp;</td><td>a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the object+background 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bck_spec</em>&nbsp;</td><td>a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the background 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sobj_spec</em>&nbsp;</td><td>a pointer to a <a class="el" href="structspectrum.html">spectrum</a> structure containing the <a class="el" href="structobject.html">object</a> 1D binned <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>aperID</em>&nbsp;</td><td>the numeric aperture ID of this table. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>beamID</em>&nbsp;</td><td>the numeric <a class="el" href="structbeam.html">beam</a> ID of this table. </td></tr>
  </table>
  </dd>
</dl>

<p><p>NEED TO ADD KEYWORK IDDD IN HDU 0 WITH HDUNUM AS VALUE </p>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l01242"></a>01242 {
<a name="l01243"></a>01243   <span class="keywordtype">char</span> ID[60], IDindex[60];
<a name="l01244"></a>01244   <span class="keywordtype">int</span> spec_len;
<a name="l01245"></a>01245   
<a name="l01246"></a>01246   sprintf (ID, <span class="stringliteral">&quot;BEAM_%d%c&quot;</span>, aperID, <a class="code" href="aXe__grism_8h.html#a7d90dabb6016bb0e09b6ab84087b70a7">BEAM</a> (beamID));
<a name="l01247"></a>01247   sprintf (IDindex, <span class="stringliteral">&quot;%s&quot;</span>, ID);
<a name="l01248"></a>01248   
<a name="l01249"></a>01249   <span class="keywordflow">if</span> (bck_spec != NULL)
<a name="l01250"></a>01250     {
<a name="l01251"></a>01251       <span class="comment">/* Check that it has the proper length */</span>
<a name="l01252"></a>01252       <span class="keywordflow">if</span> (obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> != bck_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>)
<a name="l01253"></a>01253         {
<a name="l01254"></a>01254           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01255"></a>01255                        <span class="stringliteral">&quot;add_spectra_to_SPC: Total and Background spectra&quot;</span>
<a name="l01256"></a>01256                        <span class="stringliteral">&quot; do not have the same lengths!: %d vs. %d\n&quot;</span>,
<a name="l01257"></a>01257                        obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>, bck_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l01258"></a>01258         }
<a name="l01259"></a>01259     }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="keywordflow">if</span> (sobj_spec != NULL)
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       <span class="comment">/* Check that it has the proper length */</span>
<a name="l01264"></a>01264       <span class="keywordflow">if</span> (obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> != sobj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>)
<a name="l01265"></a>01265         {
<a name="l01266"></a>01266           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l01267"></a>01267                        <span class="stringliteral">&quot;add_spectra_to_SPC: Total and Object spectra&quot;</span>
<a name="l01268"></a>01268                        <span class="stringliteral">&quot; do not have the same lengths!: %d vs. %d\n&quot;</span>,
<a name="l01269"></a>01269                        obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>, sobj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l01270"></a>01270         }
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272   
<a name="l01273"></a>01273   <span class="keywordflow">if</span> (obj_spec!=NULL) 
<a name="l01274"></a>01274     spec_len = obj_spec-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>;
<a name="l01275"></a>01275   <span class="keywordflow">else</span> 
<a name="l01276"></a>01276     spec_len = 0;
<a name="l01277"></a>01277    
<a name="l01278"></a>01278   <a class="code" href="spc__spc_8c.html#a5985d31d3be091b7b8e151f940914392">add_ID_to_SPC_opened</a> (input, spec_len, ID);
<a name="l01280"></a>01280   <span class="comment">//  add_ID_index_to_SPC (filename, IDindex, hdunum);</span>
<a name="l01281"></a>01281   
<a name="l01282"></a>01282   <span class="comment">// Write data into HDU HERE!</span>
<a name="l01283"></a>01283   <a class="code" href="spc__spc_8c.html#a0d937250aad5dea3bcebe04d66bbfa90">add_data_to_SPC_opened</a> (bck_spec, <span class="stringliteral">&quot;BCOUNT&quot;</span>, <span class="stringliteral">&quot;BERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, input, spec_len);
<a name="l01284"></a>01284   
<a name="l01285"></a>01285   <a class="code" href="spc__spc_8c.html#a0d937250aad5dea3bcebe04d66bbfa90">add_data_to_SPC_opened</a> (obj_spec, <span class="stringliteral">&quot;TCOUNT&quot;</span>, <span class="stringliteral">&quot;TERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, input, spec_len);
<a name="l01286"></a>01286   
<a name="l01287"></a>01287   <span class="comment">/* warning, if sobj_spec does not contain a valiv lambda and</span>
<a name="l01288"></a>01288 <span class="comment">     weight values, then these still get written... */</span>
<a name="l01289"></a>01289   <a class="code" href="spc__spc_8c.html#a0d937250aad5dea3bcebe04d66bbfa90">add_data_to_SPC_opened</a> (sobj_spec, <span class="stringliteral">&quot;COUNT&quot;</span>, <span class="stringliteral">&quot;ERROR&quot;</span>, <span class="stringliteral">&quot;WEIGHT&quot;</span>, ID, input, spec_len);
<a name="l01290"></a>01290 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b7693a22a9e1b6d287465b8bff189de"></a><!-- doxytag: member="spc_spc.h::allocate_spectrum" ref="a2b7693a22a9e1b6d287465b8bff189de" args="(const int numbin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspectrum.html">spectrum</a>* allocate_spectrum </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>numbin</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: allocate_spectrum allocates and initializes a <a class="el" href="structspectrum.html">spectrum</a> and its subordinate data structures (this is usually called by binning routines, so I've declared it static)</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>numbin</em>&nbsp;</td><td>- number of <a class="el" href="structspectrum.html">spectrum</a> data points</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>sp - the allocated <a class="el" href="structspectrum.html">spectrum</a> structure </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00028"></a>00028 {
<a name="l00029"></a>00029   <a class="code" href="structspectrum.html">spectrum</a> *sp;
<a name="l00030"></a>00030   <span class="keywordtype">int</span> i;
<a name="l00031"></a>00031   
<a name="l00032"></a>00032   sp = malloc (<span class="keyword">sizeof</span> (<a class="code" href="structspectrum.html">spectrum</a>));
<a name="l00033"></a>00033   <span class="keywordflow">if</span> (!sp)
<a name="l00034"></a>00034     {
<a name="l00035"></a>00035       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00036"></a>00036     }
<a name="l00037"></a>00037   sp-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> = numbin;
<a name="l00038"></a>00038   sp-&gt;<a class="code" href="structspectrum.html#a9db80753621188168361c845f8c2bd9a">warning</a> = 0;
<a name="l00039"></a>00039   sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a> = malloc (numbin * <span class="keyword">sizeof</span> (<a class="code" href="structspc__entry.html">spc_entry</a>));
<a name="l00040"></a>00040   <span class="keywordflow">if</span> (!sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>)
<a name="l00041"></a>00041     {
<a name="l00042"></a>00042       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__, <span class="stringliteral">&quot;Out of memory&quot;</span>);
<a name="l00043"></a>00043     }
<a name="l00044"></a>00044   <span class="keywordflow">for</span> (i = 0; i &lt; sp-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; i++)
<a name="l00045"></a>00045     {
<a name="l00046"></a>00046       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a> = 0.;
<a name="l00047"></a>00047       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a> = +1e38;
<a name="l00048"></a>00048       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a> = -1e38;
<a name="l00049"></a>00049       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a> = GSL_NAN;
<a name="l00050"></a>00050       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a> = 0.;
<a name="l00051"></a>00051       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a> = 0.;
<a name="l00052"></a>00052       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a> = 0.;
<a name="l00053"></a>00053       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a> = -1.0;
<a name="l00054"></a>00054       sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a> = 0;
<a name="l00055"></a>00055       
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   
<a name="l00059"></a>00059   <span class="keywordflow">return</span> sp;
<a name="l00060"></a>00060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a04113a68250979dcf9b17544cf8edb33"></a><!-- doxytag: member="spc_spc.h::create_SPC" ref="a04113a68250979dcf9b17544cf8edb33" args="(char filename[], int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: create_SPC A function that creates a FITS file containing an empty primary header</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- the name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>- if set to 1, then any exisiting file is deleted. Nothing is done otherwise. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252      fitsfile *output;
<a name="l00253"></a>00253      <span class="keywordtype">int</span> f_status = 0;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255      <span class="comment">// Try to open the file</span>
<a name="l00256"></a>00256      {
<a name="l00257"></a>00257           FILE *in_file;
<a name="l00258"></a>00258           in_file = fopen (filename, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00259"></a>00259           <span class="keywordflow">if</span> ((overwrite == 1) &amp;&amp; (in_file != NULL))
<a name="l00260"></a>00260             {
<a name="l00261"></a>00261                  <span class="comment">//aXe_message (aXe_M_WARN3, __FILE__, __LINE__,</span>
<a name="l00262"></a>00262                 <span class="comment">//            &quot;create_SPC: File %s &quot;</span>
<a name="l00263"></a>00263                 <span class="comment">//            &quot;exits. Overwriting it.&quot;, filename);</span>
<a name="l00264"></a>00264                  fclose (in_file);
<a name="l00265"></a>00265                  unlink (filename);
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267           <span class="keywordflow">if</span> ((overwrite != 1) &amp;&amp; (in_file != NULL))
<a name="l00268"></a>00268             {
<a name="l00269"></a>00269                  fclose (in_file);
<a name="l00270"></a>00270                  <span class="keywordflow">return</span>;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272      }
<a name="l00273"></a>00273      <span class="comment">// Open the file for creating/appending</span>
<a name="l00274"></a>00274      <span class="comment">//fprintf(stderr,&quot;Creating file %s\n&quot;,filename);</span>
<a name="l00275"></a>00275      fits_create_file (&amp;output, filename, &amp;f_status);
<a name="l00276"></a>00276      <span class="keywordflow">if</span> (f_status)
<a name="l00277"></a>00277        {
<a name="l00278"></a>00278             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00279"></a>00279                          <span class="stringliteral">&quot;create_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file: %s&quot;</span>, filename);
<a name="l00280"></a>00280        }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282      <span class="comment">// Create empty HDU</span>
<a name="l00283"></a>00283      {
<a name="l00284"></a>00284           <span class="keywordtype">int</span> naxis = 0;
<a name="l00285"></a>00285           <span class="keywordtype">long</span> naxes[2];
<a name="l00286"></a>00286           ffiimg (output, 16, naxis, naxes, &amp;f_status);
<a name="l00287"></a>00287           <span class="keywordflow">if</span> (f_status)
<a name="l00288"></a>00288             {
<a name="l00289"></a>00289                  <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00290"></a>00290                               <span class="stringliteral">&quot;create_SPC: Error creating &quot;</span>
<a name="l00291"></a>00291                               <span class="stringliteral">&quot; empty first HDU in: %s&quot;</span>, filename);
<a name="l00292"></a>00292             }
<a name="l00293"></a>00293      }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295      fits_close_file (output, &amp;f_status);
<a name="l00296"></a>00296      <span class="keywordflow">if</span> (f_status)
<a name="l00297"></a>00297        {
<a name="l00298"></a>00298             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00299"></a>00299                          <span class="stringliteral">&quot;create_SPC: Could not&quot;</span> <span class="stringliteral">&quot; close file: %s&quot;</span>, filename);
<a name="l00300"></a>00300        }
<a name="l00301"></a>00301 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2d1c885838e3b2bd9f1fdb2f62cbceae"></a><!-- doxytag: member="spc_spc.h::create_SPC_opened" ref="a2d1c885838e3b2bd9f1fdb2f62cbceae" args="(char filename[], int overwrite)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fitsfile* create_SPC_opened </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>overwrite</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: create_SPC_opened A function that creates a FITS file containing an empty primary header</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- The name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>overwrite</em>&nbsp;</td><td>- If set to 1, then any exisiting file is deleted. Nothing is done otherwise.</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>output - pointer to the opened fits-file </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00315"></a>00315 {
<a name="l00316"></a>00316   fitsfile *output;
<a name="l00317"></a>00317   <span class="keywordtype">int</span> f_status = 0;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">// Try to open the file</span>
<a name="l00320"></a>00320   {
<a name="l00321"></a>00321     FILE *in_file;
<a name="l00322"></a>00322     in_file = fopen (filename, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00323"></a>00323     <span class="keywordflow">if</span> ((overwrite == 1) &amp;&amp; (in_file != NULL))
<a name="l00324"></a>00324       {
<a name="l00325"></a>00325         <span class="comment">//aXe_message (aXe_M_WARN3, __FILE__, __LINE__,</span>
<a name="l00326"></a>00326         <span class="comment">//            &quot;create_SPC: File %s &quot;</span>
<a name="l00327"></a>00327         <span class="comment">//            &quot;exits. Overwriting it.&quot;, filename);</span>
<a name="l00328"></a>00328         fclose (in_file);
<a name="l00329"></a>00329         unlink (filename);
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331     <span class="keywordflow">if</span> ((overwrite != 1) &amp;&amp; (in_file != NULL))
<a name="l00332"></a>00332       {
<a name="l00333"></a>00333         fits_open_file (&amp;output, filename, READONLY, &amp;f_status);
<a name="l00334"></a>00334         <span class="keywordflow">if</span> (f_status)
<a name="l00335"></a>00335           {
<a name="l00336"></a>00336             ffrprt (stderr, f_status);
<a name="l00337"></a>00337             <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00338"></a>00338                          <span class="stringliteral">&quot;create_SPC_opened: Could not open SPC file: %s&quot;</span>,
<a name="l00339"></a>00339                          filename);
<a name="l00340"></a>00340           }
<a name="l00341"></a>00341         <span class="keywordflow">return</span> output;
<a name="l00342"></a>00342       }
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344   <span class="comment">// Open the file for creating/appending</span>
<a name="l00345"></a>00345   <span class="comment">//fprintf(stderr,&quot;Creating file %s\n&quot;,filename);</span>
<a name="l00346"></a>00346   fits_create_file (&amp;output, filename, &amp;f_status);
<a name="l00347"></a>00347   <span class="keywordflow">if</span> (f_status)
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00350"></a>00350                    <span class="stringliteral">&quot;create_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file: %s&quot;</span>, filename);
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352   
<a name="l00353"></a>00353   <span class="comment">// Create empty HDU</span>
<a name="l00354"></a>00354   {
<a name="l00355"></a>00355     <span class="keywordtype">int</span> naxis = 0;
<a name="l00356"></a>00356     <span class="keywordtype">long</span> naxes[2];
<a name="l00357"></a>00357     ffiimg (output, 16, naxis, naxes, &amp;f_status);
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (f_status)
<a name="l00359"></a>00359       {
<a name="l00360"></a>00360         <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00361"></a>00361                      <span class="stringliteral">&quot;create_SPC: Error creating &quot;</span>
<a name="l00362"></a>00362                      <span class="stringliteral">&quot; empty first HDU in: %s&quot;</span>, filename);
<a name="l00363"></a>00363       }
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="keywordflow">return</span> output;
<a name="l00367"></a>00367 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad92b28f006b157c32fd16f9cdb7b2c82"></a><!-- doxytag: member="spc_spc.h::empty_counts_spectrum_copy" ref="ad92b28f006b157c32fd16f9cdb7b2c82" args="(spectrum *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspectrum.html">spectrum</a>* empty_counts_spectrum_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: empty_counts_spectrum_copy Allocate and create an empty <a class="el" href="structspectrum.html">spectrum</a> on the basis of a template <a class="el" href="structspectrum.html">spectrum</a></p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>- the input <a class="el" href="structspectrum.html">spectrum</a></td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>- the subtracted <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <span class="keywordtype">int</span> i;
<a name="l00215"></a>00215   <a class="code" href="structspectrum.html">spectrum</a> *res;
<a name="l00216"></a>00216   
<a name="l00217"></a>00217   <span class="keywordflow">if</span> (a==NULL) <span class="keywordflow">return</span> NULL;
<a name="l00218"></a>00218   
<a name="l00219"></a>00219   <span class="comment">/* Allocate new spectrum */</span>
<a name="l00220"></a>00220   res = <a class="code" href="spc__spc_8c.html#a2b7693a22a9e1b6d287465b8bff189de">allocate_spectrum</a> (a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l00221"></a>00221   
<a name="l00222"></a>00222   <span class="comment">/* All the counts and flux are set to zero, rest is */</span>
<a name="l00223"></a>00223   <span class="comment">/* identical to the original spectrum */</span>
<a name="l00224"></a>00224   <span class="keywordflow">for</span> (i = 0; i &lt; a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; i++)
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l00227"></a>00227       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a>;
<a name="l00228"></a>00228       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a> = 0.0;
<a name="l00229"></a>00229       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a> = 0.0;
<a name="l00230"></a>00230       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a> = 0.0;
<a name="l00231"></a>00231       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a> = 0.0;
<a name="l00232"></a>00232       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>;
<a name="l00233"></a>00233       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a>;
<a name="l00234"></a>00234       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a>;
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236   
<a name="l00237"></a>00237   <span class="keywordflow">return</span> res;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa9de3dbaee823cf4223edf572b5d95ae"></a><!-- doxytag: member="spc_spc.h::find_ID_in_SPC" ref="aa9de3dbaee823cf4223edf572b5d95ae" args="(char filename[], char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int find_ID_in_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: find_ID_in_SPC A function to return the number of the HDU which has a givenextname.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- the name of the file to open </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>- a string containing the ID to match</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>- the number of the HDU with matching ID. Returns -1 if none is found. A warning is issued. </dd></dl>

<p><p>NEED TO LOOK IN HDU 1 FOR KEY IDDD</p>
<p>IF FOUND EXIT NOW </p>
</p>

<p><div class="fragment"><pre class="fragment"><a name="l00383"></a>00383 {
<a name="l00384"></a>00384   fitsfile *output;
<a name="l00385"></a>00385   <span class="keywordtype">int</span> f_status = 0;
<a name="l00386"></a>00386   <span class="keywordtype">int</span> hdunum = 0;
<a name="l00387"></a>00387   <span class="keywordtype">char</span> IDindex[60];
<a name="l00388"></a>00388 
<a name="l00390"></a>00390   sprintf (IDindex, <span class="stringliteral">&quot;ID%s&quot;</span>, ID);
<a name="l00391"></a>00391   hdunum = <a class="code" href="spc__spc_8c.html#abb978bc00496ea18cc7590c587133887">get_ID_index_to_SPC</a> (filename, IDindex);
<a name="l00393"></a>00393   <span class="keywordflow">if</span> (hdunum != -1)
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395       <span class="keywordflow">return</span> hdunum;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397   
<a name="l00398"></a>00398   
<a name="l00399"></a>00399   <span class="comment">//  Open the file for creating/appending</span>
<a name="l00400"></a>00400   fits_open_file (&amp;output, filename, READONLY, &amp;f_status);
<a name="l00401"></a>00401   <span class="keywordflow">if</span> (f_status)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403       ffrprt (stderr, f_status);
<a name="l00404"></a>00404       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00405"></a>00405                    <span class="stringliteral">&quot;find_ID_in_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file: %s&quot;</span>,
<a name="l00406"></a>00406                    filename);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408   <span class="comment">// Move to the HDU which has the desired extname</span>
<a name="l00409"></a>00409   fits_movnam_hdu (output, BINARY_TBL, ID, 0, &amp;f_status);
<a name="l00410"></a>00410   <span class="keywordflow">if</span> (f_status)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       fits_close_file (output, &amp;f_status);
<a name="l00413"></a>00413       <span class="keywordflow">return</span> -1;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415   
<a name="l00416"></a>00416   <span class="comment">/* Get current HDU number */</span>
<a name="l00417"></a>00417   fits_get_hdu_num (output, &amp;hdunum);
<a name="l00418"></a>00418   <span class="keywordflow">if</span> (f_status)
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420       ffrprt (stderr, f_status);
<a name="l00421"></a>00421       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00422"></a>00422                    <span class="stringliteral">&quot;find_ID_in_SPC: Could not get&quot;</span>
<a name="l00423"></a>00423                    <span class="stringliteral">&quot; current HDU number from file: %s&quot;</span>, filename);
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425   fits_close_file (output, &amp;f_status);
<a name="l00426"></a>00426   <span class="keywordflow">if</span> (f_status)
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428       ffrprt (stderr, f_status);
<a name="l00429"></a>00429       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00430"></a>00430                    <span class="stringliteral">&quot;find_ID_in_SPO: Could not&quot;</span> <span class="stringliteral">&quot; close file: %s&quot;</span>,
<a name="l00431"></a>00431                    filename);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433   <span class="keywordflow">return</span> hdunum;
<a name="l00434"></a>00434 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acae5c3e717ae1e9e19c97e6a688efae5"></a><!-- doxytag: member="spc_spc.h::fprintf_spectrum" ref="acae5c3e717ae1e9e19c97e6a688efae5" args="(FILE *output, const spectrum *const sp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fprintf_spectrum </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structspectrum.html">spectrum</a> *const &nbsp;</td>
          <td class="paramname"> <em>sp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: fprintf_spectrum Function to display the content of a <a class="el" href="structspectrum.html">spectrum</a></p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>output</em>&nbsp;</td><td>- a pointer to a stream </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sp</em>&nbsp;</td><td>- a pointer to a <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091   <span class="keywordtype">int</span> i;
<a name="l00092"></a>00092   <span class="keywordtype">double</span> sum = 0;
<a name="l00093"></a>00093   
<a name="l00094"></a>00094   fprintf(output,<span class="stringliteral">&quot;# &quot;</span>
<a name="l00095"></a>00095           <span class="stringliteral">&quot;lambda_mean count error weight i lambda_max &quot;</span>
<a name="l00096"></a>00096           <span class="stringliteral">&quot;lambda_min delta_lambda flux ferror\n&quot;</span>);
<a name="l00097"></a>00097   <span class="keywordflow">for</span> (i = 0; i &lt; sp-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; i++)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099       <span class="keywordflow">if</span> (isnan (sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>))
<a name="l00100"></a>00100         {
<a name="l00101"></a>00101           <span class="comment">//  continue;</span>
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103       fprintf (output, <span class="stringliteral">&quot;%g %g %g %g %i %g %g %g %g %g\n&quot;</span>,
<a name="l00104"></a>00104                sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>, sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>,
<a name="l00105"></a>00105                sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>, sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>, i,
<a name="l00106"></a>00106                sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a>, sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a>,
<a name="l00107"></a>00107                sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a> - sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a>,
<a name="l00108"></a>00108                sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a>, sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a>);
<a name="l00109"></a>00109       
<a name="l00110"></a>00110       sum += sp-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>;
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112   fprintf (output, <span class="stringliteral">&quot;#Spectrum sum: %f\n&quot;</span>, sum);
<a name="l00113"></a>00113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5be6cea9695b1d36f979acac98009ff3"></a><!-- doxytag: member="spc_spc.h::free_spectrum" ref="a5be6cea9695b1d36f979acac98009ff3" args="(spectrum *const spec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_spectrum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>spec</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: free_spectrum Frees a <a class="el" href="structspectrum.html">spectrum</a> and its subordinate data structures</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spec</em>&nbsp;</td><td>- a pointer to the <a class="el" href="structspectrum.html">spectrum</a> structure. </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00072"></a>00072 {
<a name="l00073"></a>00073   <span class="keywordflow">if</span> (spec == NULL) <span class="keywordflow">return</span>;
<a name="l00074"></a>00074   free (spec-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>);
<a name="l00075"></a>00075   spec-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a> = NULL;
<a name="l00076"></a>00076   free (spec);
<a name="l00077"></a>00077   spec = NULL;
<a name="l00078"></a>00078 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb978bc00496ea18cc7590c587133887"></a><!-- doxytag: member="spc_spc.h::get_ID_index_to_SPC" ref="abb978bc00496ea18cc7590c587133887" args="(char filename[], char ID[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_ID_index_to_SPC </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>filename</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>ID</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_ID_index_to_SPC Get the value of an HDU index keyword of the for "ID%d%c" from the first HDU of an existing FITS file.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>- a pointer to an array containing the name of an existing FITS file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>- a pointer to a char array containing the <a class="el" href="structbeam.html">beam</a> ID in the form "ID%d%c".</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>hdunum - the number of the HDU containing this <a class="el" href="structbeam.html">beam</a>. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00739"></a>00739 {
<a name="l00740"></a>00740   fitsfile *input;
<a name="l00741"></a>00741   <span class="keywordtype">int</span> f_status = 0, hdutype;
<a name="l00742"></a>00742   <span class="keywordtype">char</span> comment[FLEN_COMMENT];
<a name="l00743"></a>00743   <span class="keywordtype">long</span> hdunum;
<a name="l00744"></a>00744   
<a name="l00745"></a>00745   <span class="comment">//  Open the file for reading </span>
<a name="l00746"></a>00746   fits_open_file (&amp;input, filename, READONLY, &amp;f_status);
<a name="l00747"></a>00747   <span class="keywordflow">if</span> (f_status)
<a name="l00748"></a>00748     {
<a name="l00749"></a>00749       ffrprt (stderr, f_status);
<a name="l00750"></a>00750       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00751"></a>00751                    <span class="stringliteral">&quot;get_ID_index_to_SPC: Could not open&quot;</span> <span class="stringliteral">&quot; file:&quot;</span>,
<a name="l00752"></a>00752                    filename);
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754   <span class="comment">/* Move to first hdu */</span>
<a name="l00755"></a>00755   fits_movabs_hdu (input, 1, &amp;hdutype, &amp;f_status);
<a name="l00756"></a>00756   <span class="keywordflow">if</span> (f_status)
<a name="l00757"></a>00757     {
<a name="l00758"></a>00758       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00759"></a>00759                    <span class="stringliteral">&quot;get_ID_index_to_SPC: &quot;</span>
<a name="l00760"></a>00760                    <span class="stringliteral">&quot;Could not read extention %d from file: %s&quot;</span>, hdunum,
<a name="l00761"></a>00761                    filename);
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763   
<a name="l00764"></a>00764   fits_read_key_lng (input, ID, &amp;hdunum, comment, &amp;f_status);
<a name="l00765"></a>00765   <span class="keywordflow">if</span> (f_status)
<a name="l00766"></a>00766     {
<a name="l00767"></a>00767       <span class="keywordflow">if</span> (f_status == 202)
<a name="l00768"></a>00768         {
<a name="l00769"></a>00769           hdunum = -1;
<a name="l00770"></a>00770           f_status = 0;
<a name="l00771"></a>00771         }
<a name="l00772"></a>00772       <span class="keywordflow">else</span>
<a name="l00773"></a>00773         {
<a name="l00774"></a>00774           ffrprt (stderr, f_status);
<a name="l00775"></a>00775           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00776"></a>00776                        <span class="stringliteral">&quot;get_ID_index_to_SPC: Error getting index keyword %s &quot;</span>,
<a name="l00777"></a>00777                        ID);
<a name="l00778"></a>00778         }
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781   fits_close_file (input, &amp;f_status);
<a name="l00782"></a>00782   <span class="keywordflow">if</span> (f_status)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00785"></a>00785                    <span class="stringliteral">&quot;get_ID_index_to_SPC: Error closing file: %s &quot;</span>,
<a name="l00786"></a>00786                    filename);
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788   
<a name="l00789"></a>00789   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) hdunum;
<a name="l00790"></a>00790 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4a3cfebfb9e8d0b9e17e8f87ab3a59e2"></a><!-- doxytag: member="spc_spc.h::get_SPC_colnum" ref="a4a3cfebfb9e8d0b9e17e8f87ab3a59e2" args="(fitsfile *input, char colname[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_SPC_colnum </td>
          <td>(</td>
          <td class="paramtype">fitsfile *&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>colname</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: get_SPC_colnum A helper function which returns the collumn number of the column matching a given name. Function fails if collumn is not found.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>input</em>&nbsp;</td><td>- a pointer to an opened FITS binary table </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>colname</em>&nbsp;</td><td>- the name of the desired column</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>colnum - the number of the column. </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00807"></a>00807 {
<a name="l00808"></a>00808   <span class="keywordtype">int</span> colnum, f_status = 0;
<a name="l00809"></a>00809   
<a name="l00810"></a>00810   fits_get_colnum (input, CASEINSEN, colname, &amp;colnum, &amp;f_status);
<a name="l00811"></a>00811 <span class="preprocessor">#ifdef SPCDEBUG</span>
<a name="l00812"></a>00812 <span class="preprocessor"></span>  fprintf (stderr, <span class="stringliteral">&quot;get_SPC_colnum: colum of %s is %d\n&quot;</span>, colname, colnum);
<a name="l00813"></a>00813 <span class="preprocessor">#endif</span>
<a name="l00814"></a>00814 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (f_status)
<a name="l00815"></a>00815     {
<a name="l00816"></a>00816       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00817"></a>00817                    <span class="stringliteral">&quot;get_SPC_colnum: Could not find collumn %s &quot;</span>,
<a name="l00818"></a>00818                    colname);
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821   <span class="keywordflow">return</span> colnum;
<a name="l00822"></a>00822 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9792a9c98d3cfae195b45055127a7af7"></a><!-- doxytag: member="spc_spc.h::subtract_spectra" ref="a9792a9c98d3cfae195b45055127a7af7" args="(spectrum *a, spectrum *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspectrum.html">spectrum</a>* subtract_spectra </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: subtract_spectra Subtract one <a class="el" href="structspectrum.html">spectrum</a> form sa second one</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>- the original <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>- the <a class="el" href="structspectrum.html">spectrum</a> to subtract</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>- the subtracted <a class="el" href="structspectrum.html">spectrum</a> </td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00128"></a>00128 {
<a name="l00129"></a>00129   <span class="keywordtype">int</span> i;
<a name="l00130"></a>00130   <a class="code" href="structspectrum.html">spectrum</a> *res;
<a name="l00131"></a>00131   <span class="keywordtype">double</span> alignement;
<a name="l00132"></a>00132   
<a name="l00133"></a>00133   <span class="keywordflow">if</span> ( (a==NULL) || (b==NULL) )
<a name="l00134"></a>00134     {
<a name="l00135"></a>00135       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a3f3c2d017ceaf0b51cfb71efbcaeff44">aXe_M_WARN4</a>, __FILE__, __LINE__,
<a name="l00136"></a>00136                    <span class="stringliteral">&quot;subtract_spectra: spectra empty.&quot;</span>);
<a name="l00137"></a>00137       <span class="keywordflow">return</span> NULL;
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139   
<a name="l00140"></a>00140   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> != b-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>)
<a name="l00141"></a>00141     {
<a name="l00142"></a>00142       fprintf (stderr, <span class="stringliteral">&quot;%d %d\n&quot;</span>, a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>, b-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l00143"></a>00143       <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00144"></a>00144                    <span class="stringliteral">&quot;subtract_spectra: spectra not aligned.&quot;</span>);
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146   
<a name="l00147"></a>00147   <span class="comment">/* Allocate new spectrum */</span>
<a name="l00148"></a>00148   res = <a class="code" href="spc__spc_8c.html#a2b7693a22a9e1b6d287465b8bff189de">allocate_spectrum</a> (a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>);
<a name="l00149"></a>00149   
<a name="l00150"></a>00150   <span class="keywordflow">for</span> (i = 0; i &lt; a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; i++)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (isnan (a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>))
<a name="l00153"></a>00153         {
<a name="l00154"></a>00154           <span class="keywordflow">continue</span>;
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (isnan (b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>))
<a name="l00157"></a>00157         {
<a name="l00158"></a>00158           <span class="keywordflow">continue</span>;
<a name="l00159"></a>00159         }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161       <span class="comment">// compute the difference between</span>
<a name="l00162"></a>00162       <span class="comment">// the wavelength in the object and</span>
<a name="l00163"></a>00163       <span class="comment">// the background spectral element</span>
<a name="l00164"></a>00164       alignement= (a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a> - b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>)
<a name="l00165"></a>00165         / a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167       <span class="comment">// check whether the alignement is OK</span>
<a name="l00168"></a>00168       if (alignement &gt; <a class="code" href="spc__spc_8h.html#af61a1a0b448a3583ed18f5a34076b974">SPCTOL</a>)
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170           { 
<a name="l00171"></a>00171             <span class="keywordtype">int</span> j;
<a name="l00172"></a>00172             <span class="keywordflow">for</span> (j=0; j&lt;a-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; j++)
<a name="l00173"></a>00173               fprintf(stderr,<span class="stringliteral">&quot;%f %f\n&quot;</span>,a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[j].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>,b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[j].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>);
<a name="l00174"></a>00174           }
<a name="l00175"></a>00175           fprintf (stderr, <span class="stringliteral">&quot;lambda: %f %f; misalignement: %f\n&quot;</span>, a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>,
<a name="l00176"></a>00176                    b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>, alignement);
<a name="l00177"></a>00177           <a class="code" href="aXe__errors_8c.html#a7ef7588e5f91237ba7ce4084e6ed3c11">aXe_message</a> (<a class="code" href="aXe__errors_8h.html#a2556a67874555249b07691c37aa6d6e9">aXe_M_FATAL</a>, __FILE__, __LINE__,
<a name="l00178"></a>00178                        <span class="stringliteral">&quot;subtract_spectra: spectra not aligned.&quot;</span>);
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l00181"></a>00181       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a>;
<a name="l00182"></a>00182       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a> - b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>;
<a name="l00183"></a>00183       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a> =
<a name="l00184"></a>00184         sqrt (pow (a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>, 2) + pow (b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>, 2));
<a name="l00185"></a>00185       
<a name="l00186"></a>00186       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a> - b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ab9baf671046970b64bc5e209815ef3ba">flux</a>;
<a name="l00187"></a>00187       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a> =
<a name="l00188"></a>00188         sqrt (pow (a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a>, 2) +
<a name="l00189"></a>00189               pow (b-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a68d27286e09aa4efa3acc087b171c125">ferror</a>, 2));
<a name="l00190"></a>00190       
<a name="l00191"></a>00191       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>;
<a name="l00192"></a>00192       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a>;
<a name="l00193"></a>00193       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a>;
<a name="l00194"></a>00194       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a>;
<a name="l00195"></a>00195       res-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a> = a-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a>;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197   <span class="keywordflow">return</span> res;
<a name="l00198"></a>00198 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b09e9e958c00c75f26933bac7d0ffe8"></a><!-- doxytag: member="spc_spc.h::trim_spectrum" ref="a3b09e9e958c00c75f26933bac7d0ffe8" args="(spectrum *spc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspectrum.html">spectrum</a>* trim_spectrum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspectrum.html">spectrum</a> *&nbsp;</td>
          <td class="paramname"> <em>spc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function: trim_spectrum A function which trims the beginning and ending INDEF values out of a <a class="el" href="structspectrum.html">spectrum</a> structure (left by the bin_naive routine. The <a class="el" href="structspectrum.html">spectrum</a> is replace in place.</p>
<p>Parameters: </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spc</em>&nbsp;</td><td>- a pointer to an existing <a class="el" href="structspectrum.html">spectrum</a> structure</td></tr>
  </table>
  </dd>
</dl>
<p>Returns: new_spc - pointer to a trimmed <a class="el" href="structspectrum.html">spectrum</a> structure </p>

<p><div class="fragment"><pre class="fragment"><a name="l01578"></a>01578 {
<a name="l01579"></a>01579   <span class="keywordtype">int</span> i, is = 0, ie = 0;
<a name="l01580"></a>01580   <a class="code" href="structspectrum.html">spectrum</a> *new_spc;
<a name="l01581"></a>01581 
<a name="l01582"></a>01582   <span class="comment">//fprintf(stderr,&quot;here\n&quot;);</span>
<a name="l01583"></a>01583   <span class="keywordflow">for</span> (i = 0; i &lt; spc-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a>; i++)
<a name="l01584"></a>01584     {
<a name="l01585"></a>01585       <span class="keywordflow">if</span> (!(isnan (spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>)))
<a name="l01586"></a>01586         {
<a name="l01587"></a>01587           is = i;       <span class="comment">/* Beginning of data found */</span>
<a name="l01588"></a>01588           <span class="keywordflow">break</span>;
<a name="l01589"></a>01589         }
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591   <span class="comment">//fprintf(stderr,&quot;here2\n&quot;);</span>
<a name="l01592"></a>01592   
<a name="l01593"></a>01593   <span class="keywordflow">for</span> (i = spc-&gt;<a class="code" href="structspectrum.html#a7f1df316451ab775f47013bc7c556f08">spec_len</a> - 1; i &gt;= 0; i--)
<a name="l01594"></a>01594     {
<a name="l01595"></a>01595       <span class="keywordflow">if</span> (!(isnan (spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>)))
<a name="l01596"></a>01596         {
<a name="l01597"></a>01597           ie = i;       <span class="comment">/* End of data found */</span>
<a name="l01598"></a>01598           <span class="keywordflow">break</span>;
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601   <span class="comment">//fprintf(stderr,&quot;old length: %d\n&quot;,spc-&gt;spec_len);</span>
<a name="l01602"></a>01602   <span class="comment">//fprintf(stderr,&quot;Begin at: %d, end at %d\n&quot;,is,ie);</span>
<a name="l01603"></a>01603 
<a name="l01604"></a>01604   <span class="comment">/* Allocate new spectrum structure and transfer content from</span>
<a name="l01605"></a>01605 <span class="comment">     the old one into it. */</span>
<a name="l01606"></a>01606   new_spc = <a class="code" href="spc__spc_8c.html#a2b7693a22a9e1b6d287465b8bff189de">allocate_spectrum</a> (ie - is + 1);
<a name="l01607"></a>01607   <span class="keywordflow">for</span> (i = is; i &lt;= ie; i++)
<a name="l01608"></a>01608     {
<a name="l01609"></a>01609       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#afabeeb9b94d4d47d65ade75c6ff82adc">lambda_mean</a>;
<a name="l01610"></a>01610       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a97f46ece62a58b05548668058ec97fb7">dlambda</a>;
<a name="l01611"></a>01611       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a834d349c0cc41820b2435c394a23b9b5">lambda_min</a>;
<a name="l01612"></a>01612       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#ad03114ac70ff73ea0fb8d5d1d36e991e">lambda_max</a>;
<a name="l01613"></a>01613       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#aa00854ac87415f7a7ce9f06018cecfe7">error</a>;
<a name="l01614"></a>01614       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a80b739cd679fdd22fc316f86a210614b">count</a>;
<a name="l01615"></a>01615       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#abb44f7d3d364666f7e64850cc1d05375">weight</a>;
<a name="l01616"></a>01616       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a8f512d7d02cbdceb5ef45430bec817ca">contam</a>;
<a name="l01617"></a>01617       new_spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i - is].<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a> = spc-&gt;<a class="code" href="structspectrum.html#a12640df5c0e35a9a377291dd11022bcf">spec</a>[i].<a class="code" href="structspc__entry.html#a031bf569d78d78e605e1f84ac1e64cb9">dq</a>;
<a name="l01618"></a>01618       
<a name="l01619"></a>01619     }
<a name="l01620"></a>01620   new_spc-&gt;<a class="code" href="structspectrum.html#a9db80753621188168361c845f8c2bd9a">warning</a> = spc-&gt;<a class="code" href="structspectrum.html#a9db80753621188168361c845f8c2bd9a">warning</a>;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622   <span class="comment">//fprintf(stderr,&quot;new length: %d\n&quot;,new_spc-&gt;spec_len);</span>
<a name="l01623"></a>01623   
<a name="l01624"></a>01624   <span class="keywordflow">return</span> new_spc;
<a name="l01625"></a>01625 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2014 for TIPS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
